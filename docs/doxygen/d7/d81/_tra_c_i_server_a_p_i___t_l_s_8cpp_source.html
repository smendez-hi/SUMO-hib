<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: TraCIServerAPI_TLS.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_321e1e012996dae673e7b6b67cce78a7.html">traci-server</a>
  </div>
</div>
<div class="contents">
<h1>TraCIServerAPI_TLS.cpp</h1><a href="../../d7/d81/_tra_c_i_server_a_p_i___t_l_s_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00009"></a>00009 <span class="comment">// APIs for getting/setting traffic light values via TraCI</span>
<a name="l00010"></a>00010 <span class="comment">/****************************************************************************/</span>
<a name="l00011"></a>00011 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00012"></a>00012 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00013"></a>00013 <span class="comment">/****************************************************************************/</span>
<a name="l00014"></a>00014 <span class="comment">//</span>
<a name="l00015"></a>00015 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00016"></a>00016 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00017"></a>00017 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00018"></a>00018 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00019"></a>00019 <span class="comment">//   (at your option) any later version.</span>
<a name="l00020"></a>00020 <span class="comment">//</span>
<a name="l00021"></a>00021 <span class="comment">/****************************************************************************/</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="comment">// ===========================================================================</span>
<a name="l00025"></a>00025 <span class="comment">// included modules</span>
<a name="l00026"></a>00026 <span class="comment">// ===========================================================================</span>
<a name="l00027"></a>00027 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00028"></a>00028 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#else</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#endif</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html">TraCIConstants.h</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/df9/_m_s_t_l_logic_control_8h.html">microsim/traffic_lights/MSTLLogicControl.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d38/_m_s_lane_8h.html">microsim/MSLane.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/d90/_tra_c_i_server_a_p_i___t_l_s_8h.html">TraCIServerAPI_TLS.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span>
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="comment">// ===========================================================================</span>
<a name="l00044"></a>00044 <span class="comment">// used namespaces</span>
<a name="l00045"></a>00045 <span class="comment">// ===========================================================================</span>
<a name="l00046"></a>00046 <span class="keyword">using namespace </span>traci;
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="comment">// ===========================================================================</span>
<a name="l00050"></a>00050 <span class="comment">// method definitions</span>
<a name="l00051"></a>00051 <span class="comment">// ===========================================================================</span>
<a name="l00052"></a>00052 <span class="keywordtype">bool</span>
<a name="l00053"></a><a class="code" href="../../df/d9a/class_tra_c_i_server_a_p_i___t_l_s.html#aeb16b2b36b53820effd2b600e835ecdc">00053</a> <a class="code" href="../../df/d9a/class_tra_c_i_server_a_p_i___t_l_s.html#aeb16b2b36b53820effd2b600e835ecdc" title="Processes a get value command (Command 0xa2: Get Traffic Lights Variable).">TraCIServerAPI_TLS::processGet</a>(<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html">TraCIServer</a>&amp; server, tcpip::Storage&amp; inputStorage,
<a name="l00054"></a>00054                                tcpip::Storage&amp; outputStorage) {
<a name="l00055"></a>00055     std::string warning = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// additional description for response</span>
<a name="l00056"></a>00056     <span class="comment">// variable &amp; id</span>
<a name="l00057"></a>00057     <span class="keywordtype">int</span> variable = inputStorage.readUnsignedByte();
<a name="l00058"></a>00058     std::string <span class="keywordtype">id</span> = inputStorage.readString();
<a name="l00059"></a>00059     <span class="comment">// check variable</span>
<a name="l00060"></a>00060     <span class="keywordflow">if</span> (variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a28687ff0fca27086bca2dfb0c0aa8708">ID_LIST</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a8023e019a18d24881b8780aef047b455">TL_RED_YELLOW_GREEN_STATE</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#abae7b714231e81de94e1024f9f41a75b">TL_COMPLETE_DEFINITION_RYG</a>
<a name="l00061"></a>00061             &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a2e60c8a6b44d8d40ad51c65ab95b3e9e">TL_CONTROLLED_LANES</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a7eb603191d4446e7cf87c2356be3448e">TL_CONTROLLED_LINKS</a>
<a name="l00062"></a>00062             &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#aaf461fd64ac182b47c025f6f78af23e8">TL_CURRENT_PHASE</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a9224116e351cb230398e837841fac367">TL_CURRENT_PROGRAM</a>
<a name="l00063"></a>00063             &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#acee0a296326d46d40c9b97667dc2aff3">TL_NEXT_SWITCH</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#aac7f12ef78085882c4fd0a2b5dd0d359">TL_PHASE_DURATION</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a10ef5e45606c2977dd1eaf386f5d3de6">ID_COUNT</a>) {
<a name="l00064"></a>00064         server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a23a5713b2efa147f104b003c10d07ac6">CMD_GET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;Get TLS Variable: unsupported variable specified&quot;</span>, outputStorage);
<a name="l00065"></a>00065         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00066"></a>00066     }
<a name="l00067"></a>00067     <span class="comment">// begin response building</span>
<a name="l00068"></a>00068     tcpip::Storage tempMsg;
<a name="l00069"></a>00069     <span class="comment">//  response-code, variableID, objectID</span>
<a name="l00070"></a>00070     tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#ab9a720c867f40272e532baba3fe1d503">RESPONSE_GET_TL_VARIABLE</a>);
<a name="l00071"></a>00071     tempMsg.writeUnsignedByte(variable);
<a name="l00072"></a>00072     tempMsg.writeString(<span class="keywordtype">id</span>);
<a name="l00073"></a>00073     <span class="keywordflow">if</span> (variable == <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a28687ff0fca27086bca2dfb0c0aa8708">ID_LIST</a>) {
<a name="l00074"></a>00074         std::vector&lt;std::string&gt; ids = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a261f742b0134b938dbf7120f3120c2f6" title="Returns the tls logics control.">getTLSControl</a>().<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#abba7c75ae621f4a4b8d45f9c2ca0424a">getAllTLIds</a>();
<a name="l00075"></a>00075         tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5561b6050ea28ec6d322e28848460c17">TYPE_STRINGLIST</a>);
<a name="l00076"></a>00076         tempMsg.writeStringList(ids);
<a name="l00077"></a>00077     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (variable == <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a10ef5e45606c2977dd1eaf386f5d3de6">ID_COUNT</a>) {
<a name="l00078"></a>00078         std::vector&lt;std::string&gt; ids = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a261f742b0134b938dbf7120f3120c2f6" title="Returns the tls logics control.">getTLSControl</a>().<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#abba7c75ae621f4a4b8d45f9c2ca0424a">getAllTLIds</a>();
<a name="l00079"></a>00079         tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00080"></a>00080         tempMsg.writeInt((<span class="keywordtype">int</span>) ids.size());
<a name="l00081"></a>00081     } <span class="keywordflow">else</span> {
<a name="l00082"></a>00082         <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a261f742b0134b938dbf7120f3120c2f6" title="Returns the tls logics control.">getTLSControl</a>().<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ab5047f0dcdf4a838c6d6b646b271c705" title="Returns the information whether the named tls is stored.">knows</a>(<span class="keywordtype">id</span>)) {
<a name="l00083"></a>00083             server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a23a5713b2efa147f104b003c10d07ac6">CMD_GET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;Traffic light &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39; is not known&quot;</span>, outputStorage);
<a name="l00084"></a>00084             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086         <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html" title="Storage for all programs of a single tls.">MSTLLogicControl::TLSLogicVariants</a>&amp; vars = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a261f742b0134b938dbf7120f3120c2f6" title="Returns the tls logics control.">getTLSControl</a>().<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6ae9f71b08e1f7a71a05ceb2c20ca62f" title="Returns the variants of a named tls.">get</a>(<span class="keywordtype">id</span>);
<a name="l00087"></a>00087         <span class="keywordflow">switch</span> (variable) {
<a name="l00088"></a>00088             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a28687ff0fca27086bca2dfb0c0aa8708">ID_LIST</a>:
<a name="l00089"></a>00089                 <span class="keywordflow">break</span>;
<a name="l00090"></a>00090             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a8023e019a18d24881b8780aef047b455">TL_RED_YELLOW_GREEN_STATE</a>: {
<a name="l00091"></a>00091                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>);
<a name="l00092"></a>00092                 std::string state = vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a06670997037f3fb482f271601a852a41" title="Returns the definition of the current phase.">getCurrentPhaseDef</a>().<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ac1a06ef5f493feeb13d574dad17fa032" title="Returns the state within this phase.">getState</a>();
<a name="l00093"></a>00093                 tempMsg.writeString(state);
<a name="l00094"></a>00094             }
<a name="l00095"></a>00095             <span class="keywordflow">break</span>;
<a name="l00096"></a>00096             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#abae7b714231e81de94e1024f9f41a75b">TL_COMPLETE_DEFINITION_RYG</a>: {
<a name="l00097"></a>00097                 std::vector&lt;MSTrafficLightLogic*&gt; logics = vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a28b61684f6dc9e44e4e80ad380023c79">getAllLogics</a>();
<a name="l00098"></a>00098                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5af12da4378875209e0b79bbe6b70e48">TYPE_COMPOUND</a>);
<a name="l00099"></a>00099                 tcpip::Storage tempContent;
<a name="l00100"></a>00100                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cnt = 0;
<a name="l00101"></a>00101                 tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00102"></a>00102                 tempContent.writeInt((<span class="keywordtype">int</span>) logics.size());
<a name="l00103"></a>00103                 ++cnt;
<a name="l00104"></a>00104                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; logics.size(); ++i) {
<a name="l00105"></a>00105                     <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* logic = logics[i];
<a name="l00106"></a>00106                     tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>);
<a name="l00107"></a>00107                     tempContent.writeString(logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#aaed0ae013f012eaf282b6cd1ce904bae" title="Returns this tl-logic&amp;#39;s id.">getProgramID</a>());
<a name="l00108"></a>00108                     ++cnt;
<a name="l00109"></a>00109                     <span class="comment">// type (always 0 by now)</span>
<a name="l00110"></a>00110                     tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00111"></a>00111                     tempContent.writeInt(0);
<a name="l00112"></a>00112                     ++cnt;
<a name="l00113"></a>00113                     <span class="comment">// subparameter (always 0 by now)</span>
<a name="l00114"></a>00114                     tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5af12da4378875209e0b79bbe6b70e48">TYPE_COMPOUND</a>);
<a name="l00115"></a>00115                     tempContent.writeInt(0);
<a name="l00116"></a>00116                     ++cnt;
<a name="l00117"></a>00117                     <span class="comment">// (current) phase index</span>
<a name="l00118"></a>00118                     tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00119"></a>00119                     tempContent.writeInt((<span class="keywordtype">int</span>) logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a6d43c415f080bdc364141b24601e4f6b" title="Returns the current index within the program.">getCurrentPhaseIndex</a>());
<a name="l00120"></a>00120                     ++cnt;
<a name="l00121"></a>00121                     <span class="comment">// phase number</span>
<a name="l00122"></a>00122                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> phaseNo = logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a71e437cf8bbac32df36b8f6ec41b3fb2" title="Returns the number of phases.">getPhaseNumber</a>();
<a name="l00123"></a>00123                     tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00124"></a>00124                     tempContent.writeInt((<span class="keywordtype">int</span>) phaseNo);
<a name="l00125"></a>00125                     ++cnt;
<a name="l00126"></a>00126                     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; phaseNo; ++j) {
<a name="l00127"></a>00127                         <a class="code" href="../../d0/d95/class_m_s_phase_definition.html" title="The definition of a single phase of a tls logic.">MSPhaseDefinition</a> phase = logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(j);
<a name="l00128"></a>00128                         tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00129"></a>00129                         tempContent.writeInt(phase.<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a>);
<a name="l00130"></a>00130                         ++cnt;
<a name="l00131"></a>00131                         tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00132"></a>00132                         tempContent.writeInt(phase.<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#a7d14da785d35027015056a6574724ea8" title="The minimum duration of the phase.">minDuration</a>);
<a name="l00133"></a>00133                         ++cnt; <span class="comment">// not implemented</span>
<a name="l00134"></a>00134                         tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00135"></a>00135                         tempContent.writeInt(phase.<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#a2b19d615d0fdf46e66ceb80c6b460ca1" title="The maximum duration of the phase.">maxDuration</a>);
<a name="l00136"></a>00136                         ++cnt; <span class="comment">// not implemented</span>
<a name="l00137"></a>00137                         <span class="keyword">const</span> std::string&amp; state = phase.<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ac1a06ef5f493feeb13d574dad17fa032" title="Returns the state within this phase.">getState</a>();
<a name="l00138"></a>00138                         <span class="comment">//unsigned int linkNo = (unsigned int)(vars.getActive()-&gt;getLinks().size());</span>
<a name="l00139"></a>00139                         tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>);
<a name="l00140"></a>00140                         tempContent.writeString(state);
<a name="l00141"></a>00141                         ++cnt;
<a name="l00142"></a>00142                     }
<a name="l00143"></a>00143                 }
<a name="l00144"></a>00144                 tempMsg.writeInt((<span class="keywordtype">int</span>) cnt);
<a name="l00145"></a>00145                 tempMsg.writeStorage(tempContent);
<a name="l00146"></a>00146             }
<a name="l00147"></a>00147             <span class="keywordflow">break</span>;
<a name="l00148"></a>00148             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a2e60c8a6b44d8d40ad51c65ab95b3e9e">TL_CONTROLLED_LANES</a>: {
<a name="l00149"></a>00149                 <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a10eb168c280f264faa913fd88f958c58" title="Definition of a list that holds lists of links that do have the same attribute.">MSTrafficLightLogic::LaneVectorVector</a>&amp; lanes = vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a68a47c7cfbc99237d629d0e1788ac268" title="Returns the list of lists of all lanes controlled by this tls.">getLanes</a>();
<a name="l00150"></a>00150                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5561b6050ea28ec6d322e28848460c17">TYPE_STRINGLIST</a>);
<a name="l00151"></a>00151                 std::vector&lt;std::string&gt; laneIDs;
<a name="l00152"></a>00152                 <span class="keywordflow">for</span> (MSTrafficLightLogic::LaneVectorVector::const_iterator i = lanes.begin(); i != lanes.end(); ++i) {
<a name="l00153"></a>00153                     <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a37b19ea86942157d4c464d92d8349b6b" title="Definition of the list of links that participate in this tl-light.">MSTrafficLightLogic::LaneVector</a>&amp; llanes = (*i);
<a name="l00154"></a>00154                     <span class="keywordflow">for</span> (MSTrafficLightLogic::LaneVector::const_iterator j = llanes.begin(); j != llanes.end(); ++j) {
<a name="l00155"></a>00155                         laneIDs.push_back((*j)-&gt;getID());
<a name="l00156"></a>00156                     }
<a name="l00157"></a>00157                 }
<a name="l00158"></a>00158                 tempMsg.writeStringList(laneIDs);
<a name="l00159"></a>00159             }
<a name="l00160"></a>00160             <span class="keywordflow">break</span>;
<a name="l00161"></a>00161             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a7eb603191d4446e7cf87c2356be3448e">TL_CONTROLLED_LINKS</a>: {
<a name="l00162"></a>00162                 <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a10eb168c280f264faa913fd88f958c58" title="Definition of a list that holds lists of links that do have the same attribute.">MSTrafficLightLogic::LaneVectorVector</a>&amp; lanes = vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a68a47c7cfbc99237d629d0e1788ac268" title="Returns the list of lists of all lanes controlled by this tls.">getLanes</a>();
<a name="l00163"></a>00163                 <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#aedd962ec51b90bf2d6590f0c95fbeb9c" title="Definition of a list that holds lists of links that do have the same attribute.">MSTrafficLightLogic::LinkVectorVector</a>&amp; links = vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a36a47f9e5c249d3835955af54db1221f" title="Returns the list of lists of all affected links.">getLinks</a>();
<a name="l00164"></a>00164                 <span class="comment">//</span>
<a name="l00165"></a>00165                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5af12da4378875209e0b79bbe6b70e48">TYPE_COMPOUND</a>);
<a name="l00166"></a>00166                 tcpip::Storage tempContent;
<a name="l00167"></a>00167                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> cnt = 0;
<a name="l00168"></a>00168                 tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00169"></a>00169                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> no = (<span class="keywordtype">unsigned</span> int) lanes.size();
<a name="l00170"></a>00170                 tempContent.writeInt((<span class="keywordtype">int</span>) no);
<a name="l00171"></a>00171                 <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; no; ++i) {
<a name="l00172"></a>00172                     <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a37b19ea86942157d4c464d92d8349b6b" title="Definition of the list of links that participate in this tl-light.">MSTrafficLightLogic::LaneVector</a>&amp; llanes = lanes[i];
<a name="l00173"></a>00173                     <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#aefc18f7ac36df86b0f7d8b6d48503d92" title="Definition of the list of links that participate in this tl-light.">MSTrafficLightLogic::LinkVector</a>&amp; llinks = links[i];
<a name="l00174"></a>00174                     <span class="comment">// number of links controlled by this signal (signal i)</span>
<a name="l00175"></a>00175                     tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00176"></a>00176                     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> no2 = (<span class="keywordtype">unsigned</span> int) llanes.size();
<a name="l00177"></a>00177                     tempContent.writeInt((<span class="keywordtype">int</span>) no2);
<a name="l00178"></a>00178                     ++cnt;
<a name="l00179"></a>00179                     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> j = 0; j &lt; no2; ++j) {
<a name="l00180"></a>00180                         <a class="code" href="../../d3/d2e/class_m_s_link.html">MSLink</a>* link = llinks[j];
<a name="l00181"></a>00181                         std::vector&lt;std::string&gt; def;
<a name="l00182"></a>00182                         <span class="comment">// incoming lane</span>
<a name="l00183"></a>00183                         def.push_back(llanes[j]-&gt;getID());
<a name="l00184"></a>00184                         <span class="comment">// approached non-internal lane (if any)</span>
<a name="l00185"></a>00185                         def.push_back(link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a078289793c9a153caeaa0f73cce012e8" title="Returns the connected lane.">getLane</a>() != 0 ? link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a078289793c9a153caeaa0f73cce012e8" title="Returns the connected lane.">getLane</a>()-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00186"></a>00186                         <span class="comment">// approached &quot;via&quot;, internal lane (if any)</span>
<a name="l00187"></a>00187 <span class="preprocessor">#ifdef HAVE_INTERNAL_LANES</span>
<a name="l00188"></a>00188 <span class="preprocessor"></span>                        def.push_back(link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a4dc53aa035090cd12e7c407540a32ddf" title="Returns the following inner lane.">getViaLane</a>() != 0 ? link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a4dc53aa035090cd12e7c407540a32ddf" title="Returns the following inner lane.">getViaLane</a>()-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00189"></a>00189 <span class="preprocessor">#else</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>                        def.push_back(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00191"></a>00191 <span class="preprocessor">#endif</span>
<a name="l00192"></a>00192 <span class="preprocessor"></span>                        tempContent.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5561b6050ea28ec6d322e28848460c17">TYPE_STRINGLIST</a>);
<a name="l00193"></a>00193                         tempContent.writeStringList(def);
<a name="l00194"></a>00194                         ++cnt;
<a name="l00195"></a>00195                     }
<a name="l00196"></a>00196                 }
<a name="l00197"></a>00197                 tempMsg.writeInt((<span class="keywordtype">int</span>) cnt);
<a name="l00198"></a>00198                 tempMsg.writeStorage(tempContent);
<a name="l00199"></a>00199             }
<a name="l00200"></a>00200             <span class="keywordflow">break</span>;
<a name="l00201"></a>00201             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#aaf461fd64ac182b47c025f6f78af23e8">TL_CURRENT_PHASE</a>:
<a name="l00202"></a>00202                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00203"></a>00203                 tempMsg.writeInt((<span class="keywordtype">int</span>) vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a6d43c415f080bdc364141b24601e4f6b" title="Returns the current index within the program.">getCurrentPhaseIndex</a>());
<a name="l00204"></a>00204                 <span class="keywordflow">break</span>;
<a name="l00205"></a>00205             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a9224116e351cb230398e837841fac367">TL_CURRENT_PROGRAM</a>:
<a name="l00206"></a>00206                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>);
<a name="l00207"></a>00207                 tempMsg.writeString(vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#aaed0ae013f012eaf282b6cd1ce904bae" title="Returns this tl-logic&amp;#39;s id.">getProgramID</a>());
<a name="l00208"></a>00208                 <span class="keywordflow">break</span>;
<a name="l00209"></a>00209             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#aac7f12ef78085882c4fd0a2b5dd0d359">TL_PHASE_DURATION</a>:
<a name="l00210"></a>00210                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00211"></a>00211                 tempMsg.writeInt((<span class="keywordtype">int</span>) vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a06670997037f3fb482f271601a852a41" title="Returns the definition of the current phase.">getCurrentPhaseDef</a>().<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a>);
<a name="l00212"></a>00212                 <span class="keywordflow">break</span>;
<a name="l00213"></a>00213             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#acee0a296326d46d40c9b97667dc2aff3">TL_NEXT_SWITCH</a>:
<a name="l00214"></a>00214                 tempMsg.writeUnsignedByte(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>);
<a name="l00215"></a>00215                 tempMsg.writeInt((<span class="keywordtype">int</span>) vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#af6ccd6102a5566112716c47fd14bc73b" title="Returns the assumed next switch time.">getNextSwitchTime</a>());
<a name="l00216"></a>00216                 <span class="keywordflow">break</span>;
<a name="l00217"></a>00217             <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#addac5c47b0c3f52a08255d079dfb6c82">TL_CONTROLLED_JUNCTIONS</a>: {
<a name="l00218"></a>00218             }
<a name="l00219"></a>00219             <span class="keywordflow">break</span>;
<a name="l00220"></a>00220             <span class="keywordflow">default</span>:
<a name="l00221"></a>00221                 <span class="keywordflow">break</span>;
<a name="l00222"></a>00222         }
<a name="l00223"></a>00223     }
<a name="l00224"></a>00224     server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a23a5713b2efa147f104b003c10d07ac6">CMD_GET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a541fc8755958a227fe412e2df7fa31fa">RTYPE_OK</a>, warning, outputStorage);
<a name="l00225"></a>00225     server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#ad863107695199922e2dace0bbb517f2c">writeResponseWithLength</a>(outputStorage, tempMsg);
<a name="l00226"></a>00226     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00227"></a>00227 }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 <span class="keywordtype">bool</span>
<a name="l00231"></a><a class="code" href="../../df/d9a/class_tra_c_i_server_a_p_i___t_l_s.html#ab1175bd09c1bf69920d01f81ae2e8356">00231</a> <a class="code" href="../../df/d9a/class_tra_c_i_server_a_p_i___t_l_s.html#ab1175bd09c1bf69920d01f81ae2e8356" title="Processes a set value command (Command 0xc2: Change Traffic Lights State).">TraCIServerAPI_TLS::processSet</a>(<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html">TraCIServer</a>&amp; server, tcpip::Storage&amp; inputStorage,
<a name="l00232"></a>00232                                tcpip::Storage&amp; outputStorage) {
<a name="l00233"></a>00233     std::string warning = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">// additional description for response</span>
<a name="l00234"></a>00234     <span class="comment">// variable</span>
<a name="l00235"></a>00235     <span class="keywordtype">int</span> variable = inputStorage.readUnsignedByte();
<a name="l00236"></a>00236     <span class="keywordflow">if</span> (variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#add58d847358637741402c2979fc014ab">TL_PHASE_INDEX</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#af39eae82404a11130f08d21c9d8a84f6">TL_PROGRAM</a>
<a name="l00237"></a>00237             &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#aac7f12ef78085882c4fd0a2b5dd0d359">TL_PHASE_DURATION</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a8023e019a18d24881b8780aef047b455">TL_RED_YELLOW_GREEN_STATE</a> &amp;&amp; variable != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a34b22bed0e5c0ba971a86ab8c56838fc">TL_COMPLETE_PROGRAM_RYG</a>) {
<a name="l00238"></a>00238         server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;Change TLS State: unsupported variable specified&quot;</span>, outputStorage);
<a name="l00239"></a>00239         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00240"></a>00240     }
<a name="l00241"></a>00241     std::string <span class="keywordtype">id</span> = inputStorage.readString();
<a name="l00242"></a>00242     <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getTLSControl().knows(<span class="keywordtype">id</span>)) {
<a name="l00243"></a>00243         server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;Traffic light &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39; is not known&quot;</span>, outputStorage);
<a name="l00244"></a>00244         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>&amp; tlsControl = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a261f742b0134b938dbf7120f3120c2f6" title="Returns the tls logics control.">getTLSControl</a>();
<a name="l00247"></a>00247     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> cTime = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l00248"></a>00248     <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html" title="Storage for all programs of a single tls.">MSTLLogicControl::TLSLogicVariants</a>&amp; vars = tlsControl.<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6ae9f71b08e1f7a71a05ceb2c20ca62f" title="Returns the variants of a named tls.">get</a>(<span class="keywordtype">id</span>);
<a name="l00249"></a>00249     <span class="keywordtype">int</span> valueDataType = inputStorage.readUnsignedByte();
<a name="l00250"></a>00250     <span class="keywordflow">switch</span> (variable) {
<a name="l00251"></a>00251         <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#add58d847358637741402c2979fc014ab">TL_PHASE_INDEX</a>: {
<a name="l00252"></a>00252             <span class="keywordflow">if</span> (valueDataType != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00253"></a>00253                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;The phase index must be given as an integer.&quot;</span>, outputStorage);
<a name="l00254"></a>00254                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00255"></a>00255             }
<a name="l00256"></a>00256             <span class="keywordtype">int</span> index = inputStorage.readInt();
<a name="l00257"></a>00257             <span class="keywordflow">if</span> (index &lt; 0 || vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a71e437cf8bbac32df36b8f6ec41b3fb2" title="Returns the number of phases.">getPhaseNumber</a>() &lt;= (<span class="keywordtype">unsigned</span> int)index) {
<a name="l00258"></a>00258                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;The phase index is not in the allowed range.&quot;</span>, outputStorage);
<a name="l00259"></a>00259                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00260"></a>00260             }
<a name="l00261"></a>00261             <span class="keywordtype">int</span> duration = vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(index).<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a>;
<a name="l00262"></a>00262             vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a9b0582ea8abef098a40b12958bf0c508" title="Changes the current phase and her duration.">changeStepAndDuration</a>(tlsControl, cTime, index, duration);
<a name="l00263"></a>00263         }
<a name="l00264"></a>00264         <span class="keywordflow">break</span>;
<a name="l00265"></a>00265         <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#af39eae82404a11130f08d21c9d8a84f6">TL_PROGRAM</a>: {
<a name="l00266"></a>00266             <span class="keywordflow">if</span> (valueDataType != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>) {
<a name="l00267"></a>00267                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;The program must be given as a string.&quot;</span>, outputStorage);
<a name="l00268"></a>00268                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00269"></a>00269             }
<a name="l00270"></a>00270             std::string subID = inputStorage.readString();
<a name="l00271"></a>00271             <span class="keywordflow">try</span> {
<a name="l00272"></a>00272                 vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a15e0d6752531e466fa5a2b35289dc8d0">switchTo</a>(tlsControl, subID);
<a name="l00273"></a>00273             } <span class="keywordflow">catch</span> (<a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>&amp; e) {
<a name="l00274"></a>00274                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, e.what(), outputStorage);
<a name="l00275"></a>00275                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00276"></a>00276             }
<a name="l00277"></a>00277         }
<a name="l00278"></a>00278         <span class="keywordflow">break</span>;
<a name="l00279"></a>00279         <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#aac7f12ef78085882c4fd0a2b5dd0d359">TL_PHASE_DURATION</a>: {
<a name="l00280"></a>00280             <span class="keywordflow">if</span> (valueDataType != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00281"></a>00281                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;The phase duration must be given as an integer.&quot;</span>, outputStorage);
<a name="l00282"></a>00282                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00283"></a>00283             }
<a name="l00284"></a>00284             <span class="keywordtype">int</span> duration = inputStorage.readInt();
<a name="l00285"></a>00285             <span class="keywordtype">int</span> index = vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a6d43c415f080bdc364141b24601e4f6b" title="Returns the current index within the program.">getCurrentPhaseIndex</a>();
<a name="l00286"></a>00286             vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a9b0582ea8abef098a40b12958bf0c508" title="Changes the current phase and her duration.">changeStepAndDuration</a>(tlsControl, cTime, index, duration);
<a name="l00287"></a>00287         }
<a name="l00288"></a>00288         <span class="keywordflow">break</span>;
<a name="l00289"></a>00289         <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a8023e019a18d24881b8780aef047b455">TL_RED_YELLOW_GREEN_STATE</a>: {
<a name="l00290"></a>00290             <span class="keywordflow">if</span> (valueDataType != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>) {
<a name="l00291"></a>00291                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;The phase must be given as a string.&quot;</span>, outputStorage);
<a name="l00292"></a>00292                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00293"></a>00293             }
<a name="l00294"></a>00294             <span class="comment">// build only once...</span>
<a name="l00295"></a>00295             std::string state = inputStorage.readString();
<a name="l00296"></a>00296             <span class="keywordflow">if</span> (vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a17013afd6c1288175334fd0309d629d2">getLogic</a>(<span class="stringliteral">&quot;online&quot;</span>) == 0) {
<a name="l00297"></a>00297                 <a class="code" href="../../d0/d95/class_m_s_phase_definition.html" title="The definition of a single phase of a tls logic.">MSPhaseDefinition</a>* phase = <span class="keyword">new</span> <a class="code" href="../../d0/d95/class_m_s_phase_definition.html" title="The definition of a single phase of a tls logic.">MSPhaseDefinition</a>(<a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>, state);
<a name="l00298"></a>00298                 std::vector&lt;MSPhaseDefinition*&gt; phases;
<a name="l00299"></a>00299                 phases.push_back(phase);
<a name="l00300"></a>00300                 <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* logic = <span class="keyword">new</span> <a class="code" href="../../d7/d57/class_m_s_simple_traffic_light_logic.html" title="A fixed traffic light logic.">MSSimpleTrafficLightLogic</a>(tlsControl, <span class="keywordtype">id</span>, <span class="stringliteral">&quot;online&quot;</span>, phases, 0, cTime + <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>);
<a name="l00301"></a>00301                 vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a959a0a696ef9e978490473c2c64f4c96" title="Adds a logic (program).">addLogic</a>(<span class="stringliteral">&quot;online&quot;</span>, logic, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00302"></a>00302             } <span class="keywordflow">else</span> {
<a name="l00303"></a>00303                 <a class="code" href="../../d0/d95/class_m_s_phase_definition.html" title="The definition of a single phase of a tls logic.">MSPhaseDefinition</a> nphase(<a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>, state);
<a name="l00304"></a>00304                 *(<span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d57/class_m_s_simple_traffic_light_logic.html" title="A fixed traffic light logic.">MSSimpleTrafficLightLogic</a>*<span class="keyword">&gt;</span>(vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a17013afd6c1288175334fd0309d629d2">getLogic</a>(<span class="stringliteral">&quot;online&quot;</span>))-&gt;getPhases()[0]) = nphase;
<a name="l00305"></a>00305             }
<a name="l00306"></a>00306             <span class="comment">// @note: this assumes logic &quot;online&quot; is still active</span>
<a name="l00307"></a>00307             vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ad70ff883bf33c4770529abefc0d1a40a" title="Applies the current signal states to controlled links.">setTrafficLightSignals</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep());
<a name="l00308"></a>00308             vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ae44b4fe6810a305c8b17bc7d3b05b614">executeOnSwitchActions</a>();
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310         <span class="keywordflow">break</span>;
<a name="l00311"></a>00311         <span class="keywordflow">case</span> <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a34b22bed0e5c0ba971a86ab8c56838fc">TL_COMPLETE_PROGRAM_RYG</a>: {
<a name="l00312"></a>00312             <span class="keywordflow">if</span> (valueDataType != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5af12da4378875209e0b79bbe6b70e48">TYPE_COMPOUND</a>) {
<a name="l00313"></a>00313                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;A compound object is needed for setting a new program.&quot;</span>, outputStorage);
<a name="l00314"></a>00314                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00315"></a>00315             }
<a name="l00316"></a>00316             <span class="comment">//read itemNo</span>
<a name="l00317"></a>00317             inputStorage.readInt();
<a name="l00318"></a>00318             <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>) {
<a name="l00319"></a>00319                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 1. parameter (subid) must be a string.&quot;</span>, outputStorage);
<a name="l00320"></a>00320                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00321"></a>00321             }
<a name="l00322"></a>00322             std::string subid = inputStorage.readString();
<a name="l00323"></a>00323             <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00324"></a>00324                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 2. parameter (type) must be an int.&quot;</span>, outputStorage);
<a name="l00325"></a>00325                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00326"></a>00326             }
<a name="l00327"></a>00327             <span class="comment">//read type</span>
<a name="l00328"></a>00328             inputStorage.readInt();
<a name="l00329"></a>00329             <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a5af12da4378875209e0b79bbe6b70e48">TYPE_COMPOUND</a>) {
<a name="l00330"></a>00330                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 3. parameter (subparams) must be a compound object.&quot;</span>, outputStorage);
<a name="l00331"></a>00331                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00332"></a>00332             }
<a name="l00333"></a>00333             <span class="comment">//read sublength</span>
<a name="l00334"></a>00334             inputStorage.readInt();
<a name="l00335"></a>00335             <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00336"></a>00336                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 4. parameter (index) must be an int.&quot;</span>, outputStorage);
<a name="l00337"></a>00337                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00338"></a>00338             }
<a name="l00339"></a>00339             <span class="keywordtype">int</span> index = inputStorage.readInt();
<a name="l00340"></a>00340             <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00341"></a>00341                 server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 5. parameter (phase number) must be an int.&quot;</span>, outputStorage);
<a name="l00342"></a>00342                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00343"></a>00343             }
<a name="l00344"></a>00344             <span class="keywordtype">int</span> phaseNo = inputStorage.readInt();
<a name="l00345"></a>00345             std::vector&lt;MSPhaseDefinition*&gt; phases;
<a name="l00346"></a>00346             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; phaseNo; ++j) {
<a name="l00347"></a>00347                 <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00348"></a>00348                     server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 6.1. parameter (duration) must be an int.&quot;</span>, outputStorage);
<a name="l00349"></a>00349                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00350"></a>00350                 }
<a name="l00351"></a>00351                 <span class="keywordtype">int</span> duration = inputStorage.readInt();
<a name="l00352"></a>00352                 <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00353"></a>00353                     server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 6.2. parameter (min duration) must be an int.&quot;</span>, outputStorage);
<a name="l00354"></a>00354                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00355"></a>00355                 }
<a name="l00356"></a>00356                 <span class="keywordtype">int</span> minDuration = inputStorage.readInt();
<a name="l00357"></a>00357                 <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a929147425bf7969fe1d0e33716d02bc8">TYPE_INTEGER</a>) {
<a name="l00358"></a>00358                     server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 6.3. parameter (max duration) must be an int.&quot;</span>, outputStorage);
<a name="l00359"></a>00359                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00360"></a>00360                 }
<a name="l00361"></a>00361                 <span class="keywordtype">int</span> maxDuration = inputStorage.readInt();
<a name="l00362"></a>00362                 <span class="keywordflow">if</span> (inputStorage.readUnsignedByte() != <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a4e4e428e3a6a191834e3ff63bd301866">TYPE_STRING</a>) {
<a name="l00363"></a>00363                     server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a43465ba21de31f9ae2573e7ac5f24919">RTYPE_ERR</a>, <span class="stringliteral">&quot;set program: 6.4. parameter (phase) must be a string.&quot;</span>, outputStorage);
<a name="l00364"></a>00364                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00365"></a>00365                 }
<a name="l00366"></a>00366                 std::string state = inputStorage.readString();
<a name="l00367"></a>00367                 <a class="code" href="../../d0/d95/class_m_s_phase_definition.html" title="The definition of a single phase of a tls logic.">MSPhaseDefinition</a>* phase = <span class="keyword">new</span> <a class="code" href="../../d0/d95/class_m_s_phase_definition.html" title="The definition of a single phase of a tls logic.">MSPhaseDefinition</a>(duration, minDuration, maxDuration, state);
<a name="l00368"></a>00368                 phases.push_back(phase);
<a name="l00369"></a>00369             }
<a name="l00370"></a>00370             <span class="keywordflow">if</span> (vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a17013afd6c1288175334fd0309d629d2">getLogic</a>(subid) == 0) {
<a name="l00371"></a>00371                 <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* logic = <span class="keyword">new</span> <a class="code" href="../../d7/d57/class_m_s_simple_traffic_light_logic.html" title="A fixed traffic light logic.">MSSimpleTrafficLightLogic</a>(tlsControl, <span class="keywordtype">id</span>, subid, phases, index, 0);
<a name="l00372"></a>00372                 vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a959a0a696ef9e978490473c2c64f4c96" title="Adds a logic (program).">addLogic</a>(subid, logic, <span class="keyword">true</span>, <span class="keyword">true</span>);
<a name="l00373"></a>00373             } <span class="keywordflow">else</span> {
<a name="l00374"></a>00374                 <span class="keyword">static_cast&lt;</span><a class="code" href="../../d7/d57/class_m_s_simple_traffic_light_logic.html" title="A fixed traffic light logic.">MSSimpleTrafficLightLogic</a>*<span class="keyword">&gt;</span>(vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a17013afd6c1288175334fd0309d629d2">getLogic</a>(subid))-&gt;setPhases(phases);
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376             vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>()-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ad70ff883bf33c4770529abefc0d1a40a" title="Applies the current signal states to controlled links.">setTrafficLightSignals</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep());
<a name="l00377"></a>00377             vars.<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ae44b4fe6810a305c8b17bc7d3b05b614">executeOnSwitchActions</a>();
<a name="l00378"></a>00378         }
<a name="l00379"></a>00379         <span class="keywordflow">break</span>;
<a name="l00380"></a>00380         <span class="keywordflow">default</span>:
<a name="l00381"></a>00381             <span class="keywordflow">break</span>;
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     server.<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a5c45d0ac74428278b8620033422dfbd6">writeStatusCmd</a>(<a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a45d28d5e51861aadcb6628654e5eb216">CMD_SET_TL_VARIABLE</a>, <a class="code" href="../../dd/dba/_tra_c_i_constants_8h.html#a541fc8755958a227fe412e2df7fa31fa">RTYPE_OK</a>, warning, outputStorage);
<a name="l00384"></a>00384     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00385"></a>00385 }
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="comment">/****************************************************************************/</span>
<a name="l00388"></a>00388 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:13 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
