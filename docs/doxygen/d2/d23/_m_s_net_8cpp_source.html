<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: MSNet.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_6b4e825611921d20a66b187b0ee8072c.html">microsim</a>
  </div>
</div>
<div class="contents">
<h1>MSNet.cpp</h1><a href="../../d2/d23/_m_s_net_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00012"></a>00012 <span class="comment">// The simulated network and simulation perfomer</span>
<a name="l00013"></a>00013 <span class="comment">/****************************************************************************/</span>
<a name="l00014"></a>00014 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00015"></a>00015 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00016"></a>00016 <span class="comment">/****************************************************************************/</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00019"></a>00019 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00020"></a>00020 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00021"></a>00021 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00022"></a>00022 <span class="comment">//   (at your option) any later version.</span>
<a name="l00023"></a>00023 <span class="comment">//</span>
<a name="l00024"></a>00024 <span class="comment">/****************************************************************************/</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="comment">// ===========================================================================</span>
<a name="l00028"></a>00028 <span class="comment">// included modules</span>
<a name="l00029"></a>00029 <span class="comment">// ===========================================================================</span>
<a name="l00030"></a>00030 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#else</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#endif</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="preprocessor">#ifdef HAVE_VERSION_H</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;version.h&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;typeinfo&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db4/_util_exceptions_8h.html">utils/common/UtilExceptions.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dfa/_m_s_net_8h.html">MSNet.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/df4/_m_s_person_control_8h.html">MSPersonControl.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d9c/_m_s_edge_control_8h.html">MSEdgeControl.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/d82/_m_s_junction_control_8h.html">MSJunctionControl.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/daf/_m_s_insertion_control_8h.html">MSInsertionControl.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d94/_m_s_event_control_8h.html">MSEventControl.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dea/_m_s_edge_8h.html">MSEdge.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../d8/d61/_m_s_junction_8h.html">MSJunction.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dc8/_m_s_junction_logic_8h.html">MSJunctionLogic.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d38/_m_s_lane_8h.html">MSLane.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/d15/_m_s_vehicle_transfer_8h.html">MSVehicleTransfer.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d24/_m_s_route_8h.html">MSRoute.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d0a/_m_s_route_loader_control_8h.html">MSRouteLoaderControl.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/df9/_m_s_t_l_logic_control_8h.html">traffic_lights/MSTLLogicControl.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d52/_m_s_vehicle_control_8h.html">MSVehicleControl.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/df7/_msg_handler_8h.html">utils/common/MsgHandler.h</a>&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d08/_to_string_8h.html">utils/common/ToString.h</a>&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &lt;<a class="code" href="../../de/de7/_m_s_detector_control_8h.html">microsim/output/MSDetectorControl.h</a>&gt;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &lt;<a class="code" href="../../d9/d15/_m_s_vehicle_transfer_8h.html">microsim/MSVehicleTransfer.h</a>&gt;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d43/_m_s_traffic_light_logic_8h.html">traffic_lights/MSTrafficLightLogic.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &lt;<a class="code" href="../../da/d08/_polygon_8h.html">utils/shapes/Polygon.h</a>&gt;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/df9/_shape_container_8h.html">utils/shapes/ShapeContainer.h</a>&gt;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dec/_m_s_x_m_l_raw_out_8h.html">output/MSXMLRawOut.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &lt;<a class="code" href="../../d1/d3f/_output_device_8h.html">utils/iodevices/OutputDevice.h</a>&gt;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &lt;<a class="code" href="../../db/da5/_sys_utils_8h.html">utils/common/SysUtils.h</a>&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &lt;<a class="code" href="../../df/d2e/_wrapping_command_8h.html">utils/common/WrappingCommand.h</a>&gt;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d5c/_options_cont_8h.html">utils/options/OptionsCont.h</a>&gt;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dbe/_m_s_globals_8h.html">MSGlobals.h</a>&quot;</span>
<a name="l00076"></a>00076 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d6d/_geo_conv_helper_8h.html">utils/geom/GeoConvHelper.h</a>&gt;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;ctime&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db6/_m_s_person_8h.html">MSPerson.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d74/_m_s_edge_weights_storage_8h.html">MSEdgeWeightsStorage.h</a>&quot;</span>
<a name="l00080"></a>00080 
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/d4c/_m_s_message_emitter_8h.html">MSMessageEmitter.h</a>&quot;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#endif</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00086"></a>00086 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00087"></a>00087 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mesosim/MELoop.h&gt;</span>
<a name="l00088"></a>00088 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/da1/_binary_input_device_8h.html">utils/iodevices/BinaryInputDevice.h</a>&gt;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#endif</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span>
<a name="l00091"></a>00091 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/dff/_tra_c_i_server_8h.html">traci-server/TraCIServer.h</a>&gt;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#endif</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span>
<a name="l00095"></a>00095 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00097"></a>00097 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a>00099 
<a name="l00100"></a>00100 <span class="comment">// ===========================================================================</span>
<a name="l00101"></a>00101 <span class="comment">// static member definitions</span>
<a name="l00102"></a>00102 <span class="comment">// ===========================================================================</span>
<a name="l00103"></a>00103 <a class="code" href="../../dc/d5d/class_m_s_net.html" title="The simulated network and simulation perfomer.">MSNet</a>* <a class="code" href="../../dc/d5d/class_m_s_net.html#ad852628863040d3dd65686744b6daee5" title="Unique instance of MSNet.">MSNet::myInstance</a> = 0;
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="comment">// ===========================================================================</span>
<a name="l00107"></a>00107 <span class="comment">// member method definitions</span>
<a name="l00108"></a>00108 <span class="comment">// ===========================================================================</span>
<a name="l00109"></a>00109 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00110"></a>00110 <span class="comment">// MSNet::EdgeWeightsProxi - methods</span>
<a name="l00111"></a>00111 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00112"></a>00112 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>
<a name="l00113"></a><a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#a3898cc0ec65fcd284a1ae1f390d5374c">00113</a> <a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#a3898cc0ec65fcd284a1ae1f390d5374c" title="Returns the effort to pass an edge.">MSNet::EdgeWeightsProxi::getEffort</a>(<span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* <span class="keyword">const</span> e,
<a name="l00114"></a>00114                                    <span class="keyword">const</span> <a class="code" href="../../db/d61/class_s_u_m_o_vehicle.html" title="Representation of a vehicle.">SUMOVehicle</a>* <span class="keyword">const</span> v,
<a name="l00115"></a>00115                                    <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> t)<span class="keyword"> const </span>{
<a name="l00116"></a>00116     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> value;
<a name="l00117"></a>00117     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#a493abf94dbee0d2752cf0df58e2c7054" title="The vehicle&amp;#39;s knownledge.">myVehicleKnowledge</a>.<a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html#aa70bc11a9a1f3dca6fd2d3d5860e5e59" title="Returns an effort for an edge and time if stored.">retrieveExistingEffort</a>(e, v, t, value)) {
<a name="l00118"></a>00118         <span class="keywordflow">return</span> value;
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#a2e07c1102d23a23ff73f203c27d10e6a" title="The global knownledge.">myNetKnowledge</a>.<a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html#aa70bc11a9a1f3dca6fd2d3d5860e5e59" title="Returns an effort for an edge and time if stored.">retrieveExistingEffort</a>(e, v, t, value)) {
<a name="l00121"></a>00121         <span class="keywordflow">return</span> value;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     <span class="keywordflow">return</span> 0;
<a name="l00124"></a>00124 }
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>
<a name="l00128"></a><a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#aa407ea973d857ea6f62a3a10d73c0de9">00128</a> <a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#aa407ea973d857ea6f62a3a10d73c0de9" title="Returns the travel time to pass an edge.">MSNet::EdgeWeightsProxi::getTravelTime</a>(<span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* <span class="keyword">const</span> e,
<a name="l00129"></a>00129                                        <span class="keyword">const</span> <a class="code" href="../../db/d61/class_s_u_m_o_vehicle.html" title="Representation of a vehicle.">SUMOVehicle</a>* <span class="keyword">const</span> v,
<a name="l00130"></a>00130                                        <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> t)<span class="keyword"> const </span>{
<a name="l00131"></a>00131     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> value;
<a name="l00132"></a>00132     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#a493abf94dbee0d2752cf0df58e2c7054" title="The vehicle&amp;#39;s knownledge.">myVehicleKnowledge</a>.<a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html#a1e42d5a68b56af9424a503aaa2c0dab5" title="Returns a travel time for an edge and time if stored.">retrieveExistingTravelTime</a>(e, v, t, value)) {
<a name="l00133"></a>00133         <span class="keywordflow">return</span> value;
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135     <span class="keywordflow">if</span> (<a class="code" href="../../d2/d35/class_m_s_net_1_1_edge_weights_proxi.html#a2e07c1102d23a23ff73f203c27d10e6a" title="The global knownledge.">myNetKnowledge</a>.<a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html#a1e42d5a68b56af9424a503aaa2c0dab5" title="Returns a travel time for an edge and time if stored.">retrieveExistingTravelTime</a>(e, v, t, value)) {
<a name="l00136"></a>00136         <span class="keywordflow">return</span> value;
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138     <span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* <span class="keyword">const</span> l = e-&gt;<a class="code" href="../../d7/d27/class_m_s_edge.html#ac6454be7984c840da4fa48808cf22833" title="Returns this edge&amp;#39;s lanes.">getLanes</a>()[0];
<a name="l00139"></a>00139     <span class="keywordflow">return</span> l-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() / l-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>();
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00145"></a>00145 <span class="comment">// MSNet - methods</span>
<a name="l00146"></a>00146 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00147"></a>00147 <a class="code" href="../../dc/d5d/class_m_s_net.html" title="The simulated network and simulation perfomer.">MSNet</a>*
<a name="l00148"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408">00148</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>(<span class="keywordtype">void</span>) {
<a name="l00149"></a>00149     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#ad852628863040d3dd65686744b6daee5" title="Unique instance of MSNet.">myInstance</a> != 0) {
<a name="l00150"></a>00150         <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#ad852628863040d3dd65686744b6daee5" title="Unique instance of MSNet.">myInstance</a>;
<a name="l00151"></a>00151     }
<a name="l00152"></a>00152     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;A network was not yet constructed.&quot;</span>);
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#ac5efa55d27e0c15c6ac8a1010294b239">00156</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#ac5efa55d27e0c15c6ac8a1010294b239" title="Constructor.">MSNet::MSNet</a>(<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html" title="The class responsible for building and deletion of vehicles.">MSVehicleControl</a>* vc, <a class="code" href="../../d1/dd4/class_m_s_event_control.html" title="Stores time-dependant events and executes them at the proper time.">MSEventControl</a>* beginOfTimestepEvents,
<a name="l00157"></a>00157              <a class="code" href="../../d1/dd4/class_m_s_event_control.html" title="Stores time-dependant events and executes them at the proper time.">MSEventControl</a>* endOfTimestepEvents, <a class="code" href="../../d1/dd4/class_m_s_event_control.html" title="Stores time-dependant events and executes them at the proper time.">MSEventControl</a>* insertionEvents,
<a name="l00158"></a>00158              <a class="code" href="../../d6/d6b/class_shape_container.html" title="Storage for geometrical objects, sorted by the layers they are in.">ShapeContainer</a>* shapeCont) {
<a name="l00159"></a>00159     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#ad852628863040d3dd65686744b6daee5" title="Unique instance of MSNet.">myInstance</a> != 0) {
<a name="l00160"></a>00160         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;A network was already constructed.&quot;</span>);
<a name="l00161"></a>00161     }
<a name="l00162"></a>00162     <a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc = <a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>();
<a name="l00163"></a>00163     <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a> = <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5d22214aa371f87d2d4ff1612411e632">string2time</a>(oc.<a class="code" href="../../db/d31/class_options_cont.html#a52d3421a5d26c2f95b99485de9daa50a" title="Returns the string-value of the named option (only for Option_String).">getString</a>(<span class="stringliteral">&quot;begin&quot;</span>));
<a name="l00164"></a>00164     <a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a> = !oc.<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;no-duration-log&quot;</span>);
<a name="l00165"></a>00165     <a class="code" href="../../dc/d5d/class_m_s_net.html#a4e09f3fb80c012e5aa41d993d097a3d4" title="Information whether the number of the simulation step shall be logged.">myLogStepNumber</a> = !oc.<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;no-step-log&quot;</span>);
<a name="l00166"></a>00166     <a class="code" href="../../dc/d5d/class_m_s_net.html#a6d5ebd0c99a93fb56596e6838293cb89" title="Storage for maximum vehicle number.">myTooManyVehicles</a> = oc.<a class="code" href="../../db/d31/class_options_cont.html#ae244c2df910bcb4cb4d38ee784ee47f9" title="Returns the int-value of the named option (only for Option_Integer).">getInt</a>(<span class="stringliteral">&quot;max-num-vehicles&quot;</span>);
<a name="l00167"></a>00167     <a class="code" href="../../dc/d5d/class_m_s_net.html#adb8745311c4aacd5d7c3140f1aadc56c" title="Controls vehicle insertion;.">myInserter</a> = <span class="keyword">new</span> <a class="code" href="../../d6/d7e/class_m_s_insertion_control.html" title="Inserts vehicles into the network when their departure time is reached.">MSInsertionControl</a>(*vc, <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5d22214aa371f87d2d4ff1612411e632">string2time</a>(oc.<a class="code" href="../../db/d31/class_options_cont.html#a52d3421a5d26c2f95b99485de9daa50a" title="Returns the string-value of the named option (only for Option_String).">getString</a>(<span class="stringliteral">&quot;max-depart-delay&quot;</span>)), oc.<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;sloppy-insert&quot;</span>));
<a name="l00168"></a>00168     <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a> = vc;
<a name="l00169"></a>00169     <a class="code" href="../../dc/d5d/class_m_s_net.html#abfadf2fdf2cc2a2f30f4fddd561f258c" title="Controls detectors;.">myDetectorControl</a> = <span class="keyword">new</span> <a class="code" href="../../d5/d3d/class_m_s_detector_control.html" title="Detectors container; responsible for string and output generation.">MSDetectorControl</a>();
<a name="l00170"></a>00170     <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a> = 0;
<a name="l00171"></a>00171     <a class="code" href="../../dc/d5d/class_m_s_net.html#a2c5fc5113c4414966f1cc72d5a90ba0b" title="Controls junctions, realizes right-of-way rules;.">myJunctions</a> = 0;
<a name="l00172"></a>00172     <a class="code" href="../../dc/d5d/class_m_s_net.html#a50d4ca22b9545ec7c08055092129be22" title="Route loader for dynamic loading of routes.">myRouteLoaders</a> = 0;
<a name="l00173"></a>00173     <a class="code" href="../../dc/d5d/class_m_s_net.html#ab540cd6a35c4c32d917da85513dfd23b" title="Controls tls logics, realizes waiting on tls rules;.">myLogics</a> = 0;
<a name="l00174"></a>00174     <a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a> = 0;
<a name="l00175"></a>00175     <a class="code" href="../../dc/d5d/class_m_s_net.html#ace3a283e1c2dfb4e33f4413d9c2ae586" title="The net&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a> = 0;
<a name="l00176"></a>00176     <a class="code" href="../../dc/d5d/class_m_s_net.html#a31f66cd17256265bd7e17a03b3a0a3c8" title="A container for geometrical shapes;.">myShapeContainer</a> = shapeCont == 0 ? <span class="keyword">new</span> <a class="code" href="../../d6/d6b/class_shape_container.html" title="Storage for geometrical objects, sorted by the layers they are in.">ShapeContainer</a>() : shapeCont;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178     <a class="code" href="../../dc/d5d/class_m_s_net.html#a27713ee1d3b81e67cd82d4e4de8cdc48" title="Controls events executed at the begin of a time step;.">myBeginOfTimestepEvents</a> = beginOfTimestepEvents;
<a name="l00179"></a>00179     <a class="code" href="../../dc/d5d/class_m_s_net.html#a6074fcc7ed238a0d7098b03642556fe6" title="Controls events executed at the end of a time step;.">myEndOfTimestepEvents</a> = endOfTimestepEvents;
<a name="l00180"></a>00180     <a class="code" href="../../dc/d5d/class_m_s_net.html#a4ea21f7e9988b56579694b4f9125ff0a" title="Controls insertion events;.">myInsertionEvents</a> = insertionEvents;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00183"></a>00183 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (MSGlobals::gUseMesoSim) {
<a name="l00184"></a>00184         MSGlobals::gMesoNet = <span class="keyword">new</span> MELoop(<a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5d22214aa371f87d2d4ff1612411e632">string2time</a>(oc.<a class="code" href="../../db/d31/class_options_cont.html#a52d3421a5d26c2f95b99485de9daa50a" title="Returns the string-value of the named option (only for Option_String).">getString</a>(<span class="stringliteral">&quot;meso-recheck&quot;</span>)));
<a name="l00185"></a>00185     }
<a name="l00186"></a>00186 <span class="preprocessor">#endif</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>    <a class="code" href="../../dc/d5d/class_m_s_net.html#ad852628863040d3dd65686744b6daee5" title="Unique instance of MSNet.">myInstance</a> = <span class="keyword">this</span>;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="keywordtype">void</span>
<a name="l00194"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#ac81d5ad9eb1b029c0d06ff2bb8438e5f">00194</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#ac81d5ad9eb1b029c0d06ff2bb8438e5f" title="Closes the network&amp;#39;s building process.">MSNet::closeBuilding</a>(<a class="code" href="../../d2/ddb/class_m_s_edge_control.html" title="Stores edges and lanes, performs moving of vehicle.">MSEdgeControl</a>* edges, <a class="code" href="../../db/dbb/class_m_s_junction_control.html" title="Container for junctions; performs operations on all stored junctions.">MSJunctionControl</a>* junctions,
<a name="l00195"></a>00195                      <a class="code" href="../../de/d20/class_m_s_route_loader_control.html">MSRouteLoaderControl</a>* routeLoaders,
<a name="l00196"></a>00196                      <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>* tlc,
<a name="l00197"></a>00197                      std::vector&lt;SUMOTime&gt; stateDumpTimes,
<a name="l00198"></a>00198                      std::vector&lt;std::string&gt; stateDumpFiles) {
<a name="l00199"></a>00199     <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a> = edges;
<a name="l00200"></a>00200     <a class="code" href="../../dc/d5d/class_m_s_net.html#a2c5fc5113c4414966f1cc72d5a90ba0b" title="Controls junctions, realizes right-of-way rules;.">myJunctions</a> = junctions;
<a name="l00201"></a>00201     <a class="code" href="../../dc/d5d/class_m_s_net.html#a50d4ca22b9545ec7c08055092129be22" title="Route loader for dynamic loading of routes.">myRouteLoaders</a> = routeLoaders;
<a name="l00202"></a>00202     <a class="code" href="../../dc/d5d/class_m_s_net.html#ab540cd6a35c4c32d917da85513dfd23b" title="Controls tls logics, realizes waiting on tls rules;.">myLogics</a> = tlc;
<a name="l00203"></a>00203     <span class="comment">// save the time the network state shall be saved at</span>
<a name="l00204"></a>00204     <a class="code" href="../../dc/d5d/class_m_s_net.html#a9f2b5e981fd3d259650202b1f1786368" title="Times at which a state shall be written.">myStateDumpTimes</a> = stateDumpTimes;
<a name="l00205"></a>00205     <a class="code" href="../../dc/d5d/class_m_s_net.html#aab4332652a23b6b024ad58c39593e9f6" title="The names for the state files.">myStateDumpFiles</a> = stateDumpFiles;
<a name="l00206"></a>00206 
<a name="l00207"></a>00207     <span class="comment">// set requests/responses</span>
<a name="l00208"></a>00208     <a class="code" href="../../dc/d5d/class_m_s_net.html#a2c5fc5113c4414966f1cc72d5a90ba0b" title="Controls junctions, realizes right-of-way rules;.">myJunctions</a>-&gt;<a class="code" href="../../db/dbb/class_m_s_junction_control.html#a5ad6593ec38ab2e81fdec876ebbcc072" title="Closes building of junctions.">postloadInitContainer</a>();
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     <span class="comment">// initialise performance computation</span>
<a name="l00211"></a>00211     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a>) {
<a name="l00212"></a>00212         <a class="code" href="../../dc/d5d/class_m_s_net.html#ae42959216e2ee147422ba66fa5de9eda" title="The overall simulation duration.">mySimBeginMillis</a> = <a class="code" href="../../db/d3b/class_sys_utils.html#aa24f6fd99b57b9331a560c2164040503">SysUtils::getCurrentMillis</a>();
<a name="l00213"></a>00213     }
<a name="l00214"></a>00214 }
<a name="l00215"></a>00215 
<a name="l00216"></a>00216 
<a name="l00217"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#ad2142c0596b3c357559bf36754cf3b7e">00217</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#ad2142c0596b3c357559bf36754cf3b7e" title="Destructor.">MSNet::~MSNet</a>() {
<a name="l00218"></a>00218     <span class="comment">// delete controls</span>
<a name="l00219"></a>00219     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a2c5fc5113c4414966f1cc72d5a90ba0b" title="Controls junctions, realizes right-of-way rules;.">myJunctions</a>;
<a name="l00220"></a>00220     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#abfadf2fdf2cc2a2f30f4fddd561f258c" title="Controls detectors;.">myDetectorControl</a>;
<a name="l00221"></a>00221     <span class="comment">// delete mean data</span>
<a name="l00222"></a>00222     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>;
<a name="l00223"></a>00223     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#adb8745311c4aacd5d7c3140f1aadc56c" title="Controls vehicle insertion;.">myInserter</a>;
<a name="l00224"></a>00224     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#ab540cd6a35c4c32d917da85513dfd23b" title="Controls tls logics, realizes waiting on tls rules;.">myLogics</a>;
<a name="l00225"></a>00225     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a50d4ca22b9545ec7c08055092129be22" title="Route loader for dynamic loading of routes.">myRouteLoaders</a>;
<a name="l00226"></a>00226     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>;
<a name="l00227"></a>00227     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a> != 0) {
<a name="l00228"></a>00228         <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a>;
<a name="l00229"></a>00229     }
<a name="l00230"></a>00230     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a31f66cd17256265bd7e17a03b3a0a3c8" title="A container for geometrical shapes;.">myShapeContainer</a>;
<a name="l00231"></a>00231 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l00232"></a>00232 <span class="preprocessor"></span>    myMsgEmitter.clear();
<a name="l00233"></a>00233     msgEmitVec.clear();
<a name="l00234"></a>00234 <span class="preprocessor">#endif</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (MSGlobals::gUseMesoSim) {
<a name="l00237"></a>00237         <span class="keyword">delete</span> MSGlobals::gMesoNet;
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239 <span class="preprocessor">#endif</span>
<a name="l00240"></a>00240 <span class="preprocessor"></span>    <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a27713ee1d3b81e67cd82d4e4de8cdc48" title="Controls events executed at the begin of a time step;.">myBeginOfTimestepEvents</a>;
<a name="l00241"></a>00241     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a6074fcc7ed238a0d7098b03642556fe6" title="Controls events executed at the end of a time step;.">myEndOfTimestepEvents</a>;
<a name="l00242"></a>00242     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a4ea21f7e9988b56579694b4f9125ff0a" title="Controls insertion events;.">myInsertionEvents</a>;
<a name="l00243"></a>00243     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#ace3a283e1c2dfb4e33f4413d9c2ae586" title="The net&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a>;
<a name="l00244"></a>00244     <a class="code" href="../../dc/d5d/class_m_s_net.html#a75b5c549295dc788851d6b82fcc8ecaa" title="Clears all dictionaries.">clearAll</a>();
<a name="l00245"></a>00245     <a class="code" href="../../dc/d5d/class_m_s_net.html#ad852628863040d3dd65686744b6daee5" title="Unique instance of MSNet.">myInstance</a> = 0;
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="keywordtype">int</span>
<a name="l00250"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a37a1e357d281a8c31cfcff30f3c562ac">00250</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a37a1e357d281a8c31cfcff30f3c562ac" title="Simulates from timestep start to stop.">MSNet::simulate</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> start, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stop) {
<a name="l00251"></a>00251     <span class="comment">// the simulation loop</span>
<a name="l00252"></a>00252     <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7" title="Possible states of a simulation - running or stopped with different reasons.">MSNet::SimulationState</a> state = <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ac91a6b8a1a2a1d96cd6a8895a1808866" title="The simulation is running.">SIMSTATE_RUNNING</a>;
<a name="l00253"></a>00253     <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a> = start;
<a name="l00254"></a>00254 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00255"></a>00255 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_PYTHON</span>
<a name="l00256"></a>00256 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().isSet(<span class="stringliteral">&quot;python-script&quot;</span>)) {
<a name="l00257"></a>00257         traci::TraCIServer::runEmbedded(<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().getString(<span class="stringliteral">&quot;python-script&quot;</span>));
<a name="l00258"></a>00258         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;Simulation End: Script ended&quot;</span>);
<a name="l00259"></a>00259         <a class="code" href="../../dc/d5d/class_m_s_net.html#a507f5a83688e6d1ab1478fe31f5331f3" title="Closes the simulation (all files, connections, etc.).">closeSimulation</a>(start);
<a name="l00260"></a>00260         <span class="keywordflow">return</span> 0;
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262 <span class="preprocessor">#endif</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00264"></a>00264 <span class="preprocessor"></span>    <span class="keywordflow">while</span> (state == <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ac91a6b8a1a2a1d96cd6a8895a1808866" title="The simulation is running.">SIMSTATE_RUNNING</a>) {
<a name="l00265"></a>00265         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a4e09f3fb80c012e5aa41d993d097a3d4" title="Information whether the number of the simulation step shall be logged.">myLogStepNumber</a>) {
<a name="l00266"></a>00266             <a class="code" href="../../dc/d5d/class_m_s_net.html#a6ae3f9779749d193a4f97f914dab17e1" title="Prints the current step number.">preSimStepOutput</a>();
<a name="l00267"></a>00267         }
<a name="l00268"></a>00268         <a class="code" href="../../dc/d5d/class_m_s_net.html#a8b84bf53a83934a9c095067de02336f9" title="Performs a single simulation step.">simulationStep</a>();
<a name="l00269"></a>00269         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a4e09f3fb80c012e5aa41d993d097a3d4" title="Information whether the number of the simulation step shall be logged.">myLogStepNumber</a>) {
<a name="l00270"></a>00270             <a class="code" href="../../dc/d5d/class_m_s_net.html#a66b9a1fe0c8c2ae37592fb17d446f1a3" title="Prints the statistics of the step at its end.">postSimStepOutput</a>();
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272         state = <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ed401851e2b85a8a9448330af7f2e54" title="Called after a simulation step, this method returns the current simulation state...">simulationState</a>(stop);
<a name="l00273"></a>00273 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (state != <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ac91a6b8a1a2a1d96cd6a8895a1808866" title="The simulation is running.">SIMSTATE_RUNNING</a>) {
<a name="l00275"></a>00275             <span class="keywordflow">if</span> (<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().getInt(<span class="stringliteral">&quot;remote-port&quot;</span>) != 0 &amp;&amp; !<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a1f64a107fe270af034e238f598d497c5" title="check whether close was requested">traci::TraCIServer::wasClosed</a>()) {
<a name="l00276"></a>00276                 state = <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ac91a6b8a1a2a1d96cd6a8895a1808866" title="The simulation is running.">SIMSTATE_RUNNING</a>;
<a name="l00277"></a>00277             }
<a name="l00278"></a>00278         }
<a name="l00279"></a>00279 <span class="preprocessor">#endif</span>
<a name="l00280"></a>00280 <span class="preprocessor"></span>    }
<a name="l00281"></a>00281     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;Simulation End: &quot;</span> + <a class="code" href="../../dc/d5d/class_m_s_net.html#a61efa4c34304128de4b9a07440accf27" title="Returns the message to show if a certain state occurs.">getStateMessage</a>(state));
<a name="l00282"></a>00282     <span class="comment">// exit simulation loop</span>
<a name="l00283"></a>00283     <a class="code" href="../../dc/d5d/class_m_s_net.html#a507f5a83688e6d1ab1478fe31f5331f3" title="Closes the simulation (all files, connections, etc.).">closeSimulation</a>(start);
<a name="l00284"></a>00284     <span class="keywordflow">return</span> 0;
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="keywordtype">void</span>
<a name="l00289"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a507f5a83688e6d1ab1478fe31f5331f3">00289</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a507f5a83688e6d1ab1478fe31f5331f3" title="Closes the simulation (all files, connections, etc.).">MSNet::closeSimulation</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> start) {
<a name="l00290"></a>00290     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a>) {
<a name="l00291"></a>00291         <span class="keywordtype">long</span> duration = <a class="code" href="../../db/d3b/class_sys_utils.html#aa24f6fd99b57b9331a560c2164040503">SysUtils::getCurrentMillis</a>() - <a class="code" href="../../dc/d5d/class_m_s_net.html#ae42959216e2ee147422ba66fa5de9eda" title="The overall simulation duration.">mySimBeginMillis</a>;
<a name="l00292"></a>00292         std::ostringstream msg;
<a name="l00293"></a>00293         msg &lt;&lt; <span class="stringliteral">&quot;Performance: &quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; <span class="stringliteral">&quot; Duration: &quot;</span> &lt;&lt; duration &lt;&lt; <span class="stringliteral">&quot; ms&quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00294"></a>00294         <span class="keywordflow">if</span> (duration != 0) {
<a name="l00295"></a>00295             msg &lt;&lt; <span class="stringliteral">&quot; Real time factor: &quot;</span> &lt;&lt; (<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a17e50ddd50517df5a81172d302f7aa70">STEPS2TIME</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a> - start) * 1000. / (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)duration) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00296"></a>00296             msg.setf(std::ios::fixed , std::ios::floatfield);    <span class="comment">// use decimal format</span>
<a name="l00297"></a>00297             msg.setf(std::ios::showpoint);    <span class="comment">// print decimal point</span>
<a name="l00298"></a>00298             msg &lt;&lt; <span class="stringliteral">&quot; UPS: &quot;</span> &lt;&lt; ((<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) <a class="code" href="../../dc/d5d/class_m_s_net.html#a9cef9aa2d7cb783351a83a54a2a9533d" title="The overall number of vehicle movements.">myVehiclesMoved</a> * 1000. / (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) duration) &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00299"></a>00299         }
<a name="l00300"></a>00300         <span class="keyword">const</span> std::string scaleNotice = ((<a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#ac82759700b8268478457076e1fbb29a6" title="Returns the number of build vehicles.">getLoadedVehicleNo</a>() != <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#aafb50a864f606739d04543dc9f6d1224" title="Returns the number of inserted vehicles.">getDepartedVehicleNo</a>()) ?
<a name="l00301"></a>00301                 <span class="stringliteral">&quot; (Loaded: &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#ac82759700b8268478457076e1fbb29a6" title="Returns the number of build vehicles.">getLoadedVehicleNo</a>()) + <span class="stringliteral">&quot;)&quot;</span> : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00302"></a>00302         msg &lt;&lt; <span class="stringliteral">&quot;Vehicles: &quot;</span> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
<a name="l00303"></a>00303             &lt;&lt; <span class="stringliteral">&quot; Emitted: &quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#aafb50a864f606739d04543dc9f6d1224" title="Returns the number of inserted vehicles.">getDepartedVehicleNo</a>() &lt;&lt; scaleNotice &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
<a name="l00304"></a>00304             &lt;&lt; <span class="stringliteral">&quot; Running: &quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a087202ef917faa85a3ee4aa7aba4d759" title="Returns the number of build and inserted, but not yet deleted vehicles.">getRunningVehicleNo</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>
<a name="l00305"></a>00305             &lt;&lt; <span class="stringliteral">&quot; Waiting: &quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#adb8745311c4aacd5d7c3140f1aadc56c" title="Controls vehicle insertion;.">myInserter</a>-&gt;<a class="code" href="../../d6/d7e/class_m_s_insertion_control.html#ac4dee6ae2fdb6931175ee42e4b90a1d3" title="Returns the number of waiting vehicles.">getWaitingVehicleNo</a>() &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00306"></a>00306         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(msg.str());
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308     <a class="code" href="../../dc/d5d/class_m_s_net.html#abfadf2fdf2cc2a2f30f4fddd561f258c" title="Controls detectors;.">myDetectorControl</a>-&gt;<a class="code" href="../../d5/d3d/class_m_s_detector_control.html#a9002dfe8638f5bad3f3903789df17111" title="Closes the detector outputs.">close</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00309"></a>00309 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span>    <a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a9576b589cbb0cd2024530d4a125da539" title="request termination of connection">traci::TraCIServer::close</a>();
<a name="l00311"></a>00311 <span class="preprocessor">#endif</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span>}
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 
<a name="l00315"></a>00315 <span class="keywordtype">void</span>
<a name="l00316"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a8b84bf53a83934a9c095067de02336f9">00316</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a8b84bf53a83934a9c095067de02336f9" title="Performs a single simulation step.">MSNet::simulationStep</a>() {
<a name="l00317"></a>00317 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00318"></a>00318 <span class="preprocessor"></span>    <a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a977df73152d27f94234e07707c02b98a" title="process all commands until a simulation step is wanted">traci::TraCIServer::processCommandsUntilSimStep</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00319"></a>00319 <span class="preprocessor">#endif</span>
<a name="l00320"></a>00320 <span class="preprocessor"></span>    <span class="comment">// execute beginOfTimestepEvents</span>
<a name="l00321"></a>00321     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a>) {
<a name="l00322"></a>00322         <a class="code" href="../../dc/d5d/class_m_s_net.html#a284d9b4f146117720d20c9978f7fed79" title="The last simulation step begin, end and duration.">mySimStepBegin</a> = <a class="code" href="../../db/d3b/class_sys_utils.html#aa24f6fd99b57b9331a560c2164040503">SysUtils::getCurrentMillis</a>();
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00325"></a>00325 <span class="preprocessor"></span>    <span class="comment">// netstate output</span>
<a name="l00326"></a>00326     std::vector&lt;SUMOTime&gt;::iterator timeIt = find(<a class="code" href="../../dc/d5d/class_m_s_net.html#a9f2b5e981fd3d259650202b1f1786368" title="Times at which a state shall be written.">myStateDumpTimes</a>.begin(), <a class="code" href="../../dc/d5d/class_m_s_net.html#a9f2b5e981fd3d259650202b1f1786368" title="Times at which a state shall be written.">myStateDumpTimes</a>.end(), <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00327"></a>00327     <span class="keywordflow">if</span> (timeIt != <a class="code" href="../../dc/d5d/class_m_s_net.html#a9f2b5e981fd3d259650202b1f1786368" title="Times at which a state shall be written.">myStateDumpTimes</a>.end()) {
<a name="l00328"></a>00328         <span class="keyword">const</span> <span class="keywordtype">int</span> dist = distance(<a class="code" href="../../dc/d5d/class_m_s_net.html#a9f2b5e981fd3d259650202b1f1786368" title="Times at which a state shall be written.">myStateDumpTimes</a>.begin(), timeIt);
<a name="l00329"></a>00329         std::ofstream strm(<a class="code" href="../../dc/d5d/class_m_s_net.html#aab4332652a23b6b024ad58c39593e9f6" title="The names for the state files.">myStateDumpFiles</a>[dist].c_str(), std::fstream::out | std::fstream::binary);
<a name="l00330"></a>00330         saveState(strm);
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 <span class="preprocessor">#endif</span>
<a name="l00333"></a>00333 <span class="preprocessor"></span>    <a class="code" href="../../dc/d5d/class_m_s_net.html#a27713ee1d3b81e67cd82d4e4de8cdc48" title="Controls events executed at the begin of a time step;.">myBeginOfTimestepEvents</a>-&gt;<a class="code" href="../../d1/dd4/class_m_s_event_control.html#a19048ff2946aba416bd9767411744e8f" title="Executes time-dependant commands.">execute</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00334"></a>00334     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#ac6266ef6763e950e2bda86c55aac4807">MSGlobals::gCheck4Accidents</a>) {
<a name="l00335"></a>00335         <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#a61c991a9e3e42ccef29e03ddf82be784" title="Detect collisions.">detectCollisions</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00336"></a>00336     }
<a name="l00337"></a>00337     <span class="comment">// check whether the tls programs need to be switched</span>
<a name="l00338"></a>00338     <a class="code" href="../../dc/d5d/class_m_s_net.html#ab540cd6a35c4c32d917da85513dfd23b" title="Controls tls logics, realizes waiting on tls rules;.">myLogics</a>-&gt;<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#abe46edf59985bace57328f0d4dda161e" title="Checks whether any WAUT is trying to switch a tls into another program.">check2Switch</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00339"></a>00339     <span class="comment">// set the signals</span>
<a name="l00340"></a>00340     <a class="code" href="../../dc/d5d/class_m_s_net.html#ab540cd6a35c4c32d917da85513dfd23b" title="Controls tls logics, realizes waiting on tls rules;.">myLogics</a>-&gt;<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a02aa67e250da5c15336cb72a82aadaab" title="Lets all running (current) tls programs apply their current signal states to links...">setTrafficLightSignals</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00343"></a>00343 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (MSGlobals::gUseMesoSim) {
<a name="l00344"></a>00344         MSGlobals::gMesoNet-&gt;simulate(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00345"></a>00345     } <span class="keywordflow">else</span> {
<a name="l00346"></a>00346 <span class="preprocessor">#endif</span>
<a name="l00347"></a>00347 <span class="preprocessor"></span>
<a name="l00348"></a>00348         <span class="comment">// assure all lanes with vehicles are &#39;active&#39;</span>
<a name="l00349"></a>00349         <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#a39c9a5f80bc0175ffd340863b9628b6b" title="Resets information whether a lane is active for all lanes.">patchActiveLanes</a>();
<a name="l00350"></a>00350 
<a name="l00351"></a>00351         <span class="comment">// move vehicles</span>
<a name="l00352"></a>00352         <span class="comment">//  precompute possible positions for vehicles that do interact with</span>
<a name="l00353"></a>00353         <span class="comment">//   their lane&#39;s end</span>
<a name="l00354"></a>00354         <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#aaccaff08ed82a1c347bc9fcd1d355395" title="Moves (precomputes) critical vehicles.">moveCritical</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00355"></a>00355 
<a name="l00356"></a>00356         <span class="comment">// move vehicles which do interact with their lane&#39;s end</span>
<a name="l00357"></a>00357         <span class="comment">//  (it is now known whether they may drive</span>
<a name="l00358"></a>00358         <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#a0d1dd8dce85782742252f44cc9e988d9" title="Really moves critical vehicles.">moveFirst</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00359"></a>00359         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#ac6266ef6763e950e2bda86c55aac4807">MSGlobals::gCheck4Accidents</a>) {
<a name="l00360"></a>00360             <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#a61c991a9e3e42ccef29e03ddf82be784" title="Detect collisions.">detectCollisions</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00361"></a>00361         }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363         <span class="comment">// Vehicles change Lanes (maybe)</span>
<a name="l00364"></a>00364         <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#ae48522a003030b51319ce2942ef459c1" title="Moves (precomputes) critical vehicles.">changeLanes</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#ac6266ef6763e950e2bda86c55aac4807">MSGlobals::gCheck4Accidents</a>) {
<a name="l00367"></a>00367             <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#a61c991a9e3e42ccef29e03ddf82be784" title="Detect collisions.">detectCollisions</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00368"></a>00368         }
<a name="l00369"></a>00369 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00370"></a>00370 <span class="preprocessor"></span>    }
<a name="l00371"></a>00371 <span class="preprocessor">#endif</span>
<a name="l00372"></a>00372 <span class="preprocessor"></span>    <span class="comment">// load routes</span>
<a name="l00373"></a>00373     <a class="code" href="../../dc/d5d/class_m_s_net.html#a50d4ca22b9545ec7c08055092129be22" title="Route loader for dynamic loading of routes.">myRouteLoaders</a>-&gt;<a class="code" href="../../de/d20/class_m_s_route_loader_control.html#a3e2c0cf2c27f6ab37c28558edcbf801f" title="loads the next routes">loadNext</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00374"></a>00374 
<a name="l00375"></a>00375     <span class="comment">// persons</span>
<a name="l00376"></a>00376     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a> != 0) {
<a name="l00377"></a>00377         <a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a>-&gt;<a class="code" href="../../db/d3c/class_m_s_person_control.html#a4c07ab2c2ef21b08294aa75a9099bced" title="checks whether any persons waiting or walking time is over">checkArrivedPersons</a>(<span class="keyword">this</span>, <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379     <span class="comment">// emit Vehicles</span>
<a name="l00380"></a>00380     <a class="code" href="../../dc/d5d/class_m_s_net.html#a4ea21f7e9988b56579694b4f9125ff0a" title="Controls insertion events;.">myInsertionEvents</a>-&gt;<a class="code" href="../../d1/dd4/class_m_s_event_control.html#a19048ff2946aba416bd9767411744e8f" title="Executes time-dependant commands.">execute</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00381"></a>00381     <a class="code" href="../../dc/d5d/class_m_s_net.html#adb8745311c4aacd5d7c3140f1aadc56c" title="Controls vehicle insertion;.">myInserter</a>-&gt;<a class="code" href="../../d6/d7e/class_m_s_insertion_control.html#ab2a5c6ec59f067896fe88e63593f7836" title="Emits vehicles that want to depart at the given time.">emitVehicles</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#ac6266ef6763e950e2bda86c55aac4807">MSGlobals::gCheck4Accidents</a>) {
<a name="l00383"></a>00383         <a class="code" href="../../dc/d5d/class_m_s_net.html#a81fb8e32e65143c2d21731cf9cd6ceab" title="Controls edges, performs vehicle movement;.">myEdges</a>-&gt;<a class="code" href="../../d2/ddb/class_m_s_edge_control.html#a61c991a9e3e42ccef29e03ddf82be784" title="Detect collisions.">detectCollisions</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385     <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSVehicleTransfer::getInstance</a>()-&gt;checkInsertions(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00386"></a>00386 
<a name="l00387"></a>00387     <span class="comment">// execute endOfTimestepEvents</span>
<a name="l00388"></a>00388     <a class="code" href="../../dc/d5d/class_m_s_net.html#a6074fcc7ed238a0d7098b03642556fe6" title="Controls events executed at the end of a time step;.">myEndOfTimestepEvents</a>-&gt;<a class="code" href="../../d1/dd4/class_m_s_event_control.html#a19048ff2946aba416bd9767411744e8f" title="Executes time-dependant commands.">execute</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     <span class="comment">// update and write (if needed) detector values</span>
<a name="l00391"></a>00391     <a class="code" href="../../dc/d5d/class_m_s_net.html#a941971ed20f921e920a9469f37b4f7e4" title="Write netstate, emission and detector output.">writeOutput</a>();
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a>) {
<a name="l00394"></a>00394         <a class="code" href="../../dc/d5d/class_m_s_net.html#a6d5c03f9101fdbd8755f44e198bd1751">mySimStepEnd</a> = <a class="code" href="../../db/d3b/class_sys_utils.html#aa24f6fd99b57b9331a560c2164040503">SysUtils::getCurrentMillis</a>();
<a name="l00395"></a>00395         <a class="code" href="../../dc/d5d/class_m_s_net.html#a5e1ba27154736e3cb08b476d407939ca">mySimStepDuration</a> = <a class="code" href="../../dc/d5d/class_m_s_net.html#a6d5c03f9101fdbd8755f44e198bd1751">mySimStepEnd</a> - <a class="code" href="../../dc/d5d/class_m_s_net.html#a284d9b4f146117720d20c9978f7fed79" title="The last simulation step begin, end and duration.">mySimStepBegin</a>;
<a name="l00396"></a>00396         <a class="code" href="../../dc/d5d/class_m_s_net.html#a9cef9aa2d7cb783351a83a54a2a9533d" title="The overall number of vehicle movements.">myVehiclesMoved</a> += <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a087202ef917faa85a3ee4aa7aba4d759" title="Returns the number of build and inserted, but not yet deleted vehicles.">getRunningVehicleNo</a>();
<a name="l00397"></a>00397     }
<a name="l00398"></a>00398     <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a> += <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>;
<a name="l00399"></a>00399 }
<a name="l00400"></a>00400 
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7" title="Possible states of a simulation - running or stopped with different reasons.">MSNet::SimulationState</a>
<a name="l00403"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a1ed401851e2b85a8a9448330af7f2e54">00403</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ed401851e2b85a8a9448330af7f2e54" title="Called after a simulation step, this method returns the current simulation state...">MSNet::simulationState</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stopTime)<span class="keyword"> const </span>{
<a name="l00404"></a>00404     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a6d5ebd0c99a93fb56596e6838293cb89" title="Storage for maximum vehicle number.">myTooManyVehicles</a> &gt; 0 &amp;&amp; (<span class="keywordtype">int</span>) <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a087202ef917faa85a3ee4aa7aba4d759" title="Returns the number of build and inserted, but not yet deleted vehicles.">getRunningVehicleNo</a>() &gt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a6d5ebd0c99a93fb56596e6838293cb89" title="Storage for maximum vehicle number.">myTooManyVehicles</a>) {
<a name="l00405"></a>00405         <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7a304d90e540364ddfa6a98df71bcd5035" title="The simulation contains too many vehicles (.">SIMSTATE_TOO_MANY_VEHICLES</a>;
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00408"></a>00408 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../dc/d48/classtraci_1_1_tra_c_i_server.html#a1f64a107fe270af034e238f598d497c5" title="check whether close was requested">traci::TraCIServer::wasClosed</a>()) {
<a name="l00409"></a>00409         <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ab8c6b9c758a97352746d4a7d4d7cbd5a" title="The connection to a client was closed by the client.">SIMSTATE_CONNECTION_CLOSED</a>;
<a name="l00410"></a>00410     }
<a name="l00411"></a>00411     <span class="keywordflow">if</span> (stopTime &lt; 0 &amp;&amp; <a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().<a class="code" href="../../db/d31/class_options_cont.html#ae244c2df910bcb4cb4d38ee784ee47f9" title="Returns the int-value of the named option (only for Option_Integer).">getInt</a>(<span class="stringliteral">&quot;remote-port&quot;</span>) == 0) {
<a name="l00412"></a>00412 <span class="preprocessor">#else</span>
<a name="l00413"></a>00413 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (stopTime &lt; 0) {
<a name="l00414"></a>00414 <span class="preprocessor">#endif</span>
<a name="l00415"></a>00415 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a4ea21f7e9988b56579694b4f9125ff0a" title="Controls insertion events;.">myInsertionEvents</a>-&gt;<a class="code" href="../../d1/dd4/class_m_s_event_control.html#a3068bbf3bb21a5a16d3acf100a9af031" title="Returns whether events are in the que.">isEmpty</a>()
<a name="l00416"></a>00416                 &amp;&amp; (<a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a30091ef609eea279becb0bdc4cd2bf8f" title="Returns the number of build vehicles that have not been removed or need to wait for...">getActiveVehicleCount</a>() == 0)
<a name="l00417"></a>00417                 &amp;&amp; (<a class="code" href="../../dc/d5d/class_m_s_net.html#adb8745311c4aacd5d7c3140f1aadc56c" title="Controls vehicle insertion;.">myInserter</a>-&gt;<a class="code" href="../../d6/d7e/class_m_s_insertion_control.html#a8a1a18b017f222622e3002ab666a0b4a" title="Returns the number of flows that are still active.">getPendingFlowCount</a>() == 0)
<a name="l00418"></a>00418                 &amp;&amp; (<a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a> == 0 || !<a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a>-&gt;<a class="code" href="../../db/d3c/class_m_s_person_control.html#a4130c51870d73fcab085b767e62bc0f7" title="checks whether any person is still engaged in walking / stopping">hasPedestrians</a>())) {
<a name="l00419"></a>00419             <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a>) {
<a name="l00420"></a>00420                 <a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a>-&gt;<a class="code" href="../../db/d3c/class_m_s_person_control.html#a5a3759af1236c37aaaa339f88d0f9fff" title="aborts the plan for any person that is still waiting for a ride">abortWaiting</a>();
<a name="l00421"></a>00421             }
<a name="l00422"></a>00422             <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#af0fa3b9c938ade87efa0b6a38da313ca" title="removes any vehicles that are still waiting">abortWaiting</a>();
<a name="l00423"></a>00423             <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7a2baf1ba2d309acecf37b5693967a239c" title="The simulation does not contain further vehicles.">SIMSTATE_NO_FURTHER_VEHICLES</a>;
<a name="l00424"></a>00424         }
<a name="l00425"></a>00425     }
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (stopTime &gt;= 0 &amp;&amp; <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a> &gt;= stopTime) {
<a name="l00427"></a>00427         <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7af96bafea87bcd3b352a4bc4ec1e25e76" title="The final simulation step has been performed.">SIMSTATE_END_STEP_REACHED</a>;
<a name="l00428"></a>00428     }
<a name="l00429"></a>00429     <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ac91a6b8a1a2a1d96cd6a8895a1808866" title="The simulation is running.">SIMSTATE_RUNNING</a>;
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 std::string
<a name="l00434"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a61efa4c34304128de4b9a07440accf27">00434</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a61efa4c34304128de4b9a07440accf27" title="Returns the message to show if a certain state occurs.">MSNet::getStateMessage</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7" title="Possible states of a simulation - running or stopped with different reasons.">MSNet::SimulationState</a> state) {
<a name="l00435"></a>00435     <span class="keywordflow">switch</span> (state) {
<a name="l00436"></a>00436         <span class="keywordflow">case</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ac91a6b8a1a2a1d96cd6a8895a1808866" title="The simulation is running.">MSNet::SIMSTATE_RUNNING</a>:
<a name="l00437"></a>00437             <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00438"></a>00438         <span class="keywordflow">case</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7af96bafea87bcd3b352a4bc4ec1e25e76" title="The final simulation step has been performed.">MSNet::SIMSTATE_END_STEP_REACHED</a>:
<a name="l00439"></a>00439             <span class="keywordflow">return</span> <span class="stringliteral">&quot;The final simulation step has been reached.&quot;</span>;
<a name="l00440"></a>00440         <span class="keywordflow">case</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7a2baf1ba2d309acecf37b5693967a239c" title="The simulation does not contain further vehicles.">MSNet::SIMSTATE_NO_FURTHER_VEHICLES</a>:
<a name="l00441"></a>00441             <span class="keywordflow">return</span> <span class="stringliteral">&quot;All vehicles have left the simulation.&quot;</span>;
<a name="l00442"></a>00442         <span class="keywordflow">case</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7ab8c6b9c758a97352746d4a7d4d7cbd5a" title="The connection to a client was closed by the client.">MSNet::SIMSTATE_CONNECTION_CLOSED</a>:
<a name="l00443"></a>00443             <span class="keywordflow">return</span> <span class="stringliteral">&quot;TraCI requested termination.&quot;</span>;
<a name="l00444"></a>00444         <span class="keywordflow">case</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7aae05de067f4c021a6a6e1cfc0c543f77" title="An error occured during the simulation step.">MSNet::SIMSTATE_ERROR_IN_SIM</a>:
<a name="l00445"></a>00445             <span class="keywordflow">return</span> <span class="stringliteral">&quot;An error occured (see log).&quot;</span>;
<a name="l00446"></a>00446         <span class="keywordflow">case</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a526d4fc9c35b8924a769c5be4ed918f7a304d90e540364ddfa6a98df71bcd5035" title="The simulation contains too many vehicles (.">MSNet::SIMSTATE_TOO_MANY_VEHICLES</a>:
<a name="l00447"></a>00447             <span class="keywordflow">return</span> <span class="stringliteral">&quot;Too many vehicles.&quot;</span>;
<a name="l00448"></a>00448         <span class="keywordflow">default</span>:
<a name="l00449"></a>00449             <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown reason.&quot;</span>;
<a name="l00450"></a>00450     }
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="keywordtype">void</span>
<a name="l00455"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a75b5c549295dc788851d6b82fcc8ecaa">00455</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a75b5c549295dc788851d6b82fcc8ecaa" title="Clears all dictionaries.">MSNet::clearAll</a>() {
<a name="l00456"></a>00456     <span class="comment">// clear container</span>
<a name="l00457"></a>00457     <a class="code" href="../../d7/d27/class_m_s_edge.html#a1a8042740aa6e610bdb56c664d0dbd4b" title="Clears the dictionary.">MSEdge::clear</a>();
<a name="l00458"></a>00458     <a class="code" href="../../d9/d16/class_m_s_lane.html#a418b400ba90e57bb5fd66a0253208c02">MSLane::clear</a>();
<a name="l00459"></a>00459     <a class="code" href="../../de/dd8/class_m_s_route.html#ae9cd87494996ae9ce55e32a5027d62be" title="Clears the dictionary (delete all known routes, too).">MSRoute::clear</a>();
<a name="l00460"></a>00460     <span class="keyword">delete</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSVehicleTransfer::getInstance</a>();
<a name="l00461"></a>00461 }
<a name="l00462"></a>00462 
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a>
<a name="l00465"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943">00465</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">MSNet::getCurrentTimeStep</a>()<span class="keyword"> const </span>{
<a name="l00466"></a>00466     <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>;
<a name="l00467"></a>00467 }
<a name="l00468"></a>00468 
<a name="l00469"></a>00469 
<a name="l00470"></a>00470 <span class="keywordtype">void</span>
<a name="l00471"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a941971ed20f921e920a9469f37b4f7e4">00471</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a941971ed20f921e920a9469f37b4f7e4" title="Write netstate, emission and detector output.">MSNet::writeOutput</a>() {
<a name="l00472"></a>00472     <span class="comment">// update detector values</span>
<a name="l00473"></a>00473     <a class="code" href="../../dc/d5d/class_m_s_net.html#abfadf2fdf2cc2a2f30f4fddd561f258c" title="Controls detectors;.">myDetectorControl</a>-&gt;<a class="code" href="../../d5/d3d/class_m_s_detector_control.html#a83912de47184445293fb27e5c2c4e756" title="Computes detector values.">updateDetectors</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00474"></a>00474     <span class="comment">// check state dumps</span>
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     <span class="comment">/*if (OptionsCont::getOptions().isSet(&quot;netstate-dump-fev&quot;)) {</span>
<a name="l00477"></a>00477 <span class="comment">            MSXMLRawOut::writeFev(OutputDevice::getDeviceByOption(&quot;netstate-dump-fev&quot;), *myEdges, myStep);</span>
<a name="l00478"></a>00478 <span class="comment">    }*/</span><span class="comment">/*</span>
<a name="l00479"></a>00479 <span class="comment">    if (OptionsCont::getOptions().isSet(&quot;netstate-dump&quot;)) {</span>
<a name="l00480"></a>00480 <span class="comment">        MSXMLRawOut::write(OutputDevice::getDeviceByOption(&quot;netstate-dump&quot;), *myEdges, myStep);</span>
<a name="l00481"></a>00481 <span class="comment">    }*/</span>
<a name="l00482"></a>00482     <span class="comment">// emission output</span>
<a name="l00483"></a>00483     <span class="keywordflow">if</span> (<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().isSet(<span class="stringliteral">&quot;summary-output&quot;</span>)) {
<a name="l00484"></a>00484         <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; od = <a class="code" href="../../de/da0/class_output_device.html#a8f99dc2c6fedf48066712a22622298d4" title="Returns the device described by the option.">OutputDevice::getDeviceByOption</a>(<span class="stringliteral">&quot;summary&quot;</span>);
<a name="l00485"></a>00485         od &lt;&lt; <span class="stringliteral">&quot;    &lt;step time=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5bd5c47639f33fda316b4eca62222a21">time2string</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>) &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00486"></a>00486            &lt;&lt; <span class="stringliteral">&quot;loaded=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#ac82759700b8268478457076e1fbb29a6" title="Returns the number of build vehicles.">getLoadedVehicleNo</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00487"></a>00487            &lt;&lt; <span class="stringliteral">&quot;emitted=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#aafb50a864f606739d04543dc9f6d1224" title="Returns the number of inserted vehicles.">getDepartedVehicleNo</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00488"></a>00488            &lt;&lt; <span class="stringliteral">&quot;running=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a087202ef917faa85a3ee4aa7aba4d759" title="Returns the number of build and inserted, but not yet deleted vehicles.">getRunningVehicleNo</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00489"></a>00489            &lt;&lt; <span class="stringliteral">&quot;waiting=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#adb8745311c4aacd5d7c3140f1aadc56c" title="Controls vehicle insertion;.">myInserter</a>-&gt;<a class="code" href="../../d6/d7e/class_m_s_insertion_control.html#ac4dee6ae2fdb6931175ee42e4b90a1d3" title="Returns the number of waiting vehicles.">getWaitingVehicleNo</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00490"></a>00490            &lt;&lt; <span class="stringliteral">&quot;ended=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#ac6f152005f570ff7e7f0925674320312" title="Returns the number of removed vehicles.">getEndedVehicleNo</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00491"></a>00491            &lt;&lt; <span class="stringliteral">&quot;meanWaitingTime=\&quot;&quot;</span>;
<a name="l00492"></a>00492         <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a827abb5e3d36a73507018efa51863532" title="Prints the mean waiting time of vehicles. The mean time vehicles had to wait for...">printMeanWaitingTime</a>(od);
<a name="l00493"></a>00493         od &lt;&lt; <span class="stringliteral">&quot;\&quot; meanTravelTime=\&quot;&quot;</span>;
<a name="l00494"></a>00494         <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a175b05c7c8206ac3517a3fea45dae5a9" title="Returns the mean travel time of vehicles The mean travel time of ended vehicles (-1...">printMeanTravelTime</a>(od);
<a name="l00495"></a>00495         od &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>;
<a name="l00496"></a>00496         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a>) {
<a name="l00497"></a>00497             od &lt;&lt; <span class="stringliteral">&quot;duration=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a5e1ba27154736e3cb08b476d407939ca">mySimStepDuration</a> &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>;
<a name="l00498"></a>00498         }
<a name="l00499"></a>00499         od &lt;&lt; <span class="stringliteral">&quot;/&gt;\n&quot;</span>;
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501     <span class="comment">// write detector values</span>
<a name="l00502"></a>00502     <a class="code" href="../../dc/d5d/class_m_s_net.html#abfadf2fdf2cc2a2f30f4fddd561f258c" title="Controls detectors;.">myDetectorControl</a>-&gt;<a class="code" href="../../d5/d3d/class_m_s_detector_control.html#a03e9499ddc2b3f78e79c317f43bef81f" title="Writes the output to be generated within the given time step.">writeOutput</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a> + <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>, <span class="keyword">false</span>);
<a name="l00503"></a>00503 }
<a name="l00504"></a>00504 
<a name="l00505"></a>00505 
<a name="l00506"></a>00506 <span class="keywordtype">bool</span>
<a name="l00507"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a1775606dd416945cd2f9a2247ffb5dae">00507</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a1775606dd416945cd2f9a2247ffb5dae" title="Returns whether duration shall be logged.">MSNet::logSimulationDuration</a>()<span class="keyword"> const </span>{
<a name="l00508"></a>00508     <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a>;
<a name="l00509"></a>00509 }
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00513"></a>00513 <span class="preprocessor"></span><span class="keywordtype">void</span>
<a name="l00514"></a>00514 MSNet::saveState(std::ostream&amp; os) {
<a name="l00515"></a>00515     <a class="code" href="../../de/d41/class_file_helpers.html#a5e3f31b927ba199d02c7d1bf46f8b448" title="Writes a string binary.">FileHelpers::writeString</a>(os, <a class="code" href="../../db/d16/config_8h.html#a698acb89e1bf5837b33c30ef35c30044">VERSION_STRING</a>);
<a name="l00516"></a>00516     <a class="code" href="../../de/d41/class_file_helpers.html#a8ee53f0e9e18727e06a261e795cfb5ce" title="Writes an unsigned integer binary.">FileHelpers::writeUInt</a>(os, <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>));
<a name="l00517"></a>00517     <a class="code" href="../../de/d41/class_file_helpers.html#a8ee53f0e9e18727e06a261e795cfb5ce" title="Writes an unsigned integer binary.">FileHelpers::writeUInt</a>(os, <span class="keyword">sizeof</span>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>));
<a name="l00518"></a>00518     <a class="code" href="../../de/d41/class_file_helpers.html#a8ee53f0e9e18727e06a261e795cfb5ce" title="Writes an unsigned integer binary.">FileHelpers::writeUInt</a>(os, <a class="code" href="../../d7/d27/class_m_s_edge.html#a54b8eb3a4358e69944b8cbd77d94ceaf" title="Returns the number of edges.">MSEdge::dictSize</a>());
<a name="l00519"></a>00519     <a class="code" href="../../de/d41/class_file_helpers.html#a8ee53f0e9e18727e06a261e795cfb5ce" title="Writes an unsigned integer binary.">FileHelpers::writeUInt</a>(os, <a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00520"></a>00520     MSRoute::dict_saveState(os);
<a name="l00521"></a>00521     <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#af908443d7c94abf0d2c704c8e119d129" title="Loads the state of this control from the given stream.">saveState</a>(os);
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (MSGlobals::gUseMesoSim) {
<a name="l00523"></a>00523         MSGlobals::gMesoNet-&gt;saveState(os);
<a name="l00524"></a>00524     }
<a name="l00525"></a>00525 }
<a name="l00526"></a>00526 
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00529"></a>00529 MSNet::loadState(<a class="code" href="../../d4/d8f/class_binary_input_device.html" title="Encapsulates binary reading operations on a file.">BinaryInputDevice</a>&amp; bis) {
<a name="l00530"></a>00530     std::string version;
<a name="l00531"></a>00531     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sizeT, fpSize, numEdges, step;
<a name="l00532"></a>00532     bis &gt;&gt; version;
<a name="l00533"></a>00533     bis &gt;&gt; sizeT;
<a name="l00534"></a>00534     bis &gt;&gt; fpSize;
<a name="l00535"></a>00535     bis &gt;&gt; numEdges;
<a name="l00536"></a>00536     bis &gt;&gt; step;
<a name="l00537"></a>00537     <span class="keywordflow">if</span> (version != <a class="code" href="../../db/d16/config_8h.html#a698acb89e1bf5837b33c30ef35c30044">VERSION_STRING</a>) {
<a name="l00538"></a>00538         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;State was written with sumo version &quot;</span> + version + <span class="stringliteral">&quot; (present: &quot;</span> + <a class="code" href="../../db/d16/config_8h.html#a698acb89e1bf5837b33c30ef35c30044">VERSION_STRING</a> + <span class="stringliteral">&quot;)!&quot;</span>);
<a name="l00539"></a>00539     }
<a name="l00540"></a>00540     <span class="keywordflow">if</span> (sizeT != <span class="keyword">sizeof</span>(<span class="keywordtype">size_t</span>)) {
<a name="l00541"></a>00541         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;State was written on a different platform (32bit vs. 64bit)!&quot;</span>);
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543     <span class="keywordflow">if</span> (fpSize != <span class="keyword">sizeof</span>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)) {
<a name="l00544"></a>00544         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;State was written with a different precision for SUMOReal!&quot;</span>);
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546     <span class="keywordflow">if</span> (numEdges != <a class="code" href="../../d7/d27/class_m_s_edge.html#a54b8eb3a4358e69944b8cbd77d94ceaf" title="Returns the number of edges.">MSEdge::dictSize</a>()) {
<a name="l00547"></a>00547         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;State was written for a different net!&quot;</span>);
<a name="l00548"></a>00548     }
<a name="l00549"></a>00549     <span class="keyword">const</span> <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> offset = <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5d22214aa371f87d2d4ff1612411e632">string2time</a>(<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().getString(<span class="stringliteral">&quot;load-state.offset&quot;</span>));
<a name="l00550"></a>00550     MSRoute::dict_loadState(bis);
<a name="l00551"></a>00551     <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a3c43251d7124e8e1523d6b654c209f5c" title="Saves the current state into the given stream.">loadState</a>(bis, offset);
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (MSGlobals::gUseMesoSim) {
<a name="l00553"></a>00553         MSGlobals::gMesoNet-&gt;loadState(bis, *<a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>, offset);
<a name="l00554"></a>00554     }
<a name="l00555"></a>00555     <span class="keywordflow">return</span> step;
<a name="l00556"></a>00556 }
<a name="l00557"></a>00557 <span class="preprocessor">#endif</span>
<a name="l00558"></a>00558 <span class="preprocessor"></span>
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <a class="code" href="../../db/d3c/class_m_s_person_control.html">MSPersonControl</a>&amp;
<a name="l00561"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a20498f518473681a3e0e9e570e3bf12d">00561</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a20498f518473681a3e0e9e570e3bf12d" title="Returns the person control.">MSNet::getPersonControl</a>() {
<a name="l00562"></a>00562     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a> == 0) {
<a name="l00563"></a>00563         <a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a> = <span class="keyword">new</span> <a class="code" href="../../db/d3c/class_m_s_person_control.html">MSPersonControl</a>();
<a name="l00564"></a>00564     }
<a name="l00565"></a>00565     <span class="keywordflow">return</span> *<a class="code" href="../../dc/d5d/class_m_s_net.html#ae2cd9296f93d39e5f908a3df2b51651c" title="Controls person building and deletion;.">myPersonControl</a>;
<a name="l00566"></a>00566 }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 <a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html" title="A storage for edge travel times and efforts.">MSEdgeWeightsStorage</a>&amp;
<a name="l00570"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#aaa04419a63edf5d65775969b38d14635">00570</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#aaa04419a63edf5d65775969b38d14635" title="Returns the net&amp;#39;s internal edge travel times/efforts container.">MSNet::getWeightsStorage</a>() {
<a name="l00571"></a>00571     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#ace3a283e1c2dfb4e33f4413d9c2ae586" title="The net&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a> == 0) {
<a name="l00572"></a>00572         <a class="code" href="../../dc/d5d/class_m_s_net.html#ace3a283e1c2dfb4e33f4413d9c2ae586" title="The net&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a> = <span class="keyword">new</span> <a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html" title="A storage for edge travel times and efforts.">MSEdgeWeightsStorage</a>();
<a name="l00573"></a>00573     }
<a name="l00574"></a>00574     <span class="keywordflow">return</span> *<a class="code" href="../../dc/d5d/class_m_s_net.html#ace3a283e1c2dfb4e33f4413d9c2ae586" title="The net&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a>;
<a name="l00575"></a>00575 }
<a name="l00576"></a>00576 
<a name="l00577"></a>00577 
<a name="l00578"></a>00578 <span class="keywordtype">void</span>
<a name="l00579"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a6ae3f9779749d193a4f97f914dab17e1">00579</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a6ae3f9779749d193a4f97f914dab17e1" title="Prints the current step number.">MSNet::preSimStepOutput</a>()<span class="keyword"> const </span>{
<a name="l00580"></a>00580     std::cout &lt;&lt; std::setprecision(<a class="code" href="../../db/d16/config_8h.html#ad0ed926c7f0301dfe775bf3ef2673b92">OUTPUT_ACCURACY</a>);
<a name="l00581"></a>00581     std::cout &lt;&lt; <span class="stringliteral">&quot;Step #&quot;</span> &lt;&lt; <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5bd5c47639f33fda316b4eca62222a21">time2string</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a>);
<a name="l00582"></a>00582 }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 <span class="keywordtype">void</span>
<a name="l00586"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a66b9a1fe0c8c2ae37592fb17d446f1a3">00586</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a66b9a1fe0c8c2ae37592fb17d446f1a3" title="Prints the statistics of the step at its end.">MSNet::postSimStepOutput</a>()<span class="keyword"> const </span>{
<a name="l00587"></a>00587     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a0ad5c939d945f6f1570ee37a334c6dea" title="Information whether the simulation duration shall be logged.">myLogExecutionTime</a>) {
<a name="l00588"></a>00588         std::string msg;
<a name="l00589"></a>00589         std::ostringstream oss;
<a name="l00590"></a>00590         oss.setf(std::ios::fixed , std::ios::floatfield);    <span class="comment">// use decimal format</span>
<a name="l00591"></a>00591         oss.setf(std::ios::showpoint);    <span class="comment">// print decimal point</span>
<a name="l00592"></a>00592         oss &lt;&lt; std::setprecision(<a class="code" href="../../db/d16/config_8h.html#ad0ed926c7f0301dfe775bf3ef2673b92">OUTPUT_ACCURACY</a>);
<a name="l00593"></a>00593         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a5e1ba27154736e3cb08b476d407939ca">mySimStepDuration</a> != 0) {
<a name="l00594"></a>00594             oss &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a5e1ba27154736e3cb08b476d407939ca">mySimStepDuration</a> &lt;&lt; <span class="stringliteral">&quot;ms ~= &quot;</span>
<a name="l00595"></a>00595                 &lt;&lt; (1000. / (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) <a class="code" href="../../dc/d5d/class_m_s_net.html#a5e1ba27154736e3cb08b476d407939ca">mySimStepDuration</a>) &lt;&lt; <span class="stringliteral">&quot;*RT, ~&quot;</span>
<a name="l00596"></a>00596                 &lt;&lt; ((<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a087202ef917faa85a3ee4aa7aba4d759" title="Returns the number of build and inserted, but not yet deleted vehicles.">getRunningVehicleNo</a>() / (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) <a class="code" href="../../dc/d5d/class_m_s_net.html#a5e1ba27154736e3cb08b476d407939ca">mySimStepDuration</a> * 1000.);
<a name="l00597"></a>00597         } <span class="keywordflow">else</span> {
<a name="l00598"></a>00598             oss &lt;&lt; <span class="stringliteral">&quot; (0ms ?*RT. ?&quot;</span>;
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600         oss &lt;&lt; <span class="stringliteral">&quot;UPS, vehicles&quot;</span>
<a name="l00601"></a>00601             &lt;&lt; <span class="stringliteral">&quot; TOT &quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#aafb50a864f606739d04543dc9f6d1224" title="Returns the number of inserted vehicles.">getDepartedVehicleNo</a>()
<a name="l00602"></a>00602             &lt;&lt; <span class="stringliteral">&quot; ACT &quot;</span> &lt;&lt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a71674ff8e40c53541e8d690767c04d7b" title="Controls vehicle building and deletion;.">myVehicleControl</a>-&gt;<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a087202ef917faa85a3ee4aa7aba4d759" title="Returns the number of build and inserted, but not yet deleted vehicles.">getRunningVehicleNo</a>()
<a name="l00603"></a>00603             &lt;&lt; <span class="stringliteral">&quot;)                                              &quot;</span>;
<a name="l00604"></a>00604         msg = oss.str();
<a name="l00605"></a>00605         std::string prev = <span class="stringliteral">&quot;Step #&quot;</span> + <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5bd5c47639f33fda316b4eca62222a21">time2string</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a1ea90aef20ab58bfddd69cdb4fc7989f" title="Current time step.">myStep</a> - <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>);
<a name="l00606"></a>00606         msg = msg.substr(0, 78 - prev.length());
<a name="l00607"></a>00607         std::cout &lt;&lt; msg;
<a name="l00608"></a>00608     }
<a name="l00609"></a>00609     std::cout &lt;&lt; (char) 13;
<a name="l00610"></a>00610 }
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="keywordtype">void</span>
<a name="l00614"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a9812cb65739225e06b41764bdc1c56d9">00614</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a9812cb65739225e06b41764bdc1c56d9" title="Adds a vehicle states listener.">MSNet::addVehicleStateListener</a>(<a class="code" href="../../dc/dd1/class_m_s_net_1_1_vehicle_state_listener.html" title="Interface for objects listening to vehicle state changes.">VehicleStateListener</a>* listener) {
<a name="l00615"></a>00615     <span class="keywordflow">if</span> (find(<a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.begin(), <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.end(), listener) == <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.end()) {
<a name="l00616"></a>00616         <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.push_back(listener);
<a name="l00617"></a>00617     }
<a name="l00618"></a>00618 }
<a name="l00619"></a>00619 
<a name="l00620"></a>00620 
<a name="l00621"></a>00621 <span class="keywordtype">void</span>
<a name="l00622"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a0e27d7798c482f3b1694623a9b088798">00622</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a0e27d7798c482f3b1694623a9b088798" title="Removes a vehicle states listener.">MSNet::removeVehicleStateListener</a>(<a class="code" href="../../dc/dd1/class_m_s_net_1_1_vehicle_state_listener.html" title="Interface for objects listening to vehicle state changes.">VehicleStateListener</a>* listener) {
<a name="l00623"></a>00623     std::vector&lt;VehicleStateListener*&gt;::iterator i = find(<a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.begin(), <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.end(), listener);
<a name="l00624"></a>00624     <span class="keywordflow">if</span> (i != <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.end()) {
<a name="l00625"></a>00625         <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.erase(i);
<a name="l00626"></a>00626     }
<a name="l00627"></a>00627 }
<a name="l00628"></a>00628 
<a name="l00629"></a>00629 
<a name="l00630"></a>00630 <span class="keywordtype">void</span>
<a name="l00631"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a7edf08cf3b7fd9e30f98c13b7c34f131">00631</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a7edf08cf3b7fd9e30f98c13b7c34f131" title="Informs all added listeners about a vehicle&amp;#39;s state change.">MSNet::informVehicleStateListener</a>(<span class="keyword">const</span> <a class="code" href="../../db/d61/class_s_u_m_o_vehicle.html" title="Representation of a vehicle.">SUMOVehicle</a>* <span class="keyword">const</span> vehicle, <a class="code" href="../../dc/d5d/class_m_s_net.html#a19e1d800f4d19bae756b5597a6101d7a" title="Definition of a vehicle state.">VehicleState</a> to) {
<a name="l00632"></a>00632     <span class="keywordflow">for</span> (std::vector&lt;VehicleStateListener*&gt;::iterator i = <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.begin(); i != <a class="code" href="../../dc/d5d/class_m_s_net.html#aba5d7c423f46994d7f423414313cbffd" title="Container for vehicle state listener.">myVehicleStateListeners</a>.end(); ++i) {
<a name="l00633"></a>00633         (*i)-&gt;vehicleStateChanged(vehicle, to);
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635 }
<a name="l00636"></a>00636 
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="comment">// ------ Insertion and retrieval of bus stops ------</span>
<a name="l00640"></a>00640 <span class="keywordtype">bool</span>
<a name="l00641"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#af6c68c3133cfa8d60ed3928c74dd84bc">00641</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#af6c68c3133cfa8d60ed3928c74dd84bc" title="Adds a bus stop.">MSNet::addBusStop</a>(<a class="code" href="../../d9/d26/class_m_s_bus_stop.html" title="A lane area vehicles can halt at.">MSBusStop</a>* busStop) {
<a name="l00642"></a>00642     <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a12a1371c2de2b031a3dc8da9af5d9cde" title="Dictionary of bus stops.">myBusStopDict</a>.<a class="code" href="../../d2/d4d/class_named_object_cont.html#abb1b71208223975d8f61a8451102dd80" title="Adds an item.">add</a>(busStop-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>(), busStop);
<a name="l00643"></a>00643 }
<a name="l00644"></a>00644 
<a name="l00645"></a>00645 
<a name="l00646"></a>00646 <a class="code" href="../../d9/d26/class_m_s_bus_stop.html" title="A lane area vehicles can halt at.">MSBusStop</a>*
<a name="l00647"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a47bc0503e556135e3aceb65c691209de">00647</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a47bc0503e556135e3aceb65c691209de" title="Returns the named bus stop.">MSNet::getBusStop</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)<span class="keyword"> const </span>{
<a name="l00648"></a>00648     <span class="keywordflow">return</span> <a class="code" href="../../dc/d5d/class_m_s_net.html#a12a1371c2de2b031a3dc8da9af5d9cde" title="Dictionary of bus stops.">myBusStopDict</a>.<a class="code" href="../../d2/d4d/class_named_object_cont.html#a3496e778d7d1a587d1d9132a2c03c5a1" title="Retrieves an item.">get</a>(<span class="keywordtype">id</span>);
<a name="l00649"></a>00649 }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 
<a name="l00652"></a>00652 std::string
<a name="l00653"></a><a class="code" href="../../dc/d5d/class_m_s_net.html#a56b6ff09f6b851c80aaf7f385eb03c00">00653</a> <a class="code" href="../../dc/d5d/class_m_s_net.html#a56b6ff09f6b851c80aaf7f385eb03c00" title="Returns the bus stop close to the given position.">MSNet::getBusStopID</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* lane, <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> pos)<span class="keyword"> const </span>{
<a name="l00654"></a>00654     <span class="keyword">const</span> std::map&lt;std::string, MSBusStop*&gt; &amp;vals = <a class="code" href="../../dc/d5d/class_m_s_net.html#a12a1371c2de2b031a3dc8da9af5d9cde" title="Dictionary of bus stops.">myBusStopDict</a>.<a class="code" href="../../d2/d4d/class_named_object_cont.html#a5906292968619158067a8029a64c2e63">getMyMap</a>();
<a name="l00655"></a>00655     <span class="keywordflow">for</span> (std::map&lt;std::string, MSBusStop*&gt;::const_iterator it = vals.begin(); it != vals.end(); ++it) {
<a name="l00656"></a>00656         <a class="code" href="../../d9/d26/class_m_s_bus_stop.html" title="A lane area vehicles can halt at.">MSBusStop</a>* stop = it-&gt;second;
<a name="l00657"></a>00657         <span class="keywordflow">if</span> (&amp;stop-&gt;<a class="code" href="../../d9/d26/class_m_s_bus_stop.html#ac60536cf240567fc9de28d1a73167aee" title="Returns the lane this bus stop is located at.">getLane</a>() == lane &amp;&amp; fabs(stop-&gt;<a class="code" href="../../d9/d26/class_m_s_bus_stop.html#af9eae7f84f4b47dd025000596c101c2c" title="Returns the end position of this bus stop.">getEndLanePosition</a>() - pos) &lt; <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>) {
<a name="l00658"></a>00658             <span class="keywordflow">return</span> stop-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>();
<a name="l00659"></a>00659         }
<a name="l00660"></a>00660     }
<a name="l00661"></a>00661     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>;
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l00666"></a>00666 <span class="preprocessor"></span>MSMessageEmitter*
<a name="l00667"></a>00667 MSNet::getMsgEmitter(<span class="keyword">const</span> std::string&amp; whatemit) {
<a name="l00668"></a>00668     msgEmitVec.clear();
<a name="l00669"></a>00669     msgEmitVec = myMsgEmitter.buildAndGetStaticVector();
<a name="l00670"></a>00670     MSMessageEmitter* msgEmitter = 0;
<a name="l00671"></a>00671     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; msgEmitVec.size(); ++i) {
<a name="l00672"></a>00672         <span class="keywordflow">if</span> (msgEmitVec.at(i)-&gt;getEventsEnabled(whatemit)) {
<a name="l00673"></a>00673             msgEmitter = msgEmitVec.at(i);
<a name="l00674"></a>00674             <span class="keywordflow">break</span>;
<a name="l00675"></a>00675         }
<a name="l00676"></a>00676     }
<a name="l00677"></a>00677     <span class="comment">// returns 0 if the requested MessageEmitter is not in the map</span>
<a name="l00678"></a>00678     <span class="keywordflow">return</span> msgEmitter;
<a name="l00679"></a>00679 }
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 <span class="keywordtype">void</span>
<a name="l00683"></a>00683 MSNet::createMsgEmitter(std::string&amp; <span class="keywordtype">id</span>,
<a name="l00684"></a>00684                         std::string&amp; file,
<a name="l00685"></a>00685                         <span class="keyword">const</span> std::string&amp; base,
<a name="l00686"></a>00686                         std::string&amp; whatemit,
<a name="l00687"></a>00687                         <span class="keywordtype">bool</span> reverse,
<a name="l00688"></a>00688                         <span class="keywordtype">bool</span> table,
<a name="l00689"></a>00689                         <span class="keywordtype">bool</span> xy,
<a name="l00690"></a>00690                         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> step) {
<a name="l00691"></a>00691     MSMessageEmitter* msgEmitter = <span class="keyword">new</span> MSMessageEmitter(file, base, whatemit, reverse, table, xy, step);
<a name="l00692"></a>00692     myMsgEmitter.add(<span class="keywordtype">id</span>, msgEmitter);
<a name="l00693"></a>00693 }
<a name="l00694"></a>00694 <span class="preprocessor">#endif</span>
<a name="l00695"></a>00695 <span class="preprocessor"></span>
<a name="l00696"></a>00696 
<a name="l00697"></a>00697 <span class="comment">/****************************************************************************/</span>
<a name="l00698"></a>00698 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:01 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
