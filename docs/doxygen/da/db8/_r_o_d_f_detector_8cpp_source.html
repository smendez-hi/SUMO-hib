<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: RODFDetector.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_6a148b0530b6cc52c6efcdda6101d856.html">dfrouter</a>
  </div>
</div>
<div class="contents">
<h1>RODFDetector.cpp</h1><a href="../../da/db8/_r_o_d_f_detector_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00012"></a>00012 <span class="comment">// Class representing a detector within the DFROUTER</span>
<a name="l00013"></a>00013 <span class="comment">/****************************************************************************/</span>
<a name="l00014"></a>00014 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00015"></a>00015 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00016"></a>00016 <span class="comment">/****************************************************************************/</span>
<a name="l00017"></a>00017 <span class="comment">//</span>
<a name="l00018"></a>00018 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00019"></a>00019 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00020"></a>00020 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00021"></a>00021 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00022"></a>00022 <span class="comment">//   (at your option) any later version.</span>
<a name="l00023"></a>00023 <span class="comment">//</span>
<a name="l00024"></a>00024 <span class="comment">/****************************************************************************/</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 <span class="comment">// ===========================================================================</span>
<a name="l00028"></a>00028 <span class="comment">// included modules</span>
<a name="l00029"></a>00029 <span class="comment">// ===========================================================================</span>
<a name="l00030"></a>00030 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#else</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#endif</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html">RODFDetector.h</a>&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/da2/_file_helpers_8h.html">utils/common/FileHelpers.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/df7/_msg_handler_8h.html">utils/common/MsgHandler.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db4/_util_exceptions_8h.html">utils/common/UtilExceptions.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d08/_to_string_8h.html">utils/common/ToString.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/d94/_r_o_edge_8h.html">router/ROEdge.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/dd4/_r_o_d_f_edge_8h.html">RODFEdge.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d75/_r_o_d_f_route_desc_8h.html">RODFRouteDesc.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/db7/_r_o_d_f_route_cont_8h.html">RODFRouteCont.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/dec/_r_o_d_f_detector_flow_8h.html">RODFDetectorFlow.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/d19/_random_distributor_8h.html">utils/common/RandomDistributor.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="../../da/dbd/_std_defs_8h.html">utils/common/StdDefs.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="../../d5/df0/_geom_helper_8h.html">utils/geom/GeomHelper.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/d79/_r_o_d_f_net_8h.html">RODFNet.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="../../d1/d3f/_output_device_8h.html">utils/iodevices/OutputDevice.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="../../de/dde/_string_utils_8h.html">utils/common/StringUtils.h</a>&gt;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00054"></a>00054 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00056"></a>00056 <span class="preprocessor"></span>
<a name="l00057"></a>00057 
<a name="l00058"></a>00058 <span class="comment">// ===========================================================================</span>
<a name="l00059"></a>00059 <span class="comment">// method definitions</span>
<a name="l00060"></a>00060 <span class="comment">// ===========================================================================</span>
<a name="l00061"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a32b904e9500a9c3fbfc4fddfe2bcd5d3">00061</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a32b904e9500a9c3fbfc4fddfe2bcd5d3" title="Constructor.">RODFDetector::RODFDetector</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> std::string&amp; laneID,
<a name="l00062"></a>00062                            <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> pos, <span class="keyword">const</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cf" title="Numerical representation of different detector types.">RODFDetectorType</a> type)
<a name="l00063"></a>00063     : myID(id), myLaneID(laneID), myPosition(pos), myType(type), myRoutes(0) {}
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a36b45dcf992ce2f5a1df1da64cfe02bb">00066</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a32b904e9500a9c3fbfc4fddfe2bcd5d3" title="Constructor.">RODFDetector::RODFDetector</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>&amp; f)
<a name="l00067"></a>00067     : myID(id), myLaneID(f.myLaneID), myPosition(f.myPosition),
<a name="l00068"></a>00068       myType(f.myType), myRoutes(0) {
<a name="l00069"></a>00069     <span class="keywordflow">if</span> (f.<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> != 0) {
<a name="l00070"></a>00070         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> = <span class="keyword">new</span> <a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html" title="A container for DFROUTER-routes.">RODFRouteCont</a>(*(f.<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>));
<a name="l00071"></a>00071     }
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00074"></a>00074 
<a name="l00075"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a97a042e50a9c06b7eb4421a044e507a5">00075</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a97a042e50a9c06b7eb4421a044e507a5" title="Destructor.">RODFDetector::~RODFDetector</a>() {
<a name="l00076"></a>00076     <span class="keyword">delete</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>;
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="keywordtype">void</span>
<a name="l00081"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a089135c47f08ca80f1db493ca5dd44b4">00081</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a089135c47f08ca80f1db493ca5dd44b4">RODFDetector::setType</a>(<a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cf" title="Numerical representation of different detector types.">RODFDetectorType</a> type) {
<a name="l00082"></a>00082     <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ada49624fb97460b470e212f9a9c2664b">myType</a> = type;
<a name="l00083"></a>00083 }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 
<a name="l00086"></a>00086 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>
<a name="l00087"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a7f1a6a704b16c83421a8e4c67356c45b">00087</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a7f1a6a704b16c83421a8e4c67356c45b">RODFDetector::computeDistanceFactor</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html" title="A route within the DFROUTER.">RODFRouteDesc</a>&amp; rd)<span class="keyword"> const </span>{
<a name="l00088"></a>00088     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> distance = rd.<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html#a91b406eb9edaf7ff469a6bc28455b8a7" title="The edges the route is made of.">edges2Pass</a>[0]-&gt;getFromNode()-&gt;getPosition().distanceTo(rd.<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html#a91b406eb9edaf7ff469a6bc28455b8a7" title="The edges the route is made of.">edges2Pass</a>.back()-&gt;getToNode()-&gt;getPosition());
<a name="l00089"></a>00089     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> length = 0;
<a name="l00090"></a>00090     <span class="keywordflow">for</span> (std::vector&lt;ROEdge*&gt;::const_iterator i = rd.<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html#a91b406eb9edaf7ff469a6bc28455b8a7" title="The edges the route is made of.">edges2Pass</a>.begin(); i != rd.<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html#a91b406eb9edaf7ff469a6bc28455b8a7" title="The edges the route is made of.">edges2Pass</a>.end(); ++i) {
<a name="l00091"></a>00091         length += (*i)-&gt;getLength();
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093     <span class="keywordflow">return</span> (distance / length);
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="keywordtype">void</span>
<a name="l00098"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a026477268db6096aeb005da138637ce8">00098</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a026477268db6096aeb005da138637ce8">RODFDetector::computeSplitProbabilities</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d49/class_r_o_d_f_net.html" title="A DFROUTER-network.">RODFNet</a>* net, <span class="keyword">const</span> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html" title="A container for RODFDetectors.">RODFDetectorCon</a>&amp; detectors,
<a name="l00099"></a>00099                                         <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows,
<a name="l00100"></a>00100                                         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startTime, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endTime, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stepOffset) {
<a name="l00101"></a>00101     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> == 0) {
<a name="l00102"></a>00102         <span class="keywordflow">return</span>;
<a name="l00103"></a>00103     }
<a name="l00104"></a>00104     <span class="comment">// compute edges to determine split probabilities</span>
<a name="l00105"></a>00105     <span class="keyword">const</span> std::vector&lt;RODFRouteDesc&gt; &amp;routes = <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8c8756ce72a612eeb1392f88b802a48e" title="Returns the container of stored routes.">get</a>();
<a name="l00106"></a>00106     std::vector&lt;RODFEdge*&gt; nextDetEdges;
<a name="l00107"></a>00107     <span class="keywordflow">for</span> (std::vector&lt;RODFRouteDesc&gt;::const_iterator i = routes.begin(); i != routes.end(); ++i) {
<a name="l00108"></a>00108         <span class="keyword">const</span> <a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html" title="A route within the DFROUTER.">RODFRouteDesc</a>&amp; rd = *i;
<a name="l00109"></a>00109         <span class="keywordtype">bool</span> hadSplit = <span class="keyword">false</span>;
<a name="l00110"></a>00110         <span class="keywordtype">bool</span> hadDetectorAfterSplit = <span class="keyword">false</span>;
<a name="l00111"></a>00111         <span class="keywordflow">for</span> (std::vector&lt;ROEdge*&gt;::const_iterator j = rd.<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html#a91b406eb9edaf7ff469a6bc28455b8a7" title="The edges the route is made of.">edges2Pass</a>.begin(); !hadDetectorAfterSplit &amp;&amp; j != rd.<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html#a91b406eb9edaf7ff469a6bc28455b8a7" title="The edges the route is made of.">edges2Pass</a>.end(); ++j) {
<a name="l00112"></a>00112             <span class="keywordflow">if</span> (hadSplit &amp;&amp; !hadDetectorAfterSplit &amp;&amp; net-&gt;<a class="code" href="../../d8/d49/class_r_o_d_f_net.html#aca1610f40fd93d6760890013fdfaafeb">hasDetector</a>(*j)) {
<a name="l00113"></a>00113                 hadDetectorAfterSplit = <span class="keyword">true</span>;
<a name="l00114"></a>00114                 <span class="keywordflow">if</span> (find(nextDetEdges.begin(), nextDetEdges.end(), *j) == nextDetEdges.end()) {
<a name="l00115"></a>00115                     nextDetEdges.push_back(static_cast&lt;RODFEdge*&gt;(*j));
<a name="l00116"></a>00116                 }
<a name="l00117"></a>00117                 <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a88c97c4f25180142b79c62ac669eb1c0">myRoute2Edge</a>[rd.<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html#a20d4ab8379e2eeb69f61941e62e148fe" title="The name of the route.">routename</a>] = <span class="keyword">static_cast&lt;</span><a class="code" href="../../d8/d77/class_r_o_d_f_edge.html">RODFEdge</a>*<span class="keyword">&gt;</span>(*j);
<a name="l00118"></a>00118             }
<a name="l00119"></a>00119             <span class="keywordflow">if</span> ((*j)-&gt;getNoFollowing() &gt; 1) {
<a name="l00120"></a>00120                 hadSplit = <span class="keyword">true</span>;
<a name="l00121"></a>00121             }
<a name="l00122"></a>00122         }
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     <span class="comment">// compute the probabilities to use a certain direction</span>
<a name="l00125"></a>00125     <span class="keywordtype">int</span> index = 0;
<a name="l00126"></a>00126     <span class="keywordflow">for</span> (<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> time = startTime; time &lt; endTime; time += stepOffset, ++index) {
<a name="l00127"></a>00127         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a4670bd18f655af93cfa72a1b10802e25">mySplitProbabilities</a>.push_back(std::map&lt;RODFEdge*, SUMOReal&gt;());
<a name="l00128"></a>00128         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> overallProb = 0;
<a name="l00129"></a>00129         <span class="comment">// retrieve the probabilities</span>
<a name="l00130"></a>00130         <span class="keywordflow">for</span> (std::vector&lt;RODFEdge*&gt;::const_iterator i = nextDetEdges.begin(); i != nextDetEdges.end(); ++i) {
<a name="l00131"></a>00131             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> flow = detectors.<a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a36e47bbacdacd16407c3d51d251707c1">getAggFlowFor</a>(*i, time, 60, flows);
<a name="l00132"></a>00132             overallProb += flow;
<a name="l00133"></a>00133             <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a4670bd18f655af93cfa72a1b10802e25">mySplitProbabilities</a>[index][*i] = flow;
<a name="l00134"></a>00134         }
<a name="l00135"></a>00135         <span class="comment">// norm probabilities</span>
<a name="l00136"></a>00136         <span class="keywordflow">if</span> (overallProb &gt; 0) {
<a name="l00137"></a>00137             <span class="keywordflow">for</span> (std::vector&lt;RODFEdge*&gt;::const_iterator i = nextDetEdges.begin(); i != nextDetEdges.end(); ++i) {
<a name="l00138"></a>00138                 <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a4670bd18f655af93cfa72a1b10802e25">mySplitProbabilities</a>[index][*i] = <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a4670bd18f655af93cfa72a1b10802e25">mySplitProbabilities</a>[index][*i] / overallProb;
<a name="l00139"></a>00139             }
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141     }
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 <span class="keywordtype">void</span>
<a name="l00146"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a4cf9bd1b78866a1cd17a5d6f68b12d44">00146</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a4cf9bd1b78866a1cd17a5d6f68b12d44">RODFDetector::buildDestinationDistribution</a>(<span class="keyword">const</span> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html" title="A container for RODFDetectors.">RODFDetectorCon</a>&amp; detectors,
<a name="l00147"></a>00147         <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows,
<a name="l00148"></a>00148         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startTime,
<a name="l00149"></a>00149         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endTime,
<a name="l00150"></a>00150         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stepOffset,
<a name="l00151"></a>00151         <span class="keyword">const</span> <a class="code" href="../../d8/d49/class_r_o_d_f_net.html" title="A DFROUTER-network.">RODFNet</a>&amp; net,
<a name="l00152"></a>00152         std::map&lt;<span class="keywordtype">size_t</span>, <a class="code" href="../../d5/d9b/class_random_distributor.html" title="Represents a generic random distribution.">RandomDistributor&lt;size_t&gt;</a>* &gt; &amp;into,
<a name="l00153"></a>00153         <span class="keywordtype">int</span> maxFollower)<span class="keyword"> const </span>{
<a name="l00154"></a>00154     <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c95a90e7806e4b0d21edfae15b73465">UNUSED_PARAMETER</a>(maxFollower);
<a name="l00155"></a>00155     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> == 0) {
<a name="l00156"></a>00156         <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ada49624fb97460b470e212f9a9c2664b">myType</a> != <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa8f28890d721e1cd91ed5c3b84c6407ca" title="A detector which had to be discarded (!!!).">DISCARDED_DETECTOR</a> &amp;&amp; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ada49624fb97460b470e212f9a9c2664b">myType</a> != <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa1e166e9cf0cb4f3cb8133c1dd2791382" title="An in-between detector.">BETWEEN_DETECTOR</a>) {
<a name="l00157"></a>00157             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Missing routes for detector &#39;&quot;</span> + <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00158"></a>00158         }
<a name="l00159"></a>00159         <span class="keywordflow">return</span>;
<a name="l00160"></a>00160     }
<a name="l00161"></a>00161     std::vector&lt;RODFRouteDesc&gt; &amp;descs = <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8c8756ce72a612eeb1392f88b802a48e" title="Returns the container of stored routes.">get</a>();
<a name="l00162"></a>00162 <span class="comment">//    const std::vector&lt;FlowDef&gt; &amp;mflows = flows.getFlowDefs(myID);</span>
<a name="l00163"></a>00163     <span class="comment">// iterate through time (in output interval steps)</span>
<a name="l00164"></a>00164     <span class="keywordflow">for</span> (<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> time = startTime; time &lt; endTime; time += stepOffset) {
<a name="l00165"></a>00165         into[time] = <span class="keyword">new</span> <a class="code" href="../../d5/d9b/class_random_distributor.html" title="Represents a generic random distribution.">RandomDistributor&lt;size_t&gt;</a>();
<a name="l00166"></a>00166         std::map&lt;ROEdge*, SUMOReal&gt; flowMap;
<a name="l00167"></a>00167         <span class="comment">// iterate through the routes</span>
<a name="l00168"></a>00168         <span class="keywordtype">size_t</span> index = 0;
<a name="l00169"></a>00169         <span class="keywordflow">for</span> (std::vector&lt;RODFRouteDesc&gt;::iterator ri = descs.begin(); ri != descs.end(); ++ri, index++) {
<a name="l00170"></a>00170             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> prob = 1.;
<a name="l00171"></a>00171             <span class="keywordflow">for</span> (std::vector&lt;ROEdge*&gt;::iterator j = (*ri).edges2Pass.begin(); j != (*ri).edges2Pass.end() &amp;&amp; prob &gt; 0; ++j) {
<a name="l00172"></a>00172                 <span class="keywordflow">if</span> (!net.<a class="code" href="../../d8/d49/class_r_o_d_f_net.html#aca1610f40fd93d6760890013fdfaafeb">hasDetector</a>(*j)) {
<a name="l00173"></a>00173                     <span class="keywordflow">continue</span>;
<a name="l00174"></a>00174                 }
<a name="l00175"></a>00175                 <span class="keyword">const</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>&amp; det = detectors.<a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a6898301b7158bcf9398385100187bb63">getAnyDetectorForEdge</a>(static_cast&lt;RODFEdge*&gt;(*j));
<a name="l00176"></a>00176                 <span class="keyword">const</span> std::vector&lt;std::map&lt;RODFEdge*, SUMOReal&gt; &gt; &amp;probs = det.<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ab18734194aa6546f062052d66abcc994">getSplitProbabilities</a>();
<a name="l00177"></a>00177                 <span class="keywordflow">if</span> (probs.size() == 0) {
<a name="l00178"></a>00178                     prob = 0;
<a name="l00179"></a>00179                     <span class="keywordflow">continue</span>;
<a name="l00180"></a>00180                 }
<a name="l00181"></a>00181                 <span class="keyword">const</span> std::map&lt;RODFEdge*, SUMOReal&gt; &amp;tprobs = probs[(time - startTime) / stepOffset];
<a name="l00182"></a>00182                 <span class="keywordflow">for</span> (std::map&lt;RODFEdge*, SUMOReal&gt;::const_iterator k = tprobs.begin(); k != tprobs.end(); ++k) {
<a name="l00183"></a>00183                     <span class="keywordflow">if</span> (find(j, (*ri).edges2Pass.end(), (*k).first) != (*ri).edges2Pass.end()) {
<a name="l00184"></a>00184                         prob *= (*k).second;
<a name="l00185"></a>00185                     }
<a name="l00186"></a>00186                 }
<a name="l00187"></a>00187             }
<a name="l00188"></a>00188             into[time]-&gt;add(prob, index);
<a name="l00189"></a>00189             (*ri).overallProb = prob;
<a name="l00190"></a>00190         }
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192 }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="keyword">const</span> std::vector&lt;RODFRouteDesc&gt; &amp;
<a name="l00196"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a2de23a31f13198c745b2f4f52aefd7da">00196</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a2de23a31f13198c745b2f4f52aefd7da">RODFDetector::getRouteVector</a>()<span class="keyword"> const </span>{
<a name="l00197"></a>00197     <span class="keywordflow">return</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8c8756ce72a612eeb1392f88b802a48e" title="Returns the container of stored routes.">get</a>();
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 
<a name="l00201"></a>00201 <span class="keywordtype">void</span>
<a name="l00202"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aaf351fe8e86e2edc5bf274b5a4d15e9a">00202</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aaf351fe8e86e2edc5bf274b5a4d15e9a">RODFDetector::addPriorDetector</a>(<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det) {
<a name="l00203"></a>00203     <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a37a656e085e66f26853a676f4aaf3c5c">myPriorDetectors</a>.push_back(det);
<a name="l00204"></a>00204 }
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 <span class="keywordtype">void</span>
<a name="l00208"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ae61f77bb2f72b83f55dd17f4ef5f868a">00208</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ae61f77bb2f72b83f55dd17f4ef5f868a">RODFDetector::addFollowingDetector</a>(<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det) {
<a name="l00209"></a>00209     <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a167198b51112352fcb2d57130279dc54">myFollowingDetectors</a>.push_back(det);
<a name="l00210"></a>00210 }
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="keyword">const</span> std::vector&lt;RODFDetector*&gt; &amp;
<a name="l00214"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a861c4cb442ce796b02f882cac96fa419">00214</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a861c4cb442ce796b02f882cac96fa419">RODFDetector::getPriorDetectors</a>()<span class="keyword"> const </span>{
<a name="l00215"></a>00215     <span class="keywordflow">return</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a37a656e085e66f26853a676f4aaf3c5c">myPriorDetectors</a>;
<a name="l00216"></a>00216 }
<a name="l00217"></a>00217 
<a name="l00218"></a>00218 
<a name="l00219"></a>00219 <span class="keyword">const</span> std::vector&lt;RODFDetector*&gt; &amp;
<a name="l00220"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0bdd48474d56df8f2616b686286e3047">00220</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0bdd48474d56df8f2616b686286e3047">RODFDetector::getFollowerDetectors</a>()<span class="keyword"> const </span>{
<a name="l00221"></a>00221     <span class="keywordflow">return</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a167198b51112352fcb2d57130279dc54">myFollowingDetectors</a>;
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="keywordtype">void</span>
<a name="l00227"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a61ad273d05347d4f625b8943aed25b47">00227</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a61ad273d05347d4f625b8943aed25b47">RODFDetector::addRoutes</a>(<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html" title="A container for DFROUTER-routes.">RODFRouteCont</a>* routes) {
<a name="l00228"></a>00228     <span class="keyword">delete</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>;
<a name="l00229"></a>00229     <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> = routes;
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="keywordtype">void</span>
<a name="l00234"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a385e29ec9c04dd65337ae17034e36378">00234</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a385e29ec9c04dd65337ae17034e36378">RODFDetector::addRoute</a>(<a class="code" href="../../d8/d59/struct_r_o_d_f_route_desc.html" title="A route within the DFROUTER.">RODFRouteDesc</a>&amp; nrd) {
<a name="l00235"></a>00235     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> == 0) {
<a name="l00236"></a>00236         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> = <span class="keyword">new</span> <a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html" title="A container for DFROUTER-routes.">RODFRouteCont</a>();
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238     <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a322fd5e6f10c5b72800a125832ebf887" title="Adds a route to the container.">addRouteDesc</a>(nrd);
<a name="l00239"></a>00239 }
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 
<a name="l00242"></a>00242 <span class="keywordtype">bool</span>
<a name="l00243"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a49a452dd15982af1b37c08452998d385">00243</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a49a452dd15982af1b37c08452998d385">RODFDetector::hasRoutes</a>()<span class="keyword"> const </span>{
<a name="l00244"></a>00244     <span class="keywordflow">return</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> != 0 &amp;&amp; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8c8756ce72a612eeb1392f88b802a48e" title="Returns the container of stored routes.">get</a>().size() != 0;
<a name="l00245"></a>00245 }
<a name="l00246"></a>00246 
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 <span class="keywordtype">bool</span>
<a name="l00249"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ab02beb609ea7b9d57622c0e57f445076">00249</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ab02beb609ea7b9d57622c0e57f445076">RODFDetector::writeEmitterDefinition</a>(<span class="keyword">const</span> std::string&amp; file,
<a name="l00250"></a>00250                                      <span class="keyword">const</span> std::map&lt;<span class="keywordtype">size_t</span>, <a class="code" href="../../d5/d9b/class_random_distributor.html" title="Represents a generic random distribution.">RandomDistributor&lt;size_t&gt;</a>* &gt; &amp;dists,
<a name="l00251"></a>00251                                      <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows,
<a name="l00252"></a>00252                                      <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startTime, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endTime,
<a name="l00253"></a>00253                                      <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stepOffset,
<a name="l00254"></a>00254                                      <span class="keywordtype">bool</span> includeUnusedRoutes,
<a name="l00255"></a>00255                                      <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> scale,
<a name="l00256"></a>00256                                      <span class="keywordtype">bool</span> insertionsOnly,
<a name="l00257"></a>00257                                      <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> defaultSpeed)<span class="keyword"> const </span>{
<a name="l00258"></a>00258     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00259"></a>00259     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() != <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>) {
<a name="l00260"></a>00260         out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;calibrator&quot;</span>);
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262     <span class="comment">// routes</span>
<a name="l00263"></a>00263     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> != 0 &amp;&amp; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8c8756ce72a612eeb1392f88b802a48e" title="Returns the container of stored routes.">get</a>().size() != 0) {
<a name="l00264"></a>00264         <span class="keyword">const</span> std::vector&lt;RODFRouteDesc&gt; &amp;routes = <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8c8756ce72a612eeb1392f88b802a48e" title="Returns the container of stored routes.">get</a>();
<a name="l00265"></a>00265         out.<a class="code" href="../../de/da0/class_output_device.html#a3b0f96462607bb3acd79ab119612dada" title="Opens an XML tag.">openTag</a>(<span class="stringliteral">&quot;routeDistribution&quot;</span>) &lt;&lt;  <span class="stringliteral">&quot; id=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&gt;\n&quot;</span>;
<a name="l00266"></a>00266         <span class="keywordtype">bool</span> isEmptyDist = <span class="keyword">true</span>;
<a name="l00267"></a>00267         <span class="keywordflow">for</span> (std::vector&lt;RODFRouteDesc&gt;::const_iterator i = routes.begin(); i != routes.end(); ++i) {
<a name="l00268"></a>00268             <span class="keywordflow">if</span> ((*i).overallProb &gt; 0) {
<a name="l00269"></a>00269                 isEmptyDist = <span class="keyword">false</span>;
<a name="l00270"></a>00270             }
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272         <span class="keywordflow">for</span> (std::vector&lt;RODFRouteDesc&gt;::const_iterator i = routes.begin(); i != routes.end(); ++i) {
<a name="l00273"></a>00273             <span class="keywordflow">if</span> ((*i).overallProb &gt; 0 || includeUnusedRoutes) {
<a name="l00274"></a>00274                 out.<a class="code" href="../../de/da0/class_output_device.html#a3b0f96462607bb3acd79ab119612dada" title="Opens an XML tag.">openTag</a>(<span class="stringliteral">&quot;route&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; refId=\&quot;&quot;</span> &lt;&lt; (*i).routename &lt;&lt; <span class="stringliteral">&quot;\&quot; probability=\&quot;&quot;</span> &lt;&lt; (*i).overallProb &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00275"></a>00275                 out.<a class="code" href="../../de/da0/class_output_device.html#a16c6003a3128afaaaf44014d6db7b9fa" title="Closes the most recently opened tag.">closeTag</a>(<span class="keyword">true</span>);
<a name="l00276"></a>00276             }
<a name="l00277"></a>00277             <span class="keywordflow">if</span> (isEmptyDist) {
<a name="l00278"></a>00278                 out.<a class="code" href="../../de/da0/class_output_device.html#a3b0f96462607bb3acd79ab119612dada" title="Opens an XML tag.">openTag</a>(<span class="stringliteral">&quot;route&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; refId=\&quot;&quot;</span> &lt;&lt; (*i).routename &lt;&lt; <span class="stringliteral">&quot;\&quot; probability=\&quot;1\&quot;&quot;</span>;
<a name="l00279"></a>00279                 out.<a class="code" href="../../de/da0/class_output_device.html#a16c6003a3128afaaaf44014d6db7b9fa" title="Closes the most recently opened tag.">closeTag</a>(<span class="keyword">true</span>);
<a name="l00280"></a>00280             }
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282         out.<a class="code" href="../../de/da0/class_output_device.html#a16c6003a3128afaaaf44014d6db7b9fa" title="Closes the most recently opened tag.">closeTag</a>();
<a name="l00283"></a>00283     } <span class="keywordflow">else</span> {
<a name="l00284"></a>00284         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Detector &#39;&quot;</span> + <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>() + <span class="stringliteral">&quot;&#39; has no routes!?&quot;</span>);
<a name="l00285"></a>00285         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00286"></a>00286     }
<a name="l00287"></a>00287     <span class="comment">// emissions</span>
<a name="l00288"></a>00288     <span class="keywordflow">if</span> (insertionsOnly || flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a57558ceb5b181cca0b5536fd53046637">knows</a>(<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a>)) {
<a name="l00289"></a>00289         <span class="comment">// get the flows for this detector</span>
<a name="l00290"></a>00290 
<a name="l00291"></a>00291         <span class="keyword">const</span> std::vector&lt;FlowDef&gt; &amp;mflows = flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a533f44ead9ee508cc6784acf2b8356be">getFlowDefs</a>(<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a>);
<a name="l00292"></a>00292         <span class="comment">// go through the simulation seconds</span>
<a name="l00293"></a>00293         <span class="keywordtype">int</span> index = 0;
<a name="l00294"></a>00294         <span class="keywordflow">for</span> (<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> time = startTime; time &lt; endTime; time += stepOffset, index++) {
<a name="l00295"></a>00295             <span class="comment">// get own (departure flow)</span>
<a name="l00296"></a>00296             assert(index &lt; mflows.size());
<a name="l00297"></a>00297             <span class="keyword">const</span> <a class="code" href="../../d1/db7/struct_flow_def.html" title="Definition of the traffic during a certain time containing the flows and speeds.">FlowDef</a>&amp; srcFD = mflows[index];  <span class="comment">// !!! check stepOffset</span>
<a name="l00298"></a>00298             <span class="comment">// get flows at end</span>
<a name="l00299"></a>00299             <a class="code" href="../../d5/d9b/class_random_distributor.html" title="Represents a generic random distribution.">RandomDistributor&lt;size_t&gt;</a> *destDist = dists.find(time) != dists.end() ? dists.find(time)-&gt;second : 0;
<a name="l00300"></a>00300             <span class="comment">// go through the cars</span>
<a name="l00301"></a>00301             <span class="keywordtype">size_t</span> carNo = (size_t)((srcFD.qPKW + srcFD.qLKW) * scale);
<a name="l00302"></a>00302             <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> car = 0; car &lt; carNo; ++car) {
<a name="l00303"></a>00303                 <span class="comment">// get the vehicle parameter</span>
<a name="l00304"></a>00304                 std::string type = <span class="stringliteral">&quot;test&quot;</span>;
<a name="l00305"></a>00305                 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> v = -1;
<a name="l00306"></a>00306                 <span class="keywordtype">int</span> destIndex = destDist != 0 &amp;&amp; destDist-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#aaa67eed5efe4e483489a92d9a8df577e" title="Return the sum of the probabilites assigned to the members.">getOverallProb</a>() &gt; 0 ? (int) destDist-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#a5361813e4c0d0551bbe565de31424caa" title="Draw a sample of the distribution.">get</a>() : -1;
<a name="l00307"></a>00307                 <span class="keywordflow">if</span> (srcFD.isLKW &gt;= 1) {
<a name="l00308"></a>00308                     srcFD.isLKW = srcFD.isLKW - (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) 1.;
<a name="l00310"></a>00310                     v = srcFD.vLKW;
<a name="l00311"></a>00311                 } <span class="keywordflow">else</span> {
<a name="l00313"></a>00313                     v = srcFD.vPKW;
<a name="l00314"></a>00314                 }
<a name="l00315"></a>00315                 <span class="comment">// compute emission speed</span>
<a name="l00316"></a>00316                 <span class="keywordflow">if</span> (v &lt; 0 || v &gt; 250) {
<a name="l00317"></a>00317                     v = defaultSpeed;
<a name="l00318"></a>00318                 } <span class="keywordflow">else</span> {
<a name="l00319"></a>00319                     v = (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(v / 3.6);
<a name="l00320"></a>00320                 }
<a name="l00321"></a>00321                 <span class="comment">// compute the departure time</span>
<a name="l00322"></a>00322                 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> ctime = (<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a>)(time + ((<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) stepOffset * (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) car / (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) carNo));
<a name="l00323"></a>00323 
<a name="l00324"></a>00324                 <span class="comment">// write</span>
<a name="l00325"></a>00325                 out.<a class="code" href="../../de/da0/class_output_device.html#a3b0f96462607bb3acd79ab119612dada" title="Opens an XML tag.">openTag</a>(<span class="stringliteral">&quot;vehicle&quot;</span>) &lt;&lt; <span class="stringliteral">&quot; id=\&quot;&quot;</span>;
<a name="l00326"></a>00326                 <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>) {
<a name="l00327"></a>00327                     out &lt;&lt; <span class="stringliteral">&quot;emitter_&quot;</span> &lt;&lt; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a>;
<a name="l00328"></a>00328                 } <span class="keywordflow">else</span> {
<a name="l00329"></a>00329                     out &lt;&lt; <span class="stringliteral">&quot;calibrator_&quot;</span> &lt;&lt; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a>;
<a name="l00330"></a>00330                 }
<a name="l00331"></a>00331                 out &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; ctime  &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> <span class="comment">// !!! running</span>
<a name="l00332"></a>00332                     &lt;&lt; <span class="stringliteral">&quot; depart=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5bd5c47639f33fda316b4eca62222a21">time2string</a>(ctime) &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00333"></a>00333                     &lt;&lt; <span class="stringliteral">&quot; departSpeed=\&quot;&quot;</span>;
<a name="l00334"></a>00334                 <span class="keywordflow">if</span> (v &gt; defaultSpeed) {
<a name="l00335"></a>00335                     out &lt;&lt; <span class="stringliteral">&quot;max&quot;</span>;
<a name="l00336"></a>00336                 } <span class="keywordflow">else</span> {
<a name="l00337"></a>00337                     out &lt;&lt; v;
<a name="l00338"></a>00338                 }
<a name="l00339"></a>00339                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; departPos=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac28fae580863256f9c73b740cda59a76">myPosition</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l00340"></a>00340                     &lt;&lt; <span class="stringliteral">&quot; departLane=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a99e090487a0f939295fd66805eb4547b">myLaneID</a>.substr(<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a99e090487a0f939295fd66805eb4547b">myLaneID</a>.rfind(<span class="stringliteral">&quot;_&quot;</span>) + 1) &lt;&lt; <span class="stringliteral">&quot;\&quot; route=\&quot;&quot;</span>;
<a name="l00341"></a>00341                 <span class="keywordflow">if</span> (destIndex &gt;= 0) {
<a name="l00342"></a>00342                     out &lt;&lt; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8c8756ce72a612eeb1392f88b802a48e" title="Returns the container of stored routes.">get</a>()[destIndex].routename &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00343"></a>00343                 } <span class="keywordflow">else</span> {
<a name="l00344"></a>00344                     out &lt;&lt; <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a> &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00345"></a>00345                 }
<a name="l00346"></a>00346                 out.<a class="code" href="../../de/da0/class_output_device.html#a16c6003a3128afaaaf44014d6db7b9fa" title="Closes the most recently opened tag.">closeTag</a>(<span class="keyword">true</span>);
<a name="l00347"></a>00347                 srcFD.isLKW += srcFD.fLKW;
<a name="l00348"></a>00348             }
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350     }
<a name="l00351"></a>00351     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() != <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>) {
<a name="l00352"></a>00352         out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00353"></a>00353     }
<a name="l00354"></a>00354     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00355"></a>00355 }
<a name="l00356"></a>00356 
<a name="l00357"></a>00357 
<a name="l00358"></a>00358 <span class="keywordtype">bool</span>
<a name="l00359"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a38c5757b441cc37302c7044e77f35ed3">00359</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a38c5757b441cc37302c7044e77f35ed3">RODFDetector::writeRoutes</a>(std::vector&lt;std::string&gt; &amp;saved,
<a name="l00360"></a>00360                           <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out) {
<a name="l00361"></a>00361     <span class="keywordflow">if</span> (<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a> != 0) {
<a name="l00362"></a>00362         <span class="keywordflow">return</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ac4ec12a89ceff7837d80869104e6e8e2">myRoutes</a>-&gt;<a class="code" href="../../d0/de4/class_r_o_d_f_route_cont.html#a8057411c052be3e718f8d5324543ae4d" title="Saves routes.">save</a>(saved, <span class="stringliteral">&quot;&quot;</span>, out);
<a name="l00363"></a>00363     }
<a name="l00364"></a>00364     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00365"></a>00365 }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 <span class="keywordtype">void</span>
<a name="l00369"></a><a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a7153adec2f2df8a587777137ed6943e9">00369</a> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a7153adec2f2df8a587777137ed6943e9">RODFDetector::writeSingleSpeedTrigger</a>(<span class="keyword">const</span> std::string&amp; file,
<a name="l00370"></a>00370                                       <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows,
<a name="l00371"></a>00371                                       <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startTime, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endTime,
<a name="l00372"></a>00372                                       <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stepOffset, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> defaultSpeed) {
<a name="l00373"></a>00373     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00374"></a>00374     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;vss&quot;</span>);
<a name="l00375"></a>00375     <span class="keyword">const</span> std::vector&lt;FlowDef&gt; &amp;mflows = flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a533f44ead9ee508cc6784acf2b8356be">getFlowDefs</a>(<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a1387d5db77912508f18fa1c88576e6e9">myID</a>);
<a name="l00376"></a>00376     <span class="keywordtype">int</span> index = 0;
<a name="l00377"></a>00377     <span class="keywordflow">for</span> (<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> t = startTime; t &lt; endTime; t += stepOffset, index++) {
<a name="l00378"></a>00378         assert(index &lt; mflows.size());
<a name="l00379"></a>00379         <span class="keyword">const</span> <a class="code" href="../../d1/db7/struct_flow_def.html" title="Definition of the traffic during a certain time containing the flows and speeds.">FlowDef</a>&amp; srcFD = mflows[index];
<a name="l00380"></a>00380         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> speed = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(srcFD.vLKW, srcFD.vPKW);
<a name="l00381"></a>00381         <span class="keywordflow">if</span> (speed &lt;= 0 || speed &gt; 250) {
<a name="l00382"></a>00382             speed = defaultSpeed;
<a name="l00383"></a>00383         } <span class="keywordflow">else</span> {
<a name="l00384"></a>00384             speed = (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(speed / 3.6);
<a name="l00385"></a>00385         }
<a name="l00386"></a>00386         out &lt;&lt; <span class="stringliteral">&quot;   &lt;step time=\&quot;&quot;</span> &lt;&lt; t &lt;&lt; <span class="stringliteral">&quot;\&quot; speed=\&quot;&quot;</span> &lt;&lt; speed &lt;&lt; <span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 
<a name="l00393"></a>00393 
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 
<a name="l00397"></a>00397 
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a2311e482162fb98d984d43bf38f6940d">00400</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a2311e482162fb98d984d43bf38f6940d">RODFDetectorCon::RODFDetectorCon</a>() {}
<a name="l00401"></a>00401 
<a name="l00402"></a>00402 
<a name="l00403"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a4afdc7a7b40ceec08ad44ddb8ab6cc11">00403</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a4afdc7a7b40ceec08ad44ddb8ab6cc11">RODFDetectorCon::~RODFDetectorCon</a>() {
<a name="l00404"></a>00404     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00405"></a>00405         <span class="keyword">delete</span> *i;
<a name="l00406"></a>00406     }
<a name="l00407"></a>00407 }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409 
<a name="l00410"></a>00410 <span class="keywordtype">bool</span>
<a name="l00411"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a50decc689de4a67087dc4368a6328dc8">00411</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a50decc689de4a67087dc4368a6328dc8">RODFDetectorCon::addDetector</a>(<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* dfd) {
<a name="l00412"></a>00412     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>.find(dfd-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>()) != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>.end()) {
<a name="l00413"></a>00413         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415     <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>[dfd-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>()] = dfd;
<a name="l00416"></a>00416     <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.push_back(dfd);
<a name="l00417"></a>00417     std::string edgeid = dfd-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a59594e8f73bfae7e1f764419d09b6b38" title="Returns the id of the lane this detector is placed on.">getLaneID</a>().substr(0, dfd-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a59594e8f73bfae7e1f764419d09b6b38" title="Returns the id of the lane this detector is placed on.">getLaneID</a>().rfind(<span class="charliteral">&#39;_&#39;</span>));
<a name="l00418"></a>00418     <span class="keywordflow">if</span> (<a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>.find(edgeid) == <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>.end()) {
<a name="l00419"></a>00419         <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>[edgeid] = std::vector&lt;RODFDetector*&gt;();
<a name="l00420"></a>00420     }
<a name="l00421"></a>00421     <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>[edgeid].push_back(dfd);
<a name="l00422"></a>00422     <span class="keywordflow">return</span> <span class="keyword">true</span>; <span class="comment">// !!!</span>
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a>00425 
<a name="l00426"></a>00426 <span class="keywordtype">bool</span>
<a name="l00427"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a8d214c9528d7530d72fff8c8d4b627f3">00427</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a8d214c9528d7530d72fff8c8d4b627f3">RODFDetectorCon::detectorsHaveCompleteTypes</a>()<span class="keyword"> const </span>{
<a name="l00428"></a>00428     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00429"></a>00429         <span class="keywordflow">if</span> ((*i)-&gt;getType() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfadfbd9f720b9a0209f988d72d552ac9d8" title="A not yet defined detector.">TYPE_NOT_DEFINED</a>) {
<a name="l00430"></a>00430             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00431"></a>00431         }
<a name="l00432"></a>00432     }
<a name="l00433"></a>00433     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00434"></a>00434 }
<a name="l00435"></a>00435 
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 <span class="keywordtype">bool</span>
<a name="l00438"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#aae21f7a29c29bc3a2a786063b9b64170">00438</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#aae21f7a29c29bc3a2a786063b9b64170">RODFDetectorCon::detectorsHaveRoutes</a>()<span class="keyword"> const </span>{
<a name="l00439"></a>00439     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00440"></a>00440         <span class="keywordflow">if</span> ((*i)-&gt;hasRoutes()) {
<a name="l00441"></a>00441             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00445"></a>00445 }
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 
<a name="l00448"></a>00448 <span class="keyword">const</span> std::vector&lt; RODFDetector*&gt; &amp;
<a name="l00449"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0eb2efc13ffd1ece233be388d4dd05bb">00449</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0eb2efc13ffd1ece233be388d4dd05bb">RODFDetectorCon::getDetectors</a>()<span class="keyword"> const </span>{
<a name="l00450"></a>00450     <span class="keywordflow">return</span> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>;
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 
<a name="l00454"></a>00454 <span class="keywordtype">void</span>
<a name="l00455"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a34b04415e98c954004194e1109e26783">00455</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a34b04415e98c954004194e1109e26783">RODFDetectorCon::save</a>(<span class="keyword">const</span> std::string&amp; file)<span class="keyword"> const </span>{
<a name="l00456"></a>00456     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00457"></a>00457     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;detectors&quot;</span>);
<a name="l00458"></a>00458     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00459"></a>00459         out &lt;&lt; <span class="stringliteral">&quot;   &lt;&quot;</span> &lt;&lt; <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403bad8998ab4c0b7c6df94e39f102538083b">SUMO_TAG_DETECTOR_DEFINITION</a>) &lt;&lt; <span class="stringliteral">&quot; id=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>((*i)-&gt;getID())
<a name="l00460"></a>00460             &lt;&lt; <span class="stringliteral">&quot;\&quot; lane=\&quot;&quot;</span> &lt;&lt; (*i)-&gt;getLaneID()
<a name="l00461"></a>00461             &lt;&lt; <span class="stringliteral">&quot;\&quot; pos=\&quot;&quot;</span> &lt;&lt; (*i)-&gt;getPos();
<a name="l00462"></a>00462         <span class="keywordflow">switch</span> ((*i)-&gt;getType()) {
<a name="l00463"></a>00463             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa1e166e9cf0cb4f3cb8133c1dd2791382" title="An in-between detector.">BETWEEN_DETECTOR</a>:
<a name="l00464"></a>00464                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;between\&quot;&quot;</span>;
<a name="l00465"></a>00465                 <span class="keywordflow">break</span>;
<a name="l00466"></a>00466             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>:
<a name="l00467"></a>00467                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;source\&quot;&quot;</span>;
<a name="l00468"></a>00468                 <span class="keywordflow">break</span>;
<a name="l00469"></a>00469             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa5183eceb6a7e1aa292105cd8da85b7f7">SINK_DETECTOR</a>:
<a name="l00470"></a>00470                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;sink\&quot;&quot;</span>;
<a name="l00471"></a>00471                 <span class="keywordflow">break</span>;
<a name="l00472"></a>00472             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa8f28890d721e1cd91ed5c3b84c6407ca" title="A detector which had to be discarded (!!!).">DISCARDED_DETECTOR</a>:
<a name="l00473"></a>00473                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;discarded\&quot;&quot;</span>;
<a name="l00474"></a>00474                 <span class="keywordflow">break</span>;
<a name="l00475"></a>00475             <span class="keywordflow">default</span>:
<a name="l00476"></a>00476                 <span class="keywordflow">throw</span> 1;
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478         out &lt;&lt; <span class="stringliteral">&quot;/&gt;\n&quot;</span>;
<a name="l00479"></a>00479     }
<a name="l00480"></a>00480     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00481"></a>00481 }
<a name="l00482"></a>00482 
<a name="l00483"></a>00483 
<a name="l00484"></a>00484 <span class="keywordtype">void</span>
<a name="l00485"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#ad792e6b5822ccb5b5a89017fc5375977">00485</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#ad792e6b5822ccb5b5a89017fc5375977">RODFDetectorCon::saveAsPOIs</a>(<span class="keyword">const</span> std::string&amp; file)<span class="keyword"> const </span>{
<a name="l00486"></a>00486     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00487"></a>00487     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;pois&quot;</span>);
<a name="l00488"></a>00488     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00489"></a>00489         out &lt;&lt; <span class="stringliteral">&quot;   &lt;poi id=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>((*i)-&gt;getID());
<a name="l00490"></a>00490         <span class="keywordflow">switch</span> ((*i)-&gt;getType()) {
<a name="l00491"></a>00491             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa1e166e9cf0cb4f3cb8133c1dd2791382" title="An in-between detector.">BETWEEN_DETECTOR</a>:
<a name="l00492"></a>00492                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;between_detector_position\&quot; color=\&quot;0,0,1\&quot;&quot;</span>;
<a name="l00493"></a>00493                 <span class="keywordflow">break</span>;
<a name="l00494"></a>00494             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>:
<a name="l00495"></a>00495                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;source_detector_position\&quot; color=\&quot;0,1,0\&quot;&quot;</span>;
<a name="l00496"></a>00496                 <span class="keywordflow">break</span>;
<a name="l00497"></a>00497             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa5183eceb6a7e1aa292105cd8da85b7f7">SINK_DETECTOR</a>:
<a name="l00498"></a>00498                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;sink_detector_position\&quot; color=\&quot;1,0,0\&quot;&quot;</span>;
<a name="l00499"></a>00499                 <span class="keywordflow">break</span>;
<a name="l00500"></a>00500             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa8f28890d721e1cd91ed5c3b84c6407ca" title="A detector which had to be discarded (!!!).">DISCARDED_DETECTOR</a>:
<a name="l00501"></a>00501                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;discarded_detector_position\&quot; color=\&quot;.2,.2,.2\&quot;&quot;</span>;
<a name="l00502"></a>00502                 <span class="keywordflow">break</span>;
<a name="l00503"></a>00503             <span class="keywordflow">default</span>:
<a name="l00504"></a>00504                 <span class="keywordflow">throw</span> 1;
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506         out &lt;&lt; <span class="stringliteral">&quot; lane=\&quot;&quot;</span> &lt;&lt; (*i)-&gt;getLaneID() &lt;&lt; <span class="stringliteral">&quot;\&quot; pos=\&quot;&quot;</span>
<a name="l00507"></a>00507             &lt;&lt; (*i)-&gt;getPos() &lt;&lt; <span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00508"></a>00508     }
<a name="l00509"></a>00509     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00510"></a>00510 }
<a name="l00511"></a>00511 
<a name="l00512"></a>00512 
<a name="l00513"></a>00513 <span class="keywordtype">void</span>
<a name="l00514"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a8b3d59fdba8cb434000d553a41eb215d">00514</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a8b3d59fdba8cb434000d553a41eb215d">RODFDetectorCon::saveRoutes</a>(<span class="keyword">const</span> std::string&amp; file)<span class="keyword"> const </span>{
<a name="l00515"></a>00515     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00516"></a>00516     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;routes&quot;</span>);
<a name="l00517"></a>00517     std::vector&lt;std::string&gt; saved;
<a name="l00518"></a>00518     <span class="comment">// write for source detectors</span>
<a name="l00519"></a>00519     <span class="keywordtype">bool</span> lastWasSaved = <span class="keyword">true</span>;
<a name="l00520"></a>00520     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00521"></a>00521         <span class="keywordflow">if</span> ((*i)-&gt;getType() != <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>) {
<a name="l00522"></a>00522             <span class="comment">// do not build routes for other than sources</span>
<a name="l00523"></a>00523             <span class="keywordflow">continue</span>;
<a name="l00524"></a>00524         }
<a name="l00525"></a>00525         <span class="keywordflow">if</span> (lastWasSaved) {
<a name="l00526"></a>00526             out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528         lastWasSaved = (*i)-&gt;writeRoutes(saved, out);
<a name="l00529"></a>00529     }
<a name="l00530"></a>00530     out &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00531"></a>00531     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00532"></a>00532 }
<a name="l00533"></a>00533 
<a name="l00534"></a>00534 
<a name="l00535"></a>00535 <span class="keyword">const</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>&amp;
<a name="l00536"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7c04ef039a7fd6a0b5980109410a08eb">00536</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7c04ef039a7fd6a0b5980109410a08eb">RODFDetectorCon::getDetector</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)<span class="keyword"> const </span>{
<a name="l00537"></a>00537     <span class="keywordflow">return</span> *(<a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>.find(<span class="keywordtype">id</span>)-&gt;second);
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 <span class="keywordtype">bool</span>
<a name="l00542"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a27a63f3c75a41f72eb91299c79f9e311">00542</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a27a63f3c75a41f72eb91299c79f9e311">RODFDetectorCon::knows</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)<span class="keyword"> const </span>{
<a name="l00543"></a>00543     <span class="keywordflow">return</span> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>.find(<span class="keywordtype">id</span>) != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>.end();
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 
<a name="l00547"></a>00547 <span class="keywordtype">void</span>
<a name="l00548"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7804019fadb655ac5dba03aca270ce6c">00548</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7804019fadb655ac5dba03aca270ce6c">RODFDetectorCon::writeEmitters</a>(<span class="keyword">const</span> std::string&amp; file,
<a name="l00549"></a>00549                                <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows,
<a name="l00550"></a>00550                                <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startTime, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endTime,
<a name="l00551"></a>00551                                <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stepOffset, <span class="keyword">const</span> <a class="code" href="../../d8/d49/class_r_o_d_f_net.html" title="A DFROUTER-network.">RODFNet</a>&amp; net,
<a name="l00552"></a>00552                                <span class="keywordtype">bool</span> writeCalibrators,
<a name="l00553"></a>00553                                <span class="keywordtype">bool</span> includeUnusedRoutes,
<a name="l00554"></a>00554                                <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> scale,
<a name="l00555"></a>00555                                <span class="keywordtype">int</span> maxFollower,
<a name="l00556"></a>00556                                <span class="keywordtype">bool</span> insertionsOnly) {
<a name="l00557"></a>00557     <span class="comment">// compute turn probabilities at detector</span>
<a name="l00558"></a>00558     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00559"></a>00559         (*i)-&gt;computeSplitProbabilities(&amp;net, *<span class="keyword">this</span>, flows, startTime, endTime, stepOffset);
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561     <span class="comment">//</span>
<a name="l00562"></a>00562     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00563"></a>00563     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;additional&quot;</span>);
<a name="l00564"></a>00564     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00565"></a>00565         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det = *i;
<a name="l00566"></a>00566         <span class="comment">// get file name for values (emitter/calibrator definition)</span>
<a name="l00567"></a>00567         std::string escapedID = <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>());
<a name="l00568"></a>00568         std::string defFileName;
<a name="l00569"></a>00569         <span class="keywordflow">if</span> (det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>) {
<a name="l00570"></a>00570             defFileName = file;
<a name="l00571"></a>00571         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (writeCalibrators &amp;&amp; det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa1e166e9cf0cb4f3cb8133c1dd2791382" title="An in-between detector.">BETWEEN_DETECTOR</a>) {
<a name="l00572"></a>00572             defFileName = <a class="code" href="../../de/d41/class_file_helpers.html#a97a27cea04e247e007b8fa9c6beef6fe" title="Removes the file information from the given path.">FileHelpers::getFilePath</a>(file) + <span class="stringliteral">&quot;calibrator_&quot;</span> + escapedID + <span class="stringliteral">&quot;.def.xml&quot;</span>;
<a name="l00573"></a>00573         } <span class="keywordflow">else</span> {
<a name="l00574"></a>00574             defFileName = <a class="code" href="../../de/d41/class_file_helpers.html#a97a27cea04e247e007b8fa9c6beef6fe" title="Removes the file information from the given path.">FileHelpers::getFilePath</a>(file) + <span class="stringliteral">&quot;other_&quot;</span> + escapedID + <span class="stringliteral">&quot;.def.xml&quot;</span>;
<a name="l00575"></a>00575             <span class="keywordflow">continue</span>;
<a name="l00576"></a>00576         }
<a name="l00577"></a>00577         <span class="comment">// try to write the definition</span>
<a name="l00578"></a>00578         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> defaultSpeed = net.<a class="code" href="../../de/def/class_r_o_net.html#a6ba12e67b00a1536c4ef8e106c85aabb" title="Retrieves an edge from the network.">getEdge</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0c04c89c56bc8cf3aac2bdf927544ff8" title="Returns the id of the edge this detector is placed on.">getEdgeID</a>())-&gt;getSpeed();
<a name="l00579"></a>00579         <span class="comment">//  ... compute routes&#39; distribution over time</span>
<a name="l00580"></a>00580         std::map&lt;size_t, RandomDistributor&lt;size_t&gt;* &gt; dists;
<a name="l00581"></a>00581         <span class="keywordflow">if</span> (!insertionsOnly &amp;&amp; flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a57558ceb5b181cca0b5536fd53046637">knows</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>())) {
<a name="l00582"></a>00582             det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a4cf9bd1b78866a1cd17a5d6f68b12d44">buildDestinationDistribution</a>(*<span class="keyword">this</span>, flows, startTime, endTime, stepOffset, net, dists, maxFollower);
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584         <span class="comment">//  ... write the definition</span>
<a name="l00585"></a>00585         <span class="keywordflow">if</span> (!det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#ab02beb609ea7b9d57622c0e57f445076">writeEmitterDefinition</a>(defFileName, dists, flows, startTime, endTime, stepOffset, includeUnusedRoutes, scale, insertionsOnly, defaultSpeed)) {
<a name="l00586"></a>00586             <span class="comment">// skip if something failed... (!!!)</span>
<a name="l00587"></a>00587             <span class="keywordflow">continue</span>;
<a name="l00588"></a>00588         }
<a name="l00589"></a>00589         <span class="comment">//  ... clear temporary values</span>
<a name="l00590"></a>00590         <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a5eb56883f896653bd0f298a536090f7f" title="Clears the given distributions map, deleting the timed distributions.">clearDists</a>(dists);
<a name="l00591"></a>00591         <span class="comment">// write the declaration into the file</span>
<a name="l00592"></a>00592         <span class="keywordflow">if</span> (writeCalibrators &amp;&amp; det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa1e166e9cf0cb4f3cb8133c1dd2791382" title="An in-between detector.">BETWEEN_DETECTOR</a>) {
<a name="l00593"></a>00593             out &lt;&lt; <span class="stringliteral">&quot;   &lt;calibrator id=\&quot;calibrator_&quot;</span> &lt;&lt; escapedID
<a name="l00594"></a>00594                 &lt;&lt; <span class="stringliteral">&quot;\&quot; pos=\&quot;&quot;</span> &lt;&lt; det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a36b96ba4a63cbeb023953e5af277fb59" title="Returns the position at which the detector lies.">getPos</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00595"></a>00595                 &lt;&lt; <span class="stringliteral">&quot;lane=\&quot;&quot;</span> &lt;&lt; det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a59594e8f73bfae7e1f764419d09b6b38" title="Returns the id of the lane this detector is placed on.">getLaneID</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00596"></a>00596                 &lt;&lt; <span class="stringliteral">&quot;friendlyPos=\&quot;x\&quot; &quot;</span> <span class="comment">// !!!</span>
<a name="l00597"></a>00597                 &lt;&lt; <span class="stringliteral">&quot;file=\&quot;&quot;</span> &lt;&lt; defFileName &lt;&lt; <span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599     }
<a name="l00600"></a>00600     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 
<a name="l00603"></a>00603 
<a name="l00604"></a>00604 <span class="keywordtype">void</span>
<a name="l00605"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a34874b915542b40d54a77d389ce6b9ef">00605</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a34874b915542b40d54a77d389ce6b9ef">RODFDetectorCon::writeEmitterPOIs</a>(<span class="keyword">const</span> std::string&amp; file,
<a name="l00606"></a>00606                                   <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows) {
<a name="l00607"></a>00607     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00608"></a>00608     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;additional&quot;</span>);
<a name="l00609"></a>00609     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00610"></a>00610         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det = *i;
<a name="l00611"></a>00611         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> flow = flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a98a11cca11b39091b6fbf3ebb6a329a7">getFlowSumSecure</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>());
<a name="l00612"></a>00612         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> col = flow / flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a5874cdcf1bdca9e9c27c587547f8f2a9">getMaxDetectorFlow</a>();
<a name="l00613"></a>00613         col = (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(col / 2. + .5);
<a name="l00614"></a>00614         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> r, g, b;
<a name="l00615"></a>00615         r = g = b = 0;
<a name="l00616"></a>00616         out &lt;&lt; <span class="stringliteral">&quot;   &lt;poi id=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>((*i)-&gt;getID()) &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; flow;
<a name="l00617"></a>00617         <span class="keywordflow">switch</span> ((*i)-&gt;getType()) {
<a name="l00618"></a>00618             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa1e166e9cf0cb4f3cb8133c1dd2791382" title="An in-between detector.">BETWEEN_DETECTOR</a>:
<a name="l00619"></a>00619                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;between_detector_position\&quot; color=\&quot;0,0,&quot;</span> &lt;&lt; col &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l00620"></a>00620                 <span class="keywordflow">break</span>;
<a name="l00621"></a>00621             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>:
<a name="l00622"></a>00622                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;source_detector_position\&quot; color=\&quot;0,&quot;</span> &lt;&lt; col &lt;&lt; <span class="stringliteral">&quot;,0\&quot;&quot;</span>;
<a name="l00623"></a>00623                 <span class="keywordflow">break</span>;
<a name="l00624"></a>00624             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa5183eceb6a7e1aa292105cd8da85b7f7">SINK_DETECTOR</a>:
<a name="l00625"></a>00625                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;sink_detector_position\&quot; color=\&quot;&quot;</span> &lt;&lt; col &lt;&lt; <span class="stringliteral">&quot;,0,0\&quot;&quot;</span>;
<a name="l00626"></a>00626                 <span class="keywordflow">break</span>;
<a name="l00627"></a>00627             <span class="keywordflow">case</span> <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa8f28890d721e1cd91ed5c3b84c6407ca" title="A detector which had to be discarded (!!!).">DISCARDED_DETECTOR</a>:
<a name="l00628"></a>00628                 out &lt;&lt; <span class="stringliteral">&quot;\&quot; type=\&quot;discarded_detector_position\&quot; color=\&quot;.2,.2,.2\&quot;&quot;</span>;
<a name="l00629"></a>00629                 <span class="keywordflow">break</span>;
<a name="l00630"></a>00630             <span class="keywordflow">default</span>:
<a name="l00631"></a>00631                 <span class="keywordflow">throw</span> 1;
<a name="l00632"></a>00632         }
<a name="l00633"></a>00633         out &lt;&lt; <span class="stringliteral">&quot; lane=\&quot;&quot;</span> &lt;&lt; (*i)-&gt;getLaneID() &lt;&lt; <span class="stringliteral">&quot;\&quot; pos=\&quot;&quot;</span> &lt;&lt; (*i)-&gt;getPos() &lt;&lt; <span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="keywordtype">int</span>
<a name="l00640"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a36e47bbacdacd16407c3d51d251707c1">00640</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a36e47bbacdacd16407c3d51d251707c1">RODFDetectorCon::getAggFlowFor</a>(<span class="keyword">const</span> <a class="code" href="../../de/df5/class_r_o_edge.html" title="A basic edge for routing applications.">ROEdge</a>* edge, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> time, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> period,
<a name="l00641"></a>00641                                <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp;)<span class="keyword"> const </span>{
<a name="l00642"></a>00642     <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c95a90e7806e4b0d21edfae15b73465">UNUSED_PARAMETER</a>(period);
<a name="l00643"></a>00643     <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c95a90e7806e4b0d21edfae15b73465">UNUSED_PARAMETER</a>(time);
<a name="l00644"></a>00644     <span class="keywordflow">if</span> (edge == 0) {
<a name="l00645"></a>00645         <span class="keywordflow">return</span> 0;
<a name="l00646"></a>00646     }
<a name="l00647"></a>00647 <span class="comment">//    SUMOReal stepOffset = 60; // !!!</span>
<a name="l00648"></a>00648 <span class="comment">//    SUMOReal startTime = 0; // !!!</span>
<a name="l00649"></a>00649 <span class="comment">//    cout &lt;&lt; edge-&gt;getID() &lt;&lt; endl;</span>
<a name="l00650"></a>00650     assert(<a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>.find(edge-&gt;<a class="code" href="../../de/df5/class_r_o_edge.html#a48b26b5904e8084daa327cd1c44784cb" title="Returns the id of the edge.">getID</a>()) != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>.end());
<a name="l00651"></a>00651     <span class="keyword">const</span> std::vector&lt;FlowDef&gt; &amp;flows = <span class="keyword">static_cast&lt;</span><span class="keyword">const </span><a class="code" href="../../d8/d77/class_r_o_d_f_edge.html">RODFEdge</a>*<span class="keyword">&gt;</span>(edge)-&gt;getFlows();
<a name="l00652"></a>00652     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> agg = 0;
<a name="l00653"></a>00653     <span class="keywordflow">for</span> (std::vector&lt;FlowDef&gt;::const_iterator i = flows.begin(); i != flows.end(); ++i) {
<a name="l00654"></a>00654         <span class="keyword">const</span> <a class="code" href="../../d1/db7/struct_flow_def.html" title="Definition of the traffic during a certain time containing the flows and speeds.">FlowDef</a>&amp; srcFD = *i;
<a name="l00655"></a>00655         <span class="keywordflow">if</span> (srcFD.<a class="code" href="../../d1/db7/struct_flow_def.html#a35981c3043a34c59cd6d16e65347c988">qLKW</a> &gt;= 0) {
<a name="l00656"></a>00656             agg += srcFD.<a class="code" href="../../d1/db7/struct_flow_def.html#a35981c3043a34c59cd6d16e65347c988">qLKW</a>;
<a name="l00657"></a>00657         }
<a name="l00658"></a>00658         <span class="keywordflow">if</span> (srcFD.<a class="code" href="../../d1/db7/struct_flow_def.html#a4843347a3a10be392d237d893c2108a1">qPKW</a> &gt;= 0) {
<a name="l00659"></a>00659             agg += srcFD.<a class="code" href="../../d1/db7/struct_flow_def.html#a4843347a3a10be392d237d893c2108a1">qPKW</a>;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>) agg;
<a name="l00663"></a>00663     <span class="comment">/* !!! make this time variable</span>
<a name="l00664"></a>00664 <span class="comment">    if (flows.size()!=0) {</span>
<a name="l00665"></a>00665 <span class="comment">        SUMOReal agg = 0;</span>
<a name="l00666"></a>00666 <span class="comment">        size_t beginIndex = (int)((time/stepOffset) - startTime);  // !!! falsch!!!</span>
<a name="l00667"></a>00667 <span class="comment">        for (SUMOTime t=0; t&lt;period&amp;&amp;beginIndex&lt;flows.size(); t+=(SUMOTime) stepOffset) {</span>
<a name="l00668"></a>00668 <span class="comment">            const FlowDef &amp;srcFD = flows[beginIndex++];</span>
<a name="l00669"></a>00669 <span class="comment">            if (srcFD.qLKW&gt;=0) {</span>
<a name="l00670"></a>00670 <span class="comment">                agg += srcFD.qLKW;</span>
<a name="l00671"></a>00671 <span class="comment">            }</span>
<a name="l00672"></a>00672 <span class="comment">            if (srcFD.qPKW&gt;=0) {</span>
<a name="l00673"></a>00673 <span class="comment">                agg += srcFD.qPKW;</span>
<a name="l00674"></a>00674 <span class="comment">            }</span>
<a name="l00675"></a>00675 <span class="comment">        }</span>
<a name="l00676"></a>00676 <span class="comment">        return (int) agg;</span>
<a name="l00677"></a>00677 <span class="comment">    }</span>
<a name="l00678"></a>00678 <span class="comment">    */</span>
<a name="l00679"></a>00679 <span class="comment">//    return -1;</span>
<a name="l00680"></a>00680 }
<a name="l00681"></a>00681 
<a name="l00682"></a>00682 
<a name="l00683"></a>00683 <span class="keywordtype">void</span>
<a name="l00684"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#aa0ba45b204aa20ff99b0b591402259aa">00684</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#aa0ba45b204aa20ff99b0b591402259aa">RODFDetectorCon::writeSpeedTrigger</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d49/class_r_o_d_f_net.html" title="A DFROUTER-network.">RODFNet</a>* <span class="keyword">const</span> net,
<a name="l00685"></a>00685                                    <span class="keyword">const</span> std::string&amp; file,
<a name="l00686"></a>00686                                    <span class="keyword">const</span> <a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows,
<a name="l00687"></a>00687                                    <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startTime, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endTime,
<a name="l00688"></a>00688                                    <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> stepOffset) {
<a name="l00689"></a>00689     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00690"></a>00690     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;additional&quot;</span>);
<a name="l00691"></a>00691     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00692"></a>00692         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det = *i;
<a name="l00693"></a>00693         <span class="comment">// write the declaration into the file</span>
<a name="l00694"></a>00694         <span class="keywordflow">if</span> (det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa5183eceb6a7e1aa292105cd8da85b7f7">SINK_DETECTOR</a> &amp;&amp; flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a57558ceb5b181cca0b5536fd53046637">knows</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>())) {
<a name="l00695"></a>00695             std::string filename = <a class="code" href="../../de/d41/class_file_helpers.html#a97a27cea04e247e007b8fa9c6beef6fe" title="Removes the file information from the given path.">FileHelpers::getFilePath</a>(file) + <span class="stringliteral">&quot;vss_&quot;</span> + det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>() + <span class="stringliteral">&quot;.def.xml&quot;</span>;
<a name="l00696"></a>00696             out &lt;&lt; <span class="stringliteral">&quot;   &lt;variableSpeedSign id=\&quot;vss_&quot;</span> &lt;&lt; <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>()) &lt;&lt; <span class="charliteral">&#39;\&quot;&#39;</span>
<a name="l00697"></a>00697                 &lt;&lt; <span class="stringliteral">&quot; lanes=\&quot;&quot;</span> &lt;&lt; det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a59594e8f73bfae7e1f764419d09b6b38" title="Returns the id of the lane this detector is placed on.">getLaneID</a>() &lt;&lt; <span class="charliteral">&#39;\&quot;&#39;</span>
<a name="l00698"></a>00698                 &lt;&lt; <span class="stringliteral">&quot; file=\&quot;&quot;</span> &lt;&lt; filename &lt;&lt; <span class="stringliteral">&quot;\&quot;/&gt;\n&quot;</span>;
<a name="l00699"></a>00699             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> defaultSpeed = net != 0 ? net-&gt;<a class="code" href="../../de/def/class_r_o_net.html#a6ba12e67b00a1536c4ef8e106c85aabb" title="Retrieves an edge from the network.">getEdge</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0c04c89c56bc8cf3aac2bdf927544ff8" title="Returns the id of the edge this detector is placed on.">getEdgeID</a>())-&gt;getSpeed() : (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) 200.;
<a name="l00700"></a>00700             det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a7153adec2f2df8a587777137ed6943e9">writeSingleSpeedTrigger</a>(filename, flows, startTime, endTime, stepOffset, defaultSpeed);
<a name="l00701"></a>00701         }
<a name="l00702"></a>00702     }
<a name="l00703"></a>00703     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00704"></a>00704 }
<a name="l00705"></a>00705 
<a name="l00706"></a>00706 
<a name="l00707"></a>00707 <span class="keywordtype">void</span>
<a name="l00708"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#afe61a862c5db6de2823b8583d561d597">00708</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#afe61a862c5db6de2823b8583d561d597">RODFDetectorCon::writeEndRerouterDetectors</a>(<span class="keyword">const</span> std::string&amp; file) {
<a name="l00709"></a>00709     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00710"></a>00710     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;additional&quot;</span>);
<a name="l00711"></a>00711     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00712"></a>00712         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det = *i;
<a name="l00713"></a>00713         <span class="comment">// write the declaration into the file</span>
<a name="l00714"></a>00714         <span class="keywordflow">if</span> (det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa5183eceb6a7e1aa292105cd8da85b7f7">SINK_DETECTOR</a>) {
<a name="l00715"></a>00715             out &lt;&lt; <span class="stringliteral">&quot;   &lt;rerouter id=\&quot;endrerouter_&quot;</span> &lt;&lt; <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>())
<a name="l00716"></a>00716                 &lt;&lt; <span class="stringliteral">&quot;\&quot; edges=\&quot;&quot;</span> &lt;&lt;
<a name="l00717"></a>00717                 det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a59594e8f73bfae7e1f764419d09b6b38" title="Returns the id of the lane this detector is placed on.">getLaneID</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; attr=\&quot;reroute\&quot; pos=\&quot;0\&quot; file=\&quot;endrerouter_&quot;</span>
<a name="l00718"></a>00718                 &lt;&lt; det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>() &lt;&lt; <span class="stringliteral">&quot;.def.xml\&quot;/&gt;\n&quot;</span>;
<a name="l00719"></a>00719         }
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00722"></a>00722 }
<a name="l00723"></a>00723 
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 <span class="keywordtype">void</span>
<a name="l00726"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a598d73b1fb132b8d632d90e42bc18c6e">00726</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a598d73b1fb132b8d632d90e42bc18c6e">RODFDetectorCon::writeValidationDetectors</a>(<span class="keyword">const</span> std::string&amp; file,
<a name="l00727"></a>00727         <span class="keywordtype">bool</span> includeSources,
<a name="l00728"></a>00728         <span class="keywordtype">bool</span> singleFile, <span class="keywordtype">bool</span> friendly) {
<a name="l00729"></a>00729     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; out = <a class="code" href="../../de/da0/class_output_device.html#a235c99951018d43e355900697460188b" title="Returns the described OutputDevice.">OutputDevice::getDevice</a>(file);
<a name="l00730"></a>00730     out.<a class="code" href="../../de/da0/class_output_device.html#a0692e559fb1bbdf039b0e29ca16f68ff" title="Writes an XML header with optional configuration.">writeXMLHeader</a>(<span class="stringliteral">&quot;additional&quot;</span>);
<a name="l00731"></a>00731     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00732"></a>00732         <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det = *i;
<a name="l00733"></a>00733         <span class="comment">// write the declaration into the file</span>
<a name="l00734"></a>00734         <span class="keywordflow">if</span> (det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() != <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a> || includeSources) {
<a name="l00735"></a>00735             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> pos = det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a36b96ba4a63cbeb023953e5af277fb59" title="Returns the position at which the detector lies.">getPos</a>();
<a name="l00736"></a>00736             <span class="keywordflow">if</span> (det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#aa98843425ce0eb5b4c58ec1bdc239b0c" title="Returns the type of the detector.">getType</a>() == <a class="code" href="../../d6/d23/_r_o_d_f_detector_8h.html#a5df1c599a44172df5568506e2aac43cfa57dcad06b60933a363feb5392deab4dd" title="A source detector.">SOURCE_DETECTOR</a>) {
<a name="l00737"></a>00737                 pos += 1;
<a name="l00738"></a>00738             }
<a name="l00739"></a>00739             out &lt;&lt; <span class="stringliteral">&quot;   &lt;detector id=\&quot;validation_&quot;</span> &lt;&lt; <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>()) &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00740"></a>00740                 &lt;&lt; <span class="stringliteral">&quot;lane=\&quot;&quot;</span> &lt;&lt; det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a59594e8f73bfae7e1f764419d09b6b38" title="Returns the id of the lane this detector is placed on.">getLaneID</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00741"></a>00741                 &lt;&lt; <span class="stringliteral">&quot;pos=\&quot;&quot;</span> &lt;&lt; pos &lt;&lt; <span class="stringliteral">&quot;\&quot; &quot;</span>
<a name="l00742"></a>00742                 &lt;&lt; <span class="stringliteral">&quot;freq=\&quot;60\&quot; &quot;</span>;
<a name="l00743"></a>00743             <span class="keywordflow">if</span> (friendly) {
<a name="l00744"></a>00744                 out &lt;&lt; <span class="stringliteral">&quot;friendlyPos=\&quot;x\&quot; &quot;</span>;
<a name="l00745"></a>00745             }
<a name="l00746"></a>00746             <span class="keywordflow">if</span> (!singleFile) {
<a name="l00747"></a>00747                 out &lt;&lt; <span class="stringliteral">&quot;file=\&quot;validation_det_&quot;</span> &lt;&lt; <a class="code" href="../../d3/d93/class_string_utils.html#abdb7dde528959d5d4bae2a1d7e31680d" title="Replaces the standard escapes by their XML entities.">StringUtils::escapeXML</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>()) &lt;&lt; <span class="stringliteral">&quot;.xml\&quot;/&gt;\n&quot;</span>;
<a name="l00748"></a>00748             } <span class="keywordflow">else</span> {
<a name="l00749"></a>00749                 out &lt;&lt; <span class="stringliteral">&quot;file=\&quot;validation_dets.xml\&quot;/&gt;\n&quot;</span>;
<a name="l00750"></a>00750             }
<a name="l00751"></a>00751         }
<a name="l00752"></a>00752     }
<a name="l00753"></a>00753     out.<a class="code" href="../../de/da0/class_output_device.html#a3048dc6585e7b5410104c4d64be91c9e" title="Closes the device and removes it from the dictionary.">close</a>();
<a name="l00754"></a>00754 }
<a name="l00755"></a>00755 
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 <span class="keywordtype">void</span>
<a name="l00758"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a4cfe33816deba13eaffbc2fc6c4b6e14">00758</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a4cfe33816deba13eaffbc2fc6c4b6e14">RODFDetectorCon::removeDetector</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>) {
<a name="l00759"></a>00759     <span class="comment">//</span>
<a name="l00760"></a>00760     std::map&lt;std::string, RODFDetector*&gt;::iterator ri1 = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>.find(<span class="keywordtype">id</span>);
<a name="l00761"></a>00761     <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* oldDet = (*ri1).second;
<a name="l00762"></a>00762     <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7314fc19d40afafb3c9d34756e26c365">myDetectorMap</a>.erase(ri1);
<a name="l00763"></a>00763     <span class="comment">//</span>
<a name="l00764"></a>00764     std::vector&lt;RODFDetector*&gt;::iterator ri2 =
<a name="l00765"></a>00765         find(<a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(), <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(), oldDet);
<a name="l00766"></a>00766     <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.erase(ri2);
<a name="l00767"></a>00767     <span class="comment">//</span>
<a name="l00768"></a>00768     <span class="keywordtype">bool</span> found = <span class="keyword">false</span>;
<a name="l00769"></a>00769     <span class="keywordflow">for</span> (std::map&lt;std::string, std::vector&lt;RODFDetector*&gt; &gt;::iterator rr3 = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>.begin(); !found &amp;&amp; rr3 != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a0b080243026501a40262dba764b49e1d">myDetectorEdgeMap</a>.end(); ++rr3) {
<a name="l00770"></a>00770         std::vector&lt;RODFDetector*&gt; &amp;dets = (*rr3).second;
<a name="l00771"></a>00771         <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::iterator ri3 = dets.begin(); !found &amp;&amp; ri3 != dets.end();) {
<a name="l00772"></a>00772             <span class="keywordflow">if</span> (*ri3 == oldDet) {
<a name="l00773"></a>00773                 found = <span class="keyword">true</span>;
<a name="l00774"></a>00774                 ri3 = dets.erase(ri3);
<a name="l00775"></a>00775             } <span class="keywordflow">else</span> {
<a name="l00776"></a>00776                 ++ri3;
<a name="l00777"></a>00777             }
<a name="l00778"></a>00778         }
<a name="l00779"></a>00779     }
<a name="l00780"></a>00780     <span class="keyword">delete</span> oldDet;
<a name="l00781"></a>00781 }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 
<a name="l00784"></a>00784 <span class="keywordtype">void</span>
<a name="l00785"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a8c49d6aae208c99c14c1174fa442b5ce">00785</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a8c49d6aae208c99c14c1174fa442b5ce">RODFDetectorCon::guessEmptyFlows</a>(<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html" title="A container for flows.">RODFDetectorFlows</a>&amp; flows) {
<a name="l00786"></a>00786     <span class="comment">// routes must be built (we have ensured this in main)</span>
<a name="l00787"></a>00787     <span class="comment">// detector followers/prior must be build (we have ensured this in main)</span>
<a name="l00788"></a>00788     <span class="comment">//</span>
<a name="l00789"></a>00789     <span class="keywordtype">bool</span> changed = <span class="keyword">true</span>;
<a name="l00790"></a>00790     <span class="keywordflow">while</span> (changed) {
<a name="l00791"></a>00791         <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00792"></a>00792             <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* det = *i;
<a name="l00793"></a>00793             <span class="keyword">const</span> std::vector&lt;RODFDetector*&gt; &amp;prior = det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a861c4cb442ce796b02f882cac96fa419">getPriorDetectors</a>();
<a name="l00794"></a>00794             <span class="keyword">const</span> std::vector&lt;RODFDetector*&gt; &amp;follower = det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0bdd48474d56df8f2616b686286e3047">getFollowerDetectors</a>();
<a name="l00795"></a>00795             <span class="keywordtype">size_t</span> noFollowerWithRoutes = 0;
<a name="l00796"></a>00796             <span class="keywordtype">size_t</span> noPriorWithRoutes = 0;
<a name="l00797"></a>00797             <span class="comment">// count occurences of detectors with/without routes</span>
<a name="l00798"></a>00798             std::vector&lt;RODFDetector*&gt;::const_iterator j;
<a name="l00799"></a>00799             <span class="keywordflow">for</span> (j = prior.begin(); j != prior.end(); ++j) {
<a name="l00800"></a>00800                 <span class="keywordflow">if</span> (flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a57558ceb5b181cca0b5536fd53046637">knows</a>((*j)-&gt;getID())) {
<a name="l00801"></a>00801                     ++noPriorWithRoutes;
<a name="l00802"></a>00802                 }
<a name="l00803"></a>00803             }
<a name="l00804"></a>00804             assert(noPriorWithRoutes &lt;= prior.size());
<a name="l00805"></a>00805             <span class="keywordflow">for</span> (j = follower.begin(); j != follower.end(); ++j) {
<a name="l00806"></a>00806                 <span class="keywordflow">if</span> (flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a57558ceb5b181cca0b5536fd53046637">knows</a>((*j)-&gt;getID())) {
<a name="l00807"></a>00807                     ++noFollowerWithRoutes;
<a name="l00808"></a>00808                 }
<a name="l00809"></a>00809             }
<a name="l00810"></a>00810             assert(noFollowerWithRoutes &lt;= follower.size());
<a name="l00811"></a>00811 
<a name="l00812"></a>00812             <span class="comment">// do not process detectors which have no routes</span>
<a name="l00813"></a>00813             <span class="keywordflow">if</span> (!flows.<a class="code" href="../../d6/d0f/class_r_o_d_f_detector_flows.html#a57558ceb5b181cca0b5536fd53046637">knows</a>(det-&gt;<a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html#a0f45d00d730be2214a0a02c5b30353c7" title="Returns the ID of this detector.">getID</a>())) {
<a name="l00814"></a>00814                 <span class="keywordflow">continue</span>;
<a name="l00815"></a>00815             }
<a name="l00816"></a>00816 
<a name="l00817"></a>00817             <span class="comment">// plain case: some of the following detectors have no routes</span>
<a name="l00818"></a>00818             <span class="keywordflow">if</span> (noFollowerWithRoutes == follower.size()) {
<a name="l00819"></a>00819                 <span class="comment">// the number of vehicles is the sum of all vehicles on prior</span>
<a name="l00820"></a>00820                 <span class="keywordflow">continue</span>;
<a name="l00821"></a>00821             }
<a name="l00822"></a>00822 
<a name="l00823"></a>00823         }
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825 }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 <span class="keyword">const</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>&amp;
<a name="l00829"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a6898301b7158bcf9398385100187bb63">00829</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a6898301b7158bcf9398385100187bb63">RODFDetectorCon::getAnyDetectorForEdge</a>(<span class="keyword">const</span> <a class="code" href="../../d8/d77/class_r_o_d_f_edge.html">RODFEdge</a>* <span class="keyword">const</span> edge)<span class="keyword"> const </span>{
<a name="l00830"></a>00830     <span class="keywordflow">for</span> (std::vector&lt;RODFDetector*&gt;::const_iterator i = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.begin(); i != <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a9a92ab2e4f826b8260ec4f8c61400af2">myDetectors</a>.end(); ++i) {
<a name="l00831"></a>00831         <span class="keywordflow">if</span> ((*i)-&gt;getEdgeID() == edge-&gt;<a class="code" href="../../de/df5/class_r_o_edge.html#a48b26b5904e8084daa327cd1c44784cb" title="Returns the id of the edge.">getID</a>()) {
<a name="l00832"></a>00832             <span class="keywordflow">return</span> **i;
<a name="l00833"></a>00833         }
<a name="l00834"></a>00834     }
<a name="l00835"></a>00835     <span class="keywordflow">throw</span> 1;
<a name="l00836"></a>00836 }
<a name="l00837"></a>00837 
<a name="l00838"></a>00838 
<a name="l00839"></a>00839 <span class="keywordtype">void</span>
<a name="l00840"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a5eb56883f896653bd0f298a536090f7f">00840</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a5eb56883f896653bd0f298a536090f7f" title="Clears the given distributions map, deleting the timed distributions.">RODFDetectorCon::clearDists</a>(std::map&lt;<span class="keywordtype">size_t</span>, <a class="code" href="../../d5/d9b/class_random_distributor.html" title="Represents a generic random distribution.">RandomDistributor&lt;size_t&gt;</a>* &gt; &amp;dists)<span class="keyword"> const </span>{
<a name="l00841"></a>00841     <span class="keywordflow">for</span> (std::map&lt;<span class="keywordtype">size_t</span>, <a class="code" href="../../d5/d9b/class_random_distributor.html" title="Represents a generic random distribution.">RandomDistributor&lt;size_t&gt;</a>* &gt;::iterator i = dists.begin(); i != dists.end(); ++i) {
<a name="l00842"></a>00842         <span class="keyword">delete</span>(*i).second;
<a name="l00843"></a>00843     }
<a name="l00844"></a>00844 }
<a name="l00845"></a>00845 
<a name="l00846"></a>00846 
<a name="l00847"></a>00847 <span class="keywordtype">void</span>
<a name="l00848"></a><a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a3da0dd0bbd1784e1bed001863b8d7245">00848</a> <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a3da0dd0bbd1784e1bed001863b8d7245">RODFDetectorCon::mesoJoin</a>(<span class="keyword">const</span> std::string&amp; nid,
<a name="l00849"></a>00849                           <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;oldids) {
<a name="l00850"></a>00850     <span class="comment">// build the new detector</span>
<a name="l00851"></a>00851     <span class="keyword">const</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>&amp; first = <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a7c04ef039a7fd6a0b5980109410a08eb">getDetector</a>(*(oldids.begin()));
<a name="l00852"></a>00852     <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>* newDet = <span class="keyword">new</span> <a class="code" href="../../d2/dd7/class_r_o_d_f_detector.html" title="Class representing a detector within the DFROUTER.">RODFDetector</a>(nid, first);
<a name="l00853"></a>00853     <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a50decc689de4a67087dc4368a6328dc8">addDetector</a>(newDet);
<a name="l00854"></a>00854     <span class="comment">// delete previous</span>
<a name="l00855"></a>00855     <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator i = oldids.begin(); i != oldids.end(); ++i) {
<a name="l00856"></a>00856         <a class="code" href="../../d5/d92/class_r_o_d_f_detector_con.html#a4cfe33816deba13eaffbc2fc6c4b6e14">removeDetector</a>(*i);
<a name="l00857"></a>00857     }
<a name="l00858"></a>00858 }
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="comment">/****************************************************************************/</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:11 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
