<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: MSRouteHandler.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_6b4e825611921d20a66b187b0ee8072c.html">microsim</a>
  </div>
</div>
<div class="contents">
<h1>MSRouteHandler.cpp</h1><a href="../../d3/dcd/_m_s_route_handler_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00010"></a>00010 <span class="comment">// Parser and container for routes during their loading</span>
<a name="l00011"></a>00011 <span class="comment">/****************************************************************************/</span>
<a name="l00012"></a>00012 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00013"></a>00013 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00014"></a>00014 <span class="comment">/****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00017"></a>00017 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00018"></a>00018 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00019"></a>00019 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00020"></a>00020 <span class="comment">//   (at your option) any later version.</span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="comment">/****************************************************************************/</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">// ===========================================================================</span>
<a name="l00026"></a>00026 <span class="comment">// included modules</span>
<a name="l00027"></a>00027 <span class="comment">// ===========================================================================</span>
<a name="l00028"></a>00028 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#else</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#endif</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/d24/_m_s_route_8h.html">microsim/MSRoute.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="../../da/dea/_m_s_edge_8h.html">microsim/MSEdge.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="../../db/d2e/_m_s_vehicle_type_8h.html">microsim/MSVehicleType.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="../../dc/d38/_m_s_vehicle_8h.html">microsim/MSVehicle.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="../../da/dea/_m_s_edge_8h.html">microsim/MSEdge.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/daf/_m_s_insertion_control_8h.html">microsim/MSInsertionControl.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="../../de/d52/_m_s_vehicle_control_8h.html">microsim/MSVehicleControl.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d38/_m_s_lane_8h.html">microsim/MSLane.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../df/dd2/_m_s_route_handler_8h.html">MSRouteHandler.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/df4/_m_s_person_control_8h.html">MSPersonControl.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="../../d2/d70/_s_u_m_o_s_a_x_handler_8h.html">utils/xml/SUMOSAXHandler.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html">utils/xml/SUMOXMLDefinitions.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/df7/_msg_handler_8h.html">utils/common/MsgHandler.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="../../da/d8e/_string_tokenizer_8h.html">utils/common/StringTokenizer.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db4/_util_exceptions_8h.html">utils/common/UtilExceptions.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d5c/_options_cont_8h.html">utils/options/OptionsCont.h</a>&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dfa/_m_s_net_8h.html">MSNet.h</a>&quot;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;<a class="code" href="../../d9/db0/_m_s_bus_stop_8h.html">microsim/trigger/MSBusStop.h</a>&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/dbe/_m_s_globals_8h.html">microsim/MSGlobals.h</a>&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;<a class="code" href="../../d5/d84/_s_u_m_o_vehicle_parser_helper_8h.html">utils/xml/SUMOVehicleParserHelper.h</a>&gt;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">// ===========================================================================</span>
<a name="l00065"></a>00065 <span class="comment">// method definitions</span>
<a name="l00066"></a>00066 <span class="comment">// ===========================================================================</span>
<a name="l00067"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#ab53ba792dfb736e2de5a25dda55ce5b3">00067</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ab53ba792dfb736e2de5a25dda55ce5b3" title="standard constructor">MSRouteHandler::MSRouteHandler</a>(<span class="keyword">const</span> std::string&amp; file,
<a name="l00068"></a>00068                                <span class="keywordtype">bool</span> addVehiclesDirectly) :
<a name="l00069"></a>00069     <a class="code" href="../../db/db8/class_s_u_m_o_s_a_x_handler.html" title="SAX-handler base for SUMO-files.">SUMOSAXHandler</a>(file),
<a name="l00070"></a>00070     myVehicleParameter(0),
<a name="l00071"></a>00071     myLastDepart(0),
<a name="l00072"></a>00072     myActivePlan(0),
<a name="l00073"></a>00073     myAddVehiclesDirectly(addVehiclesDirectly),
<a name="l00074"></a>00074     myCurrentVTypeDistribution(0),
<a name="l00075"></a>00075     myCurrentRouteDistribution(0),
<a name="l00076"></a>00076     myCurrentVType(0),
<a name="l00077"></a>00077     myScale(-1.),
<a name="l00078"></a>00078     myHaveWarnedAboutDeprecatedFriendlyPos(false),
<a name="l00079"></a>00079     myHaveWarnedAboutDeprecatedBusStop(false),
<a name="l00080"></a>00080     myHaveWarnedAboutDeprecatedVType(false),
<a name="l00081"></a>00081     myHaveWarnedAboutDeprecatedVTypeDistribution(false),
<a name="l00082"></a>00082     myHaveWarnedAboutDeprecatedVTypes(false),
<a name="l00083"></a>00083     myHaveWarnedAboutDeprecatedRefID(false) {
<a name="l00084"></a>00084     <a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc = <a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>();
<a name="l00085"></a>00085     <span class="keywordflow">if</span> (oc.<a class="code" href="../../db/d31/class_options_cont.html#a08a62e1f4fcf9acaefc97efce45609fc" title="Returns the information whether the named option is set.">isSet</a>(<span class="stringliteral">&quot;incremental-dua-step&quot;</span>)) {
<a name="l00086"></a>00086         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a79e8491318d1f2b5ab8f1e5fa7212b40" title="The scaling factor (especially for inc-dua).">myScale</a> = oc.<a class="code" href="../../db/d31/class_options_cont.html#ae244c2df910bcb4cb4d38ee784ee47f9" title="Returns the int-value of the named option (only for Option_Integer).">getInt</a>(<span class="stringliteral">&quot;incremental-dua-step&quot;</span>) / <span class="keyword">static_cast&lt;</span><a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a><span class="keyword">&gt;</span>(oc.<a class="code" href="../../db/d31/class_options_cont.html#ae244c2df910bcb4cb4d38ee784ee47f9" title="Returns the int-value of the named option (only for Option_Integer).">getInt</a>(<span class="stringliteral">&quot;incremental-dua-base&quot;</span>));
<a name="l00087"></a>00087     }
<a name="l00088"></a>00088     <span class="keywordflow">if</span> (oc.<a class="code" href="../../db/d31/class_options_cont.html#a08a62e1f4fcf9acaefc97efce45609fc" title="Returns the information whether the named option is set.">isSet</a>(<span class="stringliteral">&quot;scale&quot;</span>)) {
<a name="l00089"></a>00089         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a79e8491318d1f2b5ab8f1e5fa7212b40" title="The scaling factor (especially for inc-dua).">myScale</a> = oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;scale&quot;</span>);
<a name="l00090"></a>00090     }
<a name="l00091"></a>00091     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.reserve(100);
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
<a name="l00094"></a>00094 
<a name="l00095"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#ac1f95ed4003c6410a09d21442232fe50">00095</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ac1f95ed4003c6410a09d21442232fe50" title="standard destructor">MSRouteHandler::~MSRouteHandler</a>() {
<a name="l00096"></a>00096 }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a>
<a name="l00100"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a52f58c91297bf312141948da5decc2dd">00100</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a52f58c91297bf312141948da5decc2dd" title="Returns the last loaded depart time.">MSRouteHandler::getLastDepart</a>()<span class="keyword"> const </span>{
<a name="l00101"></a>00101     <span class="keywordflow">return</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ac61f9dc2d4cce2c4944d83f18d09e9c3" title="The insertion time of the vehicle read last.">myLastDepart</a>;
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 <span class="keywordtype">bool</span>
<a name="l00106"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a16d400be7f88653db8b18992260d7227">00106</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a16d400be7f88653db8b18992260d7227" title="Checks whether the route file is sorted by departure time if needed.">MSRouteHandler::checkLastDepart</a>() {
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ae42a14e21b5d040f3058ef5194e50c35" title="Information how the vehicle shall choose the depart time.">departProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#afcfaa02b708ce30f5cf9bd455ed00db9ac8d4d65e2cdf60fa00637cb8c346cd36" title="The time is given.">DEPART_GIVEN</a>) {
<a name="l00108"></a>00108         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#ac3aec841d88532f312cd0101323be5d8" title="Information whether vehicles shall be directly added to the network or kept within...">myAddVehiclesDirectly</a> &amp;&amp; <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aded3ab5fa08e689297b7db36b24c3cf8" title="The vehicle&amp;#39;s departure time.">depart</a> &lt; <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ac61f9dc2d4cce2c4944d83f18d09e9c3" title="The insertion time of the vehicle read last.">myLastDepart</a>) {
<a name="l00109"></a>00109             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Route file should be sorted by departure time, ignoring &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;!&quot;</span>);
<a name="l00110"></a>00110             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00111"></a>00111         }
<a name="l00112"></a>00112         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ac61f9dc2d4cce2c4944d83f18d09e9c3" title="The insertion time of the vehicle read last.">myLastDepart</a> = <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aded3ab5fa08e689297b7db36b24c3cf8" title="The vehicle&amp;#39;s departure time.">depart</a>;
<a name="l00113"></a>00113     }
<a name="l00114"></a>00114     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 <span class="keywordtype">void</span>
<a name="l00119"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a0697ea142da322e318ec7ec8b1abfdb9">00119</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a0697ea142da322e318ec7ec8b1abfdb9" title="Called on the opening of a tag;.">MSRouteHandler::myStartElement</a>(<span class="keywordtype">int</span> element,
<a name="l00120"></a>00120                                <span class="keyword">const</span> <a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html" title="Encapsulated SAX-Attributes.">SUMOSAXAttributes</a>&amp; attrs) {
<a name="l00121"></a>00121     <span class="keywordflow">switch</span> (element) {
<a name="l00122"></a>00122         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba561009c4827464ff6456315c887c66ab">SUMO_TAG_VEHICLE</a>:
<a name="l00123"></a>00123             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>;
<a name="l00124"></a>00124             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = <a class="code" href="../../d1/d44/class_s_u_m_o_vehicle_parser_helper.html#ad4006d6571d1dcf85d208a6f59596db3" title="Parses a vehicle&amp;#39;s attributes.">SUMOVehicleParserHelper::parseVehicleAttributes</a>(attrs);
<a name="l00125"></a>00125             <span class="keywordflow">break</span>;
<a name="l00126"></a>00126         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403bac08d0729cf15acf77d0b06c1f717ee25">SUMO_TAG_PERSON</a>:
<a name="l00127"></a>00127             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>;
<a name="l00128"></a>00128             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = <a class="code" href="../../d1/d44/class_s_u_m_o_vehicle_parser_helper.html#ad4006d6571d1dcf85d208a6f59596db3" title="Parses a vehicle&amp;#39;s attributes.">SUMOVehicleParserHelper::parseVehicleAttributes</a>(attrs);
<a name="l00129"></a>00129             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a> = <span class="keyword">new</span> <a class="code" href="../../de/d25/class_m_s_person.html#a3cb5da5d25bf664fd0e853beb3b877be" title="the structure holding the plan of a person">MSPerson::MSPersonPlan</a>();
<a name="l00130"></a>00130             <span class="keywordflow">break</span>;
<a name="l00131"></a>00131         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba98e7f3da9ab9803ac7550123752218a0">SUMO_TAG_RIDE</a>: {
<a name="l00132"></a>00132             <span class="keyword">const</span> std::string pid = <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>;
<a name="l00133"></a>00133             <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00134"></a>00134             <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* from = 0;
<a name="l00135"></a>00135             <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c3c947551970dae7f706c78ac9a7060">SUMO_ATTR_FROM</a>)) {
<a name="l00136"></a>00136                 <span class="keyword">const</span> std::string fromID = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c3c947551970dae7f706c78ac9a7060">SUMO_ATTR_FROM</a>, pid.c_str(), ok);
<a name="l00137"></a>00137                 from = <a class="code" href="../../d7/d27/class_m_s_edge.html#ab193f7a67f12ca616305c36964e5aa00" title="Inserts edge into the static dictionary Returns true if the key id isn&amp;#39;t already...">MSEdge::dictionary</a>(fromID);
<a name="l00138"></a>00138                 <span class="keywordflow">if</span> (from == 0) {
<a name="l00139"></a>00139                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;The from edge &#39;&quot;</span> + fromID + <span class="stringliteral">&quot;&#39; within a ride of person &#39;&quot;</span> + pid + <span class="stringliteral">&quot;&#39; is not known.&quot;</span>);
<a name="l00140"></a>00140                 }
<a name="l00141"></a>00141                 <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;empty() &amp;&amp; &amp;<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;back()-&gt;getDestination() != from) {
<a name="l00142"></a>00142                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Disconnected plan for person &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; (&quot;</span> + fromID + <span class="stringliteral">&quot;!=&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;back()-&gt;getDestination().getID() + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l00143"></a>00143                 }
<a name="l00144"></a>00144                 <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;empty()) {
<a name="l00145"></a>00145                     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;push_back(<span class="keyword">new</span> <a class="code" href="../../dc/df9/class_m_s_person_1_1_m_s_person_stage___waiting.html">MSPerson::MSPersonStage_Waiting</a>(*from, -1, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aded3ab5fa08e689297b7db36b24c3cf8" title="The vehicle&amp;#39;s departure time.">depart</a>));
<a name="l00146"></a>00146                 }
<a name="l00147"></a>00147             }
<a name="l00148"></a>00148             <span class="keyword">const</span> std::string toID = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c30cf894facbcdf6956d4e37c994538">SUMO_ATTR_TO</a>, pid.c_str(), ok);
<a name="l00149"></a>00149             <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* to = <a class="code" href="../../d7/d27/class_m_s_edge.html#ab193f7a67f12ca616305c36964e5aa00" title="Inserts edge into the static dictionary Returns true if the key id isn&amp;#39;t already...">MSEdge::dictionary</a>(toID);
<a name="l00150"></a>00150             <span class="keywordflow">if</span> (to == 0) {
<a name="l00151"></a>00151                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;The to edge &#39;&quot;</span> + toID + <span class="stringliteral">&quot;&#39; within a ride of person &#39;&quot;</span> + pid + <span class="stringliteral">&quot;&#39; is not known.&quot;</span>);
<a name="l00152"></a>00152             }
<a name="l00153"></a>00153             <span class="keyword">const</span> std::string desc = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a0747b3cf827a32b537a74f4a64c6e19d">SUMO_ATTR_LINES</a>, pid.c_str(), ok);
<a name="l00154"></a>00154             <a class="code" href="../../db/dc0/class_string_tokenizer.html">StringTokenizer</a> st(desc);
<a name="l00155"></a>00155             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;push_back(<span class="keyword">new</span> <a class="code" href="../../d8/d6d/class_m_s_person_1_1_m_s_person_stage___driving.html">MSPerson::MSPersonStage_Driving</a>(*to, st.<a class="code" href="../../db/dc0/class_string_tokenizer.html#a72d662534abea7f6cf23011477f23c05">getVector</a>()));
<a name="l00156"></a>00156             <span class="keywordflow">break</span>;
<a name="l00157"></a>00157         }
<a name="l00158"></a>00158         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba30e6421f8f47070ffed725f0d5be35fa">SUMO_TAG_WALK</a>: {
<a name="l00159"></a>00159             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.clear();
<a name="l00160"></a>00160             <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00161"></a>00161             <a class="code" href="../../d7/d27/class_m_s_edge.html#a47bff6e3209bb2aa1a1a9f1e0968ed97" title="Parses the given string assuming it contains a list of edge ids divided by spaces...">MSEdge::parseEdgesList</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a56eddfbe3ddf92eca2a5629ab0bda5ee" title="the edges of a route">SUMO_ATTR_EDGES</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>.c_str(), ok), <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>);
<a name="l00162"></a>00162             <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.empty()) {
<a name="l00163"></a>00163                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;No edges to walk for person &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00164"></a>00164             }
<a name="l00165"></a>00165             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;empty() &amp;&amp; &amp;<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;back()-&gt;getDestination() != <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.front()) {
<a name="l00166"></a>00166                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Disconnected plan for person &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; (&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.front()-&gt;getID() + <span class="stringliteral">&quot;!=&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;back()-&gt;getDestination().getID() + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l00167"></a>00167             }
<a name="l00168"></a>00168             <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;empty()) {
<a name="l00169"></a>00169                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;push_back(<span class="keyword">new</span> <a class="code" href="../../dc/df9/class_m_s_person_1_1_m_s_person_stage___waiting.html">MSPerson::MSPersonStage_Waiting</a>(*<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.front(), -1, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aded3ab5fa08e689297b7db36b24c3cf8" title="The vehicle&amp;#39;s departure time.">depart</a>));
<a name="l00170"></a>00170             }
<a name="l00171"></a>00171             <span class="keyword">const</span> <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> duration = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a86a6e60b2f342ff08721f29465e0fa50" title="Tries to read given attribute assuming it is a SUMOTime.">getOptSUMOTimeReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96adfa4719fd026c92649eb79501982ffef">SUMO_ATTR_DURATION</a>, 0, ok, -1);
<a name="l00172"></a>00172             <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> speed = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ac75d8d5e5b9b3a3e68582e5a1c33615b" title="Tries to read given attribute assuming it is a SUMOReal.">getOptSUMORealReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a20de2d6f5f5f179b071b7b63ed027e8e">SUMO_ATTR_SPEED</a>, 0, ok, -1);
<a name="l00173"></a>00173             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;push_back(<span class="keyword">new</span> <a class="code" href="../../d6/dcd/class_m_s_person_1_1_m_s_person_stage___walking.html">MSPerson::MSPersonStage_Walking</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>, duration, speed));
<a name="l00174"></a>00174             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.clear();
<a name="l00175"></a>00175             <span class="keywordflow">break</span>;
<a name="l00176"></a>00176         }
<a name="l00177"></a>00177         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba711b9083b7be3a2fa818e921f7e8e6b5">SUMO_TAG_FLOW</a>:
<a name="l00178"></a>00178             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>;
<a name="l00179"></a>00179             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = <a class="code" href="../../d1/d44/class_s_u_m_o_vehicle_parser_helper.html#a3b11ed079f9c069e1d36983e5e40a419" title="Parses a flow&amp;#39;s attributes.">SUMOVehicleParserHelper::parseFlowAttributes</a>(attrs);
<a name="l00180"></a>00180             <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c3c947551970dae7f706c78ac9a7060">SUMO_ATTR_FROM</a>) &amp;&amp; attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c30cf894facbcdf6956d4e37c994538">SUMO_ATTR_TO</a>)) {
<a name="l00181"></a>00181                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <span class="stringliteral">&quot;!&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>;
<a name="l00182"></a>00182                 <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00183"></a>00183                 <a class="code" href="../../d7/d27/class_m_s_edge.html#a47bff6e3209bb2aa1a1a9f1e0968ed97" title="Parses the given string assuming it contains a list of edge ids divided by spaces...">MSEdge::parseEdgesList</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c3c947551970dae7f706c78ac9a7060">SUMO_ATTR_FROM</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>.c_str(), ok),
<a name="l00184"></a>00184                                        <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>, <span class="stringliteral">&quot;for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00185"></a>00185                 <a class="code" href="../../d7/d27/class_m_s_edge.html#a47bff6e3209bb2aa1a1a9f1e0968ed97" title="Parses the given string assuming it contains a list of edge ids divided by spaces...">MSEdge::parseEdgesList</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c30cf894facbcdf6956d4e37c994538">SUMO_ATTR_TO</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>.c_str(), ok),
<a name="l00186"></a>00186                                        <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>, <span class="stringliteral">&quot;for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00187"></a>00187                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a03ce6ecb499a169339387c43c1fd72a2">closeRoute</a>();
<a name="l00188"></a>00188             }
<a name="l00189"></a>00189             <span class="keywordflow">break</span>;
<a name="l00190"></a>00190         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba0ab3b8ce7b344252965da7b878dbdb57">SUMO_TAG_VTYPE__DEPRECATED</a>:
<a name="l00191"></a>00191             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a64d8af08b39bbe6b217433c31444a2f6">myHaveWarnedAboutDeprecatedVType</a>) {
<a name="l00192"></a>00192                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a64d8af08b39bbe6b217433c31444a2f6">myHaveWarnedAboutDeprecatedVType</a> = <span class="keyword">true</span>;
<a name="l00193"></a>00193                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba0ab3b8ce7b344252965da7b878dbdb57">SUMO_TAG_VTYPE__DEPRECATED</a>) + <span class="stringliteral">&quot;&#39; is deprecated; please use &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba2de4ad0336bf6092af44720b53c7b396">SUMO_TAG_VTYPE</a>) + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00194"></a>00194             }
<a name="l00195"></a>00195         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba2de4ad0336bf6092af44720b53c7b396">SUMO_TAG_VTYPE</a>:
<a name="l00196"></a>00196             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#acd886520bcf520d1f4d900e3412ce747" title="The currently parsed vehicle type.">myCurrentVType</a> = <a class="code" href="../../d1/d44/class_s_u_m_o_vehicle_parser_helper.html#a2e7fd2cd2017e02a0f73657f79670658" title="Starts to parse a vehicle type.">SUMOVehicleParserHelper::beginVTypeParsing</a>(attrs);
<a name="l00197"></a>00197             <span class="keywordflow">break</span>;
<a name="l00198"></a>00198         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba0716797b026124d04cb0fb4df802e0f1">SUMO_TAG_VTYPE_DISTRIBUTION__DEPRECATED</a>:
<a name="l00199"></a>00199             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3d7803665e6346246dfeae288aae48ff">myHaveWarnedAboutDeprecatedVTypeDistribution</a>) {
<a name="l00200"></a>00200                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3d7803665e6346246dfeae288aae48ff">myHaveWarnedAboutDeprecatedVTypeDistribution</a> = <span class="keyword">true</span>;
<a name="l00201"></a>00201                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba0716797b026124d04cb0fb4df802e0f1">SUMO_TAG_VTYPE_DISTRIBUTION__DEPRECATED</a>) + <span class="stringliteral">&quot;&#39; is deprecated; please use &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403baa7fc1edb69992149a4af3d9e30b597bc">SUMO_TAG_VTYPE_DISTRIBUTION</a>) + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00202"></a>00202             }
<a name="l00203"></a>00203         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403baa7fc1edb69992149a4af3d9e30b597bc">SUMO_TAG_VTYPE_DISTRIBUTION</a>:
<a name="l00204"></a>00204             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aaab7249f891ddee883216b6b212a59db">openVehicleTypeDistribution</a>(attrs);
<a name="l00205"></a>00205             <span class="keywordflow">break</span>;
<a name="l00206"></a>00206         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba9625e12228b5af189de826fc724034d2">SUMO_TAG_ROUTE</a>:
<a name="l00207"></a>00207             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ad3d7080da73dbc3ed599f89e127b1c53">openRoute</a>(attrs);
<a name="l00208"></a>00208             <span class="keywordflow">break</span>;
<a name="l00209"></a>00209         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba5824e4903b9d26ea6f7903c1b22099b2">SUMO_TAG_ROUTE_DISTRIBUTION</a>:
<a name="l00210"></a>00210             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a95e669a371c9bf37f154fefdafb0f71f">openRouteDistribution</a>(attrs);
<a name="l00211"></a>00211             <span class="keywordflow">break</span>;
<a name="l00212"></a>00212         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba4ebf538080c335cb5a274dbdbe9e48a5">SUMO_TAG_STOP</a>:
<a name="l00213"></a>00213             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a1b4cf7d372f6be289a3083fcad9fff58" title="Processing of a stop.">addStop</a>(attrs);
<a name="l00214"></a>00214             <span class="keywordflow">break</span>;
<a name="l00215"></a>00215         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba4c6d0995eefc012d4d6dcd05e166d5b6">SUMO_TAG_TRIP__DEPRECATED</a>:
<a name="l00216"></a>00216         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403bafc1de1ac7bbd634ad6d32318199e67a4">SUMO_TAG_TRIP</a>: {
<a name="l00217"></a>00217             <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00218"></a>00218             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = <a class="code" href="../../d1/d44/class_s_u_m_o_vehicle_parser_helper.html#ad4006d6571d1dcf85d208a6f59596db3" title="Parses a vehicle&amp;#39;s attributes.">SUMOVehicleParserHelper::parseVehicleAttributes</a>(attrs);
<a name="l00219"></a>00219             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a2d1d1b46e10bf98a901db489412677c3" title="Information for the router which parameter were set.">setParameter</a> |= <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#aac1331506dbdcb8ab699b2361d102e6d">VEHPARS_FORCE_REROUTE</a>;
<a name="l00220"></a>00220             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <span class="stringliteral">&quot;!&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>;
<a name="l00221"></a>00221             <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c3c947551970dae7f706c78ac9a7060">SUMO_ATTR_FROM</a>) || !<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab154fdc9979abb7f30f88bd4f1734084" title="Returns whether the given parameter was set.">wasSet</a>(<a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a84f55e7647d6d9f5e5337f58a9284532">VEHPARS_TAZ_SET</a>)) {
<a name="l00222"></a>00222                 <a class="code" href="../../d7/d27/class_m_s_edge.html#a47bff6e3209bb2aa1a1a9f1e0968ed97" title="Parses the given string assuming it contains a list of edge ids divided by spaces...">MSEdge::parseEdgesList</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c3c947551970dae7f706c78ac9a7060">SUMO_ATTR_FROM</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>.c_str(), ok),
<a name="l00223"></a>00223                                        <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>, <span class="stringliteral">&quot;for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00224"></a>00224                 <a class="code" href="../../d7/d27/class_m_s_edge.html#a47bff6e3209bb2aa1a1a9f1e0968ed97" title="Parses the given string assuming it contains a list of edge ids divided by spaces...">MSEdge::parseEdgesList</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9c30cf894facbcdf6956d4e37c994538">SUMO_ATTR_TO</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>.c_str(), ok),
<a name="l00225"></a>00225                                        <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>, <span class="stringliteral">&quot;for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00226"></a>00226             } <span class="keywordflow">else</span> {
<a name="l00227"></a>00227                 <span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* fromTaz = <a class="code" href="../../d7/d27/class_m_s_edge.html#ab193f7a67f12ca616305c36964e5aa00" title="Inserts edge into the static dictionary Returns true if the key id isn&amp;#39;t already...">MSEdge::dictionary</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aeb82af5a3764ba39d9abf513ba7571eb" title="The vehicle&amp;#39;s origin zone (district).">fromTaz</a> + <span class="stringliteral">&quot;-source&quot;</span>);
<a name="l00228"></a>00228                 <span class="keywordflow">if</span> (fromTaz == 0) {
<a name="l00229"></a>00229                     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Source district &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aeb82af5a3764ba39d9abf513ba7571eb" title="The vehicle&amp;#39;s origin zone (district).">fromTaz</a> + <span class="stringliteral">&quot;&#39; not known for &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;!&quot;</span>);
<a name="l00230"></a>00230                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fromTaz-&gt;<a class="code" href="../../d7/d27/class_m_s_edge.html#a5264396c7e6da27f364e055808d03bd5" title="Returns the number of edges that may be reached from this edge.">getNoFollowing</a>() == 0) {
<a name="l00231"></a>00231                     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Source district &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aeb82af5a3764ba39d9abf513ba7571eb" title="The vehicle&amp;#39;s origin zone (district).">fromTaz</a> + <span class="stringliteral">&quot;&#39; has no outgoing edges for &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;!&quot;</span>);
<a name="l00232"></a>00232                 } <span class="keywordflow">else</span> {
<a name="l00233"></a>00233                     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.push_back(fromTaz-&gt;<a class="code" href="../../d7/d27/class_m_s_edge.html#a9599dcfb2cf98adcc57f82cc841b50d2" title="Returns the n-th of the following edges.">getFollower</a>(0));
<a name="l00234"></a>00234                 }
<a name="l00235"></a>00235             }
<a name="l00236"></a>00236             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a03ce6ecb499a169339387c43c1fd72a2">closeRoute</a>();
<a name="l00237"></a>00237             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aa8c1b281facf49fba72b7399a6a85611" title="Ends the processing of a vehicle.">closeVehicle</a>();
<a name="l00238"></a>00238         }
<a name="l00239"></a>00239         <span class="keywordflow">break</span>;
<a name="l00240"></a>00240         <span class="keywordflow">default</span>:
<a name="l00241"></a>00241             <span class="keywordflow">break</span>;
<a name="l00242"></a>00242     }
<a name="l00243"></a>00243     <span class="comment">// parse embedded vtype information</span>
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#acd886520bcf520d1f4d900e3412ce747" title="The currently parsed vehicle type.">myCurrentVType</a> != 0 &amp;&amp; element != <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba2de4ad0336bf6092af44720b53c7b396">SUMO_TAG_VTYPE</a> &amp;&amp; element != <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba0ab3b8ce7b344252965da7b878dbdb57">SUMO_TAG_VTYPE__DEPRECATED</a>) {
<a name="l00245"></a>00245         <a class="code" href="../../d1/d44/class_s_u_m_o_vehicle_parser_helper.html#a8059c6f009a34f8c75e07de0f959970a" title="Parses an element embedded in vtype definition.">SUMOVehicleParserHelper::parseVTypeEmbedded</a>(*<a class="code" href="../../d7/df0/class_m_s_route_handler.html#acd886520bcf520d1f4d900e3412ce747" title="The currently parsed vehicle type.">myCurrentVType</a>, element, attrs);
<a name="l00246"></a>00246         <span class="keywordflow">return</span>;
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="keywordtype">void</span>
<a name="l00252"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#aaab7249f891ddee883216b6b212a59db">00252</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aaab7249f891ddee883216b6b212a59db">MSRouteHandler::openVehicleTypeDistribution</a>(<span class="keyword">const</span> <a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html" title="Encapsulated SAX-Attributes.">SUMOSAXAttributes</a>&amp; attrs) {
<a name="l00253"></a>00253     <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00254"></a>00254     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4565b4a95e43fdc37d51c6cf8261dfbe" title="The id of the currently parsed vehicle type distribution.">myCurrentVTypeDistributionID</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96acd721cc93d1bc2a1d270b87a24232763">SUMO_ATTR_ID</a>, 0, ok);
<a name="l00255"></a>00255     <span class="keywordflow">if</span> (ok) {
<a name="l00256"></a>00256         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a> = <span class="keyword">new</span> <a class="code" href="../../d5/d9b/class_random_distributor.html">RandomDistributor&lt;MSVehicleType*&gt;</a>();
<a name="l00257"></a>00257         <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a727c488a0ddf025b93d7f266b57bfa1a">SUMO_ATTR_VTYPES</a>) || attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96aa045488e698fc5cdadb6aeef890c7c64">SUMO_ATTR_VTYPES__DEPRECATED</a>)) {
<a name="l00258"></a>00258             std::string vTypes;
<a name="l00259"></a>00259             <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#afe116e3e6d1490c319af94c280807186">myHaveWarnedAboutDeprecatedVTypes</a> &amp;&amp; attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96aa045488e698fc5cdadb6aeef890c7c64">SUMO_ATTR_VTYPES__DEPRECATED</a>)) {
<a name="l00260"></a>00260                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#afe116e3e6d1490c319af94c280807186">myHaveWarnedAboutDeprecatedVTypes</a> = <span class="keyword">true</span>;
<a name="l00261"></a>00261                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96aa045488e698fc5cdadb6aeef890c7c64">SUMO_ATTR_VTYPES__DEPRECATED</a>) + <span class="stringliteral">&quot;&#39; is deprecated, please use &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a727c488a0ddf025b93d7f266b57bfa1a">SUMO_ATTR_VTYPES</a>) + <span class="stringliteral">&quot;&#39; instead.&quot;</span>);
<a name="l00262"></a>00262                 vTypes = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96aa045488e698fc5cdadb6aeef890c7c64">SUMO_ATTR_VTYPES__DEPRECATED</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4565b4a95e43fdc37d51c6cf8261dfbe" title="The id of the currently parsed vehicle type distribution.">myCurrentVTypeDistributionID</a>.c_str(), ok);
<a name="l00263"></a>00263             } <span class="keywordflow">else</span> {
<a name="l00264"></a>00264                 vTypes = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a727c488a0ddf025b93d7f266b57bfa1a">SUMO_ATTR_VTYPES</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4565b4a95e43fdc37d51c6cf8261dfbe" title="The id of the currently parsed vehicle type distribution.">myCurrentVTypeDistributionID</a>.c_str(), ok);
<a name="l00265"></a>00265             }
<a name="l00266"></a>00266             <a class="code" href="../../db/dc0/class_string_tokenizer.html">StringTokenizer</a> st(vTypes);
<a name="l00267"></a>00267             <span class="keywordflow">while</span> (st.<a class="code" href="../../db/dc0/class_string_tokenizer.html#aa654384891d4b9d724eee0f6c739193c">hasNext</a>()) {
<a name="l00268"></a>00268                 std::string vtypeID = st.<a class="code" href="../../db/dc0/class_string_tokenizer.html#afbe25dccd9c18a10650861730e63a7c2">next</a>();
<a name="l00269"></a>00269                 <a class="code" href="../../de/da2/class_m_s_vehicle_type.html" title="The car-following model and parameter.">MSVehicleType</a>* type = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a5e74ee833cafefa74b84e2091ef135a3" title="Returns the vehicle control.">getVehicleControl</a>().<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a95ddc958055c59d379d373aeb39621b5" title="Returns the named vehicle type or a sample from the named distribution.">getVType</a>(vtypeID);
<a name="l00270"></a>00270                 <span class="keywordflow">if</span> (type == 0) {
<a name="l00271"></a>00271                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Unknown vtype &#39;&quot;</span> + vtypeID + <span class="stringliteral">&quot;&#39; in distribution &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4565b4a95e43fdc37d51c6cf8261dfbe" title="The id of the currently parsed vehicle type distribution.">myCurrentVTypeDistributionID</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00272"></a>00272                 }
<a name="l00273"></a>00273                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#a8725996969c8b79905375efe040a2530" title="Adds a value with an assigned probability to the distribution.">add</a>(type-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ac75a9dff5a910fe1f101a7b93ca0990b" title="Get the default probability of this vehicle type.">getDefaultProbability</a>(), type);
<a name="l00274"></a>00274             }
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <span class="keywordtype">void</span>
<a name="l00281"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a44b743b2823282cc9b95076f5d11e3b6">00281</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a44b743b2823282cc9b95076f5d11e3b6">MSRouteHandler::closeVehicleTypeDistribution</a>() {
<a name="l00282"></a>00282     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a> != 0) {
<a name="l00283"></a>00283         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#aaa67eed5efe4e483489a92d9a8df577e" title="Return the sum of the probabilites assigned to the members.">getOverallProb</a>() == 0) {
<a name="l00284"></a>00284             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a>;
<a name="l00285"></a>00285             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Vehicle type distribution &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4565b4a95e43fdc37d51c6cf8261dfbe" title="The id of the currently parsed vehicle type distribution.">myCurrentVTypeDistributionID</a> + <span class="stringliteral">&quot;&#39; is empty.&quot;</span>);
<a name="l00286"></a>00286         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getVehicleControl().addVTypeDistribution(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4565b4a95e43fdc37d51c6cf8261dfbe" title="The id of the currently parsed vehicle type distribution.">myCurrentVTypeDistributionID</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a>)) {
<a name="l00287"></a>00287             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a>;
<a name="l00288"></a>00288             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Another vehicle type (or distribution) with the id &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4565b4a95e43fdc37d51c6cf8261dfbe" title="The id of the currently parsed vehicle type distribution.">myCurrentVTypeDistributionID</a> + <span class="stringliteral">&quot;&#39; exists.&quot;</span>);
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a> = 0;
<a name="l00291"></a>00291     }
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="keywordtype">void</span>
<a name="l00296"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#ad3d7080da73dbc3ed599f89e127b1c53">00296</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ad3d7080da73dbc3ed599f89e127b1c53">MSRouteHandler::openRoute</a>(<span class="keyword">const</span> <a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html" title="Encapsulated SAX-Attributes.">SUMOSAXAttributes</a>&amp; attrs) {
<a name="l00297"></a>00297     <span class="comment">// check whether the id is really necessary</span>
<a name="l00298"></a>00298     std::string rid;
<a name="l00299"></a>00299     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a> != 0) {
<a name="l00300"></a>00300         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a> + <span class="stringliteral">&quot;#&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#a89a57be845e1f63bcd804709f9da0687" title="Returns the probabilities assigned to the members of the distribution.">getProbs</a>().size()); <span class="comment">// !!! document this</span>
<a name="l00301"></a>00301         rid =  <span class="stringliteral">&quot;distribution &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a> + <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00302"></a>00302     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> != 0) {
<a name="l00303"></a>00303         <span class="comment">// ok, a vehicle is wrapping the route,</span>
<a name="l00304"></a>00304         <span class="comment">//  we may use this vehicle&#39;s id as default</span>
<a name="l00305"></a>00305         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <span class="stringliteral">&quot;!&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>; <span class="comment">// !!! document this</span>
<a name="l00306"></a>00306         <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96acd721cc93d1bc2a1d270b87a24232763">SUMO_ATTR_ID</a>)) {
<a name="l00307"></a>00307             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Ids of internal routes are ignored (vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;).&quot;</span>);
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309     } <span class="keywordflow">else</span> {
<a name="l00310"></a>00310         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00311"></a>00311         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96acd721cc93d1bc2a1d270b87a24232763">SUMO_ATTR_ID</a>, 0, ok, <span class="keyword">false</span>);
<a name="l00312"></a>00312         <span class="keywordflow">if</span> (!ok) {
<a name="l00313"></a>00313             <span class="keywordflow">return</span>;
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315         rid = <span class="stringliteral">&quot;&#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> + <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> != 0) { <span class="comment">// have to do this here for nested route distributions</span>
<a name="l00318"></a>00318         rid =  <span class="stringliteral">&quot;for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320     <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00321"></a>00321     <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a56eddfbe3ddf92eca2a5629ab0bda5ee" title="the edges of a route">SUMO_ATTR_EDGES</a>)) {
<a name="l00322"></a>00322         <a class="code" href="../../d7/d27/class_m_s_edge.html#a47bff6e3209bb2aa1a1a9f1e0968ed97" title="Parses the given string assuming it contains a list of edge ids divided by spaces...">MSEdge::parseEdgesList</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a56eddfbe3ddf92eca2a5629ab0bda5ee" title="the edges of a route">SUMO_ATTR_EDGES</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>.c_str(), ok), <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>, rid);
<a name="l00323"></a>00323     }
<a name="l00324"></a>00324     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a532666e0ee347cad965e86e266b7b4fe" title="Tries to read given attribute assuming it is a string.">getOptStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a1c20bfb23bcb41d00d348b5d1a12a273">SUMO_ATTR_REFID</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>.c_str(), ok, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00325"></a>00325     <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ab422e3eb14529233a56668696d135acb">SUMO_ATTR_REFID__DEPRECATED</a>)) {
<a name="l00326"></a>00326         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a532666e0ee347cad965e86e266b7b4fe" title="Tries to read given attribute assuming it is a string.">getOptStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ab422e3eb14529233a56668696d135acb">SUMO_ATTR_REFID__DEPRECATED</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>.c_str(), ok, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00327"></a>00327         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a9c453b48c38ccdd147fe405f1e2bc8dc">myHaveWarnedAboutDeprecatedRefID</a>) {
<a name="l00328"></a>00328             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a9c453b48c38ccdd147fe405f1e2bc8dc">myHaveWarnedAboutDeprecatedRefID</a> = <span class="keyword">true</span>;
<a name="l00329"></a>00329             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ab422e3eb14529233a56668696d135acb">SUMO_ATTR_REFID__DEPRECATED</a>) + <span class="stringliteral">&quot;&#39; is deprecated, please use &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a1c20bfb23bcb41d00d348b5d1a12a273">SUMO_ATTR_REFID</a>) + <span class="stringliteral">&quot;&#39; instead.&quot;</span>);
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a> != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a>) == 0) {
<a name="l00333"></a>00333         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Invalid reference to route &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a> + <span class="stringliteral">&quot;&#39; in route &quot;</span> + rid + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l00334"></a>00334     }
<a name="l00335"></a>00335     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4e44437821e59010c414442f99459655" title="The id of the current route.">myActiveRouteProbability</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ac75d8d5e5b9b3a3e68582e5a1c33615b" title="Tries to read given attribute assuming it is a SUMOReal.">getOptSUMORealReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ab7a3aa8e12ca927a25012e1ff3b0d9ea">SUMO_ATTR_PROB</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>.c_str(), ok, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#afb3a1aa02c5f9ee6fa6a253a38a2ec1d">DEFAULT_VEH_PROB</a>);
<a name="l00336"></a>00336     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#afa19c7587a036f226ea4767d8304d436" title="The currently parsed route&amp;#39;s color.">myActiveRouteColor</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ac9e3c699318ae073cd4b1312b1b96dca" title="A color information.">SUMO_ATTR_COLOR</a>) ? <a class="code" href="../../da/da9/class_r_g_b_color.html#a9106d02e4ed6dc53f7550f8277e047e1" title="Parses a color information.">RGBColor::parseColorReporting</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae674bccb2c2b5213041eec13668adb00" title="Returns the string-value of the named (by its enum-value) attribute.">getString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ac9e3c699318ae073cd4b1312b1b96dca" title="A color information.">SUMO_ATTR_COLOR</a>), attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a71c6518bb947798becfe584408002142" title="return the objecttype to which these attributes belong">getObjectType</a>(),  <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>.c_str(), <span class="keyword">true</span>, ok) : <a class="code" href="../../da/da9/class_r_g_b_color.html#acfd3838bc40a07eb3b1fc17ec4233658" title="Returns the default color by parsing DEFAULT_COLOR_STRING.">RGBColor::getDefaultColor</a>();
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a>00339 
<a name="l00340"></a>00340 <span class="keywordtype">void</span>
<a name="l00341"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a456502820ae35b0cafcf9d779d1229bc">00341</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a456502820ae35b0cafcf9d779d1229bc" title="Called when a closing tag occurs.">MSRouteHandler::myEndElement</a>(<span class="keywordtype">int</span> element) {
<a name="l00342"></a>00342     <span class="keywordflow">switch</span> (element) {
<a name="l00343"></a>00343         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba9625e12228b5af189de826fc724034d2">SUMO_TAG_ROUTE</a>:
<a name="l00344"></a>00344             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a03ce6ecb499a169339387c43c1fd72a2">closeRoute</a>();
<a name="l00345"></a>00345             <span class="keywordflow">break</span>;
<a name="l00346"></a>00346         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403bac08d0729cf15acf77d0b06c1f717ee25">SUMO_TAG_PERSON</a>:
<a name="l00347"></a>00347             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a86cc7d5ac378934a5e54cae48da43558" title="Ends the processing of a person.">closePerson</a>();
<a name="l00348"></a>00348             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>;
<a name="l00349"></a>00349             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = 0;
<a name="l00350"></a>00350             <span class="keywordflow">break</span>;
<a name="l00351"></a>00351         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba561009c4827464ff6456315c887c66ab">SUMO_TAG_VEHICLE</a>:
<a name="l00352"></a>00352             <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a1526717e606c579e5ec14b7ab798fac2" title="The number of times the vehicle shall be repeatedly inserted.">repetitionNumber</a> &gt; 0) {
<a name="l00353"></a>00353                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a1526717e606c579e5ec14b7ab798fac2" title="The number of times the vehicle shall be repeatedly inserted.">repetitionNumber</a>++; <span class="comment">// for backwards compatibility</span>
<a name="l00354"></a>00354                 <span class="comment">// it is a flow, thus no break here</span>
<a name="l00355"></a>00355             } <span class="keywordflow">else</span> {
<a name="l00356"></a>00356                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aa8c1b281facf49fba72b7399a6a85611" title="Ends the processing of a vehicle.">closeVehicle</a>();
<a name="l00357"></a>00357                 <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>;
<a name="l00358"></a>00358                 <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = 0;
<a name="l00359"></a>00359                 <span class="keywordflow">break</span>;
<a name="l00360"></a>00360             }
<a name="l00361"></a>00361         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba711b9083b7be3a2fa818e921f7e8e6b5">SUMO_TAG_FLOW</a>:
<a name="l00362"></a>00362             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a655dfc9712db03610ba585196727fde4" title="Ends the processing of a flow.">closeFlow</a>();
<a name="l00363"></a>00363             <span class="keywordflow">break</span>;
<a name="l00364"></a>00364         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba0716797b026124d04cb0fb4df802e0f1">SUMO_TAG_VTYPE_DISTRIBUTION__DEPRECATED</a>:
<a name="l00365"></a>00365         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403baa7fc1edb69992149a4af3d9e30b597bc">SUMO_TAG_VTYPE_DISTRIBUTION</a>:
<a name="l00366"></a>00366             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a44b743b2823282cc9b95076f5d11e3b6">closeVehicleTypeDistribution</a>();
<a name="l00367"></a>00367             <span class="keywordflow">break</span>;
<a name="l00368"></a>00368         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba5824e4903b9d26ea6f7903c1b22099b2">SUMO_TAG_ROUTE_DISTRIBUTION</a>:
<a name="l00369"></a>00369             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a5e1166d03dfacd23371da94e873ffc28">closeRouteDistribution</a>();
<a name="l00370"></a>00370             <span class="keywordflow">break</span>;
<a name="l00371"></a>00371         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba0ab3b8ce7b344252965da7b878dbdb57">SUMO_TAG_VTYPE__DEPRECATED</a>:
<a name="l00372"></a>00372         <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba2de4ad0336bf6092af44720b53c7b396">SUMO_TAG_VTYPE</a>: {
<a name="l00373"></a>00373             <a class="code" href="../../d1/d44/class_s_u_m_o_vehicle_parser_helper.html#a02c726a841906e44ea804b0219df7de0" title="Closes parsing of the vehicle type.">SUMOVehicleParserHelper::closeVTypeParsing</a>(*<a class="code" href="../../d7/df0/class_m_s_route_handler.html#acd886520bcf520d1f4d900e3412ce747" title="The currently parsed vehicle type.">myCurrentVType</a>);
<a name="l00374"></a>00374             <a class="code" href="../../de/da2/class_m_s_vehicle_type.html" title="The car-following model and parameter.">MSVehicleType</a>* vehType = <a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a1aa0ce2fe75fa298372489a259bad7a5" title="Builds the microsim vehicle type described by the given parameter.">MSVehicleType::build</a>(*<a class="code" href="../../d7/df0/class_m_s_route_handler.html#acd886520bcf520d1f4d900e3412ce747" title="The currently parsed vehicle type.">myCurrentVType</a>);
<a name="l00375"></a>00375             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#acd886520bcf520d1f4d900e3412ce747" title="The currently parsed vehicle type.">myCurrentVType</a>;
<a name="l00376"></a>00376             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#acd886520bcf520d1f4d900e3412ce747" title="The currently parsed vehicle type.">myCurrentVType</a> = 0;
<a name="l00377"></a>00377             <span class="keywordflow">if</span> (!<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getVehicleControl().addVType(vehType)) {
<a name="l00378"></a>00378                 std::string <span class="keywordtype">id</span> = vehType-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ad6dc1278af1ab98cbbc19d924739f766" title="Returns the name of the vehicle type.">getID</a>();
<a name="l00379"></a>00379                 <span class="keyword">delete</span> vehType;
<a name="l00380"></a>00380 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>                <span class="keywordflow">if</span> (!MSGlobals::gStateLoaded) {
<a name="l00382"></a>00382 <span class="preprocessor">#endif</span>
<a name="l00383"></a>00383 <span class="preprocessor"></span>                    <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Another vehicle type (or distribution) with the id &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39; exists.&quot;</span>);
<a name="l00384"></a>00384 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00385"></a>00385 <span class="preprocessor"></span>                }
<a name="l00386"></a>00386 <span class="preprocessor">#endif</span>
<a name="l00387"></a>00387 <span class="preprocessor"></span>            } <span class="keywordflow">else</span> {
<a name="l00388"></a>00388                 <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a> != 0) {
<a name="l00389"></a>00389                     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a75150981d544c3641c1013140069c101" title="The currently parsed distribution of vehicle types (probability-&amp;gt;vehicle type)...">myCurrentVTypeDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#a8725996969c8b79905375efe040a2530" title="Adds a value with an assigned probability to the distribution.">add</a>(vehType-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ac75a9dff5a910fe1f101a7b93ca0990b" title="Get the default probability of this vehicle type.">getDefaultProbability</a>(), vehType);
<a name="l00390"></a>00390                 }
<a name="l00391"></a>00391             }
<a name="l00392"></a>00392         }
<a name="l00393"></a>00393         <span class="keywordflow">break</span>;
<a name="l00394"></a>00394         <span class="keywordflow">default</span>:
<a name="l00395"></a>00395             <span class="keywordflow">break</span>;
<a name="l00396"></a>00396     }
<a name="l00397"></a>00397 }
<a name="l00398"></a>00398 
<a name="l00399"></a>00399 
<a name="l00400"></a>00400 <span class="keywordtype">void</span>
<a name="l00401"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a03ce6ecb499a169339387c43c1fd72a2">00401</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a03ce6ecb499a169339387c43c1fd72a2">MSRouteHandler::closeRoute</a>() {
<a name="l00402"></a>00402     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.size() == 0) {
<a name="l00403"></a>00403         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a> != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a> != 0) {
<a name="l00404"></a>00404             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#a8725996969c8b79905375efe040a2530" title="Adds a value with an assigned probability to the distribution.">add</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4e44437821e59010c414442f99459655" title="The id of the current route.">myActiveRouteProbability</a>, <a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a>));
<a name="l00405"></a>00405             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00406"></a>00406             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a142252f1260399a2a9ccc4fe2d0fb88a" title="The id of the route the current route references to.">myActiveRouteRefID</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00407"></a>00407             <span class="keywordflow">return</span>;
<a name="l00408"></a>00408         }
<a name="l00409"></a>00409         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> != 0) {
<a name="l00410"></a>00410             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Vehicle&#39;s &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; route has no edges.&quot;</span>);
<a name="l00411"></a>00411         } <span class="keywordflow">else</span> {
<a name="l00412"></a>00412             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Route &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> + <span class="stringliteral">&quot;&#39; has no edges.&quot;</span>);
<a name="l00413"></a>00413         }
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415     <a class="code" href="../../de/dd8/class_m_s_route.html">MSRoute</a>* route = <span class="keyword">new</span> <a class="code" href="../../de/dd8/class_m_s_route.html">MSRoute</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>,
<a name="l00416"></a>00416                                  <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> == 0 || <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a1526717e606c579e5ec14b7ab798fac2" title="The number of times the vehicle shall be repeatedly inserted.">repetitionNumber</a> &gt;= 1,
<a name="l00417"></a>00417                                  <a class="code" href="../../d7/df0/class_m_s_route_handler.html#afa19c7587a036f226ea4767d8304d436" title="The currently parsed route&amp;#39;s color.">myActiveRouteColor</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aed921a613ea359c055098f2ed5044533" title="List of the stops on the parsed route.">myActiveRouteStops</a>);
<a name="l00418"></a>00418     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a42830ab28a77eb9fde1809ff20a716cd" title="The current route.">myActiveRoute</a>.clear();
<a name="l00419"></a>00419     <span class="keywordflow">if</span> (!<a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a>, route)) {
<a name="l00420"></a>00420         <span class="keyword">delete</span> route;
<a name="l00421"></a>00421 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00422"></a>00422 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!MSGlobals::gStateLoaded) {
<a name="l00423"></a>00423 <span class="preprocessor">#endif</span>
<a name="l00424"></a>00424 <span class="preprocessor"></span>            <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> != 0) {
<a name="l00425"></a>00425                 <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getVehicleControl().getVehicle(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>) == 0) {
<a name="l00426"></a>00426                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Another route for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; exists.&quot;</span>);
<a name="l00427"></a>00427                 } <span class="keywordflow">else</span> {
<a name="l00428"></a>00428                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;A vehicle with id &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; already exists.&quot;</span>);
<a name="l00429"></a>00429                 }
<a name="l00430"></a>00430             } <span class="keywordflow">else</span> {
<a name="l00431"></a>00431                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Another route (or distribution) with the id &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> + <span class="stringliteral">&quot;&#39; exists.&quot;</span>);
<a name="l00432"></a>00432             }
<a name="l00433"></a>00433 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00434"></a>00434 <span class="preprocessor"></span>        }
<a name="l00435"></a>00435 <span class="preprocessor">#endif</span>
<a name="l00436"></a>00436 <span class="preprocessor"></span>    } <span class="keywordflow">else</span> {
<a name="l00437"></a>00437         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a> != 0) {
<a name="l00438"></a>00438             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#a8725996969c8b79905375efe040a2530" title="Adds a value with an assigned probability to the distribution.">add</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a4e44437821e59010c414442f99459655" title="The id of the current route.">myActiveRouteProbability</a>, route);
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440     }
<a name="l00441"></a>00441     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00442"></a>00442     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aed921a613ea359c055098f2ed5044533" title="List of the stops on the parsed route.">myActiveRouteStops</a>.clear();
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="keywordtype">void</span>
<a name="l00447"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a95e669a371c9bf37f154fefdafb0f71f">00447</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a95e669a371c9bf37f154fefdafb0f71f">MSRouteHandler::openRouteDistribution</a>(<span class="keyword">const</span> <a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html" title="Encapsulated SAX-Attributes.">SUMOSAXAttributes</a>&amp; attrs) {
<a name="l00448"></a>00448     <span class="comment">// check whether the id is really necessary</span>
<a name="l00449"></a>00449     <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00450"></a>00450     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> != 0) {
<a name="l00451"></a>00451         <span class="comment">// ok, a vehicle is wrapping the route,</span>
<a name="l00452"></a>00452         <span class="comment">//  we may use this vehicle&#39;s id as default</span>
<a name="l00453"></a>00453         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a> = <span class="stringliteral">&quot;!&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>; <span class="comment">// !!! document this</span>
<a name="l00454"></a>00454     } <span class="keywordflow">else</span> {
<a name="l00455"></a>00455         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96acd721cc93d1bc2a1d270b87a24232763">SUMO_ATTR_ID</a>, 0, ok);
<a name="l00456"></a>00456         <span class="keywordflow">if</span> (!ok) {
<a name="l00457"></a>00457             <span class="keywordflow">return</span>;
<a name="l00458"></a>00458         }
<a name="l00459"></a>00459     }
<a name="l00460"></a>00460     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a> = <span class="keyword">new</span> <a class="code" href="../../d5/d9b/class_random_distributor.html">RandomDistributor&lt;const MSRoute*&gt;</a>();
<a name="l00461"></a>00461     <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a6c872f823deac968f22bcf09bcc08782">SUMO_ATTR_ROUTES</a>)) {
<a name="l00462"></a>00462         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00463"></a>00463         <a class="code" href="../../db/dc0/class_string_tokenizer.html">StringTokenizer</a> st(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a6c872f823deac968f22bcf09bcc08782">SUMO_ATTR_ROUTES</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a>.c_str(), ok));
<a name="l00464"></a>00464         <span class="keywordflow">while</span> (st.<a class="code" href="../../db/dc0/class_string_tokenizer.html#aa654384891d4b9d724eee0f6c739193c">hasNext</a>()) {
<a name="l00465"></a>00465             std::string routeID = st.<a class="code" href="../../db/dc0/class_string_tokenizer.html#afbe25dccd9c18a10650861730e63a7c2">next</a>();
<a name="l00466"></a>00466             <span class="keyword">const</span> <a class="code" href="../../de/dd8/class_m_s_route.html">MSRoute</a>* route = <a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(routeID);
<a name="l00467"></a>00467             <span class="keywordflow">if</span> (route == 0) {
<a name="l00468"></a>00468                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Unknown route &#39;&quot;</span> + routeID + <span class="stringliteral">&quot;&#39; in distribution &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00469"></a>00469             }
<a name="l00470"></a>00470             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#a8725996969c8b79905375efe040a2530" title="Adds a value with an assigned probability to the distribution.">add</a>(1., route, <span class="keyword">false</span>);
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473 }
<a name="l00474"></a>00474 
<a name="l00475"></a>00475 
<a name="l00476"></a>00476 <span class="keywordtype">void</span>
<a name="l00477"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a5e1166d03dfacd23371da94e873ffc28">00477</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a5e1166d03dfacd23371da94e873ffc28">MSRouteHandler::closeRouteDistribution</a>() {
<a name="l00478"></a>00478     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a> != 0) {
<a name="l00479"></a>00479         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>-&gt;<a class="code" href="../../d5/d9b/class_random_distributor.html#aaa67eed5efe4e483489a92d9a8df577e" title="Return the sum of the probabilites assigned to the members.">getOverallProb</a>() == 0) {
<a name="l00480"></a>00480             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>;
<a name="l00481"></a>00481             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Route distribution &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a> + <span class="stringliteral">&quot;&#39; is empty.&quot;</span>);
<a name="l00482"></a>00482         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>)) {
<a name="l00483"></a>00483             <span class="keyword">delete</span> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a>;
<a name="l00484"></a>00484             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Another route (or distribution) with the id &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a7186ca94e94a213035a2e008cfe5f75a" title="The id of the currently parsed route distribution.">myCurrentRouteDistributionID</a> + <span class="stringliteral">&quot;&#39; exists.&quot;</span>);
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a514aded371ab7d6725a98b8d5eeea53c" title="The currently parsed distribution of routes (probability-&amp;gt;route).">myCurrentRouteDistribution</a> = 0;
<a name="l00487"></a>00487     }
<a name="l00488"></a>00488 }
<a name="l00489"></a>00489 
<a name="l00490"></a>00490 
<a name="l00491"></a>00491 <span class="keywordtype">void</span>
<a name="l00492"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#aa8c1b281facf49fba72b7399a6a85611">00492</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aa8c1b281facf49fba72b7399a6a85611" title="Ends the processing of a vehicle.">MSRouteHandler::closeVehicle</a>() {
<a name="l00493"></a>00493     <span class="comment">// get nested route</span>
<a name="l00494"></a>00494     <span class="keyword">const</span> <a class="code" href="../../de/dd8/class_m_s_route.html">MSRoute</a>* route = <a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<span class="stringliteral">&quot;!&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>);
<a name="l00495"></a>00495     <a class="code" href="../../db/d2f/class_m_s_vehicle_control.html" title="The class responsible for building and deletion of vehicles.">MSVehicleControl</a>&amp; vehControl = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a5e74ee833cafefa74b84e2091ef135a3" title="Returns the vehicle control.">getVehicleControl</a>();
<a name="l00496"></a>00496     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ae42a14e21b5d040f3058ef5194e50c35" title="Information how the vehicle shall choose the depart time.">departProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#afcfaa02b708ce30f5cf9bd455ed00db9ac8d4d65e2cdf60fa00637cb8c346cd36" title="The time is given.">DEPART_GIVEN</a>) {
<a name="l00497"></a>00497         <span class="comment">// let&#39;s check whether this vehicle had to depart before the simulation starts</span>
<a name="l00498"></a>00498         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a16d400be7f88653db8b18992260d7227" title="Checks whether the route file is sorted by departure time if needed.">checkLastDepart</a>() || <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aded3ab5fa08e689297b7db36b24c3cf8" title="The vehicle&amp;#39;s departure time.">depart</a> &lt; <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5d22214aa371f87d2d4ff1612411e632">string2time</a>(<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().getString(<span class="stringliteral">&quot;begin&quot;</span>))) {
<a name="l00499"></a>00499             <span class="keywordflow">if</span> (route != 0) {
<a name="l00500"></a>00500                 route-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a6c90716ed4c237338afbf3b249345264" title="increments the reference counter for the route">addReference</a>();
<a name="l00501"></a>00501                 route-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#ad9f4430dbaaeebc843a7d9f01ab5c470" title="deletes the route if there are no further references to it">release</a>();
<a name="l00502"></a>00502             }
<a name="l00503"></a>00503             <span class="keywordflow">return</span>;
<a name="l00504"></a>00504         }
<a name="l00505"></a>00505     }
<a name="l00506"></a>00506     <span class="comment">// get the vehicle&#39;s type</span>
<a name="l00507"></a>00507     <a class="code" href="../../de/da2/class_m_s_vehicle_type.html" title="The car-following model and parameter.">MSVehicleType</a>* vtype = 0;
<a name="l00508"></a>00508     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a22192d6d6ac06da946f509c82f55ab74" title="The vehicle&amp;#39;s type id.">vtypeid</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00509"></a>00509         vtype = vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a95ddc958055c59d379d373aeb39621b5" title="Returns the named vehicle type or a sample from the named distribution.">getVType</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a22192d6d6ac06da946f509c82f55ab74" title="The vehicle&amp;#39;s type id.">vtypeid</a>);
<a name="l00510"></a>00510         <span class="keywordflow">if</span> (vtype == 0) {
<a name="l00511"></a>00511             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;The vehicle type &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a22192d6d6ac06da946f509c82f55ab74" title="The vehicle&amp;#39;s type id.">vtypeid</a> + <span class="stringliteral">&quot;&#39; for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; is not known.&quot;</span>);
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513     } <span class="keywordflow">else</span> {
<a name="l00514"></a>00514         <span class="comment">// there should be one (at least the default one)</span>
<a name="l00515"></a>00515         vtype = vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a95ddc958055c59d379d373aeb39621b5" title="Returns the named vehicle type or a sample from the named distribution.">getVType</a>();
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517     <span class="keywordflow">if</span> (route == 0) {
<a name="l00518"></a>00518         <span class="comment">// if there is no nested route, try via the (hopefully) given route-id</span>
<a name="l00519"></a>00519         route = <a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab30fb1b8d90dc4cbc146c61d9e5162ab" title="The vehicle&amp;#39;s route id.">routeid</a>);
<a name="l00520"></a>00520     }
<a name="l00521"></a>00521     <span class="keywordflow">if</span> (route == 0) {
<a name="l00522"></a>00522         <span class="comment">// nothing found? -&gt; error</span>
<a name="l00523"></a>00523         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab30fb1b8d90dc4cbc146c61d9e5162ab" title="The vehicle&amp;#39;s route id.">routeid</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00524"></a>00524             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;The route &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab30fb1b8d90dc4cbc146c61d9e5162ab" title="The vehicle&amp;#39;s route id.">routeid</a> + <span class="stringliteral">&quot;&#39; for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; is not known.&quot;</span>);
<a name="l00525"></a>00525         } <span class="keywordflow">else</span> {
<a name="l00526"></a>00526             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; has no route.&quot;</span>);
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     <span class="comment">// try to build the vehicle</span>
<a name="l00532"></a>00532     <a class="code" href="../../db/d61/class_s_u_m_o_vehicle.html" title="Representation of a vehicle.">SUMOVehicle</a>* vehicle = 0;
<a name="l00533"></a>00533     <span class="keywordflow">if</span> (vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a7e0bba043cf6d995661667fc4961f0a3" title="Returns the vehicle with the given id.">getVehicle</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>) == 0) {
<a name="l00534"></a>00534         vehicle = vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a03be9f9e122e132fcc440afe5e324f1a" title="Builds a vehicle, increases the number of built vehicles.">buildVehicle</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>, route, vtype);
<a name="l00535"></a>00535         <span class="comment">// maybe we do not want this vehicle to be inserted due to scaling</span>
<a name="l00536"></a>00536         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a79e8491318d1f2b5ab8f1e5fa7212b40" title="The scaling factor (especially for inc-dua).">myScale</a> &lt; 0 || vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a797a8f291a3738cc1bc0a91f06daa530" title="Returns the information whether the currently vehicle number is still in the given...">isInQuota</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a79e8491318d1f2b5ab8f1e5fa7212b40" title="The scaling factor (especially for inc-dua).">myScale</a>)) {
<a name="l00537"></a>00537             <span class="comment">// add the vehicle to the vehicle control</span>
<a name="l00538"></a>00538             vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a4a596b620fe88ac471ea9e905762ee44" title="Tries to insert the vehicle into the internal vehicle container.">addVehicle</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>, vehicle);
<a name="l00539"></a>00539             <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ae42a14e21b5d040f3058ef5194e50c35" title="Information how the vehicle shall choose the depart time.">departProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#afcfaa02b708ce30f5cf9bd455ed00db9ad491001a975b933cecedb904d0009f61" title="The departure is person triggered.">DEPART_TRIGGERED</a>) {
<a name="l00540"></a>00540                 vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a89f7ab897e1f54bc4c33f00f95c0311b">addWaiting</a>(*route-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a19df3c97135029c574956a7c0f88b9eb" title="Returns the begin of the list of edges to pass.">begin</a>(), vehicle);
<a name="l00541"></a>00541                 vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a396d78814b3e08b63fd014728ece1f47" title="increases the count of vehicles waiting for a person to allow recogniztion of person...">registerOneWaitingForPerson</a>();
<a name="l00542"></a>00542             }
<a name="l00543"></a>00543             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = 0;
<a name="l00544"></a>00544         } <span class="keywordflow">else</span> {
<a name="l00545"></a>00545             vehControl.<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a6088a11d7326c664fb854fc8bbc4ad9c" title="Deletes the vehicle.">deleteVehicle</a>(vehicle);
<a name="l00546"></a>00546             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = 0;
<a name="l00547"></a>00547             vehicle = 0;
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549     } <span class="keywordflow">else</span> {
<a name="l00550"></a>00550         <span class="comment">// strange: another vehicle with the same id already exists</span>
<a name="l00551"></a>00551 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00552"></a>00552 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (!MSGlobals::gStateLoaded) {
<a name="l00553"></a>00553 <span class="preprocessor">#endif</span>
<a name="l00554"></a>00554 <span class="preprocessor"></span>            <span class="comment">// and was not loaded while loading a simulation state</span>
<a name="l00555"></a>00555             <span class="comment">// -&gt; error</span>
<a name="l00556"></a>00556             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Another vehicle with the id &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; exists.&quot;</span>);
<a name="l00557"></a>00557 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00558"></a>00558 <span class="preprocessor"></span>        } <span class="keywordflow">else</span> {
<a name="l00559"></a>00559             <span class="comment">// ok, it seems to be loaded previously while loading a simulation state</span>
<a name="l00560"></a>00560             vehicle = 0;
<a name="l00561"></a>00561         }
<a name="l00562"></a>00562 <span class="preprocessor">#endif</span>
<a name="l00563"></a>00563 <span class="preprocessor"></span>    }
<a name="l00564"></a>00564     <span class="comment">// check whether the vehicle shall be added directly to the network or</span>
<a name="l00565"></a>00565     <span class="comment">//  shall stay in the internal buffer</span>
<a name="l00566"></a>00566     <span class="keywordflow">if</span> (vehicle != 0) {
<a name="l00567"></a>00567         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="../../db/d61/class_s_u_m_o_vehicle.html#aefc68ae53dd26cdb0f174e36d9c91a2c" title="Returns the vehicle&amp;#39;s parameter (including departure definition).">getParameter</a>().<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ae42a14e21b5d040f3058ef5194e50c35" title="Information how the vehicle shall choose the depart time.">departProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#afcfaa02b708ce30f5cf9bd455ed00db9ac8d4d65e2cdf60fa00637cb8c346cd36" title="The time is given.">DEPART_GIVEN</a>) {
<a name="l00568"></a>00568             <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#ab1fb4671cf35fef2b2cee49c3cdcc906" title="Returns the insertion control.">getInsertionControl</a>().<a class="code" href="../../d6/d7e/class_m_s_insertion_control.html#a92efb4bf39c635132f0ff821b939ead3" title="Adds a single vehicle for departure.">add</a>(vehicle);
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 }
<a name="l00572"></a>00572 
<a name="l00573"></a>00573 
<a name="l00574"></a>00574 <span class="keywordtype">void</span>
<a name="l00575"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a86cc7d5ac378934a5e54cae48da43558">00575</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a86cc7d5ac378934a5e54cae48da43558" title="Ends the processing of a person.">MSRouteHandler::closePerson</a>() {
<a name="l00576"></a>00576     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;size() == 0) {
<a name="l00577"></a>00577         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Person &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; has no plan.&quot;</span>);
<a name="l00578"></a>00578     }
<a name="l00579"></a>00579     <a class="code" href="../../de/d25/class_m_s_person.html">MSPerson</a>* person = <span class="keyword">new</span> <a class="code" href="../../de/d25/class_m_s_person.html">MSPerson</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>, <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>);
<a name="l00580"></a>00580     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a16d400be7f88653db8b18992260d7227" title="Checks whether the route file is sorted by departure time if needed.">checkLastDepart</a>() &amp;&amp; <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getPersonControl().add(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>, person)) {
<a name="l00581"></a>00581         <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a20498f518473681a3e0e9e570e3bf12d" title="Returns the person control.">getPersonControl</a>().<a class="code" href="../../db/d3c/class_m_s_person_control.html#a5fcbdc6e575cb5f48372c61ff242ab37" title="sets the arrival time for a waiting or walking person">setArrival</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aded3ab5fa08e689297b7db36b24c3cf8" title="The vehicle&amp;#39;s departure time.">depart</a>, person);
<a name="l00582"></a>00582     } <span class="keywordflow">else</span> {
<a name="l00583"></a>00583         <span class="keyword">delete</span> person;
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = 0;
<a name="l00586"></a>00586     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a> = 0;
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <span class="keywordtype">void</span>
<a name="l00591"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a655dfc9712db03610ba585196727fde4">00591</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a655dfc9712db03610ba585196727fde4" title="Ends the processing of a flow.">MSRouteHandler::closeFlow</a>() {
<a name="l00592"></a>00592     <span class="comment">// let&#39;s check whether vehicles had to depart before the simulation starts</span>
<a name="l00593"></a>00593     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a4096e3656a9b2e6a5c8b1b7f4647bfc3" title="The number of times the vehicle was already inserted.">repetitionsDone</a> = 0;
<a name="l00594"></a>00594     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> offsetToBegin = <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5d22214aa371f87d2d4ff1612411e632">string2time</a>(<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().getString(<span class="stringliteral">&quot;begin&quot;</span>)) - <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aded3ab5fa08e689297b7db36b24c3cf8" title="The vehicle&amp;#39;s departure time.">depart</a>;
<a name="l00595"></a>00595     <span class="keywordflow">while</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a4096e3656a9b2e6a5c8b1b7f4647bfc3" title="The number of times the vehicle was already inserted.">repetitionsDone</a> * <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a2829a522a1b7d2f49557271b5bbb2314" title="The time offset between vehicle reinsertions.">repetitionOffset</a> &lt; offsetToBegin) {
<a name="l00596"></a>00596         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a4096e3656a9b2e6a5c8b1b7f4647bfc3" title="The number of times the vehicle was already inserted.">repetitionsDone</a>++;
<a name="l00597"></a>00597         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a4096e3656a9b2e6a5c8b1b7f4647bfc3" title="The number of times the vehicle was already inserted.">repetitionsDone</a> == <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a1526717e606c579e5ec14b7ab798fac2" title="The number of times the vehicle shall be repeatedly inserted.">repetitionNumber</a>) {
<a name="l00598"></a>00598             <span class="keywordflow">return</span>;
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601     <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getVehicleControl().getVType(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a22192d6d6ac06da946f509c82f55ab74" title="The vehicle&amp;#39;s type id.">vtypeid</a>) == 0) {
<a name="l00602"></a>00602         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;The vehicle type &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a22192d6d6ac06da946f509c82f55ab74" title="The vehicle&amp;#39;s type id.">vtypeid</a> + <span class="stringliteral">&quot;&#39; for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; is not known.&quot;</span>);
<a name="l00603"></a>00603     }
<a name="l00604"></a>00604     <span class="keywordflow">if</span> (<a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<span class="stringliteral">&quot;!&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>) == 0) {
<a name="l00605"></a>00605         <span class="comment">// if not, try via the (hopefully) given route-id</span>
<a name="l00606"></a>00606         <span class="keywordflow">if</span> (<a class="code" href="../../de/dd8/class_m_s_route.html#a379e71c30ffbb0c2366b47f32014980f" title="Adds a route to the dictionary.">MSRoute::dictionary</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab30fb1b8d90dc4cbc146c61d9e5162ab" title="The vehicle&amp;#39;s route id.">routeid</a>) == 0) {
<a name="l00607"></a>00607             <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab30fb1b8d90dc4cbc146c61d9e5162ab" title="The vehicle&amp;#39;s route id.">routeid</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00608"></a>00608                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;The route &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab30fb1b8d90dc4cbc146c61d9e5162ab" title="The vehicle&amp;#39;s route id.">routeid</a> + <span class="stringliteral">&quot;&#39; for vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; is not known.&quot;</span>);
<a name="l00609"></a>00609             } <span class="keywordflow">else</span> {
<a name="l00610"></a>00610                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; has no route.&quot;</span>);
<a name="l00611"></a>00611             }
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613     } <span class="keywordflow">else</span> {
<a name="l00614"></a>00614         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab30fb1b8d90dc4cbc146c61d9e5162ab" title="The vehicle&amp;#39;s route id.">routeid</a> = <span class="stringliteral">&quot;!&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>;
<a name="l00615"></a>00615     }
<a name="l00616"></a>00616     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00617"></a>00617 
<a name="l00618"></a>00618     <span class="comment">// check whether the vehicle shall be added directly to the network or</span>
<a name="l00619"></a>00619     <span class="comment">//  shall stay in the internal buffer</span>
<a name="l00620"></a>00620     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a16d400be7f88653db8b18992260d7227" title="Checks whether the route file is sorted by departure time if needed.">checkLastDepart</a>()) {
<a name="l00621"></a>00621         <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#ab1fb4671cf35fef2b2cee49c3cdcc906" title="Returns the insertion control.">getInsertionControl</a>().<a class="code" href="../../d6/d7e/class_m_s_insertion_control.html#a92efb4bf39c635132f0ff821b939ead3" title="Adds a single vehicle for departure.">add</a>(<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>);
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623     <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a> = 0;
<a name="l00624"></a>00624 }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626 <span class="keywordtype">bool</span>
<a name="l00627"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8e640bb2157bcad8a25d520baef804eb">00627</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8e640bb2157bcad8a25d520baef804eb" title="check start and end position of a stop">MSRouteHandler::checkStopPos</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>&amp; startPos, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>&amp; endPos, <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> laneLength,
<a name="l00628"></a>00628                              <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> minLength, <span class="keyword">const</span> <span class="keywordtype">bool</span> friendlyPos) {
<a name="l00629"></a>00629     <span class="keywordflow">if</span> (minLength &gt; laneLength) {
<a name="l00630"></a>00630         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00631"></a>00631     }
<a name="l00632"></a>00632     <span class="keywordflow">if</span> (startPos &lt; 0) {
<a name="l00633"></a>00633         startPos += laneLength;
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     <span class="keywordflow">if</span> (endPos &lt; 0) {
<a name="l00636"></a>00636         endPos += laneLength;
<a name="l00637"></a>00637     }
<a name="l00638"></a>00638     <span class="keywordflow">if</span> (endPos &lt; minLength || endPos &gt; laneLength) {
<a name="l00639"></a>00639         <span class="keywordflow">if</span> (!friendlyPos) {
<a name="l00640"></a>00640             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00641"></a>00641         }
<a name="l00642"></a>00642         <span class="keywordflow">if</span> (endPos &lt; minLength) {
<a name="l00643"></a>00643             endPos = minLength;
<a name="l00644"></a>00644         }
<a name="l00645"></a>00645         <span class="keywordflow">if</span> (endPos &gt; laneLength) {
<a name="l00646"></a>00646             endPos = laneLength;
<a name="l00647"></a>00647         }
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (startPos &lt; 0 || startPos &gt; endPos - minLength) {
<a name="l00650"></a>00650         <span class="keywordflow">if</span> (!friendlyPos) {
<a name="l00651"></a>00651             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00652"></a>00652         }
<a name="l00653"></a>00653         <span class="keywordflow">if</span> (startPos &lt; 0) {
<a name="l00654"></a>00654             startPos = 0;
<a name="l00655"></a>00655         }
<a name="l00656"></a>00656         <span class="keywordflow">if</span> (startPos &gt; endPos - minLength) {
<a name="l00657"></a>00657             startPos = endPos - minLength;
<a name="l00658"></a>00658         }
<a name="l00659"></a>00659     }
<a name="l00660"></a>00660     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00661"></a>00661 }
<a name="l00662"></a>00662 
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 <span class="keywordtype">void</span>
<a name="l00665"></a><a class="code" href="../../d7/df0/class_m_s_route_handler.html#a1b4cf7d372f6be289a3083fcad9fff58">00665</a> <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a1b4cf7d372f6be289a3083fcad9fff58" title="Processing of a stop.">MSRouteHandler::addStop</a>(<span class="keyword">const</span> <a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html" title="Encapsulated SAX-Attributes.">SUMOSAXAttributes</a>&amp; attrs) {
<a name="l00666"></a>00666     <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00667"></a>00667     std::string errorSuffix;
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00669"></a>00669         errorSuffix = <span class="stringliteral">&quot; in route &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>;
<a name="l00670"></a>00670     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>) {
<a name="l00671"></a>00671         errorSuffix = <span class="stringliteral">&quot; in person &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>;
<a name="l00672"></a>00672     } <span class="keywordflow">else</span> {
<a name="l00673"></a>00673         errorSuffix = <span class="stringliteral">&quot; in vehicle &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>;
<a name="l00674"></a>00674     }
<a name="l00675"></a>00675     <a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html" title="Definition of vehicle stop (position and duration).">SUMOVehicleParameter::Stop</a> stop;
<a name="l00676"></a>00676     <span class="comment">// try to parse the assigned bus stop</span>
<a name="l00677"></a>00677     <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a2e0cd995a5d0ed636069bde6bfc90162">SUMO_ATTR_BUS_STOP__DEPRECATED</a>)) {
<a name="l00678"></a>00678         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ad7e6ddc044bf06a4052ac2f366372cfa" title="(Optional) bus stop if one is assigned to the stop">busstop</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a2e0cd995a5d0ed636069bde6bfc90162">SUMO_ATTR_BUS_STOP__DEPRECATED</a>, 0, ok);
<a name="l00679"></a>00679         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/df0/class_m_s_route_handler.html#ad32256d8858270882466107b81c7951c">myHaveWarnedAboutDeprecatedBusStop</a>) {
<a name="l00680"></a>00680             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#ad32256d8858270882466107b81c7951c">myHaveWarnedAboutDeprecatedBusStop</a> = <span class="keyword">true</span>;
<a name="l00681"></a>00681             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;&#39;bus_stop&#39; is deprecated, please use &#39;busStop&#39; instead.&quot;</span>);
<a name="l00682"></a>00682         }
<a name="l00683"></a>00683     } <span class="keywordflow">else</span> {
<a name="l00684"></a>00684         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ad7e6ddc044bf06a4052ac2f366372cfa" title="(Optional) bus stop if one is assigned to the stop">busstop</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a532666e0ee347cad965e86e266b7b4fe" title="Tries to read given attribute assuming it is a string.">getOptStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a3e52c157e24ce05dac3ac3898e553f0f">SUMO_ATTR_BUS_STOP</a>, 0, ok, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686     <span class="keywordflow">if</span> (stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ad7e6ddc044bf06a4052ac2f366372cfa" title="(Optional) bus stop if one is assigned to the stop">busstop</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00687"></a>00687         <span class="comment">// ok, we have obviously a bus stop</span>
<a name="l00688"></a>00688         <a class="code" href="../../d9/d26/class_m_s_bus_stop.html" title="A lane area vehicles can halt at.">MSBusStop</a>* bs = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a47bc0503e556135e3aceb65c691209de" title="Returns the named bus stop.">getBusStop</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ad7e6ddc044bf06a4052ac2f366372cfa" title="(Optional) bus stop if one is assigned to the stop">busstop</a>);
<a name="l00689"></a>00689         <span class="keywordflow">if</span> (bs != 0) {
<a name="l00690"></a>00690             <span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>&amp; l = bs-&gt;<a class="code" href="../../d9/d26/class_m_s_bus_stop.html#ac60536cf240567fc9de28d1a73167aee" title="Returns the lane this bus stop is located at.">getLane</a>();
<a name="l00691"></a>00691             stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a> = l.<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>();
<a name="l00692"></a>00692             stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a> = bs-&gt;<a class="code" href="../../d9/d26/class_m_s_bus_stop.html#af9eae7f84f4b47dd025000596c101c2c" title="Returns the end position of this bus stop.">getEndLanePosition</a>();
<a name="l00693"></a>00693             stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a3435e088375fa79b59c4b58aac609f0c" title="The stopping position start.">startPos</a> = bs-&gt;<a class="code" href="../../d9/d26/class_m_s_bus_stop.html#a9fe48767f13a678c53befcc93a6bdea0" title="Returns the begin position of this bus stop.">getBeginLanePosition</a>();
<a name="l00694"></a>00694         } <span class="keywordflow">else</span> {
<a name="l00695"></a>00695             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;The bus stop &#39;&quot;</span> + stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ad7e6ddc044bf06a4052ac2f366372cfa" title="(Optional) bus stop if one is assigned to the stop">busstop</a> + <span class="stringliteral">&quot;&#39; is not known&quot;</span> + errorSuffix);
<a name="l00696"></a>00696             <span class="keywordflow">return</span>;
<a name="l00697"></a>00697         }
<a name="l00698"></a>00698     } <span class="keywordflow">else</span> {
<a name="l00699"></a>00699         <span class="comment">// no, the lane and the position should be given</span>
<a name="l00700"></a>00700         <span class="comment">// get the lane</span>
<a name="l00701"></a>00701         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a532666e0ee347cad965e86e266b7b4fe" title="Tries to read given attribute assuming it is a string.">getOptStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a0c5bfe1cad71b317bd8330906c0dfa4e">SUMO_ATTR_LANE</a>, 0, ok, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00702"></a>00702         <span class="keywordflow">if</span> (ok &amp;&amp; stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00703"></a>00703             <span class="keywordflow">if</span> (<a class="code" href="../../d9/d16/class_m_s_lane.html#a965f4a235ad88d59aa404c1054dafe75" title="Inserts a MSLane into the static dictionary Returns true if the key id isn&amp;#39;t...">MSLane::dictionary</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a>) == 0) {
<a name="l00704"></a>00704                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;The lane &#39;&quot;</span> + stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a> + <span class="stringliteral">&quot;&#39; for a stop is not known&quot;</span> + errorSuffix);
<a name="l00705"></a>00705                 <span class="keywordflow">return</span>;
<a name="l00706"></a>00706             }
<a name="l00707"></a>00707         } <span class="keywordflow">else</span> {
<a name="l00708"></a>00708             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;A stop must be placed on a bus stop or a lane&quot;</span> + errorSuffix);
<a name="l00709"></a>00709             <span class="keywordflow">return</span>;
<a name="l00710"></a>00710         }
<a name="l00711"></a>00711         <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a> &amp;&amp;
<a name="l00712"></a>00712                 !<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;empty() &amp;&amp;
<a name="l00713"></a>00713                 &amp;<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;back()-&gt;getDestination() != &amp;<a class="code" href="../../d9/d16/class_m_s_lane.html#a965f4a235ad88d59aa404c1054dafe75" title="Inserts a MSLane into the static dictionary Returns true if the key id isn&amp;#39;t...">MSLane::dictionary</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a>)-&gt;getEdge()) {
<a name="l00714"></a>00714             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Disconnected plan for person &#39;&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; (&quot;</span> + <a class="code" href="../../d9/d16/class_m_s_lane.html#a965f4a235ad88d59aa404c1054dafe75" title="Inserts a MSLane into the static dictionary Returns true if the key id isn&amp;#39;t...">MSLane::dictionary</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a>)-&gt;getEdge().getID() + <span class="stringliteral">&quot;!=&quot;</span> + <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;back()-&gt;getDestination().getID() + <span class="stringliteral">&quot;).&quot;</span>);
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ac75d8d5e5b9b3a3e68582e5a1c33615b" title="Tries to read given attribute assuming it is a SUMOReal.">getOptSUMORealReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a420cdc947be357313ad923bbb8406d6d">SUMO_ATTR_ENDPOS</a>, 0, ok, <a class="code" href="../../d9/d16/class_m_s_lane.html#a965f4a235ad88d59aa404c1054dafe75" title="Inserts a MSLane into the static dictionary Returns true if the key id isn&amp;#39;t...">MSLane::dictionary</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a>)-&gt;getLength());
<a name="l00717"></a>00717         <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96aedb2f129c132230d40119f4d6d10ed53">SUMO_ATTR_POSITION</a>)) {
<a name="l00718"></a>00718             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Deprecated attribute &#39;pos&#39; in description of stop&quot;</span> + errorSuffix);
<a name="l00719"></a>00719             stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ac75d8d5e5b9b3a3e68582e5a1c33615b" title="Tries to read given attribute assuming it is a SUMOReal.">getOptSUMORealReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96aedb2f129c132230d40119f4d6d10ed53">SUMO_ATTR_POSITION</a>, 0, ok, stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a>);
<a name="l00720"></a>00720         }
<a name="l00721"></a>00721         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a3435e088375fa79b59c4b58aac609f0c" title="The stopping position start.">startPos</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ac75d8d5e5b9b3a3e68582e5a1c33615b" title="Tries to read given attribute assuming it is a SUMOReal.">getOptSUMORealReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a04c0d46207683c12e8a378606fac6bb8">SUMO_ATTR_STARTPOS</a>, 0, ok, stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a> - 2 * <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>);
<a name="l00722"></a>00722         <span class="keywordflow">if</span> (attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ae8e17fd4e6e7703c5efec71c14bcebf6">SUMO_ATTR_FRIENDLY_POS__DEPRECATED</a>) &amp;&amp; !<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a56a9abd87f37166e147cdddb57442813">myHaveWarnedAboutDeprecatedFriendlyPos</a>) {
<a name="l00723"></a>00723             <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a56a9abd87f37166e147cdddb57442813">myHaveWarnedAboutDeprecatedFriendlyPos</a> = <span class="keyword">true</span>;
<a name="l00724"></a>00724             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ae8e17fd4e6e7703c5efec71c14bcebf6">SUMO_ATTR_FRIENDLY_POS__DEPRECATED</a>) + <span class="stringliteral">&quot;&#39; is deprecated, use &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ab838fae782facd040295771c3556e751">SUMO_ATTR_FRIENDLY_POS</a>) + <span class="stringliteral">&quot;&#39; instead.&quot;</span>);
<a name="l00725"></a>00725         }
<a name="l00726"></a>00726         <span class="keywordtype">bool</span> friendlyPos = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ae8e17fd4e6e7703c5efec71c14bcebf6">SUMO_ATTR_FRIENDLY_POS__DEPRECATED</a>)
<a name="l00727"></a>00727                            ? attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a565ee2fcaeb1b815907eed8e32a1bf4e" title="Tries to read given attribute assuming it is a boolean.">getOptBoolReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ae8e17fd4e6e7703c5efec71c14bcebf6">SUMO_ATTR_FRIENDLY_POS__DEPRECATED</a>, 0, ok, <span class="keyword">false</span>)
<a name="l00728"></a>00728                            : attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a565ee2fcaeb1b815907eed8e32a1bf4e" title="Tries to read given attribute assuming it is a boolean.">getOptBoolReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ab838fae782facd040295771c3556e751">SUMO_ATTR_FRIENDLY_POS</a>, 0, ok, <span class="keyword">false</span>);
<a name="l00729"></a>00729         <span class="keywordflow">if</span> (!ok || !<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8e640bb2157bcad8a25d520baef804eb" title="check start and end position of a stop">checkStopPos</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a3435e088375fa79b59c4b58aac609f0c" title="The stopping position start.">startPos</a>, stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a>, <a class="code" href="../../d9/d16/class_m_s_lane.html#a965f4a235ad88d59aa404c1054dafe75" title="Inserts a MSLane into the static dictionary Returns true if the key id isn&amp;#39;t...">MSLane::dictionary</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a>)-&gt;getLength(), <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>, friendlyPos)) {
<a name="l00730"></a>00730             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Invalid start or end position for stop&quot;</span> + errorSuffix);
<a name="l00731"></a>00731             <span class="keywordflow">return</span>;
<a name="l00732"></a>00732         }
<a name="l00733"></a>00733     }
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <span class="comment">// get the standing duration</span>
<a name="l00736"></a>00736     <span class="keywordflow">if</span> (!attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96adfa4719fd026c92649eb79501982ffef">SUMO_ATTR_DURATION</a>) &amp;&amp; !attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ace19807212f7187b6b66d07d94a85a0d">SUMO_ATTR_UNTIL</a>)) {
<a name="l00737"></a>00737         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a959e989af41210da5548f1186efc4495" title="whether an arriving person lets the vehicle continue">triggered</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a565ee2fcaeb1b815907eed8e32a1bf4e" title="Tries to read given attribute assuming it is a boolean.">getOptBoolReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ade49c796c7e4a42b611d7b53c58b23c1">SUMO_ATTR_TRIGGERED</a>, 0, ok, <span class="keyword">true</span>);
<a name="l00738"></a>00738         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#af34de16e90f8027aac5973aefc3bbde0" title="The stopping duration.">duration</a> = -1;
<a name="l00739"></a>00739         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a9183e42ddbb877af1e4b767a1847ceda" title="The time at which the vehicle may continue its journey.">until</a> = -1;
<a name="l00740"></a>00740     } <span class="keywordflow">else</span> {
<a name="l00741"></a>00741         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#af34de16e90f8027aac5973aefc3bbde0" title="The stopping duration.">duration</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a86a6e60b2f342ff08721f29465e0fa50" title="Tries to read given attribute assuming it is a SUMOTime.">getOptSUMOTimeReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96adfa4719fd026c92649eb79501982ffef">SUMO_ATTR_DURATION</a>, 0, ok, -1);
<a name="l00742"></a>00742         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a9183e42ddbb877af1e4b767a1847ceda" title="The time at which the vehicle may continue its journey.">until</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a86a6e60b2f342ff08721f29465e0fa50" title="Tries to read given attribute assuming it is a SUMOTime.">getOptSUMOTimeReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ace19807212f7187b6b66d07d94a85a0d">SUMO_ATTR_UNTIL</a>, 0, ok, -1);
<a name="l00743"></a>00743         <span class="keywordflow">if</span> (!ok || (stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#af34de16e90f8027aac5973aefc3bbde0" title="The stopping duration.">duration</a> &lt; 0 &amp;&amp; stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a9183e42ddbb877af1e4b767a1847ceda" title="The time at which the vehicle may continue its journey.">until</a> &lt; 0)) {
<a name="l00744"></a>00744             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Invalid duration or end time is given for a stop&quot;</span> + errorSuffix);
<a name="l00745"></a>00745             <span class="keywordflow">return</span>;
<a name="l00746"></a>00746         }
<a name="l00747"></a>00747         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a959e989af41210da5548f1186efc4495" title="whether an arriving person lets the vehicle continue">triggered</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a565ee2fcaeb1b815907eed8e32a1bf4e" title="Tries to read given attribute assuming it is a boolean.">getOptBoolReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ade49c796c7e4a42b611d7b53c58b23c1">SUMO_ATTR_TRIGGERED</a>, 0, ok, <span class="keyword">false</span>);
<a name="l00748"></a>00748     }
<a name="l00749"></a>00749     stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ac510509332a167a67550d62e941be867" title="whether the vehicle is removed from the net while stopping">parking</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a565ee2fcaeb1b815907eed8e32a1bf4e" title="Tries to read given attribute assuming it is a boolean.">getOptBoolReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a064eff83908085f56e586f1408f958db">SUMO_ATTR_PARKING</a>, 0, ok, stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a959e989af41210da5548f1186efc4495" title="whether an arriving person lets the vehicle continue">triggered</a>);
<a name="l00750"></a>00750     <span class="keywordflow">if</span> (!ok) {
<a name="l00751"></a>00751         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Invalid bool for &#39;triggered&#39; or &#39;parking&#39; for stop&quot;</span> + errorSuffix);
<a name="l00752"></a>00752         <span class="keywordflow">return</span>;
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754     <span class="keyword">const</span> std::string idx = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a532666e0ee347cad965e86e266b7b4fe" title="Tries to read given attribute assuming it is a string.">getOptStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a8d59481c710b2f316a4c6a0cc2b8bc5b">SUMO_ATTR_INDEX</a>, 0, ok, <span class="stringliteral">&quot;end&quot;</span>);
<a name="l00755"></a>00755     <span class="keywordflow">if</span> (idx == <span class="stringliteral">&quot;end&quot;</span>) {
<a name="l00756"></a>00756         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> = <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a24c5761d498b1887614323093e764c83">STOP_INDEX_END</a>;
<a name="l00757"></a>00757     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (idx == <span class="stringliteral">&quot;fit&quot;</span>) {
<a name="l00758"></a>00758         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> = <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#ab6f852854d8e837bb72b5d08fb66cf15">STOP_INDEX_FIT</a>;
<a name="l00759"></a>00759     } <span class="keywordflow">else</span> {
<a name="l00760"></a>00760         stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#aa20314c8b11251d9d6d82566d6b34136" title="Tries to read given attribute assuming it is an int.">getIntReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a8d59481c710b2f316a4c6a0cc2b8bc5b">SUMO_ATTR_INDEX</a>, 0, ok);
<a name="l00761"></a>00761         <span class="keywordflow">if</span> (!ok || stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> &lt; 0) {
<a name="l00762"></a>00762             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Invalid &#39;index&#39; for stop&quot;</span> + errorSuffix);
<a name="l00763"></a>00763             <span class="keywordflow">return</span>;
<a name="l00764"></a>00764         }
<a name="l00765"></a>00765     }
<a name="l00766"></a>00766     <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a8544a4cefceb9286f5ee199bca8241e2" title="The id of the current route.">myActiveRouteID</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00767"></a>00767         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#aed921a613ea359c055098f2ed5044533" title="List of the stops on the parsed route.">myActiveRouteStops</a>.push_back(stop);
<a name="l00768"></a>00768     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>) {
<a name="l00769"></a>00769         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a3a13ceffecc8a70dd7d6a9ac4943dcde" title="The plan of the current person.">myActivePlan</a>-&gt;push_back(<span class="keyword">new</span> <a class="code" href="../../dc/df9/class_m_s_person_1_1_m_s_person_stage___waiting.html">MSPerson::MSPersonStage_Waiting</a>(<a class="code" href="../../d9/d16/class_m_s_lane.html#a965f4a235ad88d59aa404c1054dafe75" title="Inserts a MSLane into the static dictionary Returns true if the key id isn&amp;#39;t...">MSLane::dictionary</a>(stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a>)-&gt;getEdge(), stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#af34de16e90f8027aac5973aefc3bbde0" title="The stopping duration.">duration</a>, stop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a9183e42ddbb877af1e4b767a1847ceda" title="The time at which the vehicle may continue its journey.">until</a>));
<a name="l00770"></a>00770     } <span class="keywordflow">else</span> {
<a name="l00771"></a>00771         <a class="code" href="../../d7/df0/class_m_s_route_handler.html#a6d67669fba490431fd513aa02da94c18">myVehicleParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aba164cb7671eef176b50fca07e2fb324" title="List of the stops the vehicle will make.">stops</a>.push_back(stop);
<a name="l00772"></a>00772     }
<a name="l00773"></a>00773 }
<a name="l00774"></a>00774 
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 <span class="comment">/****************************************************************************/</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:01 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
