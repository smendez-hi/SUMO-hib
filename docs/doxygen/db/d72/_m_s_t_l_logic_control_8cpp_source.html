<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: MSTLLogicControl.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_6b4e825611921d20a66b187b0ee8072c.html">microsim</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_edb977b395c73e58882631dc263eb7dc.html">traffic_lights</a>
  </div>
</div>
<div class="contents">
<h1>MSTLLogicControl.cpp</h1><a href="../../db/d72/_m_s_t_l_logic_control_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00013"></a>00013 <span class="comment">// A class that stores and controls tls and switching of their programs</span>
<a name="l00014"></a>00014 <span class="comment">/****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00016"></a>00016 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00017"></a>00017 <span class="comment">/****************************************************************************/</span>
<a name="l00018"></a>00018 <span class="comment">//</span>
<a name="l00019"></a>00019 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00020"></a>00020 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00021"></a>00021 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00022"></a>00022 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00023"></a>00023 <span class="comment">//   (at your option) any later version.</span>
<a name="l00024"></a>00024 <span class="comment">//</span>
<a name="l00025"></a>00025 <span class="comment">/****************************************************************************/</span>
<a name="l00026"></a>00026 <span class="comment">// ===========================================================================</span>
<a name="l00027"></a>00027 <span class="comment">// included modules</span>
<a name="l00028"></a>00028 <span class="comment">// ===========================================================================</span>
<a name="l00029"></a>00029 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00030"></a>00030 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#else</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#endif</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;vector&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;iterator&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d43/_m_s_traffic_light_logic_8h.html">MSTrafficLightLogic.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../de/d3f/_m_s_simple_traffic_light_logic_8h.html">MSSimpleTrafficLightLogic.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/df9/_m_s_t_l_logic_control_8h.html">MSTLLogicControl.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d92/_m_s_off_traffic_light_logic_8h.html">MSOffTrafficLightLogic.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="../../d9/d94/_m_s_event_control_8h.html">microsim/MSEventControl.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="../../d9/dfa/_m_s_net_8h.html">microsim/MSNet.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="../../de/d4a/_tpl_convert_8h.html">utils/common/TplConvert.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d08/_to_string_8h.html">utils/common/ToString.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/df7/_msg_handler_8h.html">utils/common/MsgHandler.h</a>&gt;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00050"></a>00050 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00052"></a>00052 <span class="preprocessor"></span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="comment">// ===========================================================================</span>
<a name="l00055"></a>00055 <span class="comment">// method definitions</span>
<a name="l00056"></a>00056 <span class="comment">// ===========================================================================</span>
<a name="l00057"></a>00057 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00058"></a>00058 <span class="comment"> * MSTLLogicControl::TLSLogicVariants - methods</span>
<a name="l00059"></a>00059 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00060"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a643a8d2599eaad3538d474d2c82a7fde">00060</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a643a8d2599eaad3538d474d2c82a7fde" title="Constructor.">MSTLLogicControl::TLSLogicVariants::TLSLogicVariants</a>()
<a name="l00061"></a>00061     : myCurrentProgram(0) {
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 
<a name="l00065"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#aba990bfe3f5fb3d4d1512f4d392345c4">00065</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#aba990bfe3f5fb3d4d1512f4d392345c4" title="Destructor.">MSTLLogicControl::TLSLogicVariants::~TLSLogicVariants</a>() {
<a name="l00066"></a>00066     std::map&lt;std::string, MSTrafficLightLogic*&gt;::const_iterator j;
<a name="l00067"></a>00067     <span class="keywordflow">for</span> (std::map&lt;std::string, MSTrafficLightLogic*&gt;::iterator j = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.begin(); j != <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.end(); ++j) {
<a name="l00068"></a>00068         <span class="keyword">delete</span>(*j).second;
<a name="l00069"></a>00069     }
<a name="l00070"></a>00070     <span class="keywordflow">for</span> (std::vector&lt;OnSwitchAction*&gt;::iterator i = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a3e0d5ba7b1bfabc284ea0a190952312e" title="The list of actions/commands to execute on switch.">mySwitchActions</a>.begin(); i != <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a3e0d5ba7b1bfabc284ea0a190952312e" title="The list of actions/commands to execute on switch.">mySwitchActions</a>.end(); ++i) {
<a name="l00071"></a>00071         <span class="keyword">delete</span> *i;
<a name="l00072"></a>00072     }
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="keywordtype">bool</span>
<a name="l00077"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a87cfdd26c1fd025deb7c1f3f57a2bf8b">00077</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a87cfdd26c1fd025deb7c1f3f57a2bf8b" title="Verifies traffic lights loaded from the network.">MSTLLogicControl::TLSLogicVariants::checkOriginalTLS</a>()<span class="keyword"> const </span>{
<a name="l00078"></a>00078     <span class="keywordtype">bool</span> hadErrors = <span class="keyword">false</span>;
<a name="l00079"></a>00079     <span class="keywordflow">for</span> (std::map&lt;std::string, MSTrafficLightLogic*&gt;::const_iterator j = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.begin(); j != <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.end(); ++j) {
<a name="l00080"></a>00080         <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#aea245f341bebb1af5f3de7f8aa53f859" title="Definition of a list of phases, being the junction logic.">MSTrafficLightLogic::Phases</a>&amp; phases = (*j).second-&gt;getPhases();
<a name="l00081"></a>00081         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> linkNo = (<span class="keywordtype">unsigned</span> int)(*j).second-&gt;getLinks().size();
<a name="l00082"></a>00082         <span class="keywordtype">bool</span> hadProgramErrors = <span class="keyword">false</span>;
<a name="l00083"></a>00083         <span class="keywordflow">for</span> (MSTrafficLightLogic::Phases::const_iterator i = phases.begin(); i != phases.end(); ++i) {
<a name="l00084"></a>00084             <span class="keywordflow">if</span> ((*i)-&gt;getState().length() &lt; linkNo) {
<a name="l00085"></a>00085                 hadProgramErrors = <span class="keyword">true</span>;
<a name="l00086"></a>00086             }
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088         <span class="keywordflow">if</span> (hadProgramErrors) {
<a name="l00089"></a>00089             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Mismatching phase size in tls &#39;&quot;</span> + (*j).second-&gt;getID() + <span class="stringliteral">&quot;&#39;, program &#39;&quot;</span> + (*j).first + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00090"></a>00090             hadErrors = <span class="keyword">true</span>;
<a name="l00091"></a>00091         }
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093     <span class="keywordflow">return</span> !hadErrors;
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 <span class="keywordtype">void</span>
<a name="l00098"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#aa162d801cecab6869793c630c9771556">00098</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#aa162d801cecab6869793c630c9771556">MSTLLogicControl::TLSLogicVariants::saveInitialStates</a>() {
<a name="l00099"></a>00099     <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a3f887254ef2fa8bc1cf2ad30d0697e7c" title="Originally loaded link states.">myOriginalLinkStates</a> = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a531562c5edc05ac4e293c948b7b685ca" title="Returns the (uncontrolled) states of the controlled links.">collectLinkStates</a>();
<a name="l00100"></a>00100 }
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="keywordtype">bool</span>
<a name="l00104"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a959a0a696ef9e978490473c2c64f4c96">00104</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a959a0a696ef9e978490473c2c64f4c96" title="Adds a logic (program).">MSTLLogicControl::TLSLogicVariants::addLogic</a>(<span class="keyword">const</span> std::string&amp; programID,
<a name="l00105"></a>00105         <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* logic, <span class="keywordtype">bool</span> netWasLoaded, <span class="keywordtype">bool</span> isNewDefault) {
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.find(programID) != <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.end()) {
<a name="l00107"></a>00107         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <span class="comment">// assert the links are set</span>
<a name="l00110"></a>00110     <span class="keywordflow">if</span> (netWasLoaded) {
<a name="l00111"></a>00111         <span class="comment">// this one has not yet its links set</span>
<a name="l00112"></a>00112         <span class="keywordflow">if</span> (<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a> == 0) {
<a name="l00113"></a>00113             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;No initial signal plan loaded for tls &#39;&quot;</span> + logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a612f9f30db841c26fb177b31b9a05600" title="Returns this tl-logic&amp;#39;s id.">getID</a>() + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00114"></a>00114         }
<a name="l00115"></a>00115         logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a05b5957368404cf23f3f41d09aa0447a" title="Applies information about controlled links and lanes from the given logic.">adaptLinkInformationFrom</a>(*<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a>);
<a name="l00116"></a>00116         <span class="keywordflow">if</span> (logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a36a47f9e5c249d3835955af54db1221f" title="Returns the list of lists of all affected links.">getLinks</a>().size() &gt; logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(0).<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ac1a06ef5f493feeb13d574dad17fa032" title="Returns the state within this phase.">getState</a>().size()) {
<a name="l00117"></a>00117             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Mismatching phase size in tls &#39;&quot;</span> + logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a612f9f30db841c26fb177b31b9a05600" title="Returns this tl-logic&amp;#39;s id.">getID</a>() + <span class="stringliteral">&quot;&#39;, program &#39;&quot;</span> + programID + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00118"></a>00118         }
<a name="l00119"></a>00119     }
<a name="l00120"></a>00120     <span class="comment">// add to the list of active</span>
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.size() == 0 || isNewDefault) {
<a name="l00122"></a>00122         <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a> = logic;
<a name="l00123"></a>00123     }
<a name="l00124"></a>00124     <span class="comment">// add to the list of logic</span>
<a name="l00125"></a>00125     <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>[programID] = logic;
<a name="l00126"></a>00126     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.size() == 1 || isNewDefault) {
<a name="l00127"></a>00127         logic-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ad70ff883bf33c4770529abefc0d1a40a" title="Applies the current signal states to controlled links.">setTrafficLightSignals</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep());
<a name="l00128"></a>00128         <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ae44b4fe6810a305c8b17bc7d3b05b614">executeOnSwitchActions</a>();
<a name="l00129"></a>00129     }
<a name="l00130"></a>00130     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00131"></a>00131 }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>*
<a name="l00135"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a17013afd6c1288175334fd0309d629d2">00135</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a17013afd6c1288175334fd0309d629d2">MSTLLogicControl::TLSLogicVariants::getLogic</a>(<span class="keyword">const</span> std::string&amp; programID)<span class="keyword"> const </span>{
<a name="l00136"></a>00136     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.find(programID) == <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.end()) {
<a name="l00137"></a>00137         <span class="keywordflow">return</span> 0;
<a name="l00138"></a>00138     }
<a name="l00139"></a>00139     <span class="keywordflow">return</span> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.find(programID)-&gt;second;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a>00142 
<a name="l00143"></a>00143 <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>*
<a name="l00144"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#adf07a0484907af20553e64dfbeafd33b">00144</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#adf07a0484907af20553e64dfbeafd33b">MSTLLogicControl::TLSLogicVariants::getLogicInstantiatingOff</a>(<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>&amp; tlc,
<a name="l00145"></a>00145         <span class="keyword">const</span> std::string&amp; programID) {
<a name="l00146"></a>00146     <span class="keywordflow">if</span> (<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.find(programID) == <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.end()) {
<a name="l00147"></a>00147         <span class="keywordflow">if</span> (programID == <span class="stringliteral">&quot;off&quot;</span>) {
<a name="l00148"></a>00148             <span class="comment">// build an off-tll if this switch indicates it</span>
<a name="l00149"></a>00149             <span class="keywordflow">if</span> (!<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a959a0a696ef9e978490473c2c64f4c96" title="Adds a logic (program).">addLogic</a>(<span class="stringliteral">&quot;off&quot;</span>, <span class="keyword">new</span> <a class="code" href="../../d6/dc8/class_m_s_off_traffic_light_logic.html" title="A traffic lights logic which represents a tls in an off-mode.">MSOffTrafficLightLogic</a>(tlc, <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a612f9f30db841c26fb177b31b9a05600" title="Returns this tl-logic&amp;#39;s id.">getID</a>()), <span class="keyword">true</span>, <span class="keyword">true</span>)) {
<a name="l00150"></a>00150                 <span class="comment">// inform the user if this fails</span>
<a name="l00151"></a>00151                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not build an off-state for tls &#39;&quot;</span> + <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a612f9f30db841c26fb177b31b9a05600" title="Returns this tl-logic&amp;#39;s id.">getID</a>() + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00152"></a>00152             }
<a name="l00153"></a>00153         } <span class="keywordflow">else</span> {
<a name="l00154"></a>00154             <span class="comment">// inform the user about a missing logic</span>
<a name="l00155"></a>00155             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Can not switch tls &#39;&quot;</span> + <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a612f9f30db841c26fb177b31b9a05600" title="Returns this tl-logic&amp;#39;s id.">getID</a>() + <span class="stringliteral">&quot;&#39; to program &#39;&quot;</span> + programID + <span class="stringliteral">&quot;&#39;;\n The program is not known.&quot;</span>);
<a name="l00156"></a>00156         }
<a name="l00157"></a>00157     }
<a name="l00158"></a>00158     <span class="keywordflow">return</span> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a17013afd6c1288175334fd0309d629d2">getLogic</a>(programID);
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 <span class="keywordtype">void</span>
<a name="l00163"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a16ead2405d93995a04d71c1e9d844abc">00163</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a16ead2405d93995a04d71c1e9d844abc">MSTLLogicControl::TLSLogicVariants::addSwitchCommand</a>(<a class="code" href="../../d2/df0/class_m_s_t_l_logic_control_1_1_on_switch_action.html" title="Base class for things to execute if a tls switches to a new phase.">OnSwitchAction</a>* c) {
<a name="l00164"></a>00164     <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a3e0d5ba7b1bfabc284ea0a190952312e" title="The list of actions/commands to execute on switch.">mySwitchActions</a>.push_back(c);
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 std::vector&lt;MSTrafficLightLogic*&gt;
<a name="l00169"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a28b61684f6dc9e44e4e80ad380023c79">00169</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6e13d3e65de67ab48424de63524c6cef" title="Returns a vector which contains all logics.">MSTLLogicControl::TLSLogicVariants::getAllLogics</a>()<span class="keyword"> const </span>{
<a name="l00170"></a>00170     std::vector&lt;MSTrafficLightLogic*&gt; ret;
<a name="l00171"></a>00171     std::map&lt;std::string, MSTrafficLightLogic*&gt;::const_iterator i;
<a name="l00172"></a>00172     <span class="keywordflow">for</span> (i = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.begin(); i != <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.end(); ++i) {
<a name="l00173"></a>00173         ret.push_back((*i).second);
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175     <span class="keywordflow">return</span> ret;
<a name="l00176"></a>00176 }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="keywordtype">bool</span>
<a name="l00180"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a03ff29a22edccb7b5dacc267abae637a">00180</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a248e2fc6031b6c815e18aeecc309241b" title="Returns whether the given tls program is the currently active for his tls.">MSTLLogicControl::TLSLogicVariants::isActive</a>(<span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* tl)<span class="keyword"> const </span>{
<a name="l00181"></a>00181     <span class="keywordflow">return</span> tl == <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a>;
<a name="l00182"></a>00182 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 
<a name="l00185"></a>00185 <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>*
<a name="l00186"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">00186</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a78aa848cd3df64ba7ea5a59f03d5e3a0" title="Returns the active program of a named tls.">MSTLLogicControl::TLSLogicVariants::getActive</a>()<span class="keyword"> const </span>{
<a name="l00187"></a>00187     <span class="keywordflow">return</span> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a>;
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="keywordtype">void</span>
<a name="l00192"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a15e0d6752531e466fa5a2b35289dc8d0">00192</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a46e63ae4c10f097abdb3dcfbcb0fa8a5" title="Switches the named (id) tls to the named (programID) program.">MSTLLogicControl::TLSLogicVariants::switchTo</a>(<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>&amp; tlc, <span class="keyword">const</span> std::string&amp; programID) {
<a name="l00193"></a>00193     <span class="comment">// set the found wished sub-program as this tls&#39; current one</span>
<a name="l00194"></a>00194     <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ac08c2cf0e0fcf6821a5c9051bae96fbf" title="The currently used program.">myCurrentProgram</a> = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#adf07a0484907af20553e64dfbeafd33b">getLogicInstantiatingOff</a>(tlc, programID);
<a name="l00195"></a>00195 }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 <span class="keywordtype">void</span>
<a name="l00199"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ae44b4fe6810a305c8b17bc7d3b05b614">00199</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#ae44b4fe6810a305c8b17bc7d3b05b614">MSTLLogicControl::TLSLogicVariants::executeOnSwitchActions</a>()<span class="keyword"> const </span>{
<a name="l00200"></a>00200     <span class="keywordflow">for</span> (std::vector&lt;OnSwitchAction*&gt;::const_iterator i = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a3e0d5ba7b1bfabc284ea0a190952312e" title="The list of actions/commands to execute on switch.">mySwitchActions</a>.begin(); i != <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a3e0d5ba7b1bfabc284ea0a190952312e" title="The list of actions/commands to execute on switch.">mySwitchActions</a>.end(); ++i) {
<a name="l00201"></a>00201         (*i)-&gt;execute();
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 <span class="keywordtype">void</span>
<a name="l00207"></a><a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a34ee338baf9006060a6ff8fcc00bad8a">00207</a> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a34ee338baf9006060a6ff8fcc00bad8a">MSTLLogicControl::TLSLogicVariants::addLink</a>(<a class="code" href="../../d3/d2e/class_m_s_link.html">MSLink</a>* link, <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* lane, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> pos) {
<a name="l00208"></a>00208     <span class="keywordflow">for</span> (std::map&lt;std::string, MSTrafficLightLogic*&gt;::iterator i = <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.begin(); i != <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a8278444a8eab3e05abe20e0b6bb03d9c" title="A map of subkeys to programs.">myVariants</a>.end(); ++i) {
<a name="l00209"></a>00209         (*i).second-&gt;addLink(link, lane, pos);
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00216"></a>00216 <span class="comment"> * method definitions for the Switching Procedures</span>
<a name="l00217"></a>00217 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00218"></a>00218 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00219"></a>00219 <span class="comment"> * method definitions for WAUTSwitchProcedure</span>
<a name="l00220"></a>00220 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00221"></a>00221 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00222"></a><a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a926e28c6fdab0d90a486887ad6ddc191">00222</a> <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a926e28c6fdab0d90a486887ad6ddc191" title="Returns the GSP-value.">MSTLLogicControl::WAUTSwitchProcedure::getGSPValue</a>(<span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>&amp; logic)<span class="keyword"> const </span>{
<a name="l00223"></a>00223     std::string val = logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ae6fe23226f28c76934fbc20b1ea114dd" title="Returns a named parameter.">getParameterValue</a>(<span class="stringliteral">&quot;GSP&quot;</span>);
<a name="l00224"></a>00224     <span class="keywordflow">if</span> (val.length() == 0) {
<a name="l00225"></a>00225         <span class="keywordflow">return</span> 0;
<a name="l00226"></a>00226     }
<a name="l00227"></a>00227     <span class="keywordflow">return</span> <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2int</a>(val.c_str());
<a name="l00228"></a>00228 }
<a name="l00229"></a>00229 
<a name="l00230"></a>00230 
<a name="l00231"></a>00231 <span class="keywordtype">bool</span>
<a name="l00232"></a><a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a43a2f67f260f429521a26a8739f2fd10">00232</a> <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a43a2f67f260f429521a26a8739f2fd10" title="Checks, whether the position of a signal programm is at the GSP (&amp;quot;GuenstigerUmschaltPunkt&amp;quot;...">MSTLLogicControl::WAUTSwitchProcedure::isPosAtGSP</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> currentTime, <span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>&amp; logic) {
<a name="l00233"></a>00233     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> gspTime = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a926e28c6fdab0d90a486887ad6ddc191" title="Returns the GSP-value.">getGSPValue</a>(logic)) % logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ade80724d8a96d41c4c8b9ae1a40de399" title="Returns the cycle time (in ms).">getDefaultCycleTime</a>();
<a name="l00234"></a>00234     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> programTime = logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#abc66e0bb91c99950b2203b71c4a334f5" title="Returns the position (start of a phase during a cycle) from of a given step.">getOffsetFromIndex</a>(logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a6d43c415f080bdc364141b24601e4f6b" title="Returns the current index within the program.">getCurrentPhaseIndex</a>())
<a name="l00235"></a>00235                            + (logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a06670997037f3fb482f271601a852a41" title="Returns the definition of the current phase.">getCurrentPhaseDef</a>().<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a> - (logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#af6ccd6102a5566112716c47fd14bc73b" title="Returns the assumed next switch time.">getNextSwitchTime</a>() - currentTime));
<a name="l00236"></a>00236     <span class="keywordflow">return</span> gspTime == programTime;
<a name="l00237"></a>00237 }
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a>
<a name="l00241"></a><a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aca6f161f33bc9ce647cea2eef347c4e4">00241</a> <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aca6f161f33bc9ce647cea2eef347c4e4" title="Returns the difference between a given time and the start of the phase.">MSTLLogicControl::WAUTSwitchProcedure::getDiffToStartOfPhase</a>(<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>&amp; logic, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> toTime) {
<a name="l00242"></a>00242     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stepOfMyPos = logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a216d5c706d175eefd2be1dda036d81fa" title="Returns the step (the phasenumber) of a given position of the cycle.">getIndexFromOffset</a>(toTime);
<a name="l00243"></a>00243     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startOfPhase = logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#abc66e0bb91c99950b2203b71c4a334f5" title="Returns the position (start of a phase during a cycle) from of a given step.">getOffsetFromIndex</a>(stepOfMyPos);
<a name="l00244"></a>00244     assert(toTime &gt;= startOfPhase);
<a name="l00245"></a>00245     <span class="keywordflow">return</span> toTime - startOfPhase;
<a name="l00246"></a>00246 }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="keywordtype">void</span>
<a name="l00250"></a><a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aef00f5617942abd11808d0fdcbe85b69">00250</a> <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aef00f5617942abd11808d0fdcbe85b69" title="switches the given logic directly to the given position">MSTLLogicControl::WAUTSwitchProcedure::switchToPos</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> simStep, <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>&amp; logic, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> toTime) {
<a name="l00251"></a>00251     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stepTo = logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a216d5c706d175eefd2be1dda036d81fa" title="Returns the step (the phasenumber) of a given position of the cycle.">getIndexFromOffset</a>(toTime);
<a name="l00252"></a>00252     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> diff = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aca6f161f33bc9ce647cea2eef347c4e4" title="Returns the difference between a given time and the start of the phase.">getDiffToStartOfPhase</a>(logic, toTime);
<a name="l00253"></a>00253     <span class="keyword">const</span> <a class="code" href="../../d0/d95/class_m_s_phase_definition.html" title="The definition of a single phase of a tls logic.">MSPhaseDefinition</a>&amp; phase = logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(stepTo);
<a name="l00254"></a>00254     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> leftDuration = phase.<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a> - diff;
<a name="l00255"></a>00255     logic.<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a9b0582ea8abef098a40b12958bf0c508" title="Changes the current phase and her duration.">changeStepAndDuration</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a66e86ba3940e90a554d57b6d719f25a9" title="The control the logic belongs to.">myControl</a>, simStep, stepTo, leftDuration);
<a name="l00256"></a>00256 }
<a name="l00257"></a>00257 
<a name="l00258"></a>00258 
<a name="l00259"></a>00259 
<a name="l00260"></a>00260 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00261"></a>00261 <span class="comment"> * method definitions for WAUTSwitchProcedure_JustSwitch</span>
<a name="l00262"></a>00262 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00263"></a><a class="code" href="../../d8/d9d/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___just_switch.html#adb822b98cf38324a31d817354a31473e">00263</a> <a class="code" href="../../d8/d9d/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___just_switch.html#adb822b98cf38324a31d817354a31473e" title="Constructor.">MSTLLogicControl::WAUTSwitchProcedure_JustSwitch::WAUTSwitchProcedure_JustSwitch</a>(
<a name="l00264"></a>00264     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>&amp; control, <a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html" title="A WAUT definition.">WAUT</a>&amp; waut,
<a name="l00265"></a>00265     <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* from, <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* to, <span class="keywordtype">bool</span> synchron)
<a name="l00266"></a>00266     : <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>::<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html" title="This is the abstract base class for switching from one tls program to another.">WAUTSwitchProcedure</a>(control, waut, from, to, synchron) {}
<a name="l00267"></a>00267 
<a name="l00268"></a>00268 
<a name="l00269"></a><a class="code" href="../../d8/d9d/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___just_switch.html#a34ba6f32c2889fb75c91736f7fa6c93b">00269</a> <a class="code" href="../../d8/d9d/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___just_switch.html#a34ba6f32c2889fb75c91736f7fa6c93b" title="Destructor.">MSTLLogicControl::WAUTSwitchProcedure_JustSwitch::~WAUTSwitchProcedure_JustSwitch</a>() {}
<a name="l00270"></a>00270 
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="keywordtype">bool</span>
<a name="l00273"></a><a class="code" href="../../d8/d9d/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___just_switch.html#a103f3caf84d1bfc194ebcf156067861d">00273</a> <a class="code" href="../../d8/d9d/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___just_switch.html#a103f3caf84d1bfc194ebcf156067861d" title="Determines whether a switch is possible.">MSTLLogicControl::WAUTSwitchProcedure_JustSwitch::trySwitch</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a>) {
<a name="l00274"></a>00274     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00280"></a>00280 <span class="comment"> * method definitions for WAUTSwitchProcedure_GSP</span>
<a name="l00281"></a>00281 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00282"></a><a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#ab26e95109176353ccfe8ffd5e059350f">00282</a> <a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#ab26e95109176353ccfe8ffd5e059350f" title="Constructor.">MSTLLogicControl::WAUTSwitchProcedure_GSP::WAUTSwitchProcedure_GSP</a>(
<a name="l00283"></a>00283     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>&amp; control, <a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html" title="A WAUT definition.">WAUT</a>&amp; waut,
<a name="l00284"></a>00284     <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* from, <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* to, <span class="keywordtype">bool</span> synchron)
<a name="l00285"></a>00285     : <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>::<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html" title="This is the abstract base class for switching from one tls program to another.">WAUTSwitchProcedure</a>(control, waut, from, to, synchron) {}
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
<a name="l00288"></a><a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#a8a198cbf70232615152b211bbdf9d022">00288</a> <a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#a8a198cbf70232615152b211bbdf9d022" title="Destructor.">MSTLLogicControl::WAUTSwitchProcedure_GSP::~WAUTSwitchProcedure_GSP</a>() {}
<a name="l00289"></a>00289 
<a name="l00290"></a>00290 
<a name="l00291"></a>00291 <span class="keywordtype">bool</span>
<a name="l00292"></a><a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#ad3259f7883a098ec64cbd49f68a85baf">00292</a> <a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#ad3259f7883a098ec64cbd49f68a85baf" title="Determines whether a switch is possible.">MSTLLogicControl::WAUTSwitchProcedure_GSP::trySwitch</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> step) {
<a name="l00293"></a>00293     <span class="comment">// switch to the next programm if the GSP is reached</span>
<a name="l00294"></a>00294     <span class="keywordflow">if</span> (<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a43a2f67f260f429521a26a8739f2fd10" title="Checks, whether the position of a signal programm is at the GSP (&amp;quot;GuenstigerUmschaltPunkt&amp;quot;...">isPosAtGSP</a>(step, *<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a7a232107221c2b19f6af7fb01d4cb802" title="The current program of the tls to switch.">myFrom</a>)) {
<a name="l00295"></a>00295         <span class="comment">// adapt program&#39;s state</span>
<a name="l00296"></a>00296         <span class="keywordflow">if</span> (<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a4509c60e3b2ecc1d5a235a34768dc6cb" title="Information whether to switch synchron (?).">mySwitchSynchron</a>) {
<a name="l00297"></a>00297             <a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#abe9411fbad43d2cba942ef11e9c90e8f" title="Stretches the destination program&amp;#39;s phase to which the tls was switched.">adaptLogic</a>(step);
<a name="l00298"></a>00298         } <span class="keywordflow">else</span> {
<a name="l00299"></a>00299             <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aef00f5617942abd11808d0fdcbe85b69" title="switches the given logic directly to the given position">switchToPos</a>(step, *<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a926e28c6fdab0d90a486887ad6ddc191" title="Returns the GSP-value.">getGSPValue</a>(*<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>)));
<a name="l00300"></a>00300         }
<a name="l00301"></a>00301         <span class="comment">// switch to destination program</span>
<a name="l00302"></a>00302         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     <span class="comment">// do not switch, yet</span>
<a name="l00305"></a>00305     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00306"></a>00306 }
<a name="l00307"></a>00307 
<a name="l00308"></a>00308 
<a name="l00309"></a>00309 <span class="keywordtype">void</span>
<a name="l00310"></a><a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#abe9411fbad43d2cba942ef11e9c90e8f">00310</a> <a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html#abe9411fbad43d2cba942ef11e9c90e8f" title="Stretches the destination program&amp;#39;s phase to which the tls was switched.">MSTLLogicControl::WAUTSwitchProcedure_GSP::adaptLogic</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> step) {
<a name="l00311"></a>00311     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> gspTo = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a926e28c6fdab0d90a486887ad6ddc191" title="Returns the GSP-value.">getGSPValue</a>(*<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>));
<a name="l00312"></a>00312     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stepTo = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a216d5c706d175eefd2be1dda036d81fa" title="Returns the step (the phasenumber) of a given position of the cycle.">getIndexFromOffset</a>(gspTo);
<a name="l00313"></a>00313     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> cycleTimeTo = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ade80724d8a96d41c4c8b9ae1a40de399" title="Returns the cycle time (in ms).">getDefaultCycleTime</a>();
<a name="l00314"></a>00314     <span class="keywordflow">if</span> (gspTo == cycleTimeTo) {
<a name="l00315"></a>00315         gspTo = 0;
<a name="l00316"></a>00316     }
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> currentPosTo = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#abc66e0bb91c99950b2203b71c4a334f5" title="Returns the position (start of a phase during a cycle) from of a given step.">getOffsetFromIndex</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a6d43c415f080bdc364141b24601e4f6b" title="Returns the current index within the program.">getCurrentPhaseIndex</a>());
<a name="l00319"></a>00319     currentPosTo += (<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a06670997037f3fb482f271601a852a41" title="Returns the definition of the current phase.">getCurrentPhaseDef</a>().<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a> - (<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#af6ccd6102a5566112716c47fd14bc73b" title="Returns the assumed next switch time.">getNextSwitchTime</a>() - step));
<a name="l00320"></a>00320     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> diff = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aca6f161f33bc9ce647cea2eef347c4e4" title="Returns the difference between a given time and the start of the phase.">getDiffToStartOfPhase</a>(*<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, gspTo);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> deltaToStretch = 0;
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (gspTo &gt;= currentPosTo) {
<a name="l00324"></a>00324         deltaToStretch = (gspTo - currentPosTo);
<a name="l00325"></a>00325     } <span class="keywordflow">else</span> {
<a name="l00326"></a>00326         deltaToStretch = (cycleTimeTo - currentPosTo + gspTo);
<a name="l00327"></a>00327     }
<a name="l00328"></a>00328     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> newdur = (<span class="keywordtype">unsigned</span> int) <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(stepTo).<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a> - diff + deltaToStretch;
<a name="l00329"></a>00329     <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a9b0582ea8abef098a40b12958bf0c508" title="Changes the current phase and her duration.">changeStepAndDuration</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a66e86ba3940e90a554d57b6d719f25a9" title="The control the logic belongs to.">myControl</a>, step, stepTo, newdur);
<a name="l00330"></a>00330 }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00335"></a>00335 <span class="comment"> * method definitions for WAUTSwitchProcedure_Stretch</span>
<a name="l00336"></a>00336 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00337"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a6dd669e75fde8c44fca6f7c1a275684f">00337</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a6dd669e75fde8c44fca6f7c1a275684f" title="Constructor.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::WAUTSwitchProcedure_Stretch</a>(
<a name="l00338"></a>00338     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>&amp; control, <a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html" title="A WAUT definition.">WAUT</a>&amp; waut,
<a name="l00339"></a>00339     <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* from, <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* to, <span class="keywordtype">bool</span> synchron)
<a name="l00340"></a>00340     : <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html" title="A class that stores and controls tls and switching of their programs.">MSTLLogicControl</a>::<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html" title="This is the abstract base class for switching from one tls program to another.">WAUTSwitchProcedure</a>(control, waut, from, to, synchron) {}
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 
<a name="l00343"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a260863789704407df7041e2b2cb6d516">00343</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a260863789704407df7041e2b2cb6d516" title="Destructor.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::~WAUTSwitchProcedure_Stretch</a>() {}
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 
<a name="l00346"></a>00346 <span class="keywordtype">bool</span>
<a name="l00347"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a4e27fbb3050afb680b9b09b764f05f1d">00347</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a4e27fbb3050afb680b9b09b764f05f1d" title="Determines whether a switch is possible.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::trySwitch</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> step) {
<a name="l00348"></a>00348     <span class="comment">// switch to the next programm if the GSP is reached</span>
<a name="l00349"></a>00349     <span class="keywordflow">if</span> (<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a43a2f67f260f429521a26a8739f2fd10" title="Checks, whether the position of a signal programm is at the GSP (&amp;quot;GuenstigerUmschaltPunkt&amp;quot;...">isPosAtGSP</a>(step, *<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a7a232107221c2b19f6af7fb01d4cb802" title="The current program of the tls to switch.">myFrom</a>)) {
<a name="l00350"></a>00350         <span class="comment">// adapt program&#39;s state</span>
<a name="l00351"></a>00351         <span class="keywordflow">if</span> (<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a4509c60e3b2ecc1d5a235a34768dc6cb" title="Information whether to switch synchron (?).">mySwitchSynchron</a>) {
<a name="l00352"></a>00352             <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a2e4e40409aaf6e29c70566ab8d966f82" title="Determines the destination program&amp;#39;s changes and applies them.">adaptLogic</a>(step);
<a name="l00353"></a>00353         } <span class="keywordflow">else</span> {
<a name="l00354"></a>00354             <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aef00f5617942abd11808d0fdcbe85b69" title="switches the given logic directly to the given position">switchToPos</a>(step, *<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a926e28c6fdab0d90a486887ad6ddc191" title="Returns the GSP-value.">getGSPValue</a>(*<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>)));
<a name="l00355"></a>00355         }
<a name="l00356"></a>00356         <span class="comment">// switch to destination program</span>
<a name="l00357"></a>00357         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359     <span class="comment">// do not switch, yet</span>
<a name="l00360"></a>00360     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a>00363 
<a name="l00364"></a>00364 <span class="keywordtype">void</span>
<a name="l00365"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a2e4e40409aaf6e29c70566ab8d966f82">00365</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a2e4e40409aaf6e29c70566ab8d966f82" title="Determines the destination program&amp;#39;s changes and applies them.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::adaptLogic</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> step) {
<a name="l00366"></a>00366     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> gspTo = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a926e28c6fdab0d90a486887ad6ddc191" title="Returns the GSP-value.">getGSPValue</a>(*<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>));
<a name="l00367"></a>00367     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> cycleTime = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ade80724d8a96d41c4c8b9ae1a40de399" title="Returns the cycle time (in ms).">getDefaultCycleTime</a>();
<a name="l00368"></a>00368     <span class="comment">// the position, where the logic has to be after synchronisation</span>
<a name="l00369"></a>00369     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> posAfterSyn = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a121d34b4226178f0ac7806c14b2dbf3b" title="Returns the index of the logic at the given simulation step.">getPhaseIndexAtTime</a>(step);
<a name="l00370"></a>00370     <span class="comment">// calculate the difference, that has to be equalized</span>
<a name="l00371"></a>00371     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> deltaToCut = 0;
<a name="l00372"></a>00372     <span class="keywordflow">if</span> (posAfterSyn &lt; gspTo) {
<a name="l00373"></a>00373         deltaToCut = posAfterSyn + cycleTime - gspTo;
<a name="l00374"></a>00374     } <span class="keywordflow">else</span> {
<a name="l00375"></a>00375         deltaToCut =  posAfterSyn - gspTo;
<a name="l00376"></a>00376     }
<a name="l00377"></a>00377     <span class="comment">// test, wheter cutting of the Signalplan is possible</span>
<a name="l00378"></a>00378     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> deltaPossible = 0;
<a name="l00379"></a>00379     <span class="keywordtype">int</span> areasNo = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a0ed0663fcfa929fafe82660a28c7e95b" title="Returns the number of given Stretch-areas for the given program.">getStretchAreaNo</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>);
<a name="l00380"></a>00380     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; areasNo; i++) {
<a name="l00381"></a>00381         <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">StretchBereichDef</a> def = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae" title="Returns the numbered Stretch-area for the given program.">getStretchBereichDef</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, i + 1);
<a name="l00382"></a>00382         assert(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a5466c6cfd3881e960454b438cad293af" title="The end of a stretch/cut area (time, in s).">end</a> &gt;= def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#ac93e5a10a326aef54ae9666bfb84f490" title="The begin of a stretch/cut area (time, in s).">begin</a>) ;
<a name="l00383"></a>00383         deltaPossible += <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a5466c6cfd3881e960454b438cad293af" title="The end of a stretch/cut area (time, in s).">end</a> - def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#ac93e5a10a326aef54ae9666bfb84f490" title="The begin of a stretch/cut area (time, in s).">begin</a>);
<a name="l00384"></a>00384     }
<a name="l00385"></a>00385     <span class="keywordtype">int</span> stretchUmlaufAnz = (int) <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2SUMOReal</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ae6fe23226f28c76934fbc20b1ea114dd" title="Returns a named parameter.">getParameterValue</a>(<span class="stringliteral">&quot;StretchUmlaufAnz&quot;</span>).c_str());
<a name="l00386"></a>00386     deltaPossible = stretchUmlaufAnz * deltaPossible;
<a name="l00387"></a>00387     <span class="keywordflow">if</span> ((deltaPossible &gt; deltaToCut) &amp;&amp; (deltaToCut &lt; (cycleTime / 2))) {
<a name="l00388"></a>00388         <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ac3801d1dbf42745437904c8badfec828" title="Cuts the logic to synchronize.">cutLogic</a>(step, gspTo, deltaToCut);
<a name="l00389"></a>00389     } <span class="keywordflow">else</span> {
<a name="l00390"></a>00390         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> deltaToStretch = (cycleTime - deltaToCut) % cycleTime;
<a name="l00391"></a>00391         <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad2586418680da80890104e8935d034f1" title="Stretches the logic to synchronize.">stretchLogic</a>(step, gspTo, deltaToStretch);
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393 }
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a>00396 <span class="keywordtype">void</span>
<a name="l00397"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ac3801d1dbf42745437904c8badfec828">00397</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ac3801d1dbf42745437904c8badfec828" title="Cuts the logic to synchronize.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::cutLogic</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> step, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startPos, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> allCutTime) {
<a name="l00398"></a>00398     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> actStep = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a216d5c706d175eefd2be1dda036d81fa" title="Returns the step (the phasenumber) of a given position of the cycle.">getIndexFromOffset</a>(startPos);
<a name="l00399"></a>00399     <span class="comment">// switches to startPos and cuts this phase, if there is a &quot;Bereich&quot;</span>
<a name="l00400"></a>00400     <span class="keywordtype">int</span> areasNo = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a0ed0663fcfa929fafe82660a28c7e95b" title="Returns the number of given Stretch-areas for the given program.">getStretchAreaNo</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>);
<a name="l00401"></a>00401     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> toCut = 0;
<a name="l00402"></a>00402     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; areasNo; i++) {
<a name="l00403"></a>00403         <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">StretchBereichDef</a> def = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae" title="Returns the numbered Stretch-area for the given program.">getStretchBereichDef</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, i + 1);
<a name="l00404"></a>00404         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> begin = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#ac93e5a10a326aef54ae9666bfb84f490" title="The begin of a stretch/cut area (time, in s).">begin</a>);
<a name="l00405"></a>00405         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> end = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a5466c6cfd3881e960454b438cad293af" title="The end of a stretch/cut area (time, in s).">end</a>);
<a name="l00406"></a>00406         <span class="keywordtype">size_t</span> stepOfBegin = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a216d5c706d175eefd2be1dda036d81fa" title="Returns the step (the phasenumber) of a given position of the cycle.">getIndexFromOffset</a>(begin);
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (stepOfBegin == actStep) {
<a name="l00408"></a>00408             <span class="keywordflow">if</span> (begin &lt; startPos) {
<a name="l00409"></a>00409                 toCut = end - startPos;
<a name="l00410"></a>00410             } <span class="keywordflow">else</span> {
<a name="l00411"></a>00411                 toCut = end - begin;
<a name="l00412"></a>00412             }
<a name="l00413"></a>00413             toCut = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(allCutTime, toCut);
<a name="l00414"></a>00414             allCutTime = allCutTime - toCut;
<a name="l00415"></a>00415         }
<a name="l00416"></a>00416     }
<a name="l00417"></a>00417     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> remainingDur = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(actStep).<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a> - <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aca6f161f33bc9ce647cea2eef347c4e4" title="Returns the difference between a given time and the start of the phase.">getDiffToStartOfPhase</a>(*<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, startPos);
<a name="l00418"></a>00418     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> newDur = remainingDur - toCut;
<a name="l00419"></a>00419     <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a9b0582ea8abef098a40b12958bf0c508" title="Changes the current phase and her duration.">changeStepAndDuration</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a66e86ba3940e90a554d57b6d719f25a9" title="The control the logic belongs to.">myControl</a>, step, actStep, newDur);
<a name="l00420"></a>00420 
<a name="l00421"></a>00421     <span class="comment">// changes the duration of all other phases</span>
<a name="l00422"></a>00422     <span class="keywordtype">int</span> currStep = (actStep + 1) % (<span class="keywordtype">int</span>)<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#af57b9728d2998d6d7ffe55fd54626933" title="Returns the phases of this tls program.">getPhases</a>().size();
<a name="l00423"></a>00423     <span class="keywordflow">while</span> (allCutTime &gt; 0) {
<a name="l00424"></a>00424         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = currStep; i &lt; (int) <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#af57b9728d2998d6d7ffe55fd54626933" title="Returns the phases of this tls program.">getPhases</a>().size(); i++) {
<a name="l00425"></a>00425             <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> beginOfPhase = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#abc66e0bb91c99950b2203b71c4a334f5" title="Returns the position (start of a phase during a cycle) from of a given step.">getOffsetFromIndex</a>(i);
<a name="l00426"></a>00426             <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> durOfPhase = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(i).<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a>;
<a name="l00427"></a>00427             <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endOfPhase = beginOfPhase + durOfPhase;
<a name="l00428"></a>00428             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; areasNo; i++) {
<a name="l00429"></a>00429                 <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">StretchBereichDef</a> def = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae" title="Returns the numbered Stretch-area for the given program.">getStretchBereichDef</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, i + 1);
<a name="l00430"></a>00430                 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> begin = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#ac93e5a10a326aef54ae9666bfb84f490" title="The begin of a stretch/cut area (time, in s).">begin</a>);
<a name="l00431"></a>00431                 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> end = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a5466c6cfd3881e960454b438cad293af" title="The end of a stretch/cut area (time, in s).">end</a>);
<a name="l00432"></a>00432                 <span class="keywordflow">if</span> ((beginOfPhase &lt;= begin) &amp;&amp; (endOfPhase &gt;= end)) {
<a name="l00433"></a>00433                     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> maxCutOfPhase = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(end - begin, allCutTime);
<a name="l00434"></a>00434                     allCutTime = allCutTime - maxCutOfPhase;
<a name="l00435"></a>00435                     durOfPhase = durOfPhase - maxCutOfPhase;
<a name="l00436"></a>00436                 }
<a name="l00437"></a>00437             }
<a name="l00438"></a>00438             <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ad7645fadaf3e668f95abc871c357f63f" title="Changes the duration of the next phase.">addOverridingDuration</a>(durOfPhase);
<a name="l00439"></a>00439         }
<a name="l00440"></a>00440         currStep = 0;
<a name="l00441"></a>00441     }
<a name="l00442"></a>00442 }
<a name="l00443"></a>00443 
<a name="l00444"></a>00444 <span class="keywordtype">void</span>
<a name="l00445"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad2586418680da80890104e8935d034f1">00445</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad2586418680da80890104e8935d034f1" title="Stretches the logic to synchronize.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::stretchLogic</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> step, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> startPos, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> allStretchTime) {
<a name="l00446"></a>00446     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currStep = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a216d5c706d175eefd2be1dda036d81fa" title="Returns the step (the phasenumber) of a given position of the cycle.">getIndexFromOffset</a>(startPos);
<a name="l00447"></a>00447     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> durOfPhase = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(currStep).<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a>;
<a name="l00448"></a>00448     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> remainingStretchTime = allStretchTime;
<a name="l00449"></a>00449     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> StretchTimeOfPhase = 0;
<a name="l00450"></a>00450     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> stretchUmlaufAnz = (<span class="keywordtype">unsigned</span> int) <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2SUMOReal</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ae6fe23226f28c76934fbc20b1ea114dd" title="Returns a named parameter.">getParameterValue</a>(<span class="stringliteral">&quot;StretchUmlaufAnz&quot;</span>).c_str());
<a name="l00451"></a>00451     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> facSum = 0;
<a name="l00452"></a>00452     <span class="keywordtype">int</span> areasNo = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a0ed0663fcfa929fafe82660a28c7e95b" title="Returns the number of given Stretch-areas for the given program.">getStretchAreaNo</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>);
<a name="l00453"></a>00453     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; areasNo; x++) {
<a name="l00454"></a>00454         <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">StretchBereichDef</a> def = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae" title="Returns the numbered Stretch-area for the given program.">getStretchBereichDef</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, x + 1);
<a name="l00455"></a>00455         facSum += def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a2d845aff7f13a93ca0fe354994e5a277" title="The weight factor of a stretch/cut area.">fac</a>;
<a name="l00456"></a>00456     }
<a name="l00457"></a>00457     facSum *= stretchUmlaufAnz;
<a name="l00458"></a>00458 
<a name="l00459"></a>00459     <span class="comment">//switch to startPos and stretch this phase, if there is a end of &quot;bereich&quot; between startpos and end of phase</span>
<a name="l00460"></a>00460     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> diffToStart = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#aca6f161f33bc9ce647cea2eef347c4e4" title="Returns the difference between a given time and the start of the phase.">getDiffToStartOfPhase</a>(*<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, startPos);
<a name="l00461"></a>00461     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> x = 0; x &lt; areasNo; x++) {
<a name="l00462"></a>00462         <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">StretchBereichDef</a> def = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae" title="Returns the numbered Stretch-area for the given program.">getStretchBereichDef</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, x + 1);
<a name="l00463"></a>00463         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> end = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a5466c6cfd3881e960454b438cad293af" title="The end of a stretch/cut area (time, in s).">end</a>);
<a name="l00464"></a>00464         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endOfPhase = (startPos + durOfPhase - diffToStart);
<a name="l00465"></a>00465         <span class="keywordflow">if</span> (end &lt;= endOfPhase &amp;&amp; end &gt;= startPos) {
<a name="l00466"></a>00466             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> fac = def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a2d845aff7f13a93ca0fe354994e5a277" title="The weight factor of a stretch/cut area.">fac</a>;
<a name="l00467"></a>00467             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> actualfac = fac / facSum;
<a name="l00468"></a>00468             facSum = facSum - fac;
<a name="l00469"></a>00469             StretchTimeOfPhase = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a17e50ddd50517df5a81172d302f7aa70">STEPS2TIME</a>(remainingStretchTime) * actualfac + 0.5);
<a name="l00470"></a>00470             remainingStretchTime = allStretchTime - StretchTimeOfPhase;
<a name="l00471"></a>00471         }
<a name="l00472"></a>00472     }
<a name="l00473"></a>00473     durOfPhase = durOfPhase - diffToStart + StretchTimeOfPhase;
<a name="l00474"></a>00474     <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a9b0582ea8abef098a40b12958bf0c508" title="Changes the current phase and her duration.">changeStepAndDuration</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a66e86ba3940e90a554d57b6d719f25a9" title="The control the logic belongs to.">myControl</a>, step, currStep, durOfPhase);
<a name="l00475"></a>00475 
<a name="l00476"></a>00476     currStep = (currStep + 1) % (<span class="keywordtype">int</span>)<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#af57b9728d2998d6d7ffe55fd54626933" title="Returns the phases of this tls program.">getPhases</a>().size();
<a name="l00477"></a>00477     <span class="comment">// stretch all other phases, if there is a &quot;bereich&quot;</span>
<a name="l00478"></a>00478     <span class="keywordflow">while</span> (remainingStretchTime &gt; 0) {
<a name="l00479"></a>00479         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = currStep; i &lt; <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#af57b9728d2998d6d7ffe55fd54626933" title="Returns the phases of this tls program.">getPhases</a>().size() &amp;&amp; remainingStretchTime &gt; 0; i++) {
<a name="l00480"></a>00480             durOfPhase = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a7fb2ea30d3b16fb0770cfba5c60490dd" title="Returns the definition of the phase from the given position within the plan.">getPhase</a>(i).<a class="code" href="../../d0/d95/class_m_s_phase_definition.html#ab52b6081bd9945d33df0831ba0d6c5b8" title="The duration of the phase.">duration</a>;
<a name="l00481"></a>00481             <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> beginOfPhase = <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#abc66e0bb91c99950b2203b71c4a334f5" title="Returns the position (start of a phase during a cycle) from of a given step.">getOffsetFromIndex</a>(i);
<a name="l00482"></a>00482             <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> endOfPhase = beginOfPhase + durOfPhase;
<a name="l00483"></a>00483             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j &lt; areasNo &amp;&amp; remainingStretchTime &gt; 0; j++) {
<a name="l00484"></a>00484                 <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">StretchBereichDef</a> def = <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae" title="Returns the numbered Stretch-area for the given program.">getStretchBereichDef</a>(<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>, j + 1);
<a name="l00485"></a>00485                 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> end = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a5466c6cfd3881e960454b438cad293af" title="The end of a stretch/cut area (time, in s).">end</a>);
<a name="l00486"></a>00486                 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> fac = def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a2d845aff7f13a93ca0fe354994e5a277" title="The weight factor of a stretch/cut area.">fac</a>;
<a name="l00487"></a>00487                 <span class="keywordflow">if</span> ((beginOfPhase &lt;= end) &amp;&amp; (endOfPhase &gt;= end)) {
<a name="l00488"></a>00488                     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> actualfac = fac / facSum;
<a name="l00489"></a>00489                     StretchTimeOfPhase = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a17e50ddd50517df5a81172d302f7aa70">STEPS2TIME</a>(remainingStretchTime) * actualfac + 0.5);
<a name="l00490"></a>00490                     facSum -= fac;
<a name="l00491"></a>00491                     durOfPhase += StretchTimeOfPhase;
<a name="l00492"></a>00492                     remainingStretchTime -= StretchTimeOfPhase;
<a name="l00493"></a>00493                 }
<a name="l00494"></a>00494             }
<a name="l00495"></a>00495             <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1a4b6d366246f15d6c7277425242b58b" title="The program to switch the tls to.">myTo</a>-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ad7645fadaf3e668f95abc871c357f63f" title="Changes the duration of the next phase.">addOverridingDuration</a>(durOfPhase);
<a name="l00496"></a>00496         }
<a name="l00497"></a>00497         currStep = 0;
<a name="l00498"></a>00498     }
<a name="l00499"></a>00499 }
<a name="l00500"></a>00500 
<a name="l00501"></a>00501 <span class="keywordtype">int</span>
<a name="l00502"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a0ed0663fcfa929fafe82660a28c7e95b">00502</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#a0ed0663fcfa929fafe82660a28c7e95b" title="Returns the number of given Stretch-areas for the given program.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::getStretchAreaNo</a>(<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* from)<span class="keyword"> const </span>{
<a name="l00503"></a>00503     <span class="keywordtype">int</span> no = 0;
<a name="l00504"></a>00504     <span class="keywordflow">while</span> (from-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ae6fe23226f28c76934fbc20b1ea114dd" title="Returns a named parameter.">getParameterValue</a>(<span class="stringliteral">&quot;B&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(no + 1) + <span class="stringliteral">&quot;.begin&quot;</span>) != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00505"></a>00505         no++;
<a name="l00506"></a>00506     }
<a name="l00507"></a>00507     <span class="keywordflow">return</span> no;
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 
<a name="l00511"></a>00511 <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::StretchBereichDef</a>
<a name="l00512"></a><a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae">00512</a> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html#ad7b4d85585e424a2bb91b225b701cbae" title="Returns the numbered Stretch-area for the given program.">MSTLLogicControl::WAUTSwitchProcedure_Stretch::getStretchBereichDef</a>(<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* from, <span class="keywordtype">int</span> index)<span class="keyword"> const </span>{
<a name="l00513"></a>00513     <a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html" title="A definition of a stretch - Bereich.">StretchBereichDef</a> def;
<a name="l00514"></a>00514     def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#ac93e5a10a326aef54ae9666bfb84f490" title="The begin of a stretch/cut area (time, in s).">begin</a> = <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2SUMOReal</a>(from-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ae6fe23226f28c76934fbc20b1ea114dd" title="Returns a named parameter.">getParameterValue</a>(<span class="stringliteral">&quot;B&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(index) + <span class="stringliteral">&quot;.begin&quot;</span>).c_str());
<a name="l00515"></a>00515     def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a5466c6cfd3881e960454b438cad293af" title="The end of a stretch/cut area (time, in s).">end</a> = <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2SUMOReal</a>(from-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ae6fe23226f28c76934fbc20b1ea114dd" title="Returns a named parameter.">getParameterValue</a>(<span class="stringliteral">&quot;B&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(index) + <span class="stringliteral">&quot;.end&quot;</span>).c_str());
<a name="l00516"></a>00516     def.<a class="code" href="../../d7/d23/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch_1_1_stretch_bereich_def.html#a2d845aff7f13a93ca0fe354994e5a277" title="The weight factor of a stretch/cut area.">fac</a> = <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2SUMOReal</a>(from-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#ae6fe23226f28c76934fbc20b1ea114dd" title="Returns a named parameter.">getParameterValue</a>(<span class="stringliteral">&quot;B&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(index) + <span class="stringliteral">&quot;.factor&quot;</span>).c_str());
<a name="l00517"></a>00517     <span class="keywordflow">return</span> def;
<a name="l00518"></a>00518 }
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 
<a name="l00521"></a>00521 
<a name="l00522"></a>00522 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00523"></a>00523 <span class="comment"> * method definitions for MSTLLogicControl</span>
<a name="l00524"></a>00524 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00525"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#aa382ce206865e4e3a6928502e45b7ae9">00525</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#aa382ce206865e4e3a6928502e45b7ae9" title="Constructor.">MSTLLogicControl::MSTLLogicControl</a>()
<a name="l00526"></a>00526     : <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a7e955d854f3b1a96e043feb64d1ebdfa" title="Information whether the net was completely loaded.">myNetWasLoaded</a>(false) {}
<a name="l00527"></a>00527 
<a name="l00528"></a>00528 
<a name="l00529"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ab7598b42be79bbca43e350d317064f69">00529</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ab7598b42be79bbca43e350d317064f69" title="Destructor.">MSTLLogicControl::~MSTLLogicControl</a>() {
<a name="l00530"></a>00530     <span class="comment">// delete tls</span>
<a name="l00531"></a>00531     <span class="keywordflow">for</span> (std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end(); ++i) {
<a name="l00532"></a>00532         <span class="keyword">delete</span>(*i).second;
<a name="l00533"></a>00533     }
<a name="l00534"></a>00534     <span class="comment">// delete WAUTs</span>
<a name="l00535"></a>00535     <span class="keywordflow">for</span> (std::map&lt;std::string, WAUT*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.end(); ++i) {
<a name="l00536"></a>00536         <span class="keyword">delete</span>(*i).second;
<a name="l00537"></a>00537     }
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a>00540 
<a name="l00541"></a>00541 <span class="keywordtype">void</span>
<a name="l00542"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a02aa67e250da5c15336cb72a82aadaab">00542</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a02aa67e250da5c15336cb72a82aadaab" title="Lets all running (current) tls programs apply their current signal states to links...">MSTLLogicControl::setTrafficLightSignals</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> t)<span class="keyword"> const </span>{
<a name="l00543"></a>00543     <span class="keywordflow">for</span> (std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end(); ++i) {
<a name="l00544"></a>00544         (*i).second-&gt;getActive()-&gt;setTrafficLightSignals(t);
<a name="l00545"></a>00545     }
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 
<a name="l00549"></a>00549 std::vector&lt;MSTrafficLightLogic*&gt;
<a name="l00550"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6e13d3e65de67ab48424de63524c6cef">00550</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6e13d3e65de67ab48424de63524c6cef" title="Returns a vector which contains all logics.">MSTLLogicControl::getAllLogics</a>()<span class="keyword"> const </span>{
<a name="l00551"></a>00551     std::vector&lt;MSTrafficLightLogic*&gt; ret;
<a name="l00552"></a>00552     std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i;
<a name="l00553"></a>00553     <span class="keywordflow">for</span> (i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end(); ++i) {
<a name="l00554"></a>00554         std::vector&lt;MSTrafficLightLogic*&gt; s = (*i).second-&gt;getAllLogics();
<a name="l00555"></a>00555         copy(s.begin(), s.end(), back_inserter(ret));
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557     <span class="keywordflow">return</span> ret;
<a name="l00558"></a>00558 }
<a name="l00559"></a>00559 
<a name="l00560"></a>00560 <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html" title="Storage for all programs of a single tls.">MSTLLogicControl::TLSLogicVariants</a>&amp;
<a name="l00561"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6ae9f71b08e1f7a71a05ceb2c20ca62f">00561</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6ae9f71b08e1f7a71a05ceb2c20ca62f" title="Returns the variants of a named tls.">MSTLLogicControl::get</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)<span class="keyword"> const </span>{
<a name="l00562"></a>00562     std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(<span class="keywordtype">id</span>);
<a name="l00563"></a>00563     <span class="keywordflow">if</span> (i == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00564"></a>00564         <span class="keywordflow">throw</span> <a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>(<span class="stringliteral">&quot;The tls &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39; is not known.&quot;</span>);
<a name="l00565"></a>00565     }
<a name="l00566"></a>00566     <span class="keywordflow">return</span> *(*i).second;
<a name="l00567"></a>00567 }
<a name="l00568"></a>00568 
<a name="l00569"></a>00569 
<a name="l00570"></a>00570 <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>*
<a name="l00571"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a685cdf4f4edb2d107b84fe65c7434042">00571</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a6ae9f71b08e1f7a71a05ceb2c20ca62f" title="Returns the variants of a named tls.">MSTLLogicControl::get</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> std::string&amp; programID)<span class="keyword"> const </span>{
<a name="l00572"></a>00572     std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(<span class="keywordtype">id</span>);
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (i == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00574"></a>00574         <span class="keywordflow">return</span> 0;
<a name="l00575"></a>00575     }
<a name="l00576"></a>00576     <span class="keywordflow">return</span> (*i).second-&gt;getLogic(programID);
<a name="l00577"></a>00577 }
<a name="l00578"></a>00578 
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 std::vector&lt;std::string&gt;
<a name="l00581"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#abba7c75ae621f4a4b8d45f9c2ca0424a">00581</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#abba7c75ae621f4a4b8d45f9c2ca0424a">MSTLLogicControl::getAllTLIds</a>()<span class="keyword"> const </span>{
<a name="l00582"></a>00582     std::vector&lt;std::string&gt; ret;
<a name="l00583"></a>00583     <span class="keywordflow">for</span> (std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end(); ++i) {
<a name="l00584"></a>00584         ret.push_back((*i).first);
<a name="l00585"></a>00585     }
<a name="l00586"></a>00586     <span class="keywordflow">return</span> ret;
<a name="l00587"></a>00587 }
<a name="l00588"></a>00588 
<a name="l00589"></a>00589 
<a name="l00590"></a>00590 <span class="keywordtype">bool</span>
<a name="l00591"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#adfcd8074cf0aea022b0eaa8fe7051d5c">00591</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#adfcd8074cf0aea022b0eaa8fe7051d5c" title="Adds a tls program to the container.">MSTLLogicControl::add</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> std::string&amp; programID,
<a name="l00592"></a>00592                       <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* logic, <span class="keywordtype">bool</span> newDefault) {
<a name="l00593"></a>00593     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(<span class="keywordtype">id</span>) == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00594"></a>00594         <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>[id] = <span class="keyword">new</span> <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html" title="Storage for all programs of a single tls.">TLSLogicVariants</a>();
<a name="l00595"></a>00595     }
<a name="l00596"></a>00596     std::map&lt;std::string, TLSLogicVariants*&gt;::iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(<span class="keywordtype">id</span>);
<a name="l00597"></a>00597     <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html" title="Storage for all programs of a single tls.">TLSLogicVariants</a>* tlmap = (*i).second;
<a name="l00598"></a>00598     <span class="keywordflow">return</span> tlmap-&gt;<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a959a0a696ef9e978490473c2c64f4c96" title="Adds a logic (program).">addLogic</a>(programID, logic, <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a7e955d854f3b1a96e043feb64d1ebdfa" title="Information whether the net was completely loaded.">myNetWasLoaded</a>, newDefault);
<a name="l00599"></a>00599 }
<a name="l00600"></a>00600 
<a name="l00601"></a>00601 
<a name="l00602"></a>00602 <span class="keywordtype">bool</span>
<a name="l00603"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ab5047f0dcdf4a838c6d6b646b271c705">00603</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ab5047f0dcdf4a838c6d6b646b271c705" title="Returns the information whether the named tls is stored.">MSTLLogicControl::knows</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)<span class="keyword"> const </span>{
<a name="l00604"></a>00604     std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(<span class="keywordtype">id</span>);
<a name="l00605"></a>00605     <span class="keywordflow">if</span> (i == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00606"></a>00606         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00607"></a>00607     }
<a name="l00608"></a>00608     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00609"></a>00609 }
<a name="l00610"></a>00610 
<a name="l00611"></a>00611 
<a name="l00612"></a>00612 <span class="keywordtype">bool</span>
<a name="l00613"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a5a634407d8f8aed4ec4be4d413ca0e8a">00613</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a5a634407d8f8aed4ec4be4d413ca0e8a" title="Lets MSTLLogicControl know that the network has been loaded.">MSTLLogicControl::closeNetworkReading</a>() {
<a name="l00614"></a>00614     <span class="keywordtype">bool</span> hadErrors = <span class="keyword">false</span>;
<a name="l00615"></a>00615     <span class="keywordflow">for</span> (std::map&lt;std::string, TLSLogicVariants*&gt;::iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end(); ++i) {
<a name="l00616"></a>00616         hadErrors |= !(*i).second-&gt;checkOriginalTLS();
<a name="l00617"></a>00617         (*i).second-&gt;saveInitialStates();
<a name="l00618"></a>00618     }
<a name="l00619"></a>00619     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a7e955d854f3b1a96e043feb64d1ebdfa" title="Information whether the net was completely loaded.">myNetWasLoaded</a> = <span class="keyword">true</span>;
<a name="l00620"></a>00620     <span class="keywordflow">return</span> !hadErrors;
<a name="l00621"></a>00621 }
<a name="l00622"></a>00622 
<a name="l00623"></a>00623 
<a name="l00624"></a>00624 <span class="keywordtype">bool</span>
<a name="l00625"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a248e2fc6031b6c815e18aeecc309241b">00625</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a248e2fc6031b6c815e18aeecc309241b" title="Returns whether the given tls program is the currently active for his tls.">MSTLLogicControl::isActive</a>(<span class="keyword">const</span> <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* tl)<span class="keyword"> const </span>{
<a name="l00626"></a>00626     std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(tl-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a612f9f30db841c26fb177b31b9a05600" title="Returns this tl-logic&amp;#39;s id.">getID</a>());
<a name="l00627"></a>00627     <span class="keywordflow">if</span> (i == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00628"></a>00628         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00629"></a>00629     }
<a name="l00630"></a>00630     <span class="keywordflow">return</span> (*i).second-&gt;isActive(tl);
<a name="l00631"></a>00631 }
<a name="l00632"></a>00632 
<a name="l00633"></a>00633 
<a name="l00634"></a>00634 <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>*
<a name="l00635"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a78aa848cd3df64ba7ea5a59f03d5e3a0">00635</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a78aa848cd3df64ba7ea5a59f03d5e3a0" title="Returns the active program of a named tls.">MSTLLogicControl::getActive</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)<span class="keyword"> const </span>{
<a name="l00636"></a>00636     std::map&lt;std::string, TLSLogicVariants*&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(<span class="keywordtype">id</span>);
<a name="l00637"></a>00637     <span class="keywordflow">if</span> (i == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00638"></a>00638         <span class="keywordflow">return</span> 0;
<a name="l00639"></a>00639     }
<a name="l00640"></a>00640     <span class="keywordflow">return</span> (*i).second-&gt;getActive();
<a name="l00641"></a>00641 }
<a name="l00642"></a>00642 
<a name="l00643"></a>00643 
<a name="l00644"></a>00644 <span class="keywordtype">void</span>
<a name="l00645"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a46e63ae4c10f097abdb3dcfbcb0fa8a5">00645</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a46e63ae4c10f097abdb3dcfbcb0fa8a5" title="Switches the named (id) tls to the named (programID) program.">MSTLLogicControl::switchTo</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> std::string&amp; programID) {
<a name="l00646"></a>00646     <span class="comment">// try to get the tls program definitions</span>
<a name="l00647"></a>00647     std::map&lt;std::string, TLSLogicVariants*&gt;::iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(<span class="keywordtype">id</span>);
<a name="l00648"></a>00648     <span class="comment">// handle problems</span>
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (i == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00650"></a>00650         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not switch tls &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39; to program &#39;&quot;</span> + programID + <span class="stringliteral">&quot;&#39;: No such tls exists.&quot;</span>);
<a name="l00651"></a>00651     }
<a name="l00652"></a>00652     (*i).second-&gt;switchTo(*<span class="keyword">this</span>, programID);
<a name="l00653"></a>00653 }
<a name="l00654"></a>00654 
<a name="l00655"></a>00655 
<a name="l00656"></a>00656 <span class="keywordtype">void</span>
<a name="l00657"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a4bab321ab43c416a1f1355e4c62e10a1">00657</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a4bab321ab43c416a1f1355e4c62e10a1" title="Adds a WAUT definition.">MSTLLogicControl::addWAUT</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> refTime, <span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>,
<a name="l00658"></a>00658                           <span class="keyword">const</span> std::string&amp; startProg) {
<a name="l00659"></a>00659     <span class="comment">// check whether the waut was already defined</span>
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.find(<span class="keywordtype">id</span>) != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.end()) {
<a name="l00661"></a>00661         <span class="comment">// report an error if so</span>
<a name="l00662"></a>00662         <span class="keywordflow">throw</span> <a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>(<span class="stringliteral">&quot;Waut &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39; was already defined.&quot;</span>);
<a name="l00663"></a>00663     }
<a name="l00664"></a>00664     <a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html" title="A WAUT definition.">WAUT</a>* w = <span class="keyword">new</span> <a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html" title="A WAUT definition.">WAUT</a>;
<a name="l00665"></a>00665     w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#ac3ca39b24882d855206baa10b536410f" title="The id of the WAUT.">id</a> = id;
<a name="l00666"></a>00666     w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#af3ce4edebc0d4d8aa81d2da230ce1d6b" title="The reference time (offset to the switch times).">refTime</a> = refTime;
<a name="l00667"></a>00667     w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#a185b12a15fe9b0f13a997eda7562b189" title="The name of the start program.">startProg</a> = startProg;
<a name="l00668"></a>00668     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[id] = w;
<a name="l00669"></a>00669 }
<a name="l00670"></a>00670 
<a name="l00671"></a>00671 
<a name="l00672"></a>00672 <span class="keywordtype">void</span>
<a name="l00673"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a8a7c6ee04b89bdca00551592e44fca9b">00673</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a8a7c6ee04b89bdca00551592e44fca9b" title="Adds a WAUT switch step to a previously built WAUT.">MSTLLogicControl::addWAUTSwitch</a>(<span class="keyword">const</span> std::string&amp; wautid,
<a name="l00674"></a>00674                                 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> when, <span class="keyword">const</span> std::string&amp; to) {
<a name="l00675"></a>00675     <span class="comment">// try to get the waut</span>
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.find(wautid) == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.end()) {
<a name="l00677"></a>00677         <span class="comment">// report an error if the waut is not known</span>
<a name="l00678"></a>00678         <span class="keywordflow">throw</span> <a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>(<span class="stringliteral">&quot;Waut &#39;&quot;</span> + wautid + <span class="stringliteral">&quot;&#39; was not yet defined.&quot;</span>);
<a name="l00679"></a>00679     }
<a name="l00680"></a>00680     <span class="comment">// build and save the waut switch definition</span>
<a name="l00681"></a>00681     <a class="code" href="../../d4/d21/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch.html" title="Storage for a WAUTs switch point.">WAUTSwitch</a> s;
<a name="l00682"></a>00682     s.<a class="code" href="../../d4/d21/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch.html#ade250a2dfe2e76acaaa3b55062e6bbd2" title="The program name the WAUT shall switch the TLS to.">to</a> = to;
<a name="l00683"></a>00683     s.<a class="code" href="../../d4/d21/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch.html#ac176d90711306de04e0ec64e05b30c45" title="The time the WAUT shall switch the TLS.">when</a> = (<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;refTime + when) % 86400000;
<a name="l00684"></a>00684     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches.push_back(s);
<a name="l00685"></a>00685 }
<a name="l00686"></a>00686 
<a name="l00687"></a>00687 
<a name="l00688"></a>00688 <span class="keywordtype">void</span>
<a name="l00689"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a03f84ca068a075b2a0b5e879519112be">00689</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a03f84ca068a075b2a0b5e879519112be" title="Adds a tls to the list of tls to be switched by the named WAUT.">MSTLLogicControl::addWAUTJunction</a>(<span class="keyword">const</span> std::string&amp; wautid,
<a name="l00690"></a>00690                                   <span class="keyword">const</span> std::string&amp; tls,
<a name="l00691"></a>00691                                   <span class="keyword">const</span> std::string&amp; proc,
<a name="l00692"></a>00692                                   <span class="keywordtype">bool</span> synchron) {
<a name="l00693"></a>00693     <span class="comment">// try to get the waut</span>
<a name="l00694"></a>00694     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.find(wautid) == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.end()) {
<a name="l00695"></a>00695         <span class="comment">// report an error if the waut is not known</span>
<a name="l00696"></a>00696         <span class="keywordflow">throw</span> <a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>(<span class="stringliteral">&quot;Waut &#39;&quot;</span> + wautid + <span class="stringliteral">&quot;&#39; was not yet defined.&quot;</span>);
<a name="l00697"></a>00697     }
<a name="l00698"></a>00698     <span class="comment">// try to get the tls to switch</span>
<a name="l00699"></a>00699     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find(tls) == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.end()) {
<a name="l00700"></a>00700         <span class="comment">// report an error if the tls is not known</span>
<a name="l00701"></a>00701         <span class="keywordflow">throw</span> <a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>(<span class="stringliteral">&quot;TLS &#39;&quot;</span> + tls + <span class="stringliteral">&quot;&#39; to switch in WAUT &#39;&quot;</span> + wautid + <span class="stringliteral">&quot;&#39; was not yet defined.&quot;</span>);
<a name="l00702"></a>00702     }
<a name="l00703"></a>00703     <a class="code" href="../../d9/d37/struct_m_s_t_l_logic_control_1_1_w_a_u_t_junction.html" title="Storage for a junction assigned to a WAUT.">WAUTJunction</a> j;
<a name="l00704"></a>00704     j.<a class="code" href="../../d9/d37/struct_m_s_t_l_logic_control_1_1_w_a_u_t_junction.html#abc96315280d4a7ea8b4d2e812d52ef5c" title="The junction name.">junction</a> = tls;
<a name="l00705"></a>00705     j.<a class="code" href="../../d9/d37/struct_m_s_t_l_logic_control_1_1_w_a_u_t_junction.html#a2f3f3c5d81c3270fe6314c14d910ab0a" title="The procedure to switch the junction with.">procedure</a> = proc;
<a name="l00706"></a>00706     j.<a class="code" href="../../d9/d37/struct_m_s_t_l_logic_control_1_1_w_a_u_t_junction.html#a301e578712721e1dda63f4eb88e1d360" title="Information whether this junction shall be switched synchron.">synchron</a> = synchron;
<a name="l00707"></a>00707     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;junctions.push_back(j);
<a name="l00708"></a>00708 
<a name="l00709"></a>00709     std::string initProg = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;startProg;
<a name="l00710"></a>00710     std::vector&lt;WAUTSwitch&gt;::const_iterator first = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches.end();
<a name="l00711"></a>00711     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> minExecTime = -1;
<a name="l00712"></a>00712     <span class="keywordflow">for</span> (std::vector&lt;WAUTSwitch&gt;::const_iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches.end(); ++i) {
<a name="l00713"></a>00713         <span class="keywordflow">if</span> ((*i).when &gt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>() &amp;&amp; (minExecTime == -1 || (*i).when &lt; minExecTime)) {
<a name="l00714"></a>00714             minExecTime = (*i).when;
<a name="l00715"></a>00715             first = i;
<a name="l00716"></a>00716         }
<a name="l00717"></a>00717         <span class="keywordflow">if</span> (first != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches.begin()) {
<a name="l00718"></a>00718             initProg = (*(first - 1)).to;
<a name="l00719"></a>00719         }
<a name="l00720"></a>00720     }
<a name="l00721"></a>00721     <span class="comment">// activate the first one</span>
<a name="l00722"></a>00722     <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a46e63ae4c10f097abdb3dcfbcb0fa8a5" title="Switches the named (id) tls to the named (programID) program.">switchTo</a>(tls, initProg);
<a name="l00723"></a>00723 }
<a name="l00724"></a>00724 
<a name="l00725"></a>00725 
<a name="l00726"></a>00726 <span class="keywordtype">void</span>
<a name="l00727"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#afec646796334fb10ed00dd392ff62743">00727</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#afec646796334fb10ed00dd392ff62743" title="Closes loading of a WAUT.">MSTLLogicControl::closeWAUT</a>(<span class="keyword">const</span> std::string&amp; wautid) {
<a name="l00728"></a>00728     <span class="comment">// try to get the waut</span>
<a name="l00729"></a>00729     <span class="keywordflow">if</span> (<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.find(wautid) == <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.end()) {
<a name="l00730"></a>00730         <span class="comment">// report an error if the waut is not known</span>
<a name="l00731"></a>00731         <span class="keywordflow">throw</span> <a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>(<span class="stringliteral">&quot;Waut &#39;&quot;</span> + wautid + <span class="stringliteral">&quot;&#39; was not yet defined.&quot;</span>);
<a name="l00732"></a>00732     }
<a name="l00733"></a>00733     <a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html" title="A WAUT definition.">WAUT</a>* w = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>.find(wautid)-&gt;second;
<a name="l00734"></a>00734     std::string initProg = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;startProg;
<a name="l00735"></a>00735     <span class="comment">// get the switch to be performed as first</span>
<a name="l00736"></a>00736     std::vector&lt;WAUTSwitch&gt;::const_iterator first = w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#a5151a9f6c9fd27f97401b8b5cf535502" title="The list of switches to be done by the WAUT.">switches</a>.end();
<a name="l00737"></a>00737     <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> minExecTime = -1;
<a name="l00738"></a>00738     <span class="keywordflow">for</span> (std::vector&lt;WAUTSwitch&gt;::const_iterator i = w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#a5151a9f6c9fd27f97401b8b5cf535502" title="The list of switches to be done by the WAUT.">switches</a>.begin(); i != w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#a5151a9f6c9fd27f97401b8b5cf535502" title="The list of switches to be done by the WAUT.">switches</a>.end(); ++i) {
<a name="l00739"></a>00739         <span class="keywordflow">if</span> ((*i).when &gt; <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>() &amp;&amp; (minExecTime == -1 || (*i).when &lt; minExecTime)) {
<a name="l00740"></a>00740             minExecTime = (*i).when;
<a name="l00741"></a>00741             first = i;
<a name="l00742"></a>00742         }
<a name="l00743"></a>00743     }
<a name="l00744"></a>00744     <span class="comment">// activate the first one</span>
<a name="l00745"></a>00745     <span class="keywordflow">if</span> (first != w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#a5151a9f6c9fd27f97401b8b5cf535502" title="The list of switches to be done by the WAUT.">switches</a>.end()) {
<a name="l00746"></a>00746         std::vector&lt;WAUTSwitch&gt;::const_iterator mbegin = w-&gt;<a class="code" href="../../d7/d7c/struct_m_s_t_l_logic_control_1_1_w_a_u_t.html#a5151a9f6c9fd27f97401b8b5cf535502" title="The list of switches to be done by the WAUT.">switches</a>.begin();
<a name="l00747"></a>00747         <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a95af4e733f5fe79af4836c73234d3fad" title="Returns the event control for events executed at the begin of a time step.">getBeginOfTimestepEvents</a>().<a class="code" href="../../d1/dd4/class_m_s_event_control.html#a3a67d81a69b8966c6bb736c767e3707b" title="Adds an Event.">addEvent</a>(
<a name="l00748"></a>00748             <span class="keyword">new</span> <a class="code" href="../../d0/db0/class_m_s_t_l_logic_control_1_1_switch_init_command.html" title="This event-class is used to initialise a WAUT switch at a certain time.">SwitchInitCommand</a>(*<span class="keyword">this</span>, wautid, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)distance(mbegin, first)),
<a name="l00749"></a>00749             (*first).when, <a class="code" href="../../d1/dd4/class_m_s_event_control.html#a152e40041651a2f477f09dee765baad5af888edc820a7f87c4b50ac8695bcfa88" title="Do nothing.">MSEventControl::NO_CHANGE</a>);
<a name="l00750"></a>00750     }
<a name="l00751"></a>00751     <span class="comment">/*</span>
<a name="l00752"></a>00752 <span class="comment">    // set the current program to all junctions</span>
<a name="l00753"></a>00753 <span class="comment">    for(std::vector&lt;WAUTJunction&gt;::const_iterator i=w-&gt;junctions.begin(); i!=w-&gt;junctions.end(); ++i) {</span>
<a name="l00754"></a>00754 <span class="comment">        switchTo((*i).junction, initProg);</span>
<a name="l00755"></a>00755 <span class="comment">    }</span>
<a name="l00756"></a>00756 <span class="comment">    */</span>
<a name="l00757"></a>00757 }
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 
<a name="l00760"></a>00760 <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a>
<a name="l00761"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#aae4b4fbc97ff89c0e5b7fe5d8adc1892">00761</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#aae4b4fbc97ff89c0e5b7fe5d8adc1892" title="Initialises switching a WAUT.">MSTLLogicControl::initWautSwitch</a>(<a class="code" href="../../d0/db0/class_m_s_t_l_logic_control_1_1_switch_init_command.html" title="This event-class is used to initialise a WAUT switch at a certain time.">MSTLLogicControl::SwitchInitCommand</a>&amp; cmd) {
<a name="l00762"></a>00762     <span class="keyword">const</span> std::string&amp; wautid = cmd.<a class="code" href="../../d0/db0/class_m_s_t_l_logic_control_1_1_switch_init_command.html#a122ea243a7a682ce6e0f10b43b3dd31d" title="Returns the WAUT-id.">getWAUTID</a>();
<a name="l00763"></a>00763     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&amp; index = cmd.<a class="code" href="../../d0/db0/class_m_s_t_l_logic_control_1_1_switch_init_command.html#aaf35f3ec8b6bc4a772b3bd94b7d798b5" title="Returns a reference to the index.">getIndex</a>();
<a name="l00764"></a>00764     <a class="code" href="../../d4/d21/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch.html" title="Storage for a WAUTs switch point.">WAUTSwitch</a> s = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches[index];
<a name="l00765"></a>00765     <span class="keywordflow">for</span> (std::vector&lt;WAUTJunction&gt;::iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;junctions.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;junctions.end(); ++i) {
<a name="l00766"></a>00766         <span class="comment">// get the current program and the one to instantiate</span>
<a name="l00767"></a>00767         <a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html" title="Storage for all programs of a single tls.">TLSLogicVariants</a>* vars = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a3c40b7972e6493c0d3f670f550e03535" title="A map from ids to the corresponding variants.">myLogics</a>.find((*i).junction)-&gt;second;
<a name="l00768"></a>00768         <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* from = vars-&gt;<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#a700e5609724b6445a7effc9d212d6129">getActive</a>();
<a name="l00769"></a>00769         <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* to = vars-&gt;<a class="code" href="../../d1/dab/class_m_s_t_l_logic_control_1_1_t_l_s_logic_variants.html#adf07a0484907af20553e64dfbeafd33b">getLogicInstantiatingOff</a>(*<span class="keyword">this</span>, s.<a class="code" href="../../d4/d21/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch.html#ade250a2dfe2e76acaaa3b55062e6bbd2" title="The program name the WAUT shall switch the TLS to.">to</a>);
<a name="l00770"></a>00770         <a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html" title="This is the abstract base class for switching from one tls program to another.">WAUTSwitchProcedure</a>* proc = 0;
<a name="l00771"></a>00771         <span class="keywordflow">if</span> ((*i).procedure == <span class="stringliteral">&quot;GSP&quot;</span>) {
<a name="l00772"></a>00772             proc = <span class="keyword">new</span> <a class="code" href="../../d2/dab/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___g_s_p.html" title="This class switches using the GSP algorithm.">WAUTSwitchProcedure_GSP</a>(*<span class="keyword">this</span>, *<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid], from, to, (*i).synchron);
<a name="l00773"></a>00773         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((*i).procedure == <span class="stringliteral">&quot;Stretch&quot;</span>) {
<a name="l00774"></a>00774             proc = <span class="keyword">new</span> <a class="code" href="../../d1/dd3/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___stretch.html" title="This class switches using the Stretch algorithm.">WAUTSwitchProcedure_Stretch</a>(*<span class="keyword">this</span>, *<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid], from, to, (*i).synchron);
<a name="l00775"></a>00775         } <span class="keywordflow">else</span> {
<a name="l00776"></a>00776             proc = <span class="keyword">new</span> <a class="code" href="../../d8/d9d/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure___just_switch.html" title="This class simply switches to the next program.">WAUTSwitchProcedure_JustSwitch</a>(*<span class="keyword">this</span>, *<a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid], from, to, (*i).synchron);
<a name="l00777"></a>00777         }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779         <a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html" title="An initialised switch process.">WAUTSwitchProcess</a> p;
<a name="l00780"></a>00780         p.<a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html#a4ea6d5b4763e317799323d39656747b1" title="The id of the junction to switch.">junction</a> = (*i).junction;
<a name="l00781"></a>00781         p.<a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html#ab3dde7092925524100492e64b0a29340" title="The used procedure.">proc</a> = proc;
<a name="l00782"></a>00782         p.<a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html#a8413757239bf227adba63cb88f5de0ba" title="The current program of the tls.">from</a> = from;
<a name="l00783"></a>00783         p.<a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html#a133af8730242c0a0e4ebd195ce56d2d8" title="The program to switch the tls to.">to</a> = to;
<a name="l00784"></a>00784 
<a name="l00785"></a>00785         <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a2b9ff2285ac944f4780deedaa8da08c7" title="A list of currently running switching procedures.">myCurrentlySwitched</a>.push_back(p);
<a name="l00786"></a>00786     }
<a name="l00787"></a>00787     index++;
<a name="l00788"></a>00788     <span class="keywordflow">if</span> (index == (<span class="keywordtype">int</span>) <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches.size()) {
<a name="l00789"></a>00789         <span class="keywordflow">return</span> 0;
<a name="l00790"></a>00790     }
<a name="l00791"></a>00791     <span class="keywordflow">return</span> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ac1f0d00ff3ef6627a4281b1400ae6f1b" title="A map of ids to corresponding WAUTs.">myWAUTs</a>[wautid]-&gt;switches[index].when - <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 <span class="keywordtype">void</span>
<a name="l00796"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#abe46edf59985bace57328f0d4dda161e">00796</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#abe46edf59985bace57328f0d4dda161e" title="Checks whether any WAUT is trying to switch a tls into another program.">MSTLLogicControl::check2Switch</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> step) {
<a name="l00797"></a>00797     <span class="keywordflow">for</span> (std::vector&lt;WAUTSwitchProcess&gt;::iterator i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a2b9ff2285ac944f4780deedaa8da08c7" title="A list of currently running switching procedures.">myCurrentlySwitched</a>.begin(); i != <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a2b9ff2285ac944f4780deedaa8da08c7" title="A list of currently running switching procedures.">myCurrentlySwitched</a>.end();) {
<a name="l00798"></a>00798         <span class="keyword">const</span> <a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html" title="An initialised switch process.">WAUTSwitchProcess</a>&amp; proc = *i;
<a name="l00799"></a>00799         <span class="keywordflow">if</span> (proc.<a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html#ab3dde7092925524100492e64b0a29340" title="The used procedure.">proc</a>-&gt;<a class="code" href="../../de/de8/class_m_s_t_l_logic_control_1_1_w_a_u_t_switch_procedure.html#a1181ee69b2a07bdd13b3ee4d5dc3683c" title="Determines whether a switch is possible.">trySwitch</a>(step)) {
<a name="l00800"></a>00800             <span class="keyword">delete</span> proc.<a class="code" href="../../d4/d9b/struct_m_s_t_l_logic_control_1_1_w_a_u_t_switch_process.html#ab3dde7092925524100492e64b0a29340" title="The used procedure.">proc</a>;
<a name="l00801"></a>00801             <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a46e63ae4c10f097abdb3dcfbcb0fa8a5" title="Switches the named (id) tls to the named (programID) program.">switchTo</a>((*i).to-&gt;getID(), (*i).to-&gt;getProgramID());
<a name="l00802"></a>00802             i = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a2b9ff2285ac944f4780deedaa8da08c7" title="A list of currently running switching procedures.">myCurrentlySwitched</a>.erase(i);
<a name="l00803"></a>00803         } <span class="keywordflow">else</span> {
<a name="l00804"></a>00804             ++i;
<a name="l00805"></a>00805         }
<a name="l00806"></a>00806     }
<a name="l00807"></a>00807 }
<a name="l00808"></a>00808 
<a name="l00809"></a>00809 
<a name="l00810"></a>00810 std::pair&lt;SUMOTime, MSPhaseDefinition&gt;
<a name="l00811"></a><a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ae8bbda7e8f9820f0ae2c9bfdd2d3c32f">00811</a> <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#ae8bbda7e8f9820f0ae2c9bfdd2d3c32f" title="return the complete phase definition for a named traffic lights logic">MSTLLogicControl::getPhaseDef</a>(<span class="keyword">const</span> std::string&amp; tlid)<span class="keyword"> const </span>{
<a name="l00812"></a>00812     <a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html" title="The parent class for traffic light logics.">MSTrafficLightLogic</a>* tl = <a class="code" href="../../d2/da4/class_m_s_t_l_logic_control.html#a78aa848cd3df64ba7ea5a59f03d5e3a0" title="Returns the active program of a named tls.">getActive</a>(tlid);
<a name="l00813"></a>00813     <span class="keywordflow">return</span> std::make_pair(<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep(), tl-&gt;<a class="code" href="../../df/d93/class_m_s_traffic_light_logic.html#a06670997037f3fb482f271601a852a41" title="Returns the definition of the current phase.">getCurrentPhaseDef</a>());
<a name="l00814"></a>00814 }
<a name="l00815"></a>00815 
<a name="l00816"></a>00816 
<a name="l00817"></a>00817 
<a name="l00818"></a>00818 <span class="comment">/****************************************************************************/</span>
<a name="l00819"></a>00819 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:02 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
