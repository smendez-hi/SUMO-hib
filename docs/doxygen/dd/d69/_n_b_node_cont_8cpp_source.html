<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: NBNodeCont.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_fef730b7af99b175e444dabf8b9377e8.html">netbuild</a>
  </div>
</div>
<div class="contents">
<h1>NBNodeCont.cpp</h1><a href="../../dd/d69/_n_b_node_cont_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00013"></a>00013 <span class="comment">// Container for nodes during the netbuilding process</span>
<a name="l00014"></a>00014 <span class="comment">/****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00016"></a>00016 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00017"></a>00017 <span class="comment">/****************************************************************************/</span>
<a name="l00018"></a>00018 <span class="comment">//</span>
<a name="l00019"></a>00019 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00020"></a>00020 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00021"></a>00021 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00022"></a>00022 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00023"></a>00023 <span class="comment">//   (at your option) any later version.</span>
<a name="l00024"></a>00024 <span class="comment">//</span>
<a name="l00025"></a>00025 <span class="comment">/****************************************************************************/</span>
<a name="l00026"></a>00026 
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">// ===========================================================================</span>
<a name="l00029"></a>00029 <span class="comment">// included modules</span>
<a name="l00030"></a>00030 <span class="comment">// ===========================================================================</span>
<a name="l00031"></a>00031 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00032"></a>00032 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#else</span>
<a name="l00034"></a>00034 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#endif</span>
<a name="l00036"></a>00036 <span class="preprocessor"></span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d5c/_options_cont_8h.html">utils/options/OptionsCont.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="../../d9/df9/_boundary_8h.html">utils/geom/Boundary.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="../../d5/df0/_geom_helper_8h.html">utils/geom/GeomHelper.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/df7/_msg_handler_8h.html">utils/common/MsgHandler.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db4/_util_exceptions_8h.html">utils/common/UtilExceptions.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="../../da/d8e/_string_tokenizer_8h.html">utils/common/StringTokenizer.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="../../da/dbd/_std_defs_8h.html">utils/common/StdDefs.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d08/_to_string_8h.html">utils/common/ToString.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html">utils/xml/SUMOXMLDefinitions.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d6d/_geo_conv_helper_8h.html">utils/geom/GeoConvHelper.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="../../d1/d3f/_output_device_8h.html">utils/iodevices/OutputDevice.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="../../df/d03/_n_b_district_8h.html">NBDistrict.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="../../d7/db4/_n_b_edge_cont_8h.html">NBEdgeCont.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/dd9/_n_b_traffic_light_logic_cont_8h.html">NBTrafficLightLogicCont.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dc4/_n_b_joined_edges_map_8h.html">NBJoinedEdgesMap.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="../../d1/df8/_n_b_own_t_l_def_8h.html">NBOwnTLDef.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../da/d09/_n_b_node_cont_8h.html">NBNodeCont.h</a>&quot;</span>
<a name="l00058"></a>00058 
<a name="l00059"></a>00059 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span>
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">// ===========================================================================</span>
<a name="l00065"></a>00065 <span class="comment">// method definitions</span>
<a name="l00066"></a>00066 <span class="comment">// ===========================================================================</span>
<a name="l00067"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a7f874a4281c85461b7523ddbe1db85ed">00067</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a7f874a4281c85461b7523ddbe1db85ed" title="Constructor.">NBNodeCont::NBNodeCont</a>()
<a name="l00068"></a>00068     : myInternalID(1) {}
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a647ec7aa34ce035e90e3c7c11b8eb36e">00071</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a647ec7aa34ce035e90e3c7c11b8eb36e" title="Destructor.">NBNodeCont::~NBNodeCont</a>() {
<a name="l00072"></a>00072     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0017c5728b2f91919bb79798fb5dd981">clear</a>();
<a name="l00073"></a>00073 }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="comment">// ----------- Insertion/removal/retrieval of nodes</span>
<a name="l00077"></a>00077 <span class="keywordtype">bool</span>
<a name="l00078"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177">00078</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">NBNodeCont::insert</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>&amp; position,
<a name="l00079"></a>00079                    <a class="code" href="../../d7/d91/class_n_b_district.html" title="A class representing a single district.">NBDistrict</a>* district) {
<a name="l00080"></a>00080     NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.find(<span class="keywordtype">id</span>);
<a name="l00081"></a>00081     <span class="keywordflow">if</span> (i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end()) {
<a name="l00082"></a>00082         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00083"></a>00083     }
<a name="l00084"></a>00084     <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node = <span class="keyword">new</span> <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>(<span class="keywordtype">id</span>, position, district);
<a name="l00085"></a>00085     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>[id] = node;
<a name="l00086"></a>00086     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00087"></a>00087 }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 <span class="keywordtype">bool</span>
<a name="l00091"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#abc183cf0dfea1d7eaf14d582fcb3d5d6">00091</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">NBNodeCont::insert</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>, <span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>&amp; position) {
<a name="l00092"></a>00092     NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.find(<span class="keywordtype">id</span>);
<a name="l00093"></a>00093     <span class="keywordflow">if</span> (i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end()) {
<a name="l00094"></a>00094         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00095"></a>00095     }
<a name="l00096"></a>00096     <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node = <span class="keyword">new</span> <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>(<span class="keywordtype">id</span>, position);
<a name="l00097"></a>00097     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>[id] = node;
<a name="l00098"></a>00098     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00099"></a>00099 }
<a name="l00100"></a>00100 
<a name="l00101"></a>00101 
<a name="l00102"></a>00102 <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>
<a name="l00103"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a315d2497c943d9c2b9432f990b1602f7">00103</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">NBNodeCont::insert</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>) {
<a name="l00104"></a>00104     std::pair&lt;SUMOReal, SUMOReal&gt; ret(-1.0, -1.0);
<a name="l00105"></a>00105     NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.find(<span class="keywordtype">id</span>);
<a name="l00106"></a>00106     <span class="keywordflow">if</span> (i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end()) {
<a name="l00107"></a>00107         <span class="keywordflow">return</span> (*i).second-&gt;getPosition();
<a name="l00108"></a>00108     } <span class="keywordflow">else</span> {
<a name="l00109"></a>00109         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node = <span class="keyword">new</span> <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>(<span class="keywordtype">id</span>, <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>(-1.0, -1.0));
<a name="l00110"></a>00110         <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>[id] = node;
<a name="l00111"></a>00111     }
<a name="l00112"></a>00112     <span class="keywordflow">return</span> <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>(-1, -1);
<a name="l00113"></a>00113 }
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 <span class="keywordtype">bool</span>
<a name="l00117"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0dc2239e02e2a5788c7369df4758e492">00117</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">NBNodeCont::insert</a>(<a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node) {
<a name="l00118"></a>00118     std::string <span class="keywordtype">id</span> = node-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>();
<a name="l00119"></a>00119     NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.find(<span class="keywordtype">id</span>);
<a name="l00120"></a>00120     <span class="keywordflow">if</span> (i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end()) {
<a name="l00121"></a>00121         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>[id] = node;
<a name="l00124"></a>00124     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 
<a name="l00128"></a>00128 <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>*
<a name="l00129"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039">00129</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">NBNodeCont::retrieve</a>(<span class="keyword">const</span> std::string&amp; <span class="keywordtype">id</span>)<span class="keyword"> const </span>{
<a name="l00130"></a>00130     NodeCont::const_iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.find(<span class="keywordtype">id</span>);
<a name="l00131"></a>00131     <span class="keywordflow">if</span> (i == <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end()) {
<a name="l00132"></a>00132         <span class="keywordflow">return</span> 0;
<a name="l00133"></a>00133     }
<a name="l00134"></a>00134     <span class="keywordflow">return</span> (*i).second;
<a name="l00135"></a>00135 }
<a name="l00136"></a>00136 
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>*
<a name="l00139"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4d8b5dd3d2fc4d1397b7bfd546bf8fb3">00139</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">NBNodeCont::retrieve</a>(<span class="keyword">const</span> <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>&amp; position, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> offset)<span class="keyword"> const </span>{
<a name="l00140"></a>00140     <span class="keywordflow">for</span> (NodeCont::const_iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00141"></a>00141         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node = (*i).second;
<a name="l00142"></a>00142         <span class="keywordflow">if</span> (fabs(node-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>() - position.<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>()) &lt; offset
<a name="l00143"></a>00143                 &amp;&amp;
<a name="l00144"></a>00144                 fabs(node-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>() - position.<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>()) &lt; offset) {
<a name="l00145"></a>00145             <span class="keywordflow">return</span> node;
<a name="l00146"></a>00146         }
<a name="l00147"></a>00147     }
<a name="l00148"></a>00148     <span class="keywordflow">return</span> 0;
<a name="l00149"></a>00149 }
<a name="l00150"></a>00150 
<a name="l00151"></a>00151 
<a name="l00152"></a>00152 <span class="keywordtype">bool</span>
<a name="l00153"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4522e51f128d7e1bbe4d1acef5ae0fc9">00153</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4522e51f128d7e1bbe4d1acef5ae0fc9" title="Removes the given node, deleting it.">NBNodeCont::erase</a>(<a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node) {
<a name="l00154"></a>00154     <span class="keywordflow">if</span> (<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a750ac41317fc17e48b9fb41959bfd535" title="Removes the given node but does not delete it.">extract</a>(node)) {
<a name="l00155"></a>00155         <span class="keyword">delete</span> node;
<a name="l00156"></a>00156         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00157"></a>00157     } <span class="keywordflow">else</span> {
<a name="l00158"></a>00158         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00159"></a>00159     }
<a name="l00160"></a>00160 }
<a name="l00161"></a>00161 
<a name="l00162"></a>00162 
<a name="l00163"></a>00163 <span class="keywordtype">bool</span>
<a name="l00164"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a750ac41317fc17e48b9fb41959bfd535">00164</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a750ac41317fc17e48b9fb41959bfd535" title="Removes the given node but does not delete it.">NBNodeCont::extract</a>(<a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node, <span class="keywordtype">bool</span> remember) {
<a name="l00165"></a>00165     NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.find(node-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>());
<a name="l00166"></a>00166     <span class="keywordflow">if</span> (i == <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end()) {
<a name="l00167"></a>00167         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00168"></a>00168     }
<a name="l00169"></a>00169     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.erase(i);
<a name="l00170"></a>00170     node-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a94eecc6847719ab5672cbc6ab51dc430" title="Removes all references to traffic lights that control this tls.">removeTrafficLights</a>();
<a name="l00171"></a>00171     <span class="keywordflow">if</span> (remember) {
<a name="l00172"></a>00172         <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a2213637620467150b5ab277f03d7e3dd" title="The extracted nodes which are kept for reference.">myExtractedNodes</a>.insert(node);
<a name="l00173"></a>00173     }
<a name="l00174"></a>00174     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00175"></a>00175 }
<a name="l00176"></a>00176 
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="comment">// ----------- Adapting the input</span>
<a name="l00179"></a>00179 <span class="keywordtype">void</span>
<a name="l00180"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae2857cbc4dca5f017004e36c2f315e34">00180</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae2857cbc4dca5f017004e36c2f315e34" title="Removes self-loop edges (edges where the source and the destination node are the...">NBNodeCont::removeSelfLoops</a>(<a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tc) {
<a name="l00181"></a>00181     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> no = 0;
<a name="l00182"></a>00182     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00183"></a>00183         no += (*i).second-&gt;removeSelfLoops(dc, ec, tc);
<a name="l00184"></a>00184     }
<a name="l00185"></a>00185     <span class="keywordflow">if</span> (no != 0) {
<a name="l00186"></a>00186         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(no) + <span class="stringliteral">&quot; self-looping edge(s) removed.&quot;</span>);
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="keywordtype">void</span>
<a name="l00192"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#aab54303c06a090c99b65db66a8b661e6">00192</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#aab54303c06a090c99b65db66a8b661e6" title="Joins edges connecting the same nodes.">NBNodeCont::joinSimilarEdges</a>(<a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc) {
<a name="l00193"></a>00193     <span class="comment">// magic values</span>
<a name="l00194"></a>00194     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> distanceThreshold = 7; <span class="comment">// don&#39;t merge edges further apart</span>
<a name="l00195"></a>00195     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> lengthThreshold = 0.05; <span class="comment">// don&#39;t merge edges with higher relative length-difference</span>
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00198"></a>00198         <span class="comment">// count the edges to other nodes outgoing from the current node</span>
<a name="l00199"></a>00199         std::map&lt;NBNode*, EdgeVector&gt; connectionCount;
<a name="l00200"></a>00200         <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; outgoing = (*i).second-&gt;getOutgoingEdges();
<a name="l00201"></a>00201         <span class="keywordflow">for</span> (EdgeVector::const_iterator j = outgoing.begin(); j != outgoing.end(); j++) {
<a name="l00202"></a>00202             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* e = (*j);
<a name="l00203"></a>00203             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* connected = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>();
<a name="l00204"></a>00204             <span class="keywordflow">if</span> (connectionCount.find(connected) == connectionCount.end()) {
<a name="l00205"></a>00205                 connectionCount[connected] = <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>();
<a name="l00206"></a>00206             }
<a name="l00207"></a>00207             connectionCount[connected].push_back(e);
<a name="l00208"></a>00208         }
<a name="l00209"></a>00209         <span class="comment">// check whether more than a single edge connect another node and join them</span>
<a name="l00210"></a>00210         std::map&lt;NBNode*, EdgeVector&gt;::iterator k;
<a name="l00211"></a>00211         <span class="keywordflow">for</span> (k = connectionCount.begin(); k != connectionCount.end(); k++) {
<a name="l00212"></a>00212             <span class="comment">// possibly we do not have anything to join...</span>
<a name="l00213"></a>00213             <span class="keywordflow">if</span> ((*k).second.size() &lt; 2) {
<a name="l00214"></a>00214                 <span class="keywordflow">continue</span>;
<a name="l00215"></a>00215             }
<a name="l00216"></a>00216             <span class="comment">// for the edges that seem to be a single street,</span>
<a name="l00217"></a>00217             <span class="comment">//  check whether the geometry is similar</span>
<a name="l00218"></a>00218             <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; ev = (*k).second;
<a name="l00219"></a>00219             <span class="keyword">const</span> <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* <span class="keyword">const</span> first = ev.front();
<a name="l00220"></a>00220             EdgeVector::const_iterator jci; <span class="comment">// join candidate iterator</span>
<a name="l00221"></a>00221             <span class="keywordflow">for</span> (jci = ev.begin() + 1; jci != ev.end(); ++jci) {
<a name="l00222"></a>00222                 <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> relativeLengthDifference = fabs(first-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a2a7228d4843a064907b85b6a66180f39" title="Returns the length was set explicitly or the computed length if it wasn&amp;#39;t set...">getLoadedLength</a>() - (*jci)-&gt;getLoadedLength()) / first-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a2a7228d4843a064907b85b6a66180f39" title="Returns the length was set explicitly or the computed length if it wasn&amp;#39;t set...">getLoadedLength</a>();
<a name="l00223"></a>00223                 <span class="keywordflow">if</span> ((!first-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6ca0a25f152eb9bdc588a17eb8f7274d">isNearEnough2BeJoined2</a>(*jci, distanceThreshold)) ||
<a name="l00224"></a>00224                         (relativeLengthDifference &gt; lengthThreshold) ||
<a name="l00225"></a>00225                         (first-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() != (*jci)-&gt;getSpeed())
<a name="l00226"></a>00226                         <span class="comment">// @todo check vclass</span>
<a name="l00227"></a>00227                    ) {
<a name="l00228"></a>00228                     <span class="keywordflow">break</span>;
<a name="l00229"></a>00229                 }
<a name="l00230"></a>00230             }
<a name="l00231"></a>00231             <span class="comment">// @bug If there are 3 edges of which 2 can be joined, no joining will</span>
<a name="l00232"></a>00232             <span class="comment">//   take place with the current implementation</span>
<a name="l00233"></a>00233             <span class="keywordflow">if</span> (jci == ev.end()) {
<a name="l00234"></a>00234                 ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#accaad74b59d70896ffa51e857c2b8995" title="Joins the given edges because they connect the same nodes.">joinSameNodeConnectingEdges</a>(dc, tlc, ev);
<a name="l00235"></a>00235             }
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 
<a name="l00241"></a>00241 <span class="keywordtype">void</span>
<a name="l00242"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#afe9b8501bc580b2563137f0a7a8f64fb">00242</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#afe9b8501bc580b2563137f0a7a8f64fb" title="Removes sequences of edges that are not connected with a junction. Simple roads without...">NBNodeCont::removeIsolatedRoads</a>(<a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tc) {
<a name="l00243"></a>00243     <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c95a90e7806e4b0d21edfae15b73465">UNUSED_PARAMETER</a>(tc);
<a name="l00244"></a>00244     <span class="comment">// Warn of isolated edges, i.e. a single edge with no connection to another edge</span>
<a name="l00245"></a>00245     <span class="keywordtype">int</span> edgeCounter = 0;
<a name="l00246"></a>00246     <span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;edgeNames = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a2a5fc9d29718d582d9dd8b2e3d1f83d2" title="Returns all ids of known edges.">getAllNames</a>();
<a name="l00247"></a>00247     <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator it = edgeNames.begin(); it != edgeNames.end(); ++it) {
<a name="l00248"></a>00248         <span class="comment">// Test whether this node starts at a dead end, i.e. it has only one adjacent node</span>
<a name="l00249"></a>00249         <span class="comment">// to which an edge exists and from which an edge may come.</span>
<a name="l00250"></a>00250         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* e = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a6f3edcea491ac076689edc6d1b8ba289" title="Returns the edge that has the given id.">retrieve</a>(*it);
<a name="l00251"></a>00251         <span class="keywordflow">if</span> (e == 0) {
<a name="l00252"></a>00252             <span class="keywordflow">continue</span>;
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* from = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>();
<a name="l00255"></a>00255         <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; outgoingEdges = from-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>();
<a name="l00256"></a>00256         <span class="keywordflow">if</span> (outgoingEdges.size() != 1) {
<a name="l00257"></a>00257             <span class="comment">// At this node, several edges or no edge start; so, this node is no dead end.</span>
<a name="l00258"></a>00258             <span class="keywordflow">continue</span>;
<a name="l00259"></a>00259         }
<a name="l00260"></a>00260         <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; incomingEdges = from-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>();
<a name="l00261"></a>00261         <span class="keywordflow">if</span> (incomingEdges.size() &gt; 1) {
<a name="l00262"></a>00262             <span class="comment">// At this node, several edges end; so, this node is no dead end.</span>
<a name="l00263"></a>00263             <span class="keywordflow">continue</span>;
<a name="l00264"></a>00264         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (incomingEdges.size() == 1) {
<a name="l00265"></a>00265             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* fromNodeOfIncomingEdge = incomingEdges[0]-&gt;getFromNode();
<a name="l00266"></a>00266             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* toNodeOfOutgoingEdge = outgoingEdges[0]-&gt;getToNode();
<a name="l00267"></a>00267             <span class="keywordflow">if</span> (fromNodeOfIncomingEdge != toNodeOfOutgoingEdge) {
<a name="l00268"></a>00268                 <span class="comment">// At this node, an edge ends which is not the inverse direction of</span>
<a name="l00269"></a>00269                 <span class="comment">// the starting node.</span>
<a name="l00270"></a>00270                 <span class="keywordflow">continue</span>;
<a name="l00271"></a>00271             }
<a name="l00272"></a>00272         }
<a name="l00273"></a>00273         <span class="comment">// Now we know that the edge e starts a dead end.</span>
<a name="l00274"></a>00274         <span class="comment">// Next we test if the dead end is isolated, i.e. does not lead to a junction</span>
<a name="l00275"></a>00275         <span class="keywordtype">bool</span> hasJunction = <span class="keyword">false</span>;
<a name="l00276"></a>00276         <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a> road;
<a name="l00277"></a>00277         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* eOld = 0;
<a name="l00278"></a>00278         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* to;
<a name="l00279"></a>00279         std::set&lt;NBNode*&gt; adjacentNodes;
<a name="l00280"></a>00280         <span class="keywordflow">do</span> {
<a name="l00281"></a>00281             road.push_back(e);
<a name="l00282"></a>00282             eOld = e;
<a name="l00283"></a>00283             from = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>();
<a name="l00284"></a>00284             to = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>();
<a name="l00285"></a>00285             <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; outgoingEdgesOfToNode = to-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>();
<a name="l00286"></a>00286             <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; incomingEdgesOfToNode = to-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>();
<a name="l00287"></a>00287             adjacentNodes.clear();
<a name="l00288"></a>00288             <span class="keywordflow">for</span> (EdgeVector::const_iterator itOfOutgoings = outgoingEdgesOfToNode.begin(); itOfOutgoings != outgoingEdgesOfToNode.end(); ++itOfOutgoings) {
<a name="l00289"></a>00289                 <span class="keywordflow">if</span> ((*itOfOutgoings)-&gt;getToNode() != from        <span class="comment">// The back path</span>
<a name="l00290"></a>00290                         &amp;&amp; (*itOfOutgoings)-&gt;getToNode() != to   <span class="comment">// A loop / dummy edge</span>
<a name="l00291"></a>00291                    ) {
<a name="l00292"></a>00292                     e = *itOfOutgoings; <span class="comment">// Probably the next edge</span>
<a name="l00293"></a>00293                 }
<a name="l00294"></a>00294                 adjacentNodes.insert((*itOfOutgoings)-&gt;getToNode());
<a name="l00295"></a>00295             }
<a name="l00296"></a>00296             <span class="keywordflow">for</span> (EdgeVector::const_iterator itOfIncomings = incomingEdgesOfToNode.begin(); itOfIncomings != incomingEdgesOfToNode.end(); ++itOfIncomings) {
<a name="l00297"></a>00297                 adjacentNodes.insert((*itOfIncomings)-&gt;getFromNode());
<a name="l00298"></a>00298             }
<a name="l00299"></a>00299             adjacentNodes.erase(to);  <span class="comment">// Omit loops</span>
<a name="l00300"></a>00300             <span class="keywordflow">if</span> (adjacentNodes.size() &gt; 2) {
<a name="l00301"></a>00301                 hasJunction = <span class="keyword">true</span>;
<a name="l00302"></a>00302             }
<a name="l00303"></a>00303         } <span class="keywordflow">while</span> (!hasJunction &amp;&amp; eOld != e);
<a name="l00304"></a>00304         <span class="keywordflow">if</span> (!hasJunction) {
<a name="l00305"></a>00305             edgeCounter +=  int(road.size());
<a name="l00306"></a>00306             std::string warningString = <span class="stringliteral">&quot;Removed a road without junctions: &quot;</span>;
<a name="l00307"></a>00307             <span class="keywordflow">for</span> (EdgeVector::iterator roadIt = road.begin(); roadIt != road.end(); ++roadIt) {
<a name="l00308"></a>00308                 <span class="keywordflow">if</span> (roadIt == road.begin()) {
<a name="l00309"></a>00309                     warningString += (*roadIt)-&gt;getID();
<a name="l00310"></a>00310                 } <span class="keywordflow">else</span> {
<a name="l00311"></a>00311                     warningString += <span class="stringliteral">&quot;, &quot;</span> + (*roadIt)-&gt;getID();
<a name="l00312"></a>00312                 }
<a name="l00313"></a>00313 
<a name="l00314"></a>00314                 <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* fromNode = (*roadIt)-&gt;getFromNode();
<a name="l00315"></a>00315                 <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* toNode = (*roadIt)-&gt;getToNode();
<a name="l00316"></a>00316                 ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a40e00f566d26a3ec46c7ee5be1f1e582" title="Removes the given edge from the container (deleting it).">erase</a>(dc, *roadIt);
<a name="l00317"></a>00317                 <span class="keywordflow">if</span> (fromNode-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 0 &amp;&amp; fromNode-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 0) {
<a name="l00318"></a>00318                     <span class="comment">// Node is empty; can be removed</span>
<a name="l00319"></a>00319                     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4522e51f128d7e1bbe4d1acef5ae0fc9" title="Removes the given node, deleting it.">erase</a>(fromNode);
<a name="l00320"></a>00320                 }
<a name="l00321"></a>00321                 <span class="keywordflow">if</span> (toNode-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 0 &amp;&amp; toNode-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 0) {
<a name="l00322"></a>00322                     <span class="comment">// Node is empty; can be removed</span>
<a name="l00323"></a>00323                     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4522e51f128d7e1bbe4d1acef5ae0fc9" title="Removes the given node, deleting it.">erase</a>(toNode);
<a name="l00324"></a>00324                 }
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(warningString);
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328     }
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (edgeCounter &gt; 0 &amp;&amp; !<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().getBool(<span class="stringliteral">&quot;remove-edges.isolated&quot;</span>)) {
<a name="l00330"></a>00330         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Detected isolated roads. Use the option --remove-edges.isolated to get a list of all affected edges.&quot;</span>);
<a name="l00331"></a>00331     }
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a>00334 
<a name="l00335"></a>00335 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00336"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a947487db61d9c91c2093d4768ccd2705">00336</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a947487db61d9c91c2093d4768ccd2705" title="Removes &amp;quot;unwished&amp;quot; nodes.">NBNodeCont::removeUnwishedNodes</a>(<a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec,
<a name="l00337"></a>00337                                 <a class="code" href="../../d3/d95/class_n_b_joined_edges_map.html" title="A structure storing information about which edges were joined.">NBJoinedEdgesMap</a>&amp; je, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc,
<a name="l00338"></a>00338                                 <span class="keywordtype">bool</span> removeGeometryNodes) {
<a name="l00339"></a>00339     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> no = 0;
<a name="l00340"></a>00340     std::vector&lt;NBNode*&gt; toRemove;
<a name="l00341"></a>00341     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00342"></a>00342         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* current = (*i).second;
<a name="l00343"></a>00343         <span class="keywordtype">bool</span> <span class="keyword">remove</span> = <span class="keyword">false</span>;
<a name="l00344"></a>00344         std::vector&lt;std::pair&lt;NBEdge*, NBEdge*&gt; &gt; toJoin;
<a name="l00345"></a>00345         <span class="comment">// check for completely empty nodes</span>
<a name="l00346"></a>00346         <span class="keywordflow">if</span> (current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 0 &amp;&amp; current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 0) {
<a name="l00347"></a>00347             <span class="comment">// remove if empty</span>
<a name="l00348"></a>00348             <span class="keyword">remove</span> = <span class="keyword">true</span>;
<a name="l00349"></a>00349         }
<a name="l00350"></a>00350         <span class="comment">// check for nodes which are only geometry nodes</span>
<a name="l00351"></a>00351         <span class="keywordflow">if</span> (removeGeometryNodes) {
<a name="l00352"></a>00352             <span class="keywordflow">if</span> ((current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 1 &amp;&amp; current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 1)
<a name="l00353"></a>00353                     ||
<a name="l00354"></a>00354                     (current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 2 &amp;&amp; current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 2)) {
<a name="l00355"></a>00355                 <span class="comment">// ok, one in, one out or two in, two out</span>
<a name="l00356"></a>00356                 <span class="comment">//  -&gt; ask the node whether to join</span>
<a name="l00357"></a>00357                 <span class="keyword">remove</span> = current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a10c5858530c9b6ef5c23625d00160c20">checkIsRemovable</a>();
<a name="l00358"></a>00358                 <span class="keywordflow">if</span> (<span class="keyword">remove</span>) {
<a name="l00359"></a>00359                     toJoin = current-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8adf5404c80118f5327efaf32994f265">getEdgesToJoin</a>();
<a name="l00360"></a>00360                 }
<a name="l00361"></a>00361             }
<a name="l00362"></a>00362         }
<a name="l00363"></a>00363         <span class="comment">// remove the node and join the geometries when wished</span>
<a name="l00364"></a>00364         <span class="keywordflow">if</span> (!<span class="keyword">remove</span>) {
<a name="l00365"></a>00365             <span class="keywordflow">continue</span>;
<a name="l00366"></a>00366         }
<a name="l00367"></a>00367         <span class="keywordflow">for</span> (std::vector&lt;std::pair&lt;NBEdge*, NBEdge*&gt; &gt;::iterator j = toJoin.begin(); j != toJoin.end(); j++) {
<a name="l00368"></a>00368             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a503d8aedca02fb67ac46d906b4560f17" title="Returns the pointer to the begin of the stored nodes.">begin</a> = (*j).first;
<a name="l00369"></a>00369             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* continuation = (*j).second;
<a name="l00370"></a>00370             begin-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#af94cd1f2c0df6f17511f16d5594bb769">append</a>(continuation);
<a name="l00371"></a>00371             continuation-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>()-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a3246b849700a2347a8e2297c8c0752a8" title="Replaces occurences of the first edge within the list of incoming by the second Connections...">replaceIncoming</a>(continuation, begin, 0);
<a name="l00372"></a>00372             tlc.<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html#a5de29b861dac3e36da6bbbc90a2e01a8" title="Replaces occurences of the removed edge/lane in all definitions by the given edge...">replaceRemoved</a>(continuation, -1, begin, -1);
<a name="l00373"></a>00373             je.<a class="code" href="../../d3/d95/class_n_b_joined_edges_map.html#af57ea9b9e73ad71a8676482c97d0735c" title="Informs the map that two edges have been joined.">appended</a>(begin-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>(), continuation-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>());
<a name="l00374"></a>00374             ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a40e00f566d26a3ec46c7ee5be1f1e582" title="Removes the given edge from the container (deleting it).">erase</a>(dc, continuation);
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376         toRemove.push_back(current);
<a name="l00377"></a>00377         no++;
<a name="l00378"></a>00378     }
<a name="l00379"></a>00379     <span class="comment">// erase all</span>
<a name="l00380"></a>00380     <span class="keywordflow">for</span> (std::vector&lt;NBNode*&gt;::iterator j = toRemove.begin(); j != toRemove.end(); ++j) {
<a name="l00381"></a>00381         <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4522e51f128d7e1bbe4d1acef5ae0fc9" title="Removes the given node, deleting it.">erase</a>(*j);
<a name="l00382"></a>00382     }
<a name="l00383"></a>00383     <span class="keywordflow">return</span> no;
<a name="l00384"></a>00384 }
<a name="l00385"></a>00385 
<a name="l00386"></a>00386 
<a name="l00387"></a>00387 <span class="comment">// ----------- (Helper) methods for joining nodes</span>
<a name="l00388"></a>00388 <span class="keywordtype">void</span>
<a name="l00389"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0776cc0218451a27170ae359f2bdb19d">00389</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0776cc0218451a27170ae359f2bdb19d" title="Builds node clusters.">NBNodeCont::generateNodeClusters</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> maxDist, NodeClusters&amp; into)<span class="keyword"> const </span>{
<a name="l00390"></a>00390     std::set&lt;NBNode*&gt; visited;
<a name="l00391"></a>00391     <span class="keywordflow">for</span> (NodeCont::const_iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00392"></a>00392         std::vector&lt;NBNode*&gt; toProc;
<a name="l00393"></a>00393         <span class="keywordflow">if</span> (visited.find((*i).second) != visited.end()) {
<a name="l00394"></a>00394             <span class="keywordflow">continue</span>;
<a name="l00395"></a>00395         }
<a name="l00396"></a>00396         toProc.push_back((*i).second);
<a name="l00397"></a>00397         std::set&lt;NBNode*&gt; c;
<a name="l00398"></a>00398         <span class="keywordflow">while</span> (!toProc.empty()) {
<a name="l00399"></a>00399             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* n = toProc.back();
<a name="l00400"></a>00400             toProc.pop_back();
<a name="l00401"></a>00401             <span class="keywordflow">if</span> (visited.find(n) != visited.end()) {
<a name="l00402"></a>00402                 <span class="keywordflow">continue</span>;
<a name="l00403"></a>00403             }
<a name="l00404"></a>00404             c.insert(n);
<a name="l00405"></a>00405             visited.insert(n);
<a name="l00406"></a>00406             <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; edges = n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#aa91df34f7412f2bdb5ce116274a51196" title="Returns all edges which participate in this node.">getEdges</a>();
<a name="l00407"></a>00407             <span class="keywordflow">for</span> (EdgeVector::const_iterator j = edges.begin(); j != edges.end(); ++j) {
<a name="l00408"></a>00408                 <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* e = *j;
<a name="l00409"></a>00409                 <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* s = 0;
<a name="l00410"></a>00410                 <span class="keywordflow">if</span> (n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a386dcd34fa654a46a77992b1291fe66f" title="Returns whether the given edge ends at this node.">hasIncoming</a>(e)) {
<a name="l00411"></a>00411                     s = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>();
<a name="l00412"></a>00412                 } <span class="keywordflow">else</span> {
<a name="l00413"></a>00413                     s = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>();
<a name="l00414"></a>00414                 }
<a name="l00415"></a>00415                 <span class="keywordflow">if</span> (visited.find(s) != visited.end()) {
<a name="l00416"></a>00416                     <span class="keywordflow">continue</span>;
<a name="l00417"></a>00417                 }
<a name="l00418"></a>00418                 <span class="keywordflow">if</span> (n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#aaa1d5d9e58bc203fceee0002563c3bc2" title="returns the euclidean distance in 3 dimension">distanceTo</a>(s-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>()) &lt; maxDist) {
<a name="l00419"></a>00419                     toProc.push_back(s);
<a name="l00420"></a>00420                 }
<a name="l00421"></a>00421             }
<a name="l00422"></a>00422         }
<a name="l00423"></a>00423         <span class="keywordflow">if</span> (c.size() &lt; 2) {
<a name="l00424"></a>00424             <span class="keywordflow">continue</span>;
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426         into.push_back(c);
<a name="l00427"></a>00427     }
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a>00430 
<a name="l00431"></a>00431 <span class="keywordtype">void</span>
<a name="l00432"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a31939422980b7db3398cf01467c6b029">00432</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a31939422980b7db3398cf01467c6b029">NBNodeCont::addJoinExclusion</a>(<span class="keyword">const</span> std::vector&lt;std::string&gt; &amp;ids, <span class="keywordtype">bool</span> check) {
<a name="l00433"></a>00433     <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator it = ids.begin(); it != ids.end(); it++) {
<a name="l00434"></a>00434         <span class="comment">// error handling has to take place here since joinExclusions could be</span>
<a name="l00435"></a>00435         <span class="comment">// loaded from multiple files / command line</span>
<a name="l00436"></a>00436         <span class="keywordflow">if</span> (<a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae53550977589cf182b10d9e10299ad17" title="ids found in loaded join clusters used for error checking">myJoined</a>.count(*it) &gt; 0) {
<a name="l00437"></a>00437             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Ignoring join exclusion for node &#39;&quot;</span> + *it +  <span class="stringliteral">&quot;&#39; since it already occured in a list of nodes to be joined&quot;</span>);
<a name="l00438"></a>00438         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (check &amp;&amp; <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">retrieve</a>(*it) == 0) {
<a name="l00439"></a>00439             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Ignoring join exclusion for unknown node &#39;&quot;</span> + *it + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00440"></a>00440         } <span class="keywordflow">else</span> {
<a name="l00441"></a>00441             <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a01182e7f1b3c7e75888fb1a4eb14ba70">myJoinExclusions</a>.insert(*it);
<a name="l00442"></a>00442         }
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 
<a name="l00447"></a>00447 <span class="keywordtype">void</span>
<a name="l00448"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a5947c9601792a49a46e034a110c949a2">00448</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a5947c9601792a49a46e034a110c949a2" title="add ids of nodes which shall be joined into a single node">NBNodeCont::addCluster2Join</a>(std::set&lt;std::string&gt; cluster) {
<a name="l00449"></a>00449     <span class="comment">// error handling has to take place here since joins could be loaded from multiple files</span>
<a name="l00450"></a>00450     <span class="keywordflow">for</span> (std::set&lt;std::string&gt;::const_iterator it = cluster.begin(); it != cluster.end(); it++) {
<a name="l00451"></a>00451         <span class="keywordflow">if</span> (<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a01182e7f1b3c7e75888fb1a4eb14ba70">myJoinExclusions</a>.count(*it) &gt; 0) {
<a name="l00452"></a>00452             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Ignoring join-cluster because node &#39;&quot;</span> + *it + <span class="stringliteral">&quot;&#39; was already excluded from joining&quot;</span>);
<a name="l00453"></a>00453             <span class="keywordflow">return</span>;
<a name="l00454"></a>00454         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae53550977589cf182b10d9e10299ad17" title="ids found in loaded join clusters used for error checking">myJoined</a>.count(*it) &gt; 0) {
<a name="l00455"></a>00455             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Ignoring join-cluster because node &#39;&quot;</span> + *it + <span class="stringliteral">&quot;&#39; already occured in another join-cluster&quot;</span>);
<a name="l00456"></a>00456             <span class="keywordflow">return</span>;
<a name="l00457"></a>00457         } <span class="keywordflow">else</span> {
<a name="l00458"></a>00458             <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae53550977589cf182b10d9e10299ad17" title="ids found in loaded join clusters used for error checking">myJoined</a>.insert(*it);
<a name="l00459"></a>00459         }
<a name="l00460"></a>00460     }
<a name="l00461"></a>00461     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#aadcb59ff93ce978afdae4dcdade97db0">myClusters2Join</a>.push_back(cluster);
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a>00464 
<a name="l00465"></a>00465 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00466"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4a3c0a7bf1f6c2f7b35e5f02155ed1c7">00466</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4a3c0a7bf1f6c2f7b35e5f02155ed1c7" title="Joins loaded junction clusters (see NIXMLNodesHandler).">NBNodeCont::joinLoadedClusters</a>(<a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc) {
<a name="l00467"></a>00467     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#af1353ca920c77fd84edb996990f3814c" title="Definition of a node cluster container.">NodeClusters</a> clusters;
<a name="l00468"></a>00468     <span class="keywordflow">for</span> (std::vector&lt;std::set&lt;std::string&gt; &gt;::iterator it = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#aadcb59ff93ce978afdae4dcdade97db0">myClusters2Join</a>.begin(); it != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#aadcb59ff93ce978afdae4dcdade97db0">myClusters2Join</a>.end(); it++) {
<a name="l00469"></a>00469         <span class="comment">// verify loaded cluster</span>
<a name="l00470"></a>00470         std::set&lt;NBNode*&gt; cluster;
<a name="l00471"></a>00471         <span class="keywordflow">for</span> (std::set&lt;std::string&gt;::iterator it_id = it-&gt;begin(); it_id != it-&gt;end(); it_id++) {
<a name="l00472"></a>00472             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">retrieve</a>(*it_id);
<a name="l00473"></a>00473             <span class="keywordflow">if</span> (node == 0) {
<a name="l00474"></a>00474                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Ignoring unknown node &#39;&quot;</span> + *it_id + <span class="stringliteral">&quot;&#39; while joining&quot;</span>);
<a name="l00475"></a>00475             } <span class="keywordflow">else</span> {
<a name="l00476"></a>00476                 cluster.insert(node);
<a name="l00477"></a>00477             }
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479         <span class="keywordflow">if</span> (cluster.size() &gt; 1) {
<a name="l00480"></a>00480             clusters.push_back(cluster);
<a name="l00481"></a>00481         }
<a name="l00482"></a>00482     }
<a name="l00483"></a>00483     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4b068186c621032ae4a13035a309ee0b">joinNodeClusters</a>(clusters, dc, ec, tlc);
<a name="l00484"></a>00484     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)clusters.size();
<a name="l00485"></a>00485 }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487 
<a name="l00488"></a>00488 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>
<a name="l00489"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a58192ee9d1d9c9e06364d6741df6ea52">00489</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a58192ee9d1d9c9e06364d6741df6ea52" title="Joins junctions that are very close together.">NBNodeCont::joinJunctions</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> maxdist, <a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc) {
<a name="l00490"></a>00490     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#af1353ca920c77fd84edb996990f3814c" title="Definition of a node cluster container.">NodeClusters</a> cands;
<a name="l00491"></a>00491     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#af1353ca920c77fd84edb996990f3814c" title="Definition of a node cluster container.">NodeClusters</a> clusters;
<a name="l00492"></a>00492     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0776cc0218451a27170ae359f2bdb19d" title="Builds node clusters.">generateNodeClusters</a>(maxdist, cands);
<a name="l00493"></a>00493     <span class="keywordflow">for</span> (NodeClusters::iterator i = cands.begin(); i != cands.end(); ++i) {
<a name="l00494"></a>00494         <span class="keyword">const</span> std::set&lt;NBNode*&gt; &amp;candCluster = (*i);
<a name="l00495"></a>00495         std::set&lt;NBNode*&gt; cluster;
<a name="l00496"></a>00496         <span class="comment">// remove nodes with degree = 2 at fringe of the cluster (at least one edge leads to a non-cluster node)</span>
<a name="l00497"></a>00497         <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::const_iterator j = candCluster.begin(); j != candCluster.end(); j++) {
<a name="l00498"></a>00498             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* n = *j;
<a name="l00499"></a>00499             <span class="keywordflow">if</span> (n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 1 &amp;&amp;
<a name="l00500"></a>00500                     n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 1 &amp;&amp;
<a name="l00501"></a>00501                     (!cluster.count(n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>()[0]-&gt;getFromNode()) ||
<a name="l00502"></a>00502                      !cluster.count(n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>()[0]-&gt;getToNode()))) {
<a name="l00503"></a>00503                 <span class="keywordflow">continue</span>;
<a name="l00504"></a>00504             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a01182e7f1b3c7e75888fb1a4eb14ba70">myJoinExclusions</a>.count(n-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>()) &gt; 0) {
<a name="l00505"></a>00505                 <span class="keywordflow">continue</span>;
<a name="l00506"></a>00506             } <span class="keywordflow">else</span> {
<a name="l00507"></a>00507                 cluster.insert(n);
<a name="l00508"></a>00508             }
<a name="l00509"></a>00509         }
<a name="l00510"></a>00510         <span class="keywordflow">if</span> (cluster.size() &gt; 1) {
<a name="l00511"></a>00511             clusters.push_back(cluster);
<a name="l00512"></a>00512         }
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4b068186c621032ae4a13035a309ee0b">joinNodeClusters</a>(clusters, dc, ec, tlc);
<a name="l00515"></a>00515     <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)clusters.size();
<a name="l00516"></a>00516 }
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 <span class="keywordtype">void</span>
<a name="l00520"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4b068186c621032ae4a13035a309ee0b">00520</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4b068186c621032ae4a13035a309ee0b">NBNodeCont::joinNodeClusters</a>(NodeClusters clusters,
<a name="l00521"></a>00521                              <a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc) {
<a name="l00522"></a>00522     <span class="keywordflow">for</span> (NodeClusters::iterator i = clusters.begin(); i != clusters.end(); ++i) {
<a name="l00523"></a>00523         std::set&lt;NBNode*&gt; cluster = *i;
<a name="l00524"></a>00524         assert(cluster.size() &gt; 1);
<a name="l00525"></a>00525         <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a> pos;
<a name="l00526"></a>00526         <span class="keywordtype">bool</span> setTL;
<a name="l00527"></a>00527         std::string id;
<a name="l00528"></a>00528         <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a059c464399638f2906d884eaeb33ebeb">analyzeCluster</a>(cluster, <span class="keywordtype">id</span>, pos, setTL);
<a name="l00529"></a>00529         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">insert</a>(<span class="keywordtype">id</span>, pos)) {
<a name="l00530"></a>00530             <span class="comment">// should not fail</span>
<a name="l00531"></a>00531             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Could not join junctions &quot;</span> + <span class="keywordtype">id</span>);
<a name="l00532"></a>00532             <span class="keywordflow">continue</span>;
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* newNode = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">retrieve</a>(<span class="keywordtype">id</span>);
<a name="l00535"></a>00535         <span class="keywordflow">if</span> (setTL) {
<a name="l00536"></a>00536             <a class="code" href="../../d3/de8/class_n_b_traffic_light_definition.html" title="The base class for traffic light logic definitions.">NBTrafficLightDefinition</a>* tlDef = <span class="keyword">new</span> <a class="code" href="../../d3/dfe/class_n_b_own_t_l_def.html" title="A traffic light logics which must be computed (only nodes/edges are given).">NBOwnTLDef</a>(<span class="keywordtype">id</span>, newNode);
<a name="l00537"></a>00537             <span class="keywordflow">if</span> (!tlc.<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html#ae5230d7284321706e0fd811bc6ef8878" title="Adds a logic definition to the dictionary.">insert</a>(tlDef)) {
<a name="l00538"></a>00538                 <span class="comment">// actually, nothing should fail here</span>
<a name="l00539"></a>00539                 <span class="keyword">delete</span> tlDef;
<a name="l00540"></a>00540                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not allocate tls &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00541"></a>00541             }
<a name="l00542"></a>00542         }
<a name="l00543"></a>00543         <span class="comment">// collect edges</span>
<a name="l00544"></a>00544         std::set&lt;NBEdge*&gt; allEdges;
<a name="l00545"></a>00545         <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::const_iterator j=cluster.begin(); j!=cluster.end(); ++j) {
<a name="l00546"></a>00546             <span class="keyword">const</span> std::vector&lt;NBEdge*&gt; &amp;edges = (*j)-&gt;getEdges();
<a name="l00547"></a>00547             allEdges.insert(edges.begin(), edges.end());
<a name="l00548"></a>00548         }
<a name="l00549"></a>00549 
<a name="l00550"></a>00550         <span class="comment">// remap and remove edges which are completely within the new intersection</span>
<a name="l00551"></a>00551         <span class="keywordflow">for</span>(std::set&lt;NBEdge*&gt;::iterator j=allEdges.begin(); j!=allEdges.end();) {
<a name="l00552"></a>00552             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a> *e = (*j);
<a name="l00553"></a>00553             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a> *from = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>();
<a name="l00554"></a>00554             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a> *to = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>();
<a name="l00555"></a>00555             <span class="keywordflow">if</span>(cluster.count(from) &gt; 0 &amp;&amp; cluster.count(to) &gt; 0) {
<a name="l00556"></a>00556                 <span class="keywordflow">for</span>(std::set&lt;NBEdge*&gt;::iterator l=allEdges.begin(); l!=allEdges.end(); ++l) {
<a name="l00557"></a>00557                     <span class="keywordflow">if</span>(e != *l) {
<a name="l00558"></a>00558                         (*l)-&gt;replaceInConnections(e, e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a813dd5cc3d4ab76efd91b8c3a2dc3698" title="Returns the connections.">getConnections</a>());
<a name="l00559"></a>00559                     }
<a name="l00560"></a>00560                 }
<a name="l00561"></a>00561                 ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a40e00f566d26a3ec46c7ee5be1f1e582" title="Removes the given edge from the container (deleting it).">erase</a>(dc, e);
<a name="l00562"></a>00562                 allEdges.erase(j++); <span class="comment">// erase does not invalidate the other iterators</span>
<a name="l00563"></a>00563             } <span class="keywordflow">else</span> {
<a name="l00564"></a>00564                 ++j;
<a name="l00565"></a>00565             }
<a name="l00566"></a>00566         }
<a name="l00567"></a>00567 
<a name="l00568"></a>00568         <span class="comment">// remap edges which are incoming / outgoing</span>
<a name="l00569"></a>00569         <span class="keywordflow">for</span>(std::set&lt;NBEdge*&gt;::iterator j=allEdges.begin(); j!=allEdges.end(); ++j) {
<a name="l00570"></a>00570             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a> *e = (*j);
<a name="l00571"></a>00571             std::vector&lt;NBEdge::Connection&gt; conns = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a813dd5cc3d4ab76efd91b8c3a2dc3698" title="Returns the connections.">getConnections</a>();
<a name="l00572"></a>00572             <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> g = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l00573"></a>00573             <span class="keyword">const</span> <span class="keywordtype">bool</span> outgoing = cluster.count(e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>()) &gt; 0;
<a name="l00574"></a>00574             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a> *from = outgoing ? newNode : e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>();
<a name="l00575"></a>00575             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a> *to   = outgoing ? e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>() : newNode;
<a name="l00576"></a>00576             e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a4ea1793400d77a6df985b62eef121e7a" title="Resets initial values.">reinit</a>(from, to, e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a1c0b27336ef2000e583350fda4dd75ab">getTypeID</a>(), e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>(),
<a name="l00577"></a>00577                 e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ae3863d2a0e00bb37e381700a40729a07" title="Returns the priority of the edge.">getPriority</a>(), e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>(),
<a name="l00578"></a>00578                 e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a76365bca31a9dae5dfcf9f78b7840860" title="Returns the width of lanes of this edge.">getWidth</a>(), e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a739a05f7e06254fb93c67cc1b8045023" title="Returns the offset to the destination node.">getOffset</a>(), e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a60a30ff9f2d4daa4e9a373ec9f61a15a" title="Returns the street name of this edge.">getStreetName</a>(), e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a09d24489f2a16fe97a1aba71c8c7e644" title="Returns how this edge&amp;#39;s lanes&amp;#39; lateral offset is computed.">getLaneSpreadFunction</a>());
<a name="l00579"></a>00579             e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(g);
<a name="l00580"></a>00580             <span class="keywordflow">for</span>(std::vector&lt;NBEdge::Connection&gt;::iterator k=conns.begin(); k!=conns.end(); ++k) {
<a name="l00581"></a>00581                 e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#af27bdeb8f823e2a36cbe8784d9a514bb" title="Adds a connection between the specified this edge&amp;#39;s lane and an approached one...">addLane2LaneConnection</a>((*k).fromLane, (*k).toEdge, (*k).toLane, <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2ab1de8d5b04c54302a264f65ecc4c2c4d" title="The connection was given by the user.">NBEdge::L2L_USER</a>, <span class="keyword">false</span>, (*k).mayDefinitelyPass);
<a name="l00582"></a>00582             }
<a name="l00583"></a>00583         }
<a name="l00584"></a>00584     }
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586 
<a name="l00587"></a>00587 
<a name="l00588"></a>00588 <span class="keywordtype">void</span>
<a name="l00589"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a059c464399638f2906d884eaeb33ebeb">00589</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a059c464399638f2906d884eaeb33ebeb">NBNodeCont::analyzeCluster</a>(std::set&lt;NBNode*&gt; cluster, std::string&amp; <span class="keywordtype">id</span>, <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>&amp; pos, <span class="keywordtype">bool</span>&amp; hasTLS) {
<a name="l00590"></a>00590     <span class="keywordtype">id</span> = <span class="stringliteral">&quot;cluster&quot;</span>;
<a name="l00591"></a>00591     hasTLS = <span class="keyword">false</span>;
<a name="l00592"></a>00592     std::vector&lt;std::string&gt; member_ids;
<a name="l00593"></a>00593     <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::const_iterator j = cluster.begin(); j != cluster.end(); j++) {
<a name="l00594"></a>00594         member_ids.push_back((*j)-&gt;getID());
<a name="l00595"></a>00595         pos.<a class="code" href="../../d7/d3b/class_position.html#aa7f28af16b3c5e4396560db99d746389" title="Adds the given position to this one.">add</a>((*j)-&gt;getPosition());
<a name="l00596"></a>00596         <span class="comment">// add a traffic light if any of the cluster members was controlled</span>
<a name="l00597"></a>00597         <span class="keywordflow">if</span> ((*j)-&gt;isTLControlled()) {
<a name="l00598"></a>00598             hasTLS = <span class="keyword">true</span>;
<a name="l00599"></a>00599         }
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601     pos.<a class="code" href="../../d7/d3b/class_position.html#a58b8892ee65bcc05619d93f987cac82b" title="Multiplies both positions with the given value.">mul</a>(1.0 / cluster.size());
<a name="l00602"></a>00602     <span class="comment">// need to sort the member names to make the output deterministic</span>
<a name="l00603"></a>00603     sort(member_ids.begin(), member_ids.end());
<a name="l00604"></a>00604     <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::iterator j = member_ids.begin(); j != member_ids.end(); j++) {
<a name="l00605"></a>00605         <span class="keywordtype">id</span> = <span class="keywordtype">id</span> + <span class="stringliteral">&quot;_&quot;</span> + (*j);
<a name="l00606"></a>00606     }
<a name="l00607"></a>00607 }
<a name="l00608"></a>00608 
<a name="l00609"></a>00609 
<a name="l00610"></a>00610 <span class="comment">// ----------- (Helper) methods for guessing/computing traffic lights</span>
<a name="l00611"></a>00611 <span class="keywordtype">bool</span>
<a name="l00612"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4582742d201ce1d8491faa2351cfa7fc">00612</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4582742d201ce1d8491faa2351cfa7fc" title="Returns whethe the given node cluster should be controlled by a tls.">NBNodeCont::shouldBeTLSControlled</a>(<span class="keyword">const</span> std::set&lt;NBNode*&gt; &amp;c)<span class="keyword"> const </span>{
<a name="l00613"></a>00613     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> noIncoming = 0;
<a name="l00614"></a>00614     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> noOutgoing = 0;
<a name="l00615"></a>00615     <span class="keywordtype">bool</span> tooFast = <span class="keyword">false</span>;
<a name="l00616"></a>00616     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> f = 0;
<a name="l00617"></a>00617     std::set&lt;NBEdge*&gt; seen;
<a name="l00618"></a>00618     <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::const_iterator j = c.begin(); j != c.end(); ++j) {
<a name="l00619"></a>00619         <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; edges = (*j)-&gt;getEdges();
<a name="l00620"></a>00620         <span class="keywordflow">for</span> (EdgeVector::const_iterator k = edges.begin(); k != edges.end(); ++k) {
<a name="l00621"></a>00621             <span class="keywordflow">if</span> (c.find((*k)-&gt;getFromNode()) != c.end() &amp;&amp; c.find((*k)-&gt;getToNode()) != c.end()) {
<a name="l00622"></a>00622                 <span class="keywordflow">continue</span>;
<a name="l00623"></a>00623             }
<a name="l00624"></a>00624             <span class="keywordflow">if</span> ((*j)-&gt;hasIncoming(*k)) {
<a name="l00625"></a>00625                 ++noIncoming;
<a name="l00626"></a>00626                 f += (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(*k)-&gt;getNumLanes() * (*k)-&gt;getLaneSpeed(0);
<a name="l00627"></a>00627             } <span class="keywordflow">else</span> {
<a name="l00628"></a>00628                 ++noOutgoing;
<a name="l00629"></a>00629             }
<a name="l00630"></a>00630             <span class="keywordflow">if</span> ((*k)-&gt;getLaneSpeed(0) * 3.6 &gt; 79) {
<a name="l00631"></a>00631                 tooFast = <span class="keyword">true</span>;
<a name="l00632"></a>00632             }
<a name="l00633"></a>00633         }
<a name="l00634"></a>00634     }
<a name="l00635"></a>00635     <span class="keywordflow">return</span> !tooFast &amp;&amp; f &gt;= 150. / 3.6 &amp;&amp; c.size() != 0;
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="keywordtype">void</span>
<a name="l00640"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#acd3a1c17a67e153733048c4c0f72a115">00640</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#acd3a1c17a67e153733048c4c0f72a115" title="Guesses which junctions or junction clusters shall be controlled by tls.">NBNodeCont::guessTLs</a>(<a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc) {
<a name="l00641"></a>00641     <span class="comment">// build list of definitely not tls-controlled junctions</span>
<a name="l00642"></a>00642     std::vector&lt;NBNode*&gt; ncontrolled;
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (oc.<a class="code" href="../../db/d31/class_options_cont.html#a08a62e1f4fcf9acaefc97efce45609fc" title="Returns the information whether the named option is set.">isSet</a>(<span class="stringliteral">&quot;tls.unset&quot;</span>)) {
<a name="l00644"></a>00644         std::vector&lt;std::string&gt; notTLControlledNodes = oc.<a class="code" href="../../db/d31/class_options_cont.html#a6713cebc23d2e3a88f8a00942e4fee32" title="Returns the list of string-vector-value of the named option (only for Option_String)...">getStringVector</a>(<span class="stringliteral">&quot;tls.unset&quot;</span>);
<a name="l00645"></a>00645         <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator i = notTLControlledNodes.begin(); i != notTLControlledNodes.end(); ++i) {
<a name="l00646"></a>00646             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* n = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">NBNodeCont::retrieve</a>(*i);
<a name="l00647"></a>00647             <span class="keywordflow">if</span> (n == 0) {
<a name="l00648"></a>00648                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot; The node &#39;&quot;</span> + *i + <span class="stringliteral">&quot;&#39; to set as not-controlled is not known.&quot;</span>);
<a name="l00649"></a>00649             }
<a name="l00650"></a>00650             std::set&lt;NBTrafficLightDefinition*&gt; tls = n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a82d706679af70124d929bfe642aba13c" title="Returns the traffic lights that were assigned to this node.">getControllingTLS</a>();
<a name="l00651"></a>00651             <span class="keywordflow">for</span> (std::set&lt;NBTrafficLightDefinition*&gt;::const_iterator j = tls.begin(); j != tls.end(); ++j) {
<a name="l00652"></a>00652                 (*j)-&gt;removeNode(n);
<a name="l00653"></a>00653             }
<a name="l00654"></a>00654             n-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a94eecc6847719ab5672cbc6ab51dc430" title="Removes all references to traffic lights that control this tls.">removeTrafficLights</a>();
<a name="l00655"></a>00655             ncontrolled.push_back(n);
<a name="l00656"></a>00656         }
<a name="l00657"></a>00657     }
<a name="l00658"></a>00658 
<a name="l00659"></a>00659     <span class="comment">// loop#1 checking whether the node shall be tls controlled,</span>
<a name="l00660"></a>00660     <span class="comment">//  because it is assigned to a district</span>
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (oc.<a class="code" href="../../db/d31/class_options_cont.html#adcc78690a74f38e25ab15cb4cabcf8c6" title="Returns the information whether the named option is known.">exists</a>(<span class="stringliteral">&quot;tls.taz-nodes&quot;</span>) &amp;&amp; oc.<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;tls.taz-nodes&quot;</span>)) {
<a name="l00662"></a>00662         <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00663"></a>00663             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* cur = (*i).second;
<a name="l00664"></a>00664             <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a02dd480f3582912cb466098ebc60f8f2">isNearDistrict</a>() &amp;&amp; find(ncontrolled.begin(), ncontrolled.end(), cur) == ncontrolled.end()) {
<a name="l00665"></a>00665                 <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a3e80fe24762099d8b561cdf03ea0145f" title="Sets the given node as being controlled by a tls.">setAsTLControlled</a>(cur, tlc);
<a name="l00666"></a>00666             }
<a name="l00667"></a>00667         }
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670     <span class="comment">// maybe no tls shall be guessed</span>
<a name="l00671"></a>00671     <span class="keywordflow">if</span> (!oc.<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;tls.guess&quot;</span>)) {
<a name="l00672"></a>00672         <span class="keywordflow">return</span>;
<a name="l00673"></a>00673     }
<a name="l00674"></a>00674 
<a name="l00675"></a>00675     <span class="comment">// guess joined tls first, if wished</span>
<a name="l00676"></a>00676     <span class="keywordflow">if</span> (oc.<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;tls-guess.joining&quot;</span>)) {
<a name="l00677"></a>00677         <span class="comment">// get node clusters</span>
<a name="l00678"></a>00678         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> MAXDIST = 25;
<a name="l00679"></a>00679         std::vector&lt;std::set&lt;NBNode*&gt; &gt; cands;
<a name="l00680"></a>00680         <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0776cc0218451a27170ae359f2bdb19d" title="Builds node clusters.">generateNodeClusters</a>(MAXDIST, cands);
<a name="l00681"></a>00681         <span class="comment">// check these candidates (clusters) whether they should be controlled by a tls</span>
<a name="l00682"></a>00682         <span class="keywordflow">for</span> (std::vector&lt;std::set&lt;NBNode*&gt; &gt;::iterator i = cands.begin(); i != cands.end();) {
<a name="l00683"></a>00683             std::set&lt;NBNode*&gt; &amp;c = (*i);
<a name="l00684"></a>00684             <span class="comment">// regard only junctions which are not yet controlled and are not</span>
<a name="l00685"></a>00685             <span class="comment">//  forbidden to be controlled</span>
<a name="l00686"></a>00686             <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::iterator j = c.begin(); j != c.end();) {
<a name="l00687"></a>00687                 <span class="keywordflow">if</span> ((*j)-&gt;isTLControlled() || find(ncontrolled.begin(), ncontrolled.end(), *j) != ncontrolled.end()) {
<a name="l00688"></a>00688                     c.erase(j++);
<a name="l00689"></a>00689                 } <span class="keywordflow">else</span> {
<a name="l00690"></a>00690                     ++j;
<a name="l00691"></a>00691                 }
<a name="l00692"></a>00692             }
<a name="l00693"></a>00693             <span class="comment">// check whether the cluster should be controlled</span>
<a name="l00694"></a>00694             <span class="keywordflow">if</span> (!<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4582742d201ce1d8491faa2351cfa7fc" title="Returns whethe the given node cluster should be controlled by a tls.">shouldBeTLSControlled</a>(c)) {
<a name="l00695"></a>00695                 i = cands.erase(i);
<a name="l00696"></a>00696             } <span class="keywordflow">else</span> {
<a name="l00697"></a>00697                 ++i;
<a name="l00698"></a>00698             }
<a name="l00699"></a>00699         }
<a name="l00700"></a>00700         <span class="comment">// cands now only contain sets of junctions that shall be joined into being tls-controlled</span>
<a name="l00701"></a>00701         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
<a name="l00702"></a>00702         <span class="keywordflow">for</span> (std::vector&lt;std::set&lt;NBNode*&gt; &gt;::iterator i = cands.begin(); i != cands.end(); ++i) {
<a name="l00703"></a>00703             std::vector&lt;NBNode*&gt; nodes;
<a name="l00704"></a>00704             <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::iterator j = (*i).begin(); j != (*i).end(); j++) {
<a name="l00705"></a>00705                 nodes.push_back(*j);
<a name="l00706"></a>00706             }
<a name="l00707"></a>00707             std::string <span class="keywordtype">id</span> = <span class="stringliteral">&quot;joinedG_&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(index++);
<a name="l00708"></a>00708             <a class="code" href="../../d3/de8/class_n_b_traffic_light_definition.html" title="The base class for traffic light logic definitions.">NBTrafficLightDefinition</a>* tlDef = <span class="keyword">new</span> <a class="code" href="../../d3/dfe/class_n_b_own_t_l_def.html" title="A traffic light logics which must be computed (only nodes/edges are given).">NBOwnTLDef</a>(<span class="keywordtype">id</span>, nodes);
<a name="l00709"></a>00709             <span class="keywordflow">if</span> (!tlc.<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html#ae5230d7284321706e0fd811bc6ef8878" title="Adds a logic definition to the dictionary.">insert</a>(tlDef)) {
<a name="l00710"></a>00710                 <span class="comment">// actually, nothing should fail here</span>
<a name="l00711"></a>00711                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Could not build guessed, joined tls&quot;</span>);
<a name="l00712"></a>00712                 <span class="keyword">delete</span> tlDef;
<a name="l00713"></a>00713                 <span class="keywordflow">return</span>;
<a name="l00714"></a>00714             }
<a name="l00715"></a>00715         }
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717 
<a name="l00718"></a>00718     <span class="comment">// guess tls</span>
<a name="l00719"></a>00719     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00720"></a>00720         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* cur = (*i).second;
<a name="l00721"></a>00721         <span class="comment">//  do nothing if already is tl-controlled</span>
<a name="l00722"></a>00722         <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#aefa16e066da9a4ca84252f0ee5e32a8a" title="Returns whether this node is controlled by any tls.">isTLControlled</a>()) {
<a name="l00723"></a>00723             <span class="keywordflow">continue</span>;
<a name="l00724"></a>00724         }
<a name="l00725"></a>00725         <span class="comment">// do nothing if in the list of explicit non-controlled junctions</span>
<a name="l00726"></a>00726         <span class="keywordflow">if</span> (find(ncontrolled.begin(), ncontrolled.end(), cur) != ncontrolled.end()) {
<a name="l00727"></a>00727             <span class="keywordflow">continue</span>;
<a name="l00728"></a>00728         }
<a name="l00729"></a>00729         std::set&lt;NBNode*&gt; c;
<a name="l00730"></a>00730         c.insert(cur);
<a name="l00731"></a>00731         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4582742d201ce1d8491faa2351cfa7fc" title="Returns whethe the given node cluster should be controlled by a tls.">shouldBeTLSControlled</a>(c) || cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() &lt; 3) {
<a name="l00732"></a>00732             <span class="keywordflow">continue</span>;
<a name="l00733"></a>00733         }
<a name="l00734"></a>00734         <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a3e80fe24762099d8b561cdf03ea0145f" title="Sets the given node as being controlled by a tls.">setAsTLControlled</a>((*i).second, tlc);
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736 }
<a name="l00737"></a>00737 
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 <span class="keywordtype">void</span>
<a name="l00740"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae69e4206583d1ff3edd66c059de1045d">00740</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae69e4206583d1ff3edd66c059de1045d" title="Builds clusters of tls-controlled junctions and joins the control if possible.">NBNodeCont::joinTLS</a>(<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc) {
<a name="l00741"></a>00741     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> MAXDIST = 25;
<a name="l00742"></a>00742     std::vector&lt;std::set&lt;NBNode*&gt; &gt; cands;
<a name="l00743"></a>00743     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0776cc0218451a27170ae359f2bdb19d" title="Builds node clusters.">generateNodeClusters</a>(MAXDIST, cands);
<a name="l00744"></a>00744     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = 0;
<a name="l00745"></a>00745     <span class="keywordflow">for</span> (std::vector&lt;std::set&lt;NBNode*&gt; &gt;::iterator i = cands.begin(); i != cands.end(); ++i) {
<a name="l00746"></a>00746         std::set&lt;NBNode*&gt; &amp;c = (*i);
<a name="l00747"></a>00747         <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::iterator j = c.begin(); j != c.end();) {
<a name="l00748"></a>00748             <span class="keywordflow">if</span> (!(*j)-&gt;isTLControlled()) {
<a name="l00749"></a>00749                 c.erase(j++);
<a name="l00750"></a>00750             } <span class="keywordflow">else</span> {
<a name="l00751"></a>00751                 ++j;
<a name="l00752"></a>00752             }
<a name="l00753"></a>00753         }
<a name="l00754"></a>00754         <span class="keywordflow">if</span> (c.size() &lt; 2) {
<a name="l00755"></a>00755             <span class="keywordflow">continue</span>;
<a name="l00756"></a>00756         }
<a name="l00757"></a>00757         <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::iterator j = c.begin(); j != c.end(); ++j) {
<a name="l00758"></a>00758             std::set&lt;NBTrafficLightDefinition*&gt; tls = (*j)-&gt;getControllingTLS();
<a name="l00759"></a>00759             (*j)-&gt;removeTrafficLights();
<a name="l00760"></a>00760             <span class="keywordflow">for</span> (std::set&lt;NBTrafficLightDefinition*&gt;::iterator k = tls.begin(); k != tls.end(); ++k) {
<a name="l00761"></a>00761                 tlc.<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html#ac9f2c1745b8b88b7efeeb19d03f204fa" title="Removes a logic definition (and all programs) from the dictionary.">removeFully</a>((*j)-&gt;getID());
<a name="l00762"></a>00762             }
<a name="l00763"></a>00763         }
<a name="l00764"></a>00764         std::string <span class="keywordtype">id</span> = <span class="stringliteral">&quot;joinedS_&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(index++);
<a name="l00765"></a>00765         std::vector&lt;NBNode*&gt; nodes;
<a name="l00766"></a>00766         <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::iterator j = c.begin(); j != c.end(); j++) {
<a name="l00767"></a>00767             nodes.push_back(*j);
<a name="l00768"></a>00768         }
<a name="l00769"></a>00769         <a class="code" href="../../d3/de8/class_n_b_traffic_light_definition.html" title="The base class for traffic light logic definitions.">NBTrafficLightDefinition</a>* tlDef = <span class="keyword">new</span> <a class="code" href="../../d3/dfe/class_n_b_own_t_l_def.html" title="A traffic light logics which must be computed (only nodes/edges are given).">NBOwnTLDef</a>(<span class="keywordtype">id</span>, nodes);
<a name="l00770"></a>00770         <span class="keywordflow">if</span> (!tlc.<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html#ae5230d7284321706e0fd811bc6ef8878" title="Adds a logic definition to the dictionary.">insert</a>(tlDef)) {
<a name="l00771"></a>00771             <span class="comment">// actually, nothing should fail here</span>
<a name="l00772"></a>00772             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Could not build a joined tls.&quot;</span>);
<a name="l00773"></a>00773             <span class="keyword">delete</span> tlDef;
<a name="l00774"></a>00774             <span class="keywordflow">return</span>;
<a name="l00775"></a>00775         }
<a name="l00776"></a>00776     }
<a name="l00777"></a>00777 }
<a name="l00778"></a>00778 
<a name="l00779"></a>00779 
<a name="l00780"></a>00780 <span class="keywordtype">void</span>
<a name="l00781"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a3e80fe24762099d8b561cdf03ea0145f">00781</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a3e80fe24762099d8b561cdf03ea0145f" title="Sets the given node as being controlled by a tls.">NBNodeCont::setAsTLControlled</a>(<a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* node, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlc, std::string <span class="keywordtype">id</span>) {
<a name="l00782"></a>00782     <span class="keywordflow">if</span> (<span class="keywordtype">id</span> == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00783"></a>00783         <span class="keywordtype">id</span> = node-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>();
<a name="l00784"></a>00784     }
<a name="l00785"></a>00785     <a class="code" href="../../d3/de8/class_n_b_traffic_light_definition.html" title="The base class for traffic light logic definitions.">NBTrafficLightDefinition</a>* tlDef = <span class="keyword">new</span> <a class="code" href="../../d3/dfe/class_n_b_own_t_l_def.html" title="A traffic light logics which must be computed (only nodes/edges are given).">NBOwnTLDef</a>(<span class="keywordtype">id</span>, node);
<a name="l00786"></a>00786     <span class="keywordflow">if</span> (!tlc.<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html#ae5230d7284321706e0fd811bc6ef8878" title="Adds a logic definition to the dictionary.">insert</a>(tlDef)) {
<a name="l00787"></a>00787         <span class="comment">// actually, nothing should fail here</span>
<a name="l00788"></a>00788         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Building a tl-logic for node &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39; twice is not possible.&quot;</span>);
<a name="l00789"></a>00789         <span class="keyword">delete</span> tlDef;
<a name="l00790"></a>00790         <span class="keywordflow">return</span>;
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792 }
<a name="l00793"></a>00793 
<a name="l00794"></a>00794 
<a name="l00795"></a>00795 <span class="comment">// -----------</span>
<a name="l00796"></a>00796 <span class="keywordtype">void</span>
<a name="l00797"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#ad6df7e71fd80a154e2c7c03e7f9364e7">00797</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ad6df7e71fd80a154e2c7c03e7f9364e7" title="divides the incoming lanes on outgoing lanes">NBNodeCont::computeLanes2Lanes</a>() {
<a name="l00798"></a>00798     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00799"></a>00799         (*i).second-&gt;computeLanes2Lanes();
<a name="l00800"></a>00800     }
<a name="l00801"></a>00801 }
<a name="l00802"></a>00802 
<a name="l00803"></a>00803 
<a name="l00804"></a>00804 <span class="comment">// computes the &quot;wheel&quot; of incoming and outgoing edges for every node</span>
<a name="l00805"></a>00805 <span class="keywordtype">void</span>
<a name="l00806"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a77a290a3bb6ff73668194c765dcc1f58">00806</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a77a290a3bb6ff73668194c765dcc1f58" title="build the list of outgoing edges and lanes">NBNodeCont::computeLogics</a>(<span class="keyword">const</span> <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc) {
<a name="l00807"></a>00807     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00808"></a>00808         (*i).second-&gt;computeLogic(ec, oc);
<a name="l00809"></a>00809     }
<a name="l00810"></a>00810 }
<a name="l00811"></a>00811 
<a name="l00812"></a>00812 
<a name="l00813"></a>00813 <span class="keywordtype">void</span>
<a name="l00814"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a21e981da686b9897791720897b680b1f">00814</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a21e981da686b9897791720897b680b1f" title="sorts the nodes&amp;#39; edges">NBNodeCont::sortNodesEdges</a>(<span class="keywordtype">bool</span> leftHand) {
<a name="l00815"></a>00815     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00816"></a>00816         (*i).second-&gt;sortNodesEdges(leftHand);
<a name="l00817"></a>00817     }
<a name="l00818"></a>00818 }
<a name="l00819"></a>00819 
<a name="l00820"></a>00820 
<a name="l00821"></a>00821 <span class="keywordtype">void</span>
<a name="l00822"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a403d5893329c6cf2158dc1561b08f701">00822</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a403d5893329c6cf2158dc1561b08f701" title="computes the nodes&amp;#39; types">NBNodeCont::computeNodeTypes</a>(<span class="keyword">const</span> <a class="code" href="../../db/d57/class_n_b_type_cont.html" title="A storage for available types of edges.">NBTypeCont</a>&amp; tc) {
<a name="l00823"></a>00823     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00824"></a>00824         (*i).second-&gt;computeType(tc);
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826 }
<a name="l00827"></a>00827 
<a name="l00828"></a>00828 
<a name="l00829"></a>00829 <span class="keywordtype">void</span>
<a name="l00830"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a5cb93bb7ec5d242557402232345b3745">00830</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a5cb93bb7ec5d242557402232345b3745" title="computes priorities of edges based on junction types">NBNodeCont::computePriorities</a>() {
<a name="l00831"></a>00831     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00832"></a>00832         (*i).second-&gt;computePriorities();
<a name="l00833"></a>00833     }
<a name="l00834"></a>00834 }
<a name="l00835"></a>00835 
<a name="l00836"></a>00836 
<a name="l00837"></a>00837 <span class="keywordtype">void</span>
<a name="l00838"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0017c5728b2f91919bb79798fb5dd981">00838</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0017c5728b2f91919bb79798fb5dd981">NBNodeCont::clear</a>() {
<a name="l00839"></a>00839     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00840"></a>00840         <span class="keyword">delete</span>((*i).second);
<a name="l00841"></a>00841     }
<a name="l00842"></a>00842     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.clear();
<a name="l00843"></a>00843     <span class="keywordflow">for</span> (std::set&lt;NBNode*&gt;::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a2213637620467150b5ab277f03d7e3dd" title="The extracted nodes which are kept for reference.">myExtractedNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a2213637620467150b5ab277f03d7e3dd" title="The extracted nodes which are kept for reference.">myExtractedNodes</a>.end(); i++) {
<a name="l00844"></a>00844         <span class="keyword">delete</span>(*i);
<a name="l00845"></a>00845     }
<a name="l00846"></a>00846     <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a2213637620467150b5ab277f03d7e3dd" title="The extracted nodes which are kept for reference.">myExtractedNodes</a>.clear();
<a name="l00847"></a>00847 }
<a name="l00848"></a>00848 
<a name="l00849"></a>00849 
<a name="l00850"></a>00850 std::string
<a name="l00851"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a309aeaac40ec90f775b685447f715aac">00851</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a309aeaac40ec90f775b685447f715aac">NBNodeCont::getFreeID</a>() {
<a name="l00852"></a>00852     <span class="comment">// !!! not guaranteed to be free</span>
<a name="l00853"></a>00853     std::string ret = <span class="stringliteral">&quot;SUMOGenerated&quot;</span> + toString&lt;int&gt;(<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a1f1b7c685825074f805891303aaa40e5" title="Returns the number of known nodes.">size</a>());
<a name="l00854"></a>00854     assert(<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">retrieve</a>(ret) == 0);
<a name="l00855"></a>00855     <span class="keywordflow">return</span> ret;
<a name="l00856"></a>00856 }
<a name="l00857"></a>00857 
<a name="l00858"></a>00858 
<a name="l00859"></a>00859 <span class="keywordtype">void</span>
<a name="l00860"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4ee748d3cdb4e5c864a3bd0bac2210a9">00860</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a4ee748d3cdb4e5c864a3bd0bac2210a9">NBNodeCont::computeNodeShapes</a>(<span class="keywordtype">bool</span> leftHand) {
<a name="l00861"></a>00861     <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l00862"></a>00862         (*i).second-&gt;computeNodeShape(leftHand);
<a name="l00863"></a>00863     }
<a name="l00864"></a>00864 }
<a name="l00865"></a>00865 
<a name="l00866"></a>00866 
<a name="l00867"></a>00867 <span class="keywordtype">bool</span>
<a name="l00868"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0d1e8833780784512f2038347c285f1c">00868</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0d1e8833780784512f2038347c285f1c">NBNodeCont::mayNeedOnRamp</a>(<a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* cur)<span class="keyword"> const </span>{
<a name="l00869"></a>00869     <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 2 &amp;&amp; cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 1) {
<a name="l00870"></a>00870         <span class="comment">// may be an on-ramp</span>
<a name="l00871"></a>00871         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_highway = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>()[0];
<a name="l00872"></a>00872         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_ramp = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>()[1];
<a name="l00873"></a>00873         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* cont = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>()[0];
<a name="l00874"></a>00874 
<a name="l00875"></a>00875         <span class="comment">// do not build ramps on connectors</span>
<a name="l00876"></a>00876         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a02a003521576817270e7aa2e9db522c6" title="Returns whether this edge was marked as a macroscopic connector.">isMacroscopicConnector</a>() || pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a02a003521576817270e7aa2e9db522c6" title="Returns whether this edge was marked as a macroscopic connector.">isMacroscopicConnector</a>() || cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a02a003521576817270e7aa2e9db522c6" title="Returns whether this edge was marked as a macroscopic connector.">isMacroscopicConnector</a>()) {
<a name="l00877"></a>00877             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00878"></a>00878         }
<a name="l00879"></a>00879 
<a name="l00880"></a>00880         <span class="comment">// check whether a lane is missing</span>
<a name="l00881"></a>00881         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() + pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() &lt;= cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l00882"></a>00882             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00883"></a>00883         }
<a name="l00884"></a>00884 
<a name="l00885"></a>00885         <span class="comment">// assign highway/ramp properly</span>
<a name="l00886"></a>00886         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()) {
<a name="l00887"></a>00887             std::swap(pot_highway, pot_ramp);
<a name="l00888"></a>00888         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() == pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()
<a name="l00889"></a>00889                    &amp;&amp;
<a name="l00890"></a>00890                    pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l00891"></a>00891 
<a name="l00892"></a>00892             std::swap(pot_highway, pot_ramp);
<a name="l00893"></a>00893         }
<a name="l00894"></a>00894 
<a name="l00895"></a>00895         <span class="comment">// check conditions</span>
<a name="l00896"></a>00896         <span class="comment">// is it really a highway?</span>
<a name="l00897"></a>00897         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> minHighwaySpeed = oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.min-highway-speed&quot;</span>);
<a name="l00898"></a>00898         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; minHighwaySpeed || cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; minHighwaySpeed) {
<a name="l00899"></a>00899             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00900"></a>00900         }
<a name="l00901"></a>00901         <span class="comment">// is it really a ramp?</span>
<a name="l00902"></a>00902         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> maxRampSpeed = oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.max-ramp-speed&quot;</span>);
<a name="l00903"></a>00903         <span class="keywordflow">if</span> (maxRampSpeed &gt; 0 &amp;&amp; maxRampSpeed &lt; pot_ramp-&gt;getSpeed()) {
<a name="l00904"></a>00904             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00905"></a>00905         }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907         <span class="comment">// ok, may be</span>
<a name="l00908"></a>00908         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00909"></a>00909     }
<a name="l00910"></a>00910     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00911"></a>00911 }
<a name="l00912"></a>00912 
<a name="l00913"></a>00913 
<a name="l00914"></a>00914 <span class="keywordtype">bool</span>
<a name="l00915"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a94fa59e1b07f4833b914f4ab996249c3">00915</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a94fa59e1b07f4833b914f4ab996249c3">NBNodeCont::buildOnRamp</a>(<a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* cur,
<a name="l00916"></a>00916                         <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc,
<a name="l00917"></a>00917                         <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; incremented) {
<a name="l00918"></a>00918     <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_highway = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>()[0];
<a name="l00919"></a>00919     <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_ramp = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>()[1];
<a name="l00920"></a>00920     <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* cont = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>()[0];
<a name="l00921"></a>00921     <span class="keywordtype">bool</span> bEdgeDeleted = <span class="keyword">false</span>;
<a name="l00922"></a>00922 
<a name="l00923"></a>00923     <span class="comment">// assign highway/ramp properly</span>
<a name="l00924"></a>00924     <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()) {
<a name="l00925"></a>00925         std::swap(pot_highway, pot_ramp);
<a name="l00926"></a>00926     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() == pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()
<a name="l00927"></a>00927                &amp;&amp;
<a name="l00928"></a>00928                pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l00929"></a>00929 
<a name="l00930"></a>00930         std::swap(pot_highway, pot_ramp);
<a name="l00931"></a>00931     }
<a name="l00932"></a>00932 
<a name="l00933"></a>00933     <span class="comment">// compute the number of lanes to append</span>
<a name="l00934"></a>00934     <span class="keywordtype">int</span> toAdd = (pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() + pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) - cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>();
<a name="l00935"></a>00935     <span class="keywordflow">if</span> (toAdd &lt;= 0) {
<a name="l00936"></a>00936         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00937"></a>00937     }
<a name="l00938"></a>00938 
<a name="l00939"></a>00939     <span class="comment">//</span>
<a name="l00940"></a>00940     <span class="keywordflow">if</span> (cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>().<a class="code" href="../../da/d56/class_position_vector.html#a83cd8142323cc67c4374fdc5c6244b8b" title="Returns the length.">length</a>() - <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a> &lt;= oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.ramp-length&quot;</span>)) {
<a name="l00941"></a>00941         <span class="comment">// the edge is shorter than the wished ramp</span>
<a name="l00942"></a>00942         <span class="comment">//  append a lane only</span>
<a name="l00943"></a>00943         <span class="keywordflow">if</span> (find(incremented.begin(), incremented.end(), cont) == incremented.end()) {
<a name="l00944"></a>00944             cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7c22fd4ddb2569ae2a3d09c8e6d06d4d">incLaneNo</a>(toAdd);
<a name="l00945"></a>00945             incremented.push_back(cont);
<a name="l00946"></a>00946             <span class="keywordflow">if</span> (!pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, cont, pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(),
<a name="l00947"></a>00947                     <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() - pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>, <span class="keyword">true</span>)) {
<a name="l00948"></a>00948                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l00949"></a>00949             }
<a name="l00950"></a>00950             <span class="keywordflow">if</span> (!pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, cont, 0, pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>, <span class="keyword">true</span>)) {
<a name="l00951"></a>00951                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l00952"></a>00952             }
<a name="l00953"></a>00953             <span class="comment">//</span>
<a name="l00954"></a>00954             cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a8cc0b6bc16c67de517cfd3f7a59616a2">invalidateConnections</a>(<span class="keyword">true</span>);
<a name="l00955"></a>00955             <span class="keyword">const</span> <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; o1 = cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>()-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>();
<a name="l00956"></a>00956             <span class="keywordflow">if</span> (o1.size() == 1 &amp;&amp; o1[0]-&gt;getNumLanes() &lt; cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l00957"></a>00957                 cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() - o1[0]-&gt;getNumLanes(),
<a name="l00958"></a>00958                                               o1[0], 0, o1[0]-&gt;getNumLanes(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>);
<a name="l00959"></a>00959             }
<a name="l00960"></a>00960             <span class="comment">//</span>
<a name="l00961"></a>00961             <span class="keywordflow">if</span> (cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a09d24489f2a16fe97a1aba71c8c7e644" title="Returns how this edge&amp;#39;s lanes&amp;#39; lateral offset is computed.">getLaneSpreadFunction</a>() == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a9266afbd0b47dea3e4a46c3ea8e9b511a55d244ddc2721841db383d43bb60c01d">LANESPREAD_CENTER</a>) {
<a name="l00962"></a>00962                 <span class="keywordflow">try</span> {
<a name="l00963"></a>00963                     <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> g = cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l00964"></a>00964                     g.<a class="code" href="../../da/d56/class_position_vector.html#ac7063f8efc9107e29531d0dac99c56cb">move2side</a>(<a class="code" href="../../da/dbd/_std_defs_8h.html#a7f0404b96bcb9d743d6c46fd50903282">SUMO_const_laneWidthAndOffset</a>);
<a name="l00965"></a>00965                     cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(g);
<a name="l00966"></a>00966                 } <span class="keywordflow">catch</span> (<a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>&amp;) {
<a name="l00967"></a>00967                     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;For edge &#39;&quot;</span> + cont-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39;: could not compute shape.&quot;</span>);
<a name="l00968"></a>00968                 }
<a name="l00969"></a>00969             }
<a name="l00970"></a>00970         }
<a name="l00971"></a>00971         <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> p = pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l00972"></a>00972         p.<a class="code" href="../../da/d56/class_position_vector.html#a126ab49f900d388f524be3c05be1d219">pop_back</a>();
<a name="l00973"></a>00973         p.<a class="code" href="../../da/d56/class_position_vector.html#a99a6f657973c8a916ffa8ebca2b33d80" title="Appends the given position to the list.">push_back</a>(cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>()-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>());
<a name="l00974"></a>00974         pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(p);
<a name="l00975"></a>00975     } <span class="keywordflow">else</span> {
<a name="l00976"></a>00976         bEdgeDeleted = <span class="keyword">true</span>;
<a name="l00977"></a>00977         <span class="comment">// there is enough place to build a ramp; do it</span>
<a name="l00978"></a>00978         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* rn =
<a name="l00979"></a>00979             <span class="keyword">new</span> <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>(cont-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;-AddedOnRampNode&quot;</span>,
<a name="l00980"></a>00980                        cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>().<a class="code" href="../../da/d56/class_position_vector.html#a716318d3b0fe4298f5384d8d38688b6c" title="Returns the position at the given length.">positionAtLengthPosition</a>(
<a name="l00981"></a>00981                            oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.ramp-length&quot;</span>)));
<a name="l00982"></a>00982         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">insert</a>(rn)) {
<a name="l00983"></a>00983             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Ups - could not build on-ramp for edge &#39;&quot;</span> + pot_highway-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39; (node could not be build)!&quot;</span>);
<a name="l00984"></a>00984         }
<a name="l00985"></a>00985         std::string name = cont-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>();
<a name="l00986"></a>00986         <span class="keywordtype">bool</span> ok = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#af0ee0a24afadface83a044b1d521c503" title="Splits the edge at the position nearest to the given node.">splitAt</a>(dc, cont, rn,
<a name="l00987"></a>00987                              cont-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;-AddedOnRampEdge&quot;</span>, cont-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>(),
<a name="l00988"></a>00988                              cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() + toAdd, cont-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>());
<a name="l00989"></a>00989         <span class="keywordflow">if</span> (!ok) {
<a name="l00990"></a>00990             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Ups - could not build on-ramp for edge &#39;&quot;</span> + pot_highway-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39;!&quot;</span>);
<a name="l00991"></a>00991             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00992"></a>00992         } <span class="keywordflow">else</span> {
<a name="l00993"></a>00993             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* added_ramp = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a6f3edcea491ac076689edc6d1b8ba289" title="Returns the edge that has the given id.">retrieve</a>(name + <span class="stringliteral">&quot;-AddedOnRampEdge&quot;</span>);
<a name="l00994"></a>00994             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* added = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a6f3edcea491ac076689edc6d1b8ba289" title="Returns the edge that has the given id.">retrieve</a>(name);
<a name="l00995"></a>00995             incremented.push_back(added_ramp);
<a name="l00996"></a>00996             <span class="keywordflow">if</span> (added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() != added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l00997"></a>00997                 <span class="keywordtype">int</span> off = added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() - added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>();
<a name="l00998"></a>00998                 <span class="keywordflow">if</span> (!added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(off, added, 0, added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>)) {
<a name="l00999"></a>00999                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01000"></a>01000                 }
<a name="l01001"></a>01001                 <span class="keywordflow">if</span> (added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a09d24489f2a16fe97a1aba71c8c7e644" title="Returns how this edge&amp;#39;s lanes&amp;#39; lateral offset is computed.">getLaneSpreadFunction</a>() == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a9266afbd0b47dea3e4a46c3ea8e9b511a55d244ddc2721841db383d43bb60c01d">LANESPREAD_CENTER</a>) {
<a name="l01002"></a>01002                     <span class="keywordflow">try</span> {
<a name="l01003"></a>01003                         <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> g = added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l01004"></a>01004                         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> factor = <a class="code" href="../../da/dbd/_std_defs_8h.html#a7f0404b96bcb9d743d6c46fd50903282">SUMO_const_laneWidthAndOffset</a> * (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(toAdd - 1) + <a class="code" href="../../da/dbd/_std_defs_8h.html#a2f6de1ee0dcb917ed3bb23c6c7e07efa">SUMO_const_halfLaneAndOffset</a> * (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(toAdd % 2);
<a name="l01005"></a>01005                         g.<a class="code" href="../../da/d56/class_position_vector.html#ac7063f8efc9107e29531d0dac99c56cb">move2side</a>(factor);
<a name="l01006"></a>01006                         added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(g);
<a name="l01007"></a>01007                     } <span class="keywordflow">catch</span> (<a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>&amp;) {
<a name="l01008"></a>01008                         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;For edge &#39;&quot;</span> + added_ramp-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39;: could not compute shape.&quot;</span>);
<a name="l01009"></a>01009                     }
<a name="l01010"></a>01010                 }
<a name="l01011"></a>01011             } <span class="keywordflow">else</span> {
<a name="l01012"></a>01012                 <span class="keywordflow">if</span> (!added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, added, 0, added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>)) {
<a name="l01013"></a>01013                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01014"></a>01014                 }
<a name="l01015"></a>01015             }
<a name="l01016"></a>01016             <span class="keywordflow">if</span> (!pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, added_ramp, pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(),
<a name="l01017"></a>01017                     <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() - pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">false</span>, <span class="keyword">true</span>)) {
<a name="l01018"></a>01018                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01019"></a>01019 
<a name="l01020"></a>01020             }
<a name="l01021"></a>01021             <span class="keywordflow">if</span> (!pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, added_ramp, 0, pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>, <span class="keyword">true</span>)) {
<a name="l01022"></a>01022                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01023"></a>01023             }
<a name="l01024"></a>01024             <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> p = pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l01025"></a>01025             p.<a class="code" href="../../da/d56/class_position_vector.html#a126ab49f900d388f524be3c05be1d219">pop_back</a>();
<a name="l01026"></a>01026             p.<a class="code" href="../../da/d56/class_position_vector.html#a99a6f657973c8a916ffa8ebca2b33d80" title="Appends the given position to the list.">push_back</a>(added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>()-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>());<span class="comment">//added_ramp-&gt;getLaneShape(0).at(0));</span>
<a name="l01027"></a>01027             pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(p);
<a name="l01028"></a>01028         }
<a name="l01029"></a>01029     }
<a name="l01030"></a>01030     <span class="keywordflow">return</span> bEdgeDeleted;
<a name="l01031"></a>01031 }
<a name="l01032"></a>01032 
<a name="l01033"></a>01033 
<a name="l01034"></a>01034 <span class="keywordtype">void</span>
<a name="l01035"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#aafdedec499d5050892d3434de8be30a5">01035</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#aafdedec499d5050892d3434de8be30a5">NBNodeCont::buildOffRamp</a>(<a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* cur,
<a name="l01036"></a>01036                          <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc,
<a name="l01037"></a>01037                          <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a>&amp; incremented) {
<a name="l01038"></a>01038     <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_highway = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>()[0];
<a name="l01039"></a>01039     <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_ramp = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>()[1];
<a name="l01040"></a>01040     <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* prev = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>()[0];
<a name="l01041"></a>01041     <span class="comment">// assign highway/ramp properly</span>
<a name="l01042"></a>01042     <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()) {
<a name="l01043"></a>01043         std::swap(pot_highway, pot_ramp);
<a name="l01044"></a>01044     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() == pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()
<a name="l01045"></a>01045                &amp;&amp;
<a name="l01046"></a>01046                pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l01047"></a>01047 
<a name="l01048"></a>01048         std::swap(pot_highway, pot_ramp);
<a name="l01049"></a>01049     }
<a name="l01050"></a>01050     <span class="comment">// compute the number of lanes to append</span>
<a name="l01051"></a>01051     <span class="keywordtype">int</span> toAdd = (pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() + pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) - prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>();
<a name="l01052"></a>01052     <span class="keywordflow">if</span> (toAdd &lt;= 0) {
<a name="l01053"></a>01053         <span class="keywordflow">return</span>;
<a name="l01054"></a>01054     }
<a name="l01055"></a>01055     <span class="comment">// append on-ramp</span>
<a name="l01056"></a>01056     <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>().<a class="code" href="../../da/d56/class_position_vector.html#a83cd8142323cc67c4374fdc5c6244b8b" title="Returns the length.">length</a>() - <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a> &lt;= oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.ramp-length&quot;</span>)) {
<a name="l01057"></a>01057         <span class="comment">// the edge is shorter than the wished ramp</span>
<a name="l01058"></a>01058         <span class="comment">//  append a lane only</span>
<a name="l01059"></a>01059         <span class="keywordflow">if</span> (find(incremented.begin(), incremented.end(), prev) == incremented.end()) {
<a name="l01060"></a>01060             incremented.push_back(prev);
<a name="l01061"></a>01061             prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7c22fd4ddb2569ae2a3d09c8e6d06d4d">incLaneNo</a>(toAdd);
<a name="l01062"></a>01062             prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a8cc0b6bc16c67de517cfd3f7a59616a2">invalidateConnections</a>(<span class="keyword">true</span>);
<a name="l01063"></a>01063             <span class="keywordflow">if</span> (!prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), pot_highway, 0,
<a name="l01064"></a>01064                                                <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() - 1, pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>)) {
<a name="l01065"></a>01065 
<a name="l01066"></a>01066                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01067"></a>01067 
<a name="l01068"></a>01068             }
<a name="l01069"></a>01069             <span class="keywordflow">if</span> (!prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, pot_ramp, 0, pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">false</span>)) {
<a name="l01070"></a>01070                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01071"></a>01071 
<a name="l01072"></a>01072             }
<a name="l01073"></a>01073             <span class="keywordflow">if</span> (prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a09d24489f2a16fe97a1aba71c8c7e644" title="Returns how this edge&amp;#39;s lanes&amp;#39; lateral offset is computed.">getLaneSpreadFunction</a>() == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a9266afbd0b47dea3e4a46c3ea8e9b511a55d244ddc2721841db383d43bb60c01d">LANESPREAD_CENTER</a>) {
<a name="l01074"></a>01074                 <span class="keywordflow">try</span> {
<a name="l01075"></a>01075                     <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> g = prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l01076"></a>01076                     g.<a class="code" href="../../da/d56/class_position_vector.html#ac7063f8efc9107e29531d0dac99c56cb">move2side</a>(<a class="code" href="../../da/dbd/_std_defs_8h.html#a7f0404b96bcb9d743d6c46fd50903282">SUMO_const_laneWidthAndOffset</a>);
<a name="l01077"></a>01077                     prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(g);
<a name="l01078"></a>01078                 } <span class="keywordflow">catch</span> (<a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>&amp;) {
<a name="l01079"></a>01079                     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;For edge &#39;&quot;</span> + prev-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39;: could not compute shape.&quot;</span>);
<a name="l01080"></a>01080                 }
<a name="l01081"></a>01081             }
<a name="l01082"></a>01082         }
<a name="l01083"></a>01083         <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> p = pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l01084"></a>01084         p.<a class="code" href="../../da/d56/class_position_vector.html#af9b431042dd06b3850440a8bfb192d1a">pop_front</a>();
<a name="l01085"></a>01085         p.<a class="code" href="../../da/d56/class_position_vector.html#ab1b60c2ca322e03bb3f975fa5f6d25ee" title="Puts the given position at the begin of the list.">push_front</a>(prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>()-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>());<span class="comment">//added_ramp-&gt;getLaneShape(0).at(-1));</span>
<a name="l01086"></a>01086         pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(p);
<a name="l01087"></a>01087     } <span class="keywordflow">else</span> {
<a name="l01088"></a>01088         <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a> pos =
<a name="l01089"></a>01089             prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>().<a class="code" href="../../da/d56/class_position_vector.html#a716318d3b0fe4298f5384d8d38688b6c" title="Returns the position at the given length.">positionAtLengthPosition</a>(
<a name="l01090"></a>01090                 prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>().<a class="code" href="../../da/d56/class_position_vector.html#a83cd8142323cc67c4374fdc5c6244b8b" title="Returns the length.">length</a>() - oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.ramp-length&quot;</span>));
<a name="l01091"></a>01091         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* rn = <span class="keyword">new</span> <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>(prev-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;-AddedOffRampNode&quot;</span>, pos);
<a name="l01092"></a>01092         <span class="keywordflow">if</span> (!<a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">insert</a>(rn)) {
<a name="l01093"></a>01093             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Ups - could not build off-ramp for edge &#39;&quot;</span> + pot_highway-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39; (node could not be build)!&quot;</span>);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095         }
<a name="l01096"></a>01096         std::string name = prev-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>();
<a name="l01097"></a>01097         <span class="keywordtype">bool</span> ok = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#af0ee0a24afadface83a044b1d521c503" title="Splits the edge at the position nearest to the given node.">splitAt</a>(dc, prev, rn,
<a name="l01098"></a>01098                              prev-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>(), prev-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;-AddedOffRampEdge&quot;</span>,
<a name="l01099"></a>01099                              prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() + toAdd);
<a name="l01100"></a>01100         <span class="keywordflow">if</span> (!ok) {
<a name="l01101"></a>01101             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Ups - could not build on-ramp for edge &#39;&quot;</span> + pot_highway-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39;!&quot;</span>);
<a name="l01102"></a>01102             <span class="keywordflow">return</span>;
<a name="l01103"></a>01103         } <span class="keywordflow">else</span> {
<a name="l01104"></a>01104             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* added_ramp = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a6f3edcea491ac076689edc6d1b8ba289" title="Returns the edge that has the given id.">retrieve</a>(name + <span class="stringliteral">&quot;-AddedOffRampEdge&quot;</span>);
<a name="l01105"></a>01105             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* added = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a6f3edcea491ac076689edc6d1b8ba289" title="Returns the edge that has the given id.">retrieve</a>(name);
<a name="l01106"></a>01106             <span class="keywordflow">if</span> (added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() != added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l01107"></a>01107                 incremented.push_back(added_ramp);
<a name="l01108"></a>01108                 <span class="keywordtype">int</span> off = added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() - added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>();
<a name="l01109"></a>01109                 <span class="keywordflow">if</span> (!added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, added_ramp, off, added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>)) {
<a name="l01110"></a>01110                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01111"></a>01111 
<a name="l01112"></a>01112                 }
<a name="l01113"></a>01113                 <span class="keywordflow">if</span> (added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a09d24489f2a16fe97a1aba71c8c7e644" title="Returns how this edge&amp;#39;s lanes&amp;#39; lateral offset is computed.">getLaneSpreadFunction</a>() == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a9266afbd0b47dea3e4a46c3ea8e9b511a55d244ddc2721841db383d43bb60c01d">LANESPREAD_CENTER</a>) {
<a name="l01114"></a>01114                     <span class="keywordflow">try</span> {
<a name="l01115"></a>01115                         <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> g = added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l01116"></a>01116                         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> factor = <a class="code" href="../../da/dbd/_std_defs_8h.html#a7f0404b96bcb9d743d6c46fd50903282">SUMO_const_laneWidthAndOffset</a> * (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(toAdd - 1) + <a class="code" href="../../da/dbd/_std_defs_8h.html#a2f6de1ee0dcb917ed3bb23c6c7e07efa">SUMO_const_halfLaneAndOffset</a> * (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(toAdd % 2);
<a name="l01117"></a>01117                         g.<a class="code" href="../../da/d56/class_position_vector.html#ac7063f8efc9107e29531d0dac99c56cb">move2side</a>(factor);
<a name="l01118"></a>01118                         added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(g);
<a name="l01119"></a>01119                     } <span class="keywordflow">catch</span> (<a class="code" href="../../d3/d68/class_invalid_argument.html">InvalidArgument</a>&amp;) {
<a name="l01120"></a>01120                         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;For edge &#39;&quot;</span> + added_ramp-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39;: could not compute shape.&quot;</span>);
<a name="l01121"></a>01121                     }
<a name="l01122"></a>01122                 }
<a name="l01123"></a>01123             } <span class="keywordflow">else</span> {
<a name="l01124"></a>01124                 <span class="keywordflow">if</span> (!added-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, added_ramp, 0, added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>)) {
<a name="l01125"></a>01125                     <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01126"></a>01126                 }
<a name="l01127"></a>01127             }
<a name="l01128"></a>01128             <span class="keywordflow">if</span> (!added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), pot_highway, 0,
<a name="l01129"></a>01129                     <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() - pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">true</span>)) {
<a name="l01130"></a>01130                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01131"></a>01131             }
<a name="l01132"></a>01132             <span class="keywordflow">if</span> (!added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47ba9d1aeebff4be79cf074fb586f85c" title="Builds no connections starting at the given lanes.">addLane2LaneConnections</a>(0, pot_ramp, 0, pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>(), <a class="code" href="../../d7/d41/class_n_b_edge.html#aa1576d07471ecc008d626cdbfb3302f2aba63868f28825735eb91856ff5ae804c" title="The connection was computed and validated.">NBEdge::L2L_VALIDATED</a>, <span class="keyword">false</span>)) {
<a name="l01133"></a>01133                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not set connection!&quot;</span>);
<a name="l01134"></a>01134 
<a name="l01135"></a>01135             }
<a name="l01136"></a>01136             <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> p = pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a7ef2d0f629e4daa3310bc6bf1abe6ce9" title="Returns the geometry of the edge.">getGeometry</a>();
<a name="l01137"></a>01137             p.<a class="code" href="../../da/d56/class_position_vector.html#af9b431042dd06b3850440a8bfb192d1a">pop_front</a>();
<a name="l01138"></a>01138             p.<a class="code" href="../../da/d56/class_position_vector.html#ab1b60c2ca322e03bb3f975fa5f6d25ee" title="Puts the given position at the begin of the list.">push_front</a>(added_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>()-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a57c0891208c4e7b1925382169934b360" title="Returns the position of this node.">getPosition</a>());<span class="comment">//added_ramp-&gt;getLaneShape(0).at(-1));</span>
<a name="l01139"></a>01139             pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#afba8069e9ad5bab833e531d4b1d479d8" title="(Re)sets the edge&amp;#39;s geometry">setGeometry</a>(p);
<a name="l01140"></a>01140         }
<a name="l01141"></a>01141     }
<a name="l01142"></a>01142 }
<a name="l01143"></a>01143 
<a name="l01144"></a>01144 
<a name="l01145"></a>01145 <span class="keywordtype">bool</span>
<a name="l01146"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a60cff7d52b3efbd906847a58217e4508">01146</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a60cff7d52b3efbd906847a58217e4508">NBNodeCont::mayNeedOffRamp</a>(<a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* cur)<span class="keyword"> const </span>{
<a name="l01147"></a>01147     <span class="keywordflow">if</span> (cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 1 &amp;&amp; cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 2) {
<a name="l01148"></a>01148         <span class="comment">// may be an off-ramp</span>
<a name="l01149"></a>01149         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_highway = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>()[0];
<a name="l01150"></a>01150         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* pot_ramp = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>()[1];
<a name="l01151"></a>01151         <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* prev = cur-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>()[0];
<a name="l01152"></a>01152 
<a name="l01153"></a>01153         <span class="comment">// do not build ramps on connectors</span>
<a name="l01154"></a>01154         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a02a003521576817270e7aa2e9db522c6" title="Returns whether this edge was marked as a macroscopic connector.">isMacroscopicConnector</a>() || pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a02a003521576817270e7aa2e9db522c6" title="Returns whether this edge was marked as a macroscopic connector.">isMacroscopicConnector</a>() || prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a02a003521576817270e7aa2e9db522c6" title="Returns whether this edge was marked as a macroscopic connector.">isMacroscopicConnector</a>()) {
<a name="l01155"></a>01155             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01156"></a>01156         }
<a name="l01157"></a>01157 
<a name="l01158"></a>01158         <span class="comment">// check whether a lane is missing</span>
<a name="l01159"></a>01159         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() + pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() &lt;= prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l01160"></a>01160             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01161"></a>01161         }
<a name="l01162"></a>01162 
<a name="l01163"></a>01163         <span class="comment">// assign highway/ramp properly</span>
<a name="l01164"></a>01164         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()) {
<a name="l01165"></a>01165             std::swap(pot_highway, pot_ramp);
<a name="l01166"></a>01166         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() == pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()
<a name="l01167"></a>01167                    &amp;&amp;
<a name="l01168"></a>01168                    pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l01169"></a>01169 
<a name="l01170"></a>01170             std::swap(pot_highway, pot_ramp);
<a name="l01171"></a>01171         }
<a name="l01172"></a>01172 
<a name="l01173"></a>01173         <span class="comment">// check conditions</span>
<a name="l01174"></a>01174         <span class="comment">// is it really a highway?</span>
<a name="l01175"></a>01175         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> minHighwaySpeed = oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.min-highway-speed&quot;</span>);
<a name="l01176"></a>01176         <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; minHighwaySpeed || prev-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; minHighwaySpeed) {
<a name="l01177"></a>01177             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01178"></a>01178         }
<a name="l01179"></a>01179         <span class="comment">// is it really a ramp?</span>
<a name="l01180"></a>01180         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> maxRampSpeed = oc.<a class="code" href="../../db/d31/class_options_cont.html#ad94844bde0bafb87b800b8f147b7ed16" title="Returns the SUMOReal-value of the named option (only for Option_Float).">getFloat</a>(<span class="stringliteral">&quot;ramps.max-ramp-speed&quot;</span>);
<a name="l01181"></a>01181         <span class="keywordflow">if</span> (maxRampSpeed &gt; 0 &amp;&amp; maxRampSpeed &lt; pot_ramp-&gt;getSpeed()) {
<a name="l01182"></a>01182             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01183"></a>01183         }
<a name="l01184"></a>01184 
<a name="l01185"></a>01185         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01186"></a>01186     }
<a name="l01187"></a>01187     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01188"></a>01188 }
<a name="l01189"></a>01189 
<a name="l01190"></a>01190 
<a name="l01191"></a>01191 <span class="keywordtype">void</span>
<a name="l01192"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a07b925c276764d34a4c6f1ede2b95f16">01192</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a07b925c276764d34a4c6f1ede2b95f16">NBNodeCont::checkHighwayRampOrder</a>(<a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a> *&amp;pot_highway, <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a> *&amp;pot_ramp) {
<a name="l01193"></a>01193     <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()) {
<a name="l01194"></a>01194         std::swap(pot_highway, pot_ramp);
<a name="l01195"></a>01195     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>() == pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a6fa897ead9e371c1e431b8076550e74a" title="Returns the speed allowed on this edge.">getSpeed</a>()
<a name="l01196"></a>01196                &amp;&amp;
<a name="l01197"></a>01197                pot_highway-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>() &lt; pot_ramp-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#aa6ed274bbffc247a43e91a8ec4b150a1" title="Returns the number of lanes.">getNumLanes</a>()) {
<a name="l01198"></a>01198 
<a name="l01199"></a>01199         std::swap(pot_highway, pot_ramp);
<a name="l01200"></a>01200     }
<a name="l01201"></a>01201 }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203 
<a name="l01204"></a>01204 <span class="keywordtype">void</span>
<a name="l01205"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#ac30e2626528315aa780826aacba148c5">01205</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ac30e2626528315aa780826aacba148c5">NBNodeCont::guessRamps</a>(<a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec,
<a name="l01206"></a>01206                        <a class="code" href="../../d3/d1f/class_n_b_district_cont.html" title="A container for districts.">NBDistrictCont</a>&amp; dc) {
<a name="l01207"></a>01207     <a class="code" href="../../db/dde/_n_b_cont_8h.html#a7bbd80497f8b27f18697210825ec974a">EdgeVector</a> incremented;
<a name="l01208"></a>01208     <span class="keywordtype">bool</span> bEdgeDeleted = <span class="keyword">false</span>;
<a name="l01209"></a>01209     <span class="comment">// check whether on-off ramps shall be guessed</span>
<a name="l01210"></a>01210     <span class="keywordflow">if</span> (oc.<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;ramps.guess&quot;</span>)) {
<a name="l01211"></a>01211         <span class="keywordflow">for</span> (NodeCont::iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l01212"></a>01212             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* cur = (*i).second;
<a name="l01213"></a>01213             <span class="keywordflow">if</span> (<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0d1e8833780784512f2038347c285f1c">mayNeedOnRamp</a>(oc, cur)) {
<a name="l01214"></a>01214                 <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a94fa59e1b07f4833b914f4ab996249c3">buildOnRamp</a>(oc, cur, ec, dc, incremented);
<a name="l01215"></a>01215             }
<a name="l01216"></a>01216             <span class="keywordflow">if</span> (<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a60cff7d52b3efbd906847a58217e4508">mayNeedOffRamp</a>(oc, cur)) {
<a name="l01217"></a>01217                 <a class="code" href="../../db/d8c/class_n_b_node_cont.html#aafdedec499d5050892d3434de8be30a5">buildOffRamp</a>(oc, cur, ec, dc, incremented);
<a name="l01218"></a>01218             }
<a name="l01219"></a>01219         }
<a name="l01220"></a>01220     }
<a name="l01221"></a>01221     <span class="comment">// check whether on-off ramps shall be guessed</span>
<a name="l01222"></a>01222     <span class="keywordflow">if</span> (oc.<a class="code" href="../../db/d31/class_options_cont.html#a08a62e1f4fcf9acaefc97efce45609fc" title="Returns the information whether the named option is set.">isSet</a>(<span class="stringliteral">&quot;ramps.set&quot;</span>)) {
<a name="l01223"></a>01223         std::vector&lt;std::string&gt; edges = oc.<a class="code" href="../../db/d31/class_options_cont.html#a6713cebc23d2e3a88f8a00942e4fee32" title="Returns the list of string-vector-value of the named option (only for Option_String)...">getStringVector</a>(<span class="stringliteral">&quot;ramps.set&quot;</span>);
<a name="l01224"></a>01224         <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::iterator i = edges.begin(); i != edges.end(); ++i) {
<a name="l01225"></a>01225             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* e = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a6f3edcea491ac076689edc6d1b8ba289" title="Returns the edge that has the given id.">retrieve</a>(*i);
<a name="l01226"></a>01226             <span class="keywordflow">if</span> (e == 0) {
<a name="l01227"></a>01227                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Can not build on ramp on edge &#39;&quot;</span> + *i + <span class="stringliteral">&quot;&#39; - the edge is not known.&quot;</span>);
<a name="l01228"></a>01228                 <span class="keywordflow">continue</span>;
<a name="l01229"></a>01229             }
<a name="l01230"></a>01230             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* from = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#ab279b96c38a10b1aafba2b8f736b0410" title="Returns the origin node of the edge.">getFromNode</a>();
<a name="l01231"></a>01231             <span class="keywordflow">if</span> (from-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 2 &amp;&amp; from-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 1) {
<a name="l01232"></a>01232                 bEdgeDeleted = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a94fa59e1b07f4833b914f4ab996249c3">buildOnRamp</a>(oc, from, ec, dc, incremented);
<a name="l01233"></a>01233             }
<a name="l01234"></a>01234             <span class="comment">// load edge again to check offramps</span>
<a name="l01235"></a>01235             e = ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#a6f3edcea491ac076689edc6d1b8ba289" title="Returns the edge that has the given id.">retrieve</a>(*i);
<a name="l01236"></a>01236             <span class="keywordflow">if</span> (e == 0) {
<a name="l01237"></a>01237                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Can not build off ramp on edge &#39;&quot;</span> + *i + <span class="stringliteral">&quot;&#39; - the edge is not known.&quot;</span>);
<a name="l01238"></a>01238                 <span class="keywordflow">continue</span>;
<a name="l01239"></a>01239             }
<a name="l01240"></a>01240             <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* to = e-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a47de8fb27ded13ba7886218da6b9a60f" title="Returns the destination node of the edge.">getToNode</a>();
<a name="l01241"></a>01241             <span class="keywordflow">if</span> (to-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a8528083710540004a765fc56643c9562" title="Returns this node&amp;#39;s incoming edges.">getIncomingEdges</a>().size() == 1 &amp;&amp; to-&gt;<a class="code" href="../../d3/dd1/class_n_b_node.html#a7e586b529f4d8c758716a8c72220ca38" title="Returns this node&amp;#39;s outgoing edges.">getOutgoingEdges</a>().size() == 2) {
<a name="l01242"></a>01242                 <a class="code" href="../../db/d8c/class_n_b_node_cont.html#aafdedec499d5050892d3434de8be30a5">buildOffRamp</a>(oc, to, ec, dc, incremented);
<a name="l01243"></a>01243             }
<a name="l01244"></a>01244         }
<a name="l01245"></a>01245     }
<a name="l01246"></a>01246 }
<a name="l01247"></a>01247 
<a name="l01248"></a>01248 
<a name="l01249"></a>01249 <span class="keywordtype">void</span>
<a name="l01250"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#a40a978ce9e14e3f2d8dcc79549da0c0a">01250</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a40a978ce9e14e3f2d8dcc79549da0c0a" title="Prints statistics about built nodes.">NBNodeCont::printBuiltNodesStatistics</a>()<span class="keyword"> const </span>{
<a name="l01251"></a>01251     <span class="keywordtype">int</span> numUnregulatedJunctions = 0;
<a name="l01252"></a>01252     <span class="keywordtype">int</span> numDeadEndJunctions = 0;
<a name="l01253"></a>01253     <span class="keywordtype">int</span> numPriorityJunctions = 0;
<a name="l01254"></a>01254     <span class="keywordtype">int</span> numRightBeforeLeftJunctions = 0;
<a name="l01255"></a>01255     <span class="keywordflow">for</span> (NodeCont::const_iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); i++) {
<a name="l01256"></a>01256         <span class="keywordflow">switch</span> ((*i).second-&gt;getType()) {
<a name="l01257"></a>01257             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab28dfb39f850f0859f8e28940b7ff60ba1bbeaa02fa0063bb67f1dcdafba01a83">NODETYPE_NOJUNCTION</a>:
<a name="l01258"></a>01258                 ++numUnregulatedJunctions;
<a name="l01259"></a>01259                 <span class="keywordflow">break</span>;
<a name="l01260"></a>01260             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab28dfb39f850f0859f8e28940b7ff60bac782e7d57fbac12e9f1e9b062a87a58d">NODETYPE_DEAD_END</a>:
<a name="l01261"></a>01261                 ++numDeadEndJunctions;
<a name="l01262"></a>01262                 <span class="keywordflow">break</span>;
<a name="l01263"></a>01263             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab28dfb39f850f0859f8e28940b7ff60bae99c128b7557b84957226cd8cda11f07">NODETYPE_PRIORITY_JUNCTION</a>:
<a name="l01264"></a>01264             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab28dfb39f850f0859f8e28940b7ff60bae8545f9299fc30cd0253e6dc207946c4">NODETYPE_TRAFFIC_LIGHT</a>:
<a name="l01265"></a>01265                 ++numPriorityJunctions;
<a name="l01266"></a>01266                 <span class="keywordflow">break</span>;
<a name="l01267"></a>01267             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab28dfb39f850f0859f8e28940b7ff60ba3ab04e8411b56a12f844bd542e004e73">NODETYPE_RIGHT_BEFORE_LEFT</a>:
<a name="l01268"></a>01268                 ++numRightBeforeLeftJunctions;
<a name="l01269"></a>01269                 <span class="keywordflow">break</span>;
<a name="l01270"></a>01270             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab28dfb39f850f0859f8e28940b7ff60bad47669f635d721ff836d08b870a9efc4">NODETYPE_DISTRICT</a>:
<a name="l01271"></a>01271                 ++numRightBeforeLeftJunctions;
<a name="l01272"></a>01272                 <span class="keywordflow">break</span>;
<a name="l01273"></a>01273             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab28dfb39f850f0859f8e28940b7ff60ba83f3842f496fa9a36448211498a4f4f4">NODETYPE_UNKNOWN</a>:
<a name="l01274"></a>01274                 <span class="keywordflow">break</span>;
<a name="l01275"></a>01275             <span class="keywordflow">default</span>:
<a name="l01276"></a>01276                 <span class="keywordflow">break</span>;
<a name="l01277"></a>01277         }
<a name="l01278"></a>01278     }
<a name="l01279"></a>01279     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot; Node type statistics:&quot;</span>);
<a name="l01280"></a>01280     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;  Unregulated junctions       : &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(numUnregulatedJunctions));
<a name="l01281"></a>01281     <span class="keywordflow">if</span> (numDeadEndJunctions &gt; 0) {
<a name="l01282"></a>01282         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;  Dead-end junctions          : &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(numDeadEndJunctions));
<a name="l01283"></a>01283     }
<a name="l01284"></a>01284     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;  Priority junctions          : &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(numPriorityJunctions));
<a name="l01285"></a>01285     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;  Right-before-left junctions : &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(numRightBeforeLeftJunctions));
<a name="l01286"></a>01286 }
<a name="l01287"></a>01287 
<a name="l01288"></a>01288 
<a name="l01289"></a>01289 std::vector&lt;std::string&gt;
<a name="l01290"></a><a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae976b32dd5bd78f36ea1ac0e9944fde7">01290</a> <a class="code" href="../../db/d8c/class_n_b_node_cont.html#ae976b32dd5bd78f36ea1ac0e9944fde7" title="get all node names">NBNodeCont::getAllNames</a>()<span class="keyword"> const </span>{
<a name="l01291"></a>01291     std::vector&lt;std::string&gt; ret;
<a name="l01292"></a>01292     <span class="keywordflow">for</span> (NodeCont::const_iterator i = <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.begin(); i != <a class="code" href="../../db/d8c/class_n_b_node_cont.html#a279ad9f6e73b02ab8625820d4bf3e065" title="The map of names to nodes.">myNodes</a>.end(); ++i) {
<a name="l01293"></a>01293         ret.push_back((*i).first);
<a name="l01294"></a>01294     }
<a name="l01295"></a>01295     <span class="keywordflow">return</span> ret;
<a name="l01296"></a>01296 }
<a name="l01297"></a>01297 
<a name="l01298"></a>01298 
<a name="l01299"></a>01299 
<a name="l01300"></a>01300 <span class="comment">/****************************************************************************/</span>
<a name="l01301"></a>01301 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:03 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
