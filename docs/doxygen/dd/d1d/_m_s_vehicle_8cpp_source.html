<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: MSVehicle.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_6b4e825611921d20a66b187b0ee8072c.html">microsim</a>
  </div>
</div>
<div class="contents">
<h1>MSVehicle.cpp</h1><a href="../../dd/d1d/_m_s_vehicle_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00017"></a>00017 <span class="comment">// Representation of a vehicle in the micro simulation</span>
<a name="l00018"></a>00018 <span class="comment">/****************************************************************************/</span>
<a name="l00019"></a>00019 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00020"></a>00020 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00021"></a>00021 <span class="comment">/****************************************************************************/</span>
<a name="l00022"></a>00022 <span class="comment">//</span>
<a name="l00023"></a>00023 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00024"></a>00024 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00025"></a>00025 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00026"></a>00026 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00027"></a>00027 <span class="comment">//   (at your option) any later version.</span>
<a name="l00028"></a>00028 <span class="comment">//</span>
<a name="l00029"></a>00029 <span class="comment">/****************************************************************************/</span>
<a name="l00030"></a>00030 
<a name="l00031"></a>00031 <span class="comment">// ===========================================================================</span>
<a name="l00032"></a>00032 <span class="comment">// included modules</span>
<a name="l00033"></a>00033 <span class="comment">// ===========================================================================</span>
<a name="l00034"></a>00034 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00035"></a>00035 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#else</span>
<a name="l00037"></a>00037 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#endif</span>
<a name="l00039"></a>00039 <span class="preprocessor"></span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d38/_m_s_lane_8h.html">MSLane.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/d38/_m_s_vehicle_8h.html">MSVehicle.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="../../da/dea/_m_s_edge_8h.html">MSEdge.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="../../db/d2e/_m_s_vehicle_type_8h.html">MSVehicleType.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/dfa/_m_s_net_8h.html">MSNet.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="../../d0/d24/_m_s_route_8h.html">MSRoute.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/d26/_m_s_link_cont_8h.html">MSLinkCont.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="../../de/dde/_string_utils_8h.html">utils/common/StringUtils.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="../../da/dbd/_std_defs_8h.html">utils/common/StdDefs.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html">utils/common/SUMOTime.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="../../de/d52/_m_s_vehicle_control_8h.html">microsim/MSVehicleControl.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/dbe/_m_s_globals_8h.html">microsim/MSGlobals.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &lt;map&gt;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../db/dd5/_m_s_move_reminder_8h.html">MSMoveReminder.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d5c/_options_cont_8h.html">utils/options/OptionsCont.h</a>&gt;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="../../dd/da4/_m_s_l_c_m___d_k2004_8h.html">MSLCM_DK2004.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d08/_to_string_8h.html">utils/common/ToString.h</a>&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/da2/_file_helpers_8h.html">utils/common/FileHelpers.h</a>&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;<a class="code" href="../../d1/d3f/_output_device_8h.html">utils/iodevices/OutputDevice.h</a>&gt;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/da1/_binary_input_device_8h.html">utils/iodevices/BinaryInputDevice.h</a>&gt;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="../../d9/db0/_m_s_bus_stop_8h.html">trigger/MSBusStop.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/d78/_dijkstra_router_t_t_8h.html">utils/common/DijkstraRouterTT.h</a>&gt;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/db6/_m_s_person_8h.html">MSPerson.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="../../d4/df4/_m_s_person_control_8h.html">MSPersonControl.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/d68/_rand_helper_8h.html">utils/common/RandHelper.h</a>&gt;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d10/_m_s_device___person_8h.html">devices/MSDevice_Person.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d74/_m_s_edge_weights_storage_8h.html">MSEdgeWeightsStorage.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &lt;<a class="code" href="../../d9/d51/_helpers_h_b_e_f_a_8h.html">utils/common/HelpersHBEFA.h</a>&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &lt;<a class="code" href="../../de/d1a/_helpers_harmonoise_8h.html">utils/common/HelpersHarmonoise.h</a>&gt;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="../../d3/d1e/_my_handler2_8h.html">scenload/MyHandler2.h</a>&quot;</span>
<a name="l00075"></a>00075 <span class="preprocessor">#include &quot;<a class="code" href="../../dc/deb/_vehicle_to_track_8h.html">scenload/VehicleToTrack.h</a>&quot;</span>
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l00078"></a>00078 <span class="preprocessor"></span><span class="preprocessor">#include &quot;<a class="code" href="../../d3/d4c/_m_s_message_emitter_8h.html">MSMessageEmitter.h</a>&quot;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#endif</span>
<a name="l00080"></a>00080 <span class="preprocessor"></span>
<a name="l00081"></a>00081 <span class="preprocessor">#ifdef HAVE_MESOSIM</span>
<a name="l00082"></a>00082 <span class="preprocessor"></span><span class="preprocessor">#include &lt;mesosim/MESegment.h&gt;</span>
<a name="l00083"></a>00083 <span class="preprocessor">#include &lt;mesosim/MELoop.h&gt;</span>
<a name="l00084"></a>00084 <span class="preprocessor">#include &quot;<a class="code" href="../../d6/dbe/_m_s_globals_8h.html">MSGlobals.h</a>&quot;</span>
<a name="l00085"></a>00085 <span class="preprocessor">#endif</span>
<a name="l00086"></a>00086 <span class="preprocessor"></span>
<a name="l00087"></a>00087 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00088"></a>00088 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00089"></a>00089 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="comment">//#define DEBUG_VEHICLE_GUI_SELECTION 1</span>
<a name="l00091"></a>00091 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../dc/df0/_g_u_i_global_selection_8h.html">utils/gui/div/GUIGlobalSelection.h</a>&gt;</span>
<a name="l00093"></a>00093 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/dbc/_g_u_i_vehicle_8h.html">guisim/GUIVehicle.h</a>&gt;</span>
<a name="l00094"></a>00094 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d01/_g_u_i_lane_8h.html">guisim/GUILane.h</a>&gt;</span>
<a name="l00095"></a>00095 <span class="preprocessor">#endif</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span>
<a name="l00097"></a><a class="code" href="../../dd/d1d/_m_s_vehicle_8cpp.html#ad6e57ec62988057451224a702a658f9b">00097</a> <span class="preprocessor">#define BUS_STOP_OFFSET 0.5</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span>
<a name="l00099"></a>00099 <span class="comment">// ===========================================================================</span>
<a name="l00100"></a>00100 <span class="comment">// static value definitions</span>
<a name="l00101"></a>00101 <span class="comment">// ===========================================================================</span>
<a name="l00102"></a>00102 std::vector&lt;MSLane*&gt; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#abde29751d5030cdfc27fc1f229c197b9">MSVehicle::myEmptyLaneVector</a>;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">// ===========================================================================</span>
<a name="l00105"></a>00105 <span class="comment">// method definitions</span>
<a name="l00106"></a>00106 <span class="comment">// ===========================================================================</span>
<a name="l00107"></a>00107 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00108"></a>00108 <span class="comment"> * methods of MSVehicle::State</span>
<a name="l00109"></a>00109 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00110"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a71eedaa00220b2112f389229e7a9d316">00110</a> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a7153e929d7ee122cc56f8a9fb0726c2b" title="Constructor.">MSVehicle::State::State</a>(<span class="keyword">const</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html" title="Container that holds the vehicles driving state (position+speed).">State</a>&amp; state) {
<a name="l00111"></a>00111     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> = state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l00112"></a>00112     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> = state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>;
<a name="l00113"></a>00113     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a> = state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a>;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115 }
<a name="l00116"></a>00116 
<a name="l00117"></a>00117 <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html" title="Container that holds the vehicles driving state (position+speed).">MSVehicle::State</a>&amp;
<a name="l00118"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#aa589894fe8cc4003de9210f5434ba897">00118</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa97aaba7af12c3199c041dfa74ca4460" title="invalidated assignment operator">MSVehicle::State::operator=</a>(<span class="keyword">const</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html" title="Container that holds the vehicles driving state (position+speed).">State</a>&amp; state) {
<a name="l00119"></a>00119     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> = state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l00120"></a>00120     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> = state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>;
<a name="l00121"></a>00121     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a> = state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a>;
<a name="l00122"></a>00122     <span class="keywordflow">return</span> *<span class="keyword">this</span>;
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a61b7b2d9fe5abc44fa9f99f23f202de2">00125</a> <span class="keywordtype">bool</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a61b7b2d9fe5abc44fa9f99f23f202de2" title="Operator !=.">MSVehicle::State::operator!=</a>(<span class="keyword">const</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html" title="Container that holds the vehicles driving state (position+speed).">State</a>&amp; state) {
<a name="l00126"></a>00126     <span class="keywordflow">return</span> (<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> != state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> || <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> != state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>
<a name="l00127"></a>00127             || <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a> != state.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a>);
<a name="l00128"></a>00128 }
<a name="l00129"></a>00129 
<a name="l00130"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950">00130</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">MSVehicle::State::pos</a>()<span class="keyword"> const </span>{
<a name="l00131"></a>00131     <span class="keywordflow">return</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l00132"></a>00132 }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134 <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a7153e929d7ee122cc56f8a9fb0726c2b" title="Constructor.">MSVehicle::State::State</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> pos, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> speed, <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> lane) :
<a name="l00135"></a>00135         myPos(pos), mySpeed(speed), myTimeEnterLane(lane) {
<a name="l00136"></a>00136 }
<a name="l00137"></a>00137 
<a name="l00138"></a>00138 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00139"></a>00139 <span class="comment"> * methods of MSVehicle::Influencer</span>
<a name="l00140"></a>00140 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00141"></a>00141 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00142"></a><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a33035ee86c8200bd74852fb309b06358">00142</a> <span class="preprocessor"></span><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a33035ee86c8200bd74852fb309b06358" title="Constructor.">MSVehicle::Influencer::Influencer</a>() :
<a name="l00143"></a>00143         mySpeedAdaptationStarted(true), myConsiderSafeVelocity(true), myConsiderMaxAcceleration(
<a name="l00144"></a>00144                 true), myConsiderMaxDeceleration(true) {
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ac671b838b52890b21932de777664a338">00147</a> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ac671b838b52890b21932de777664a338" title="Destructor.">MSVehicle::Influencer::~Influencer</a>() {
<a name="l00148"></a>00148 }
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 <span class="keywordtype">void</span> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ad9bfcc858bda333c47a3bed210b94331" title="Sets a new velocity timeline.">MSVehicle::Influencer::setSpeedTimeLine</a>(
<a name="l00151"></a>00151         <span class="keyword">const</span> std::vector&lt;std::pair&lt;SUMOTime, SUMOReal&gt; &gt; &amp;speedTimeLine) {
<a name="l00152"></a>00152     <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ac42dba2f891cae274d4c78d0b327a9a2" title="Whether influencing the speed has already started.">mySpeedAdaptationStarted</a> = <span class="keyword">true</span>;
<a name="l00153"></a>00153     <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a> = speedTimeLine;
<a name="l00154"></a>00154 }
<a name="l00155"></a>00155 
<a name="l00156"></a><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a987225c3e2a7bc6726cf606a7c701928">00156</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a987225c3e2a7bc6726cf606a7c701928" title="Sets a new lane timeline.">MSVehicle::Influencer::setLaneTimeLine</a>(
<a name="l00157"></a>00157         <span class="keyword">const</span> std::vector&lt;std::pair&lt;SUMOTime, unsigned int&gt; &gt; &amp;laneTimeLine) {
<a name="l00158"></a>00158     <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a> = laneTimeLine;
<a name="l00159"></a>00159 }
<a name="l00160"></a>00160 
<a name="l00161"></a>00161 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#aba51e645f75ce33f372fa11a7d95f80c" title="Applies stored velocity information on the speed to use.">MSVehicle::Influencer::influenceSpeed</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> currentTime,
<a name="l00162"></a>00162         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> speed, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vSafe, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vMin, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vMax) {
<a name="l00163"></a>00163     <span class="comment">// keep original speed</span>
<a name="l00164"></a>00164     <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a706aa45ed8cea761f0252e5fcbb5ba87" title="The velocity before influence.">myOriginalSpeed</a> = speed;
<a name="l00165"></a>00165     <span class="comment">// remove leading commands which are no longer valid</span>
<a name="l00166"></a>00166     <span class="keywordflow">while</span> (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>.size() == 1
<a name="l00167"></a>00167             || (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>.size() &gt; 1
<a name="l00168"></a>00168                     &amp;&amp; currentTime &gt; <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[1].first)) {
<a name="l00169"></a>00169         <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>.erase(<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>.begin());
<a name="l00170"></a>00170     }
<a name="l00171"></a>00171     <span class="comment">// do nothing if the time line does not apply for the current time</span>
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>.size() &lt; 2 || currentTime &lt; <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[0].first) {
<a name="l00173"></a>00173         <span class="keywordflow">return</span> speed;
<a name="l00174"></a>00174     }
<a name="l00175"></a>00175     <span class="comment">// compute and set new speed</span>
<a name="l00176"></a>00176     <span class="keywordflow">if</span> (!<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ac42dba2f891cae274d4c78d0b327a9a2" title="Whether influencing the speed has already started.">mySpeedAdaptationStarted</a>) {
<a name="l00177"></a>00177         <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[0].second = speed;
<a name="l00178"></a>00178         <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ac42dba2f891cae274d4c78d0b327a9a2" title="Whether influencing the speed has already started.">mySpeedAdaptationStarted</a> = <span class="keyword">true</span>;
<a name="l00179"></a>00179     }
<a name="l00180"></a>00180     currentTime += <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>;
<a name="l00181"></a>00181     <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> td =
<a name="l00182"></a>00182             <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a17e50ddd50517df5a81172d302f7aa70">STEPS2TIME</a>(currentTime - <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[0].first)
<a name="l00183"></a>00183                     / <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a17e50ddd50517df5a81172d302f7aa70">STEPS2TIME</a>(<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[1].first + <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a> - <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[0].first);
<a name="l00184"></a>00184     speed = <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[0].second
<a name="l00185"></a>00185             - (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[0].second - <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a41ab4fb6428df526beb7f63eb32a0cc7" title="The velocity time line to apply.">mySpeedTimeLine</a>[1].second) * td;
<a name="l00186"></a>00186     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ac21a0cfa5b4ce6c7239b27b0410f1f19" title="Whether the safe velocity shall be regarded.">myConsiderSafeVelocity</a>) {
<a name="l00187"></a>00187         speed = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(speed, vSafe);
<a name="l00188"></a>00188     }
<a name="l00189"></a>00189     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#aedd4e9cf9d79034748adc3fdfcb8f400" title="Whether the maximum acceleration shall be regarded.">myConsiderMaxAcceleration</a>) {
<a name="l00190"></a>00190         speed = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(speed, vMax);
<a name="l00191"></a>00191     }
<a name="l00192"></a>00192     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a4eaf08185eec52bf370ab6abacd3a14f" title="Whether the maximum deceleration shall be regarded.">myConsiderMaxDeceleration</a>) {
<a name="l00193"></a>00193         speed = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(speed, vMin);
<a name="l00194"></a>00194     }
<a name="l00195"></a>00195     <span class="keywordflow">return</span> speed;
<a name="l00196"></a>00196 }
<a name="l00197"></a>00197 
<a name="l00198"></a><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ad3edd164bb3bdc1258a905a366fde312">00198</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa79784b474b1abfce0584f2e9476d9fe" title="Requests set via TraCI.">MSVehicle::ChangeRequest</a> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ad3edd164bb3bdc1258a905a366fde312">MSVehicle::Influencer::checkForLaneChanges</a>(
<a name="l00199"></a>00199         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> currentTime, <span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>&amp; currentEdge,
<a name="l00200"></a>00200         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> currentLaneIndex) {
<a name="l00201"></a>00201     <span class="comment">// remove leading commands which are no longer valid</span>
<a name="l00202"></a>00202     <span class="keywordflow">while</span> (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>.size() == 1
<a name="l00203"></a>00203             || (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>.size() &gt; 1
<a name="l00204"></a>00204                     &amp;&amp; currentTime &gt; <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>[1].first)) {
<a name="l00205"></a>00205         <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>.erase(<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>.begin());
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207     <span class="comment">// do nothing if the time line does not apply for the current time</span>
<a name="l00208"></a>00208     <span class="keywordflow">if</span> (<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>.size() &lt; 2 || currentTime &lt; <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>[0].first) {
<a name="l00209"></a>00209         <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa79784b474b1abfce0584f2e9476d9fea945dac15d9872bb4b52930b459a4c140" title="vehicle doesn&amp;#39;t want to change">REQUEST_NONE</a>;
<a name="l00210"></a>00210     }
<a name="l00211"></a>00211     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> destinationLaneIndex = <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a19e99dd096c98d5b35750944ea1292bc" title="The lane usage time line to apply.">myLaneTimeLine</a>[1].second;
<a name="l00212"></a>00212     <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) currentEdge.<a class="code" href="../../d7/d27/class_m_s_edge.html#ac6454be7984c840da4fa48808cf22833" title="Returns this edge&amp;#39;s lanes.">getLanes</a>().size() &lt;= destinationLaneIndex) {
<a name="l00213"></a>00213         <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa79784b474b1abfce0584f2e9476d9fea945dac15d9872bb4b52930b459a4c140" title="vehicle doesn&amp;#39;t want to change">REQUEST_NONE</a>;
<a name="l00214"></a>00214     }
<a name="l00215"></a>00215     <span class="keywordflow">if</span> (currentLaneIndex &gt; destinationLaneIndex) {
<a name="l00216"></a>00216         <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa79784b474b1abfce0584f2e9476d9feac773bedd05148cc2eef219027c6812f5" title="vehicle want&amp;#39;s to change to right lane">REQUEST_RIGHT</a>;
<a name="l00217"></a>00217     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (currentLaneIndex &lt; destinationLaneIndex) {
<a name="l00218"></a>00218         <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa79784b474b1abfce0584f2e9476d9fea81f6d95d3e6bf249981478f6b642bd50" title="vehicle want&amp;#39;s to change to left lane">REQUEST_LEFT</a>;
<a name="l00219"></a>00219     } <span class="keywordflow">else</span> {
<a name="l00220"></a>00220         <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa79784b474b1abfce0584f2e9476d9fea1beb39e90b456f5547601d6f267e47f0" title="vehicle want&amp;#39;s to keep the current lane">REQUEST_HOLD</a>;
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a23e8f8ecf1e54471f3281e8ea5270f63">00224</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a23e8f8ecf1e54471f3281e8ea5270f63" title="Sets whether the safe velocity shall be regarded.">MSVehicle::Influencer::setConsiderSafeVelocity</a>(<span class="keywordtype">bool</span> value) {
<a name="l00225"></a>00225     <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ac21a0cfa5b4ce6c7239b27b0410f1f19" title="Whether the safe velocity shall be regarded.">myConsiderSafeVelocity</a> = value;
<a name="l00226"></a>00226 }
<a name="l00227"></a>00227 
<a name="l00228"></a><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a1d2524c79b2572fa451aa0ecb503afe5">00228</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a1d2524c79b2572fa451aa0ecb503afe5" title="Sets whether the maximum acceleration shall be regarded.">MSVehicle::Influencer::setConsiderMaxAcceleration</a>(<span class="keywordtype">bool</span> value) {
<a name="l00229"></a>00229     <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#aedd4e9cf9d79034748adc3fdfcb8f400" title="Whether the maximum acceleration shall be regarded.">myConsiderMaxAcceleration</a> = value;
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ae307dc16e02aa73cd09590eb456db8f7">00232</a> <span class="keywordtype">void</span> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ae307dc16e02aa73cd09590eb456db8f7" title="Sets whether the maximum deceleration shall be regarded.">MSVehicle::Influencer::setConsiderMaxDeceleration</a>(<span class="keywordtype">bool</span> value) {
<a name="l00233"></a>00233     <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a4eaf08185eec52bf370ab6abacd3a14f" title="Whether the maximum deceleration shall be regarded.">myConsiderMaxDeceleration</a> = value;
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 <span class="preprocessor">#endif</span>
<a name="l00236"></a>00236 <span class="preprocessor"></span>
<a name="l00237"></a>00237 <span class="comment">/* -------------------------------------------------------------------------</span>
<a name="l00238"></a>00238 <span class="comment"> * MSVehicle-methods</span>
<a name="l00239"></a>00239 <span class="comment"> * ----------------------------------------------------------------------- */</span>
<a name="l00240"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4041fccfcd6df69a1d7ed26b142dc985">00240</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4041fccfcd6df69a1d7ed26b142dc985" title="Destructor.">MSVehicle::~MSVehicle</a>() {
<a name="l00241"></a>00241     <span class="keyword">delete</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a48115c0c5b5dac41805373f23f959683">myLaneChangeModel</a>;
<a name="l00242"></a>00242     <span class="comment">// other</span>
<a name="l00243"></a>00243     <span class="keyword">delete</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac1d5460cf8c02692ae70b5679d2a9056" title="The vehicle&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a>;
<a name="l00244"></a>00244     <span class="keywordflow">for</span> (std::vector&lt;MSLane*&gt;::iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.begin();
<a name="l00245"></a>00245             i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.end(); ++i) {
<a name="l00246"></a>00246         (*i)-&gt;resetPartialOccupation(<span class="keyword">this</span>);
<a name="l00247"></a>00247     }
<a name="l00248"></a>00248     <span class="keywordflow">for</span> (DriveItemVector::iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.begin();
<a name="l00249"></a>00249             i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.end(); ++i) {
<a name="l00250"></a>00250         <span class="keywordflow">if</span> ((*i).myLink != 0) {
<a name="l00251"></a>00251             (*i).myLink-&gt;removeApproaching(<span class="keyword">this</span>);
<a name="l00252"></a>00252         }
<a name="l00253"></a>00253     }
<a name="l00254"></a>00254     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.clear();
<a name="l00255"></a>00255     <span class="comment">//</span>
<a name="l00256"></a>00256     <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ad58de41e989066b253af5ef6e4ded046" title="Returns whether this type belongs to a single vehicle only (was modified).">amVehicleSpecific</a>()) {
<a name="l00257"></a>00257         <span class="keyword">delete</span> <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00260"></a>00260 <span class="preprocessor"></span>    <span class="keyword">delete</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a>;
<a name="l00261"></a>00261 <span class="preprocessor">#endif</span>
<a name="l00262"></a>00262 <span class="preprocessor"></span>}
<a name="l00263"></a>00263 
<a name="l00264"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a48446074ec9815b977227b86416fc7cd">00264</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ae48f5ed764d4ad6bad1b31b837ddaed5" title="invalidated default constructor">MSVehicle::MSVehicle</a>(<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html" title="Structure representing possible vehicle parameter.">SUMOVehicleParameter</a>* pars, <span class="keyword">const</span> <a class="code" href="../../de/dd8/class_m_s_route.html">MSRoute</a>* route,
<a name="l00265"></a>00265         <span class="keyword">const</span> <a class="code" href="../../de/da2/class_m_s_vehicle_type.html" title="The car-following model and parameter.">MSVehicleType</a>* type, <span class="keywordtype">int</span> <span class="comment">/*vehicleIndex*/</span>) :
<a name="l00266"></a>00266         <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html" title="The base class for microscopic and mesoscopic vehicles.">MSBaseVehicle</a>(pars, route, type), myLastLaneChangeOffset(0), myWaitingTime(
<a name="l00267"></a>00267                 0), myState(0, 0, <a class="code" href="../../dc/d5d/class_m_s_net.html" title="The simulated network and simulation perfomer.">MSNet</a>::getInstance()-&gt;getCurrentTimeStep()), <span class="comment">//</span>
<a name="l00268"></a>00268         myLane(0), myLastBestLanesEdge(0), myPersonDevice(0), myPreDawdleAcceleration(
<a name="l00269"></a>00269                 0), mySignals(0), myAmOnNet(false), myAmRegisteredAsWaitingForPerson(
<a name="l00270"></a>00270                 false), myEdgeWeights(0), myHaveToWaitOnNextLink(false)
<a name="l00271"></a>00271 #ifndef NO_TRACI
<a name="l00272"></a>00272                 , myInfluencer(0),
<a name="l00273"></a>00273 #endif
<a name="l00274"></a>00274                 hasChangeEdge(false), myLastEdgeId(<span class="stringliteral">&quot;null&quot;</span>) {
<a name="l00275"></a>00275     <span class="keywordflow">for</span> (std::vector&lt;SUMOVehicleParameter::Stop&gt;::iterator i =
<a name="l00276"></a>00276             pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aba164cb7671eef176b50fca07e2fb324" title="List of the stops the vehicle will make.">stops</a>.begin(); i != pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#aba164cb7671eef176b50fca07e2fb324" title="List of the stops the vehicle will make.">stops</a>.end(); ++i) {
<a name="l00277"></a>00277         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a602d0955951adc814cffc1a3fdc41d80" title="Adds a stop.">addStop</a>(*i)) {
<a name="l00278"></a>00278             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(
<a name="l00279"></a>00279                     <span class="stringliteral">&quot;Stop for vehicle &#39;&quot;</span> + pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; on lane &#39;&quot;</span> + i-&gt;lane
<a name="l00280"></a>00280                             + <span class="stringliteral">&quot;&#39; is not downstream the current route.&quot;</span>);
<a name="l00281"></a>00281         }
<a name="l00282"></a>00282     }
<a name="l00283"></a>00283     <span class="keywordflow">for</span> (std::vector&lt;SUMOVehicleParameter::Stop&gt;::const_iterator i =
<a name="l00284"></a>00284             route-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#ac72f97a49bcdd6948ad32f73d6baf5f2" title="Returns the stops.">getStops</a>().begin(); i != route-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#ac72f97a49bcdd6948ad32f73d6baf5f2" title="Returns the stops.">getStops</a>().end(); ++i) {
<a name="l00285"></a>00285         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a602d0955951adc814cffc1a3fdc41d80" title="Adds a stop.">addStop</a>(*i)) {
<a name="l00286"></a>00286             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(
<a name="l00287"></a>00287                     <span class="stringliteral">&quot;Stop for vehicle &#39;&quot;</span> + pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39; on lane &#39;&quot;</span> + i-&gt;lane
<a name="l00288"></a>00288                             + <span class="stringliteral">&quot;&#39; is not downstream the current route.&quot;</span>);
<a name="l00289"></a>00289         }
<a name="l00290"></a>00290     }
<a name="l00291"></a>00291     <span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* <span class="keyword">const</span> depLane = (*myCurrEdge)-&gt;getDepartLane(*<span class="keyword">this</span>);
<a name="l00292"></a>00292     <span class="keywordflow">if</span> (depLane == 0) {
<a name="l00293"></a>00293         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(
<a name="l00294"></a>00294                 <span class="stringliteral">&quot;Invalid departlane definition for vehicle &#39;&quot;</span> + pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>
<a name="l00295"></a>00295                         + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00296"></a>00296     }
<a name="l00297"></a>00297     <span class="keywordflow">if</span> (pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a9d5b4256e9937eae3c6b549961736e42" title="Information how the vehicle&amp;#39;s initial speed shall be chosen.">departSpeedProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a829433da329e7fac85ffd83d20d60346a7f48b5a378840a1589ac3c2126013603" title="The speed is given.">DEPART_SPEED_GIVEN</a>
<a name="l00298"></a>00298             &amp;&amp; pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a5c03f2409490073343459a4b966e7c7a" title="(optional) The initial speed of the vehicle">departSpeed</a> &gt; depLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>()) {
<a name="l00299"></a>00299         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(
<a name="l00300"></a>00300                 <span class="stringliteral">&quot;Departure speed for vehicle &#39;&quot;</span> + pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>
<a name="l00301"></a>00301                         + <span class="stringliteral">&quot;&#39; is too high for the departure lane &#39;&quot;</span>
<a name="l00302"></a>00302                         + depLane-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00303"></a>00303     }
<a name="l00304"></a>00304     <span class="keywordflow">if</span> (pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a9d5b4256e9937eae3c6b549961736e42" title="Information how the vehicle&amp;#39;s initial speed shall be chosen.">departSpeedProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a829433da329e7fac85ffd83d20d60346a7f48b5a378840a1589ac3c2126013603" title="The speed is given.">DEPART_SPEED_GIVEN</a>
<a name="l00305"></a>00305             &amp;&amp; pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a5c03f2409490073343459a4b966e7c7a" title="(optional) The initial speed of the vehicle">departSpeed</a> &gt; type-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#addf5daef83140069cd56d337921cb639" title="Get vehicle&amp;#39;s maximum speed [m/s].">getMaxSpeed</a>()) {
<a name="l00306"></a>00306         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(
<a name="l00307"></a>00307                 <span class="stringliteral">&quot;Departure speed for vehicle &#39;&quot;</span> + pars-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>
<a name="l00308"></a>00308                         + <span class="stringliteral">&quot;&#39; is too high for the vehicle type &#39;&quot;</span> + type-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ad6dc1278af1ab98cbbc19d924739f766" title="Returns the name of the vehicle type.">getID</a>()
<a name="l00309"></a>00309                         + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l00312"></a>00312 <span class="preprocessor"></span>    myLCMsgEmitter = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getMsgEmitter(<span class="stringliteral">&quot;lanechange&quot;</span>);
<a name="l00313"></a>00313     myBMsgEmitter = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getMsgEmitter(<span class="stringliteral">&quot;break&quot;</span>);
<a name="l00314"></a>00314     myHBMsgEmitter = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getMsgEmitter(<span class="stringliteral">&quot;heartbeat&quot;</span>);
<a name="l00315"></a>00315 <span class="preprocessor">#endif</span>
<a name="l00316"></a>00316 <span class="preprocessor"></span>    <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a48115c0c5b5dac41805373f23f959683">myLaneChangeModel</a> = <span class="keyword">new</span> <a class="code" href="../../d6/da3/class_m_s_l_c_m___d_k2004.html" title="A lane change model developed by D. Krajzewicz between 2004 and 2010.">MSLCM_DK2004</a>(*<span class="keyword">this</span>);
<a name="l00317"></a>00317     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4fc0bc70aa78016e3b376a6f0b29bf97" title="The per vehicle variables of the car following model.">myCFVariables</a> = type-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a8083fe6430ef3aa4f443be6694be41cd" title="Returns the vehicle type&amp;#39;s car following model definition (const version).">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a937a9818c516363acddee319e7d47def" title="Returns model specific values which are stored inside a vehicle and must be used...">createVehicleVariables</a>();
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 }
<a name="l00320"></a>00320 
<a name="l00321"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a7bfcbefb422ca745e47d5a32ddd1c82d">00321</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a7bfcbefb422ca745e47d5a32ddd1c82d" title="Called when the vehicle is removed from the network.">MSVehicle::onRemovalFromNet</a>(<span class="keyword">const</span> <a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208" title="Definition of a vehicle state.">MSMoveReminder::Notification</a> reason) {
<a name="l00322"></a>00322     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2d2ecdb21395e05fa17990c6770c3c9b" title="Processes active move reminder.">workOnMoveReminders</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> - <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a228586559208ae2bf4d980854f3f1836">SPEED2DIST</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>),
<a name="l00323"></a>00323             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>);
<a name="l00324"></a>00324     <span class="keywordflow">for</span> (DriveItemVector::iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.begin();
<a name="l00325"></a>00325             i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.end(); ++i) {
<a name="l00326"></a>00326         <span class="keywordflow">if</span> ((*i).myLink != 0) {
<a name="l00327"></a>00327             (*i).myLink-&gt;removeApproaching(<span class="keyword">this</span>);
<a name="l00328"></a>00328         }
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab6a1893e0f0dee87c08f1f15cc24b988" title="Update of members if vehicle leaves a new lane in the lane change step or at arrival...">leaveLane</a>(reason);
<a name="l00331"></a>00331 }
<a name="l00332"></a>00332 
<a name="l00333"></a>00333 <span class="comment">// ------------ interaction with the route</span>
<a name="l00334"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac2f78b6f676a6643bc8e823c7535be92">00334</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac2f78b6f676a6643bc8e823c7535be92" title="Returns the information whether the vehicle should end now.">MSVehicle::ends</a>()<span class="keyword"> const </span>{
<a name="l00335"></a>00335     <span class="keywordflow">return</span> <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> == <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>() - 1
<a name="l00336"></a>00336             &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> &gt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#afd710496383af73ec9caee1dcb674a5a" title="the position on the destination lane where the vehicle stops">myArrivalPos</a> - <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>;
<a name="l00337"></a>00337 }
<a name="l00338"></a>00338 
<a name="l00339"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a67a0adca2a375397c03d54fd3737d882">00339</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a67a0adca2a375397c03d54fd3737d882" title="Replaces the current route by the given one.">MSVehicle::replaceRoute</a>(<span class="keyword">const</span> <a class="code" href="../../de/dd8/class_m_s_route.html">MSRoute</a>* newRoute, <span class="keywordtype">bool</span> onInit) {
<a name="l00340"></a>00340     <span class="keyword">const</span> <a class="code" href="../../d3/db6/_m_s_person_8h.html#a5fee2764c12f25c3a26e65fd2f258097">MSEdgeVector</a>&amp; edges = newRoute-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a50d81ec26eb67c4e0016b462e560e9c3">getEdges</a>();
<a name="l00341"></a>00341     <span class="comment">// assert the vehicle may continue (must not be &quot;teleported&quot; or whatever to another position)</span>
<a name="l00342"></a>00342     <span class="keywordflow">if</span> (!onInit &amp;&amp; !newRoute-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a6c8c1576553d73a90e5a7f81749a0073">contains</a>(*<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>)) {
<a name="l00343"></a>00343         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00344"></a>00344     }
<a name="l00345"></a>00345 
<a name="l00346"></a>00346     <span class="comment">// rebuild in-vehicle route information</span>
<a name="l00347"></a>00347     <span class="keywordflow">if</span> (onInit) {
<a name="l00348"></a>00348         <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> = newRoute-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a19df3c97135029c574956a7c0f88b9eb" title="Returns the begin of the list of edges to pass.">begin</a>();
<a name="l00349"></a>00349     } <span class="keywordflow">else</span> {
<a name="l00350"></a>00350         <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> = find(edges.begin(), edges.end(), *<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>);
<a name="l00351"></a>00351     }
<a name="l00352"></a>00352     <span class="comment">// check whether the old route may be deleted (is not used by anyone else)</span>
<a name="l00353"></a>00353     newRoute-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a6c90716ed4c237338afbf3b249345264" title="increments the reference counter for the route">addReference</a>();
<a name="l00354"></a>00354     <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#ad9f4430dbaaeebc843a7d9f01ab5c470" title="deletes the route if there are no further references to it">release</a>();
<a name="l00355"></a>00355     <span class="comment">// assign new route</span>
<a name="l00356"></a>00356     <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a> = newRoute;
<a name="l00357"></a>00357     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a74c3dababee7d9cd7594e4fd4495cb6d">myLastBestLanesEdge</a> = 0;
<a name="l00358"></a>00358     <span class="comment">// update arrival definition</span>
<a name="l00359"></a>00359     <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a176693feb2a2312be1aca414d27e3373" title="(Re-)Calculates the arrival position from the vehicle parameters">calculateArrivalPos</a>();
<a name="l00360"></a>00360     <span class="comment">// save information that the vehicle was rerouted</span>
<a name="l00361"></a>00361     <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a17aa2315d1bd8621f0304117f603e261" title="The number of reroutings.">myNumberReroutes</a>++;
<a name="l00362"></a>00362     <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a7edf08cf3b7fd9e30f98c13b7c34f131" title="Informs all added listeners about a vehicle&amp;#39;s state change.">informVehicleStateListener</a>(<span class="keyword">this</span>,
<a name="l00363"></a>00363             <a class="code" href="../../dc/d5d/class_m_s_net.html#a19e1d800f4d19bae756b5597a6101d7aa0ba914f641fd4f72f1e7ce393abcf682" title="The vehicle got a new route.">MSNet::VEHICLE_STATE_NEWROUTE</a>);
<a name="l00364"></a>00364     <span class="comment">// recheck stops</span>
<a name="l00365"></a>00365     <span class="keywordflow">for</span> (std::list&lt;Stop&gt;::iterator iter = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin();
<a name="l00366"></a>00366             iter != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.end();) {
<a name="l00367"></a>00367         <span class="keywordflow">if</span> (find(edges.begin(), edges.end(), &amp;iter-&gt;lane-&gt;getEdge())
<a name="l00368"></a>00368                 == edges.end()) {
<a name="l00369"></a>00369             iter = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.erase(iter);
<a name="l00370"></a>00370         } <span class="keywordflow">else</span> {
<a name="l00371"></a>00371             iter-&gt;edge = find(edges.begin(), edges.end(),
<a name="l00372"></a>00372                     &amp;iter-&gt;lane-&gt;getEdge());
<a name="l00373"></a>00373             ++iter;
<a name="l00374"></a>00374         }
<a name="l00375"></a>00375     }
<a name="l00376"></a>00376     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00377"></a>00377 }
<a name="l00378"></a>00378 
<a name="l00379"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5f2790f00efd949513f4a048cfe8f6a6">00379</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5f2790f00efd949513f4a048cfe8f6a6" title="Returns whether the vehicle wil pass the given edge.">MSVehicle::willPass</a>(<span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* <span class="keyword">const</span> edge)<span class="keyword"> const </span>{
<a name="l00380"></a>00380     <span class="keywordflow">return</span> find(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>(), edge) != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>();
<a name="l00381"></a>00381 }
<a name="l00382"></a>00382 
<a name="l00383"></a>00383 <a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html" title="A storage for edge travel times and efforts.">MSEdgeWeightsStorage</a>&amp;
<a name="l00384"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9f7808ad293132af07435a98b745f8ce">00384</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9f7808ad293132af07435a98b745f8ce" title="Returns the vehicle&amp;#39;s internal edge travel times/efforts container.">MSVehicle::getWeightsStorage</a>() {
<a name="l00385"></a>00385     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac1d5460cf8c02692ae70b5679d2a9056" title="The vehicle&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a> == 0) {
<a name="l00386"></a>00386         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac1d5460cf8c02692ae70b5679d2a9056" title="The vehicle&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a> = <span class="keyword">new</span> <a class="code" href="../../d6/d8f/class_m_s_edge_weights_storage.html" title="A storage for edge travel times and efforts.">MSEdgeWeightsStorage</a>();
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388     <span class="keywordflow">return</span> *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac1d5460cf8c02692ae70b5679d2a9056" title="The vehicle&amp;#39;s knowledge about edge efforts/travel times;.">myEdgeWeights</a>;
<a name="l00389"></a>00389 }
<a name="l00390"></a>00390 
<a name="l00391"></a>00391 <span class="comment">// ------------ Interaction with move reminders</span>
<a name="l00392"></a>00392 <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2d2ecdb21395e05fa17990c6770c3c9b" title="Processes active move reminder.">MSVehicle::workOnMoveReminders</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> oldPos, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> newPos,
<a name="l00393"></a>00393         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> newSpeed) {
<a name="l00394"></a>00394     <span class="comment">// This erasure-idiom works for all stl-sequence-containers</span>
<a name="l00395"></a>00395     <span class="comment">// See Meyers: Effective STL, Item 9</span>
<a name="l00396"></a>00396     <span class="keywordflow">for</span> (MoveReminderCont::iterator rem = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.begin();
<a name="l00397"></a>00397             rem != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.end();) {
<a name="l00398"></a>00398         <span class="keywordflow">if</span> (!rem-&gt;first-&gt;notifyMove(*<span class="keyword">this</span>, oldPos + rem-&gt;second,
<a name="l00399"></a>00399                 newPos + rem-&gt;second, newSpeed)) {
<a name="l00400"></a>00400             rem = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.erase(rem);
<a name="l00401"></a>00401         } <span class="keywordflow">else</span> {
<a name="l00402"></a>00402             ++rem;
<a name="l00403"></a>00403         }
<a name="l00404"></a>00404     }
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2501dc16614c13ce4e62831c0c234eaf">00407</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2501dc16614c13ce4e62831c0c234eaf" title="Adapts the vehicle&amp;#39;s entering of a new lane.">MSVehicle::adaptLaneEntering2MoveReminder</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>&amp; enteredLane) {
<a name="l00408"></a>00408     <span class="comment">// save the old work reminders, patching the position information</span>
<a name="l00409"></a>00409     <span class="comment">//  add the information about the new offset to the old lane reminders</span>
<a name="l00410"></a>00410     <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> oldLaneLength = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l00411"></a>00411     <span class="keywordflow">for</span> (MoveReminderCont::iterator rem = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.begin();
<a name="l00412"></a>00412             rem != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.end(); ++rem) {
<a name="l00413"></a>00413         rem-&gt;second += oldLaneLength;
<a name="l00414"></a>00414     }
<a name="l00415"></a>00415     <span class="keywordflow">for</span> (std::vector&lt;MSMoveReminder*&gt;::const_iterator rem =
<a name="l00416"></a>00416             enteredLane.<a class="code" href="../../d9/d16/class_m_s_lane.html#ad57e765b14d44ac3b32e65ed6d18e561" title="Return the list of this lane&amp;#39;s move reminders.">getMoveReminders</a>().begin();
<a name="l00417"></a>00417             rem != enteredLane.<a class="code" href="../../d9/d16/class_m_s_lane.html#ad57e765b14d44ac3b32e65ed6d18e561" title="Return the list of this lane&amp;#39;s move reminders.">getMoveReminders</a>().end(); ++rem) {
<a name="l00418"></a>00418         <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a32bbfcef95b3ea0c42d77b5e9921b953" title="Adds a MoveReminder dynamically.">addReminder</a>(*rem);
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 <span class="comment">// ------------ Other getter methods</span>
<a name="l00423"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73">00423</a> <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">MSVehicle::getPosition</a>()<span class="keyword"> const </span>{
<a name="l00424"></a>00424     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a> == 0) {
<a name="l00425"></a>00425         <span class="keywordflow">return</span> <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a>(-1000, -1000);
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8b6eba4f01577ab96e7e606d5028bf44" title="Returns this lane&amp;#39;s shape.">getShape</a>().<a class="code" href="../../da/d56/class_position_vector.html#a716318d3b0fe4298f5384d8d38688b6c" title="Returns the position at the given length.">positionAtLengthPosition</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>());
<a name="l00428"></a>00428 }
<a name="l00429"></a>00429 
<a name="l00430"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a58306cace8fdb949c89fefb3279220f8">00430</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a58306cace8fdb949c89fefb3279220f8" title="Returns the vehicle&amp;#39;s direction in degrees.">MSVehicle::getAngle</a>()<span class="keyword"> const </span>{
<a name="l00431"></a>00431     <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a> p1 = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8b6eba4f01577ab96e7e606d5028bf44" title="Returns this lane&amp;#39;s shape.">getShape</a>().<a class="code" href="../../da/d56/class_position_vector.html#a716318d3b0fe4298f5384d8d38688b6c" title="Returns the position at the given length.">positionAtLengthPosition</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>());
<a name="l00432"></a>00432     <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a> p2 =
<a name="l00433"></a>00433             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.size() &gt; 0 ?
<a name="l00434"></a>00434                     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.front()-&gt;getShape().positionAtLengthPosition(
<a name="l00435"></a>00435                             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.front()-&gt;getPartialOccupatorEnd()) :
<a name="l00436"></a>00436                     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8b6eba4f01577ab96e7e606d5028bf44" title="Returns this lane&amp;#39;s shape.">getShape</a>().<a class="code" href="../../da/d56/class_position_vector.html#a716318d3b0fe4298f5384d8d38688b6c" title="Returns the position at the given length.">positionAtLengthPosition</a>(
<a name="l00437"></a>00437                             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>() - <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#affc5e63e8f8ff67003b8e3109f05ce5c" title="Get vehicle&amp;#39;s length including the minimum gap [m].">getLengthWithGap</a>());
<a name="l00438"></a>00438     <span class="keywordflow">if</span> (p1 != p2) {
<a name="l00439"></a>00439         <span class="keywordflow">return</span> atan2(p1.<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>() - p2.<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>(), p2.<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>() - p1.<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>()) * 180. / <a class="code" href="../../d1/dc9/polyfonts_8c.html#a598a3330b3c21701223ee0ca14316eca">PI</a>;
<a name="l00440"></a>00440     } <span class="keywordflow">else</span> {
<a name="l00441"></a>00441         <span class="keywordflow">return</span> -<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8b6eba4f01577ab96e7e606d5028bf44" title="Returns this lane&amp;#39;s shape.">getShape</a>().<a class="code" href="../../da/d56/class_position_vector.html#aa657defd3f3245b6e186e080be2a22d1" title="Returns the position at the given length.">rotationDegreeAtLengthPosition</a>(
<a name="l00442"></a>00442                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9730b019bfc264e955b4af196619f72d" title="Get the vehicle&amp;#39;s position along the lane.">getPositionOnLane</a>());
<a name="l00443"></a>00443     }
<a name="l00444"></a>00444 }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446 <span class="comment">// ------------</span>
<a name="l00447"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a602d0955951adc814cffc1a3fdc41d80">00447</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a602d0955951adc814cffc1a3fdc41d80" title="Adds a stop.">MSVehicle::addStop</a>(<span class="keyword">const</span> <a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html" title="Definition of vehicle stop (position and duration).">SUMOVehicleParameter::Stop</a>&amp; stopPar,
<a name="l00448"></a>00448         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> untilOffset) {
<a name="l00449"></a>00449     <a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html" title="Definition of vehicle stop (position and duration).">Stop</a> stop;
<a name="l00450"></a>00450     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a1fb74cf5fb948ec9413368b6ee50e0c2" title="The lane to stop at.">lane</a> = <a class="code" href="../../d9/d16/class_m_s_lane.html#a965f4a235ad88d59aa404c1054dafe75" title="Inserts a MSLane into the static dictionary Returns true if the key id isn&amp;#39;t...">MSLane::dictionary</a>(stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a>);
<a name="l00451"></a>00451     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#ada264a37f412a62743bf99a40b07cb10" title="(Optional) bus stop if one is assigned to the stop">busstop</a> = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a47bc0503e556135e3aceb65c691209de" title="Returns the named bus stop.">getBusStop</a>(stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ad7e6ddc044bf06a4052ac2f366372cfa" title="(Optional) bus stop if one is assigned to the stop">busstop</a>);
<a name="l00452"></a>00452     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a83aa90ad9a973fc67f7194a6cc4eca07" title="The stopping position start.">startPos</a> = stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a3435e088375fa79b59c4b58aac609f0c" title="The stopping position start.">startPos</a>;
<a name="l00453"></a>00453     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#af98c0ad5162478cebabf542f7d510cfb" title="The stopping position end.">endPos</a> = stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a>;
<a name="l00454"></a>00454     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a612239bd519fdc6b960fed7f4b693afd" title="The stopping duration.">duration</a> = stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#af34de16e90f8027aac5973aefc3bbde0" title="The stopping duration.">duration</a>;
<a name="l00455"></a>00455     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#abb4ee623bd804746c08c84ae7cf9617e" title="The time at which the vehicle may continue its journey.">until</a> = stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a9183e42ddbb877af1e4b767a1847ceda" title="The time at which the vehicle may continue its journey.">until</a>;
<a name="l00456"></a>00456     <span class="keywordflow">if</span> (stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#abb4ee623bd804746c08c84ae7cf9617e" title="The time at which the vehicle may continue its journey.">until</a> != -1) {
<a name="l00457"></a>00457         stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#abb4ee623bd804746c08c84ae7cf9617e" title="The time at which the vehicle may continue its journey.">until</a> += untilOffset;
<a name="l00458"></a>00458     }
<a name="l00459"></a>00459     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a9564f074adf2dc50ee8348cbefae72cb" title="whether an arriving person lets the vehicle continue">triggered</a> = stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a959e989af41210da5548f1186efc4495" title="whether an arriving person lets the vehicle continue">triggered</a>;
<a name="l00460"></a>00460     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#af08228ab5253e1f2c8942745073238e6" title="whether the vehicle is removed from the net while stopping">parking</a> = stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ac510509332a167a67550d62e941be867" title="whether the vehicle is removed from the net while stopping">parking</a>;
<a name="l00461"></a>00461     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a9384cf1a51ffa78f0ac5efe2a695caca" title="Information whether the stop has been reached.">reached</a> = <span class="keyword">false</span>;
<a name="l00462"></a>00462     <span class="keywordflow">if</span> (stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a83aa90ad9a973fc67f7194a6cc4eca07" title="The stopping position start.">startPos</a> &lt; 0 || stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#af98c0ad5162478cebabf542f7d510cfb" title="The stopping position end.">endPos</a> &gt; stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a1fb74cf5fb948ec9413368b6ee50e0c2" title="The lane to stop at.">lane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>()) {
<a name="l00463"></a>00463         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00464"></a>00464     }
<a name="l00465"></a>00465     stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a> = find(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>(), &amp;stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a1fb74cf5fb948ec9413368b6ee50e0c2" title="The lane to stop at.">lane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>());
<a name="l00466"></a>00466     <a class="code" href="../../d0/d24/_m_s_route_8h.html#a7253220e09ff4670521e6da98a9fc3f6">MSRouteIterator</a> prevStopEdge = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>;
<a name="l00467"></a>00467     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> prevStopPos = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l00468"></a>00468     <span class="comment">// where to insert the stop</span>
<a name="l00469"></a>00469     std::list&lt;Stop&gt;::iterator iter = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin();
<a name="l00470"></a>00470     <span class="keywordflow">if</span> (stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a24c5761d498b1887614323093e764c83">STOP_INDEX_END</a>
<a name="l00471"></a>00471             || stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> &gt;= static_cast&lt;int&gt;(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.size())) {
<a name="l00472"></a>00472         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.size() &gt; 0) {
<a name="l00473"></a>00473             prevStopEdge = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.back().edge;
<a name="l00474"></a>00474             prevStopPos = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.back().endPos;
<a name="l00475"></a>00475             iter = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.end();
<a name="l00476"></a>00476             stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a> = find(prevStopEdge, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>(),
<a name="l00477"></a>00477                     &amp;stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a1fb74cf5fb948ec9413368b6ee50e0c2" title="The lane to stop at.">lane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>());
<a name="l00478"></a>00478         }
<a name="l00479"></a>00479     } <span class="keywordflow">else</span> {
<a name="l00480"></a>00480         <span class="keywordflow">if</span> (stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#ab6f852854d8e837bb72b5d08fb66cf15">STOP_INDEX_FIT</a>) {
<a name="l00481"></a>00481             <span class="keywordflow">while</span> (iter != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.end()
<a name="l00482"></a>00482                     &amp;&amp; (iter-&gt;edge &lt; stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a>
<a name="l00483"></a>00483                             || (iter-&gt;endPos &lt; stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#af98c0ad5162478cebabf542f7d510cfb" title="The stopping position end.">endPos</a>
<a name="l00484"></a>00484                                     &amp;&amp; iter-&gt;edge == stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a>))) {
<a name="l00485"></a>00485                 prevStopEdge = iter-&gt;edge;
<a name="l00486"></a>00486                 prevStopPos = iter-&gt;endPos;
<a name="l00487"></a>00487                 ++iter;
<a name="l00488"></a>00488             }
<a name="l00489"></a>00489         } <span class="keywordflow">else</span> {
<a name="l00490"></a>00490             <span class="keywordtype">int</span> index = stopPar.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a>;
<a name="l00491"></a>00491             <span class="keywordflow">while</span> (index &gt; 0) {
<a name="l00492"></a>00492                 prevStopEdge = iter-&gt;edge;
<a name="l00493"></a>00493                 prevStopPos = iter-&gt;endPos;
<a name="l00494"></a>00494                 ++iter;
<a name="l00495"></a>00495                 --index;
<a name="l00496"></a>00496             }
<a name="l00497"></a>00497             stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a> = find(prevStopEdge, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>(),
<a name="l00498"></a>00498                     &amp;stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a1fb74cf5fb948ec9413368b6ee50e0c2" title="The lane to stop at.">lane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>());
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a> == <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>() || prevStopEdge &gt; stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a>
<a name="l00502"></a>00502             || prevStopEdge == stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a> &amp;&amp; prevStopPos &gt; stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#af98c0ad5162478cebabf542f7d510cfb" title="The stopping position end.">endPos</a>) {
<a name="l00503"></a>00503         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00504"></a>00504     }
<a name="l00505"></a>00505     <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> == stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a75d4e1017272090b082ee34989e321a1" title="The edge in the route to stop at.">edge</a>
<a name="l00506"></a>00506             &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>
<a name="l00507"></a>00507                     &gt; stop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#af98c0ad5162478cebabf542f7d510cfb" title="The stopping position end.">endPos</a>
<a name="l00508"></a>00508                             - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a69f16520d18bdb916d03d0ad4d342209" title="Returns the distance the vehicle needs to halt including driver&amp;#39;s reaction time...">brakeGap</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) {
<a name="l00509"></a>00509         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00510"></a>00510     }
<a name="l00511"></a>00511     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.insert(iter, stop);
<a name="l00512"></a>00512     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#aacc7b7189db234f706f3329434c9e38d">00515</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aacc7b7189db234f706f3329434c9e38d" title="Returns whether the vehicle is at a stop.">MSVehicle::isStopped</a>()<span class="keyword"> const </span>{
<a name="l00516"></a>00516     <span class="keywordflow">return</span> !<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.empty() &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin()-&gt;reached;
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a032507a55bddb7aa027f5c05766c3c36">00519</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a032507a55bddb7aa027f5c05766c3c36" title="Returns whether the vehicle is parking.">MSVehicle::isParking</a>()<span class="keyword"> const </span>{
<a name="l00520"></a>00520     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aacc7b7189db234f706f3329434c9e38d" title="Returns whether the vehicle is at a stop.">isStopped</a>() &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin()-&gt;parking;
<a name="l00521"></a>00521 }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ad1fe58c18722da8f15644cfd7afdf59e" title="Processes stops, returns the velocity needed to reach the stop.">MSVehicle::processNextStop</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> currentVelocity) {
<a name="l00524"></a>00524     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.empty()) {
<a name="l00525"></a>00525         <span class="comment">// no stops; pass</span>
<a name="l00526"></a>00526         <span class="keywordflow">return</span> currentVelocity;
<a name="l00527"></a>00527     }
<a name="l00528"></a>00528     <a class="code" href="../../da/ddf/struct_stop.html" title="Definition of vehicle stop (position and duration).">Stop</a>&amp; stop = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.front();
<a name="l00529"></a>00529     <span class="keywordflow">if</span> (stop.reached) {
<a name="l00530"></a>00530         <span class="comment">// ok, we have already reached the next stop</span>
<a name="l00531"></a>00531         <span class="comment">// any waiting persons may board now</span>
<a name="l00532"></a>00532         <span class="keywordtype">bool</span> boarded = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a20498f518473681a3e0e9e570e3bf12d" title="Returns the person control.">getPersonControl</a>().<a class="code" href="../../db/d3c/class_m_s_person_control.html#ae15c14f0a85d59d8d42b985f3c78e040" title="board any applicable persons Boards any people who wait on that edge for the given...">boardAnyWaiting</a>(
<a name="l00533"></a>00533                 &amp;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>(), <span class="keyword">this</span>);
<a name="l00534"></a>00534         <span class="keywordflow">if</span> (boarded) {
<a name="l00535"></a>00535             <span class="comment">// the triggering condition has been fulfilled. Maybe we want to wait a bit longer for additional riders (car pooling)</span>
<a name="l00536"></a>00536             stop.triggered = <span class="keyword">false</span>;
<a name="l00537"></a>00537             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4349d9d0dae9f9b60ed3aba717978dd2" title="Whether this vehicle is registered as waiting for a person (for deadlock-recognition)...">myAmRegisteredAsWaitingForPerson</a>) {
<a name="l00538"></a>00538                 <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a5e74ee833cafefa74b84e2091ef135a3" title="Returns the vehicle control.">getVehicleControl</a>().<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#ad5889b28f06a66219d70cb9cf8551451" title="decreases the count of vehicles waiting for a person to allow recogniztion of person...">unregisterOneWaitingForPerson</a>();
<a name="l00539"></a>00539                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4349d9d0dae9f9b60ed3aba717978dd2" title="Whether this vehicle is registered as waiting for a person (for deadlock-recognition)...">myAmRegisteredAsWaitingForPerson</a> = <span class="keyword">false</span>;
<a name="l00540"></a>00540             }
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542         <span class="keywordflow">if</span> (stop.duration &lt;= 0 &amp;&amp; !stop.triggered) {
<a name="l00543"></a>00543             <span class="comment">// we have waited long enough and fulfilled any passenger-requirements</span>
<a name="l00544"></a>00544             <span class="keywordflow">if</span> (stop.busstop != 0) {
<a name="l00545"></a>00545                 <span class="comment">// inform bus stop about leaving it</span>
<a name="l00546"></a>00546                 stop.busstop-&gt;leaveFrom(<span class="keyword">this</span>);
<a name="l00547"></a>00547             }
<a name="l00548"></a>00548             <span class="comment">// the current stop is no longer valid</span>
<a name="l00549"></a>00549             <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a5e74ee833cafefa74b84e2091ef135a3" title="Returns the vehicle control.">getVehicleControl</a>().<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a737cd6116266e0dc73dd8962d9001ebb">removeWaiting</a>(
<a name="l00550"></a>00550                     &amp;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>(), <span class="keyword">this</span>);
<a name="l00551"></a>00551             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.pop_front();
<a name="l00552"></a>00552             <span class="comment">// do not count the stopping time towards gridlock time.</span>
<a name="l00553"></a>00553             <span class="comment">// Other outputs use an independent counter and are not affected.</span>
<a name="l00554"></a>00554             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a1436c3be4a550287cb44712bafdf865c" title="The time the vehicle waits (is not faster than 0.1m/s) in seconds.">myWaitingTime</a> = 0;
<a name="l00555"></a>00555             <span class="comment">// maybe the next stop is on the same edge; let&#39;s rebuild best lanes</span>
<a name="l00556"></a>00556             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4fc0b32f53a2415b39634217a5741adc" title="Returns the description of best lanes to use in order to continue the route.">getBestLanes</a>(<span class="keyword">true</span>);
<a name="l00557"></a>00557             <span class="comment">// continue as wished...</span>
<a name="l00558"></a>00558         } <span class="keywordflow">else</span> {
<a name="l00559"></a>00559             <span class="comment">// we have to wait some more time</span>
<a name="l00560"></a>00560             <span class="keywordflow">if</span> (stop.triggered &amp;&amp; !<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4349d9d0dae9f9b60ed3aba717978dd2" title="Whether this vehicle is registered as waiting for a person (for deadlock-recognition)...">myAmRegisteredAsWaitingForPerson</a>) {
<a name="l00561"></a>00561                 <span class="comment">// we can only register after waiting for one step. otherwise we might falsely signal a deadlock</span>
<a name="l00562"></a>00562                 <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a5e74ee833cafefa74b84e2091ef135a3" title="Returns the vehicle control.">getVehicleControl</a>().<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a396d78814b3e08b63fd014728ece1f47" title="increases the count of vehicles waiting for a person to allow recogniztion of person...">registerOneWaitingForPerson</a>();
<a name="l00563"></a>00563                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4349d9d0dae9f9b60ed3aba717978dd2" title="Whether this vehicle is registered as waiting for a person (for deadlock-recognition)...">myAmRegisteredAsWaitingForPerson</a> = <span class="keyword">true</span>;
<a name="l00564"></a>00564             }
<a name="l00565"></a>00565             stop.duration -= <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>;
<a name="l00566"></a>00566             <span class="keywordflow">return</span> 0;
<a name="l00567"></a>00567         }
<a name="l00568"></a>00568     } <span class="keywordflow">else</span> {
<a name="l00569"></a>00569         <span class="comment">// is the next stop on the current lane?</span>
<a name="l00570"></a>00570         <span class="keywordflow">if</span> (stop.edge == <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>) {
<a name="l00571"></a>00571             <span class="comment">// get the stopping position</span>
<a name="l00572"></a>00572             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> endPos = stop.endPos;
<a name="l00573"></a>00573             <span class="keywordtype">bool</span> busStopsMustHaveSpace = <span class="keyword">true</span>;
<a name="l00574"></a>00574             <span class="keywordflow">if</span> (stop.busstop != 0) {
<a name="l00575"></a>00575                 <span class="comment">// on bus stops, we have to wait for free place if they are in use...</span>
<a name="l00576"></a>00576                 endPos = stop.busstop-&gt;getLastFreePos();
<a name="l00577"></a>00577                 <span class="keywordflow">if</span> (endPos - 5. &lt; stop.busstop-&gt;getBeginLanePosition()) { <span class="comment">// !!! explicit offset</span>
<a name="l00578"></a>00578                     busStopsMustHaveSpace = <span class="keyword">false</span>;
<a name="l00579"></a>00579                 }
<a name="l00580"></a>00580             }
<a name="l00581"></a>00581             <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>() &gt;= endPos - <a class="code" href="../../dd/d1d/_m_s_vehicle_8cpp.html#ad6e57ec62988057451224a702a658f9b">BUS_STOP_OFFSET</a>
<a name="l00582"></a>00582                     &amp;&amp; busStopsMustHaveSpace) {
<a name="l00583"></a>00583                 <span class="comment">// ok, we may stop (have reached the stop)</span>
<a name="l00584"></a>00584                 stop.reached = <span class="keyword">true</span>;
<a name="l00585"></a>00585                 <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a5e74ee833cafefa74b84e2091ef135a3" title="Returns the vehicle control.">getVehicleControl</a>().<a class="code" href="../../db/d2f/class_m_s_vehicle_control.html#a89f7ab897e1f54bc4c33f00f95c0311b">addWaiting</a>(
<a name="l00586"></a>00586                         &amp;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>(), <span class="keyword">this</span>);
<a name="l00587"></a>00587                 <span class="comment">// compute stopping time</span>
<a name="l00588"></a>00588                 <span class="keywordflow">if</span> (stop.until &gt;= 0) {
<a name="l00589"></a>00589                     <span class="keywordflow">if</span> (stop.duration == -1) {
<a name="l00590"></a>00590                         stop.duration = stop.until
<a name="l00591"></a>00591                                 - <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l00592"></a>00592                     } <span class="keywordflow">else</span> {
<a name="l00593"></a>00593                         stop.duration =
<a name="l00594"></a>00594                                 <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(stop.duration,
<a name="l00595"></a>00595                                         stop.until
<a name="l00596"></a>00596                                                 - <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>());
<a name="l00597"></a>00597                     }
<a name="l00598"></a>00598                 }
<a name="l00599"></a>00599                 <span class="keywordflow">if</span> (stop.busstop != 0) {
<a name="l00600"></a>00600                     <span class="comment">// let the bus stop know the vehicle</span>
<a name="l00601"></a>00601                     stop.busstop-&gt;enter(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>(),
<a name="l00602"></a>00602                             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>() - <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#affc5e63e8f8ff67003b8e3109f05ce5c" title="Get vehicle&amp;#39;s length including the minimum gap [m].">getLengthWithGap</a>());
<a name="l00603"></a>00603                 }
<a name="l00604"></a>00604             }
<a name="l00605"></a>00605             <span class="comment">// decelerate</span>
<a name="l00606"></a>00606             <span class="comment">// !!! should not v be 0 when we have reached the stop?</span>
<a name="l00607"></a>00607             <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>, endPos - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>());
<a name="l00608"></a>00608         }
<a name="l00609"></a>00609     }
<a name="l00610"></a>00610     <span class="keywordflow">return</span> currentVelocity;
<a name="l00611"></a>00611 }
<a name="l00612"></a>00612 
<a name="l00613"></a>00613 <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ad33ff712c77d8f3a80d4397873b65b6e" title="Moves vehicles which may run out of the lane.">MSVehicle::moveRegardingCritical</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> t, <span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* <span class="keyword">const</span> lane,
<a name="l00614"></a>00614         <span class="keyword">const</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html" title="Representation of a vehicle in the micro simulation.">MSVehicle</a>* <span class="keyword">const</span> pred, <span class="keyword">const</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html" title="Representation of a vehicle in the micro simulation.">MSVehicle</a>* <span class="keyword">const</span> neigh,
<a name="l00615"></a>00615         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> lengthsInFront) {
<a name="l00616"></a>00616 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l00617"></a>00617 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (myHBMsgEmitter != 0) {
<a name="l00618"></a>00618         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9c57b7d54c70b1d5c7b2db6434c2c7e0" title="Returns the information whether the vehicle is on a road (is simulated).">isOnRoad</a>()) {
<a name="l00619"></a>00619             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> timeStep = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l00620"></a>00620             myHBMsgEmitter-&gt;writeHeartBeatEvent(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>, timeStep, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>());
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623 <span class="preprocessor">#endif</span>
<a name="l00624"></a>00624 <span class="preprocessor"></span><span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l00625"></a>00625 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../de/dd7/_g_u_i_global_selection_8cpp.html#a2726a253c94700d65ae60acdf38a4f29" title="A global holder of selected objects.">gSelected</a>.<a class="code" href="../../d1/dae/class_g_u_i_selected_storage.html#aabb67245d52decb3dbc5aee46ab82a24" title="Returns the information whether the object with the given type and id is selected...">isSelected</a>(<a class="code" href="../../db/dcf/_g_u_i_gl_object_types_8h.html#af2b60d80f2ed12c3f597887aec83db5caae40d439832a13fb1598a451375e92ce" title="a vehicles">GLO_VEHICLE</a>, static_cast&lt;const GUIVehicle*&gt;(<span class="keyword">this</span>)-&gt;getGlID())) {
<a name="l00626"></a>00626         <span class="keywordtype">int</span> <a class="code" href="../../d5/d3d/_m_s___e2___z_s___collector_over_lanes_8cpp.html#a01abcd138495e1be908eb2bdf86f453e">bla</a> = 0;
<a name="l00627"></a>00627     }
<a name="l00628"></a>00628 <span class="preprocessor">#endif</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span>    <span class="comment">// remove information about approaching links, will be reset later in this step</span>
<a name="l00630"></a>00630     <span class="keywordflow">for</span> (DriveItemVector::iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.begin();
<a name="l00631"></a>00631             i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.end(); ++i) {
<a name="l00632"></a>00632         <span class="keywordflow">if</span> ((*i).myLink != 0) {
<a name="l00633"></a>00633             (*i).myLink-&gt;removeApproaching(<span class="keyword">this</span>);
<a name="l00634"></a>00634         }
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.clear();
<a name="l00637"></a>00637     <span class="comment">//</span>
<a name="l00638"></a>00638     <span class="keyword">const</span> <a class="code" href="../../d1/d9d/class_m_s_c_f_model.html" title="The car-following model abstraction.">MSCFModel</a>&amp; cfModel = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>();
<a name="l00639"></a>00639     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vBeg = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#af87c32b0447ae5bc4d30e5b633af963a" title="Returns the maximum speed given the current speed.">maxNextSpeed</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>),
<a name="l00640"></a>00640             lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>());
<a name="l00641"></a>00641     <span class="comment">// check whether the vehicle is not on an appropriate lane</span>
<a name="l00642"></a>00642     <span class="keywordtype">bool</span> onAppropriateLane = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a1ee9f222afc0947807e1b4e5790cb008">appropriate</a>(<span class="keyword">this</span>);
<a name="l00643"></a>00643     <span class="keywordflow">if</span> (!onAppropriateLane) {
<a name="l00644"></a>00644         <span class="comment">// decelerate to lane end when yes</span>
<a name="l00645"></a>00645         vBeg = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(
<a name="l00646"></a>00646                 cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>),
<a name="l00647"></a>00647                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>());
<a name="l00648"></a>00648     }
<a name="l00649"></a>00649     <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> == <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>() - 1) {
<a name="l00650"></a>00650         <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a1a96ff3c032ed5aa862bf3cf3d4607d4" title="Information how the vehicle&amp;#39;s end speed shall be chosen.">arrivalSpeedProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a42d4e43bf91f4d708bb6c0ae0a6b8abdadb730c6984248f5d75a66b16e43c1062" title="The speed is given.">ARRIVAL_SPEED_GIVEN</a>) {
<a name="l00651"></a>00651             vBeg = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(
<a name="l00652"></a>00652                     cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a343e6bf5cc2808e2641a2578002948c0" title="Computes the vehicle&amp;#39;s safe speed without a leader.">freeSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(),
<a name="l00653"></a>00653                             <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#afd710496383af73ec9caee1dcb674a5a" title="the position on the destination lane where the vehicle stops">myArrivalPos</a> - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>,
<a name="l00654"></a>00654                             <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a4126e93c0bd2fb528e9b0d625e73e3b0" title="(optional) The final speed of the vehicle (not used yet)">arrivalSpeed</a>), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>());
<a name="l00655"></a>00655         } <span class="keywordflow">else</span> {
<a name="l00656"></a>00656             vBeg = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>();
<a name="l00657"></a>00657         }
<a name="l00658"></a>00658     }
<a name="l00659"></a>00659     <span class="comment">// interaction with leader</span>
<a name="l00660"></a>00660     <span class="keywordflow">if</span> (pred != 0) {
<a name="l00661"></a>00661         <span class="comment">// interaction with leader if one exists on same lane</span>
<a name="l00662"></a>00662         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a73e2d1e81a2505efe0e50b7531fd4708" title="Uses the given values to compute the brutto-gap.">gap</a> = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ad2349642fcefda05160bc549921a29c2" title="Returns the gap between pred and this vehicle.">gap2pred</a>(*pred);
<a name="l00663"></a>00663         <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#ac6266ef6763e950e2bda86c55aac4807">MSGlobals::gCheck4Accidents</a> &amp;&amp; gap &lt; 0) {
<a name="l00664"></a>00664             <span class="comment">// collision occured!</span>
<a name="l00665"></a>00665             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00666"></a>00666         }
<a name="l00667"></a>00667         vBeg = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vBeg,
<a name="l00668"></a>00668                 cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a83091fc05838bf11888a8ce394593bfc" title="Computes the vehicle&amp;#39;s safe speed (no dawdling).">followSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ad2349642fcefda05160bc549921a29c2" title="Returns the gap between pred and this vehicle.">gap2pred</a>(*pred),
<a name="l00669"></a>00669                         pred-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(),
<a name="l00670"></a>00670                         pred-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a34ff88aa3a70d55d1d771284e521877a" title="Get the vehicle type&amp;#39;s maximum deceleration [m/s^2].">getMaxDecel</a>()));
<a name="l00671"></a>00671     } <span class="keywordflow">else</span> {
<a name="l00672"></a>00672         <span class="comment">// (potential) interaction with a vehicle extending partially into this lane</span>
<a name="l00673"></a>00673         <a class="code" href="../../d7/d90/class_m_s_vehicle.html" title="Representation of a vehicle in the micro simulation.">MSVehicle</a>* predP = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ac35b6a282ccf3433234cf9b071966deb" title="Returns the vehicle which laps into this lane.">getPartialOccupator</a>();
<a name="l00674"></a>00674         <span class="keywordflow">if</span> (predP != 0 &amp;&amp; predP != <span class="keyword">this</span>) {
<a name="l00675"></a>00675             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> gap = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ac5ebca511b7620782816f28257913c7a" title="Returns the position of the in-lapping vehicle&amp;#39;s end.">getPartialOccupatorEnd</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l00676"></a>00676             <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#ac6266ef6763e950e2bda86c55aac4807">MSGlobals::gCheck4Accidents</a> &amp;&amp; gap &lt; 0) {
<a name="l00677"></a>00677                 <span class="comment">// collision occured!</span>
<a name="l00678"></a>00678                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00679"></a>00679             }
<a name="l00680"></a>00680             vBeg = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vBeg,
<a name="l00681"></a>00681                     cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a83091fc05838bf11888a8ce394593bfc" title="Computes the vehicle&amp;#39;s safe speed (no dawdling).">followSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(), gap,
<a name="l00682"></a>00682                             predP-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(),
<a name="l00683"></a>00683                             predP-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a34ff88aa3a70d55d1d771284e521877a" title="Get the vehicle type&amp;#39;s maximum deceleration [m/s^2].">getMaxDecel</a>()));
<a name="l00684"></a>00684         }
<a name="l00685"></a>00685     }
<a name="l00686"></a>00686     <span class="comment">// interaction with left-lane leader (do not overtake right)</span>
<a name="l00687"></a>00687     cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a663a578edc87ebf122044e26ae14bb53" title="Incorporates the influence of the vehicle on the left lane.">leftVehicleVsafe</a>(<span class="keyword">this</span>, neigh, vBeg);
<a name="l00688"></a>00688     <span class="comment">// check whether the vehicle wants to stop somewhere</span>
<a name="l00689"></a>00689     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.empty()
<a name="l00690"></a>00690             &amp;&amp; &amp;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin()-&gt;lane-&gt;getEdge() == &amp;lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>()) {
<a name="l00691"></a>00691         <span class="keyword">const</span> <a class="code" href="../../da/ddf/struct_stop.html" title="Definition of vehicle stop (position and duration).">Stop</a>&amp; stop = *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin();
<a name="l00692"></a>00692         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> stopPos =
<a name="l00693"></a>00693                 stop.busstop == 0 ?
<a name="l00694"></a>00694                         stop.endPos :
<a name="l00695"></a>00695                         stop.busstop-&gt;getLastFreePos() - <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>;
<a name="l00696"></a>00696         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> seen = lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>();
<a name="l00697"></a>00697         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vsafeStop = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>,
<a name="l00698"></a>00698                 seen - (lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - stopPos));
<a name="l00699"></a>00699         vBeg = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vBeg, vsafeStop);
<a name="l00700"></a>00700     }
<a name="l00701"></a>00701     vBeg = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>((<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) 0, vBeg);
<a name="l00702"></a>00702 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l00703"></a>00703 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (vBeg &lt; cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) {
<a name="l00704"></a>00704         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Vehicle &#39;&quot;</span> + <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af558b8f5379ec8f91cb47e9b7d2b7556" title="Returns the name of the vehicle.">getID</a>() + <span class="stringliteral">&quot;&#39; is decelerating too much (#1; is: &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> - vBeg) + <span class="stringliteral">&quot;, may: &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) + <span class="stringliteral">&quot;)&quot;</span>);
<a name="l00705"></a>00705     }
<a name="l00706"></a>00706 <span class="preprocessor">#endif</span>
<a name="l00707"></a>00707 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (!onAppropriateLane) {
<a name="l00708"></a>00708         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.push_back(
<a name="l00709"></a>00709                 DriveProcessItem(0, vBeg, vBeg, <span class="keyword">false</span>, 0, 0,
<a name="l00710"></a>00710                         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>));
<a name="l00711"></a>00711     } <span class="keywordflow">else</span> {
<a name="l00712"></a>00712         <span class="comment">// check whether the driver wants to let someone in</span>
<a name="l00713"></a>00713         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a42b50352626b97cb3fe023efbbf49ee3">vsafeCriticalCont</a>(t, vBeg);
<a name="l00714"></a>00714         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a181288900ce4518b7af2534a984db33d">checkRewindLinkLanes</a>(lengthsInFront);
<a name="l00715"></a>00715     }
<a name="l00716"></a>00716     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00717"></a>00717 }
<a name="l00718"></a>00718 
<a name="l00719"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#ad30685077da0c8a7e9b5d3b925448a89">00719</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ad30685077da0c8a7e9b5d3b925448a89" title="Moves the vehicle after the responds (right-of-way rules) are known.">MSVehicle::moveChecked</a>() {
<a name="l00720"></a>00720 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l00721"></a>00721 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../de/dd7/_g_u_i_global_selection_8cpp.html#a2726a253c94700d65ae60acdf38a4f29" title="A global holder of selected objects.">gSelected</a>.<a class="code" href="../../d1/dae/class_g_u_i_selected_storage.html#aabb67245d52decb3dbc5aee46ab82a24" title="Returns the information whether the object with the given type and id is selected...">isSelected</a>(<a class="code" href="../../db/dcf/_g_u_i_gl_object_types_8h.html#af2b60d80f2ed12c3f597887aec83db5caae40d439832a13fb1598a451375e92ce" title="a vehicles">GLO_VEHICLE</a>, static_cast&lt;const GUIVehicle*&gt;(<span class="keyword">this</span>)-&gt;getGlID())) {
<a name="l00722"></a>00722         <span class="keywordtype">int</span> <a class="code" href="../../d5/d3d/_m_s___e2___z_s___collector_over_lanes_8cpp.html#a01abcd138495e1be908eb2bdf86f453e">bla</a> = 0;
<a name="l00723"></a>00723     }
<a name="l00724"></a>00724 <span class="preprocessor">#endif</span>
<a name="l00725"></a>00725 <span class="preprocessor"></span>    <span class="comment">// get vsafe</span>
<a name="l00726"></a>00726     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vSafe = 0;
<a name="l00727"></a>00727     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9befd677bbe3bba3b2d192ca54301557">myHaveToWaitOnNextLink</a> = <span class="keyword">false</span>;
<a name="l00728"></a>00728     assert(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.size() != 0);
<a name="l00729"></a>00729     DriveItemVector::iterator i;
<a name="l00730"></a>00730     <span class="keywordtype">bool</span> braking = <span class="keyword">false</span>;
<a name="l00731"></a>00731     <span class="keywordtype">bool</span> lastWasGreenCont = <span class="keyword">false</span>;
<a name="l00732"></a>00732     <span class="comment">//Added by Hi-Iberia</span>
<a name="l00733"></a>00733     <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* lastLane = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>;
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a27329a66619be1d62503fd9062670eba">setMyPosOnLane</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>);
<a name="l00736"></a>00736     <span class="keywordflow">for</span> (i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.begin(); i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.end(); ++i) {
<a name="l00737"></a>00737         <a class="code" href="../../d3/d2e/class_m_s_link.html">MSLink</a>* link = (*i).myLink;
<a name="l00738"></a>00738         <span class="comment">// the vehicle must change the lane on one of the next lanes</span>
<a name="l00739"></a>00739         <span class="keywordflow">if</span> (link != 0 &amp;&amp; (*i).mySetRequest) {
<a name="l00740"></a>00740             <span class="keyword">const</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0" title="The right-of-way state of a link between two lanes used when constructing a NBTrafficLightLogic...">LinkState</a> ls = link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#af0ce438792d4eaf299c48a41ed0f1150" title="Returns the current state of the link.">getState</a>();
<a name="l00741"></a>00741             <span class="comment">// vehicles should brake when running onto a yellow light if the distance allows to halt in front</span>
<a name="l00742"></a>00742             <span class="keyword">const</span> <span class="keywordtype">bool</span> yellow = ls == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0a4f9c8f40228bc373888e0ad0c4ea94bc" title="The link has yellow light, may pass.">LINKSTATE_TL_YELLOW_MAJOR</a>
<a name="l00743"></a>00743                     || ls == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0ac024e70664be064530ddcd83984c50ba" title="The link has yellow light, has to brake anyway.">LINKSTATE_TL_YELLOW_MINOR</a>;
<a name="l00744"></a>00744             <span class="keywordflow">if</span> (yellow
<a name="l00745"></a>00745                     &amp;&amp; (*i).myDistance
<a name="l00746"></a>00746                             &gt; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().getSpeedAfterMaxDecel(
<a name="l00747"></a>00747                                     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) {
<a name="l00748"></a>00748                 vSafe = (*i).myVLinkWait;
<a name="l00749"></a>00749                 braking = <span class="keyword">true</span>;
<a name="l00750"></a>00750                 lastWasGreenCont = <span class="keyword">false</span>;
<a name="l00751"></a>00751                 link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a5ea57b146011f376cc3fbb03180ffe2f">removeApproaching</a>(<span class="keyword">this</span>);
<a name="l00752"></a>00752                 <span class="keywordflow">break</span>;
<a name="l00753"></a>00753             }
<a name="l00754"></a>00754             <span class="comment">//</span>
<a name="l00755"></a>00755             <span class="keyword">const</span> <span class="keywordtype">bool</span> opened = link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a32eb62bd90840565b59ca4ab11bb3f40" title="Returns the information whether the link may be passed.">opened</a>((*i).myArrivalTime,
<a name="l00756"></a>00756                     (*i).myArrivalSpeed, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().getLengthWithGap());
<a name="l00757"></a>00757             <span class="comment">// vehicles should decelerate when approaching a minor link</span>
<a name="l00758"></a>00758             <span class="keywordflow">if</span> (opened &amp;&amp; !lastWasGreenCont &amp;&amp; !link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a4606e3d78c34042ad589658695629811" title="Returns whether this link is a major link.">havePriority</a>()
<a name="l00759"></a>00759                     &amp;&amp; (*i).myDistance &gt; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a34ff88aa3a70d55d1d771284e521877a" title="Get the vehicle type&amp;#39;s maximum deceleration [m/s^2].">getMaxDecel</a>()) {
<a name="l00760"></a>00760                 vSafe = (*i).myVLinkWait;
<a name="l00761"></a>00761                 braking = <span class="keyword">true</span>;
<a name="l00762"></a>00762                 lastWasGreenCont = <span class="keyword">false</span>;
<a name="l00763"></a>00763                 <span class="keywordflow">if</span> (ls == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0a6defec283ab1a09233513987b79422bd" title="This is an uncontrolled, right-before-left link.">LINKSTATE_EQUAL</a>) {
<a name="l00764"></a>00764                     link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a5ea57b146011f376cc3fbb03180ffe2f">removeApproaching</a>(<span class="keyword">this</span>);
<a name="l00765"></a>00765                 }
<a name="l00766"></a>00766                 <span class="keywordflow">break</span>; <span class="comment">// could be revalidated</span>
<a name="l00767"></a>00767             }
<a name="l00768"></a>00768             <span class="comment">// have waited; may pass if opened...</span>
<a name="l00769"></a>00769             <span class="keywordflow">if</span> (opened) {
<a name="l00770"></a>00770                 vSafe = (*i).myVLinkPass;
<a name="l00771"></a>00771                 lastWasGreenCont = link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a6b7f3f40535924a9eaa62453bd30da9d">isCont</a>()
<a name="l00772"></a>00772                         &amp;&amp; (ls == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0a6a04d869db81e9a6e456eac1534720ba" title="The link has green light, may pass.">LINKSTATE_TL_GREEN_MAJOR</a>);
<a name="l00773"></a>00773             } <span class="keywordflow">else</span> {
<a name="l00774"></a>00774                 lastWasGreenCont = <span class="keyword">false</span>;
<a name="l00775"></a>00775                 vSafe = (*i).myVLinkWait;
<a name="l00776"></a>00776                 braking = <span class="keyword">true</span>;
<a name="l00777"></a>00777                 <span class="keywordflow">if</span> (ls == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0a6defec283ab1a09233513987b79422bd" title="This is an uncontrolled, right-before-left link.">LINKSTATE_EQUAL</a>) {
<a name="l00778"></a>00778                     link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a5ea57b146011f376cc3fbb03180ffe2f">removeApproaching</a>(<span class="keyword">this</span>);
<a name="l00779"></a>00779                 }
<a name="l00780"></a>00780                 <span class="keywordflow">break</span>;
<a name="l00781"></a>00781             }
<a name="l00782"></a>00782         } <span class="keywordflow">else</span> {
<a name="l00783"></a>00783             vSafe = (*i).myVLinkWait;
<a name="l00784"></a>00784             braking = <span class="keyword">true</span>;
<a name="l00785"></a>00785             <span class="keywordflow">break</span>;
<a name="l00786"></a>00786         }
<a name="l00787"></a>00787     }
<a name="l00788"></a>00788 
<a name="l00789"></a>00789     <span class="keywordflow">if</span> (braking) {
<a name="l00790"></a>00790         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9befd677bbe3bba3b2d192ca54301557">myHaveToWaitOnNextLink</a> = <span class="keyword">true</span>;
<a name="l00791"></a>00791     }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vNext = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a9342f04f484417946d8cbb4cb3dd489a" title="Applies interaction with stops and lane changing model influences.">moveHelper</a>(<span class="keyword">this</span>, vSafe);
<a name="l00794"></a>00794     <span class="comment">//  Added by Hi-Iberia</span>
<a name="l00795"></a>00795     <span class="comment">//  Following the same approach followed by the article</span>
<a name="l00796"></a>00796     <span class="comment">//  &quot;Electric Vehicle Simulator for energy Consumption Studies in Electric Mobility Systems&quot;</span>
<a name="l00797"></a>00797     <a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html" title="A device which collects Full electric vehicles consumptions.">MSDevice_FEV</a> * aux1 = NULL;
<a name="l00798"></a>00798     <span class="keywordflow">for</span> (std::vector&lt;MSDevice*&gt;::const_iterator it = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a7424c2ea68f5eba6643ef6aa587910de" title="Returns this vehicle&amp;#39;s devices.">getDevices</a>().begin();
<a name="l00799"></a>00799             it != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a7424c2ea68f5eba6643ef6aa587910de" title="Returns this vehicle&amp;#39;s devices.">getDevices</a>().end(); ++it) {
<a name="l00800"></a>00800         aux1 = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html" title="A device which collects Full electric vehicles consumptions.">MSDevice_FEV</a>*<span class="keyword">&gt;</span>(*it);
<a name="l00801"></a>00801         <span class="keywordflow">if</span> (aux1) {
<a name="l00802"></a>00802             <span class="keywordflow">break</span>;
<a name="l00803"></a>00803         }
<a name="l00804"></a>00804     }
<a name="l00805"></a>00805     <span class="keywordtype">double</span> maxSpeedByTorque = aux1-&gt;<a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html#aad01d3e7558a93324cfa5a0c842eaec0" title="Called on writing tripinfo output.">computeMaxSpeed</a>(vNext);
<a name="l00806"></a>00806     <span class="keywordflow">if</span> (maxSpeedByTorque &lt; 0)
<a name="l00807"></a>00807         maxSpeedByTorque = vNext;
<a name="l00808"></a>00808     vNext = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(vNext, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) 0.);
<a name="l00809"></a>00809 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l00810"></a>00810 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a> != 0) {
<a name="l00811"></a>00811         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vMin = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>(0),
<a name="l00812"></a>00812                 <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().getSpeedAfterMaxDecel(
<a name="l00813"></a>00813                         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>));
<a name="l00814"></a>00814         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vMax = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a8083fe6430ef3aa4f443be6694be41cd" title="Returns the vehicle type&amp;#39;s car following model definition (const version).">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#af87c32b0447ae5bc4d30e5b633af963a" title="Returns the maximum speed given the current speed.">maxNextSpeed</a>(
<a name="l00815"></a>00815                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>);
<a name="l00816"></a>00816         vNext = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a>-&gt;<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#aba51e645f75ce33f372fa11a7d95f80c" title="Applies stored velocity information on the speed to use.">influenceSpeed</a>(
<a name="l00817"></a>00817                 <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep(), vNext, vSafe, vMin,
<a name="l00818"></a>00818                 vMax);
<a name="l00819"></a>00819     }
<a name="l00820"></a>00820 <span class="preprocessor">#endif</span>
<a name="l00821"></a>00821 <span class="preprocessor"></span>    <span class="comment">// visit waiting time</span>
<a name="l00822"></a>00822     <span class="keywordflow">if</span> (vNext &lt;= 0.1) {
<a name="l00823"></a>00823         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a1436c3be4a550287cb44712bafdf865c" title="The time the vehicle waits (is not faster than 0.1m/s) in seconds.">myWaitingTime</a> += <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a462b4847ee7697f3bee34fce1df9f87c">DELTA_T</a>;
<a name="l00824"></a>00824         braking = <span class="keyword">true</span>;
<a name="l00825"></a>00825     } <span class="keywordflow">else</span> {
<a name="l00826"></a>00826         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a1436c3be4a550287cb44712bafdf865c" title="The time the vehicle waits (is not faster than 0.1m/s) in seconds.">myWaitingTime</a> = 0;
<a name="l00827"></a>00827     }
<a name="l00828"></a>00828     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> &lt; vNext) {
<a name="l00829"></a>00829         braking = <span class="keyword">false</span>;
<a name="l00830"></a>00830     }
<a name="l00831"></a>00831     <span class="keywordflow">if</span> (braking) {
<a name="l00832"></a>00832         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#af7597f6554e8af4fe2046f46fa8a6fe3" title="Switches the given signal on.">switchOnSignal</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a6d11e2d5d480e643accf2267a99b4fb5" title="The brake lights are on.">VEH_SIGNAL_BRAKELIGHT</a>);
<a name="l00833"></a>00833     } <span class="keywordflow">else</span> {
<a name="l00834"></a>00834         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a934e442e57717599c2ada67b4063cda3" title="Switches the given signal off.">switchOffSignal</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a6d11e2d5d480e643accf2267a99b4fb5" title="The brake lights are on.">VEH_SIGNAL_BRAKELIGHT</a>);
<a name="l00835"></a>00835     }
<a name="l00836"></a>00836     <span class="comment">// call reminders after vNext is set</span>
<a name="l00837"></a>00837     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> pos = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l00838"></a>00838     vNext = <a class="code" href="../../da/dbd/_std_defs_8h.html#a5f92f2a25e588fd5cddc7af24836046e">MIN3</a>(vNext, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a52dce019121d18dc5680d36f2c645512" title="Returns the current maximum speed.">getMaxSpeed</a>(), maxSpeedByTorque);
<a name="l00839"></a>00839 
<a name="l00840"></a>00840 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l00841"></a>00841 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (myHBMsgEmitter != 0) {
<a name="l00842"></a>00842         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9c57b7d54c70b1d5c7b2db6434c2c7e0" title="Returns the information whether the vehicle is on a road (is simulated).">isOnRoad</a>()) {
<a name="l00843"></a>00843             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> timeStep = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l00844"></a>00844             myHBMsgEmitter-&gt;writeHeartBeatEvent(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>, timeStep, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>());
<a name="l00845"></a>00845         }
<a name="l00846"></a>00846     }
<a name="l00847"></a>00847     <span class="keywordflow">if</span> (myBMsgEmitter != 0) {
<a name="l00848"></a>00848         <span class="keywordflow">if</span> (vNext &lt; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>) {
<a name="l00849"></a>00849             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> timeStep = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l00850"></a>00850             myBMsgEmitter-&gt;writeBreakEvent(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>, timeStep, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>());
<a name="l00851"></a>00851         }
<a name="l00852"></a>00852     }
<a name="l00853"></a>00853 <span class="preprocessor">#endif</span>
<a name="l00854"></a>00854 <span class="preprocessor"></span>    <span class="comment">// update position and speed</span>
<a name="l00855"></a>00855     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> += <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a228586559208ae2bf4d980854f3f1836">SPEED2DIST</a>(vNext);
<a name="l00856"></a>00856     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> = vNext;
<a name="l00857"></a>00857     std::vector&lt;MSLane*&gt; passedLanes;
<a name="l00858"></a>00858     <span class="keywordflow">for</span> (std::vector&lt;MSLane*&gt;::reverse_iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.rbegin();
<a name="l00859"></a>00859             i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.rend(); ++i) {
<a name="l00860"></a>00860         passedLanes.push_back(*i);
<a name="l00861"></a>00861     }
<a name="l00862"></a>00862     <span class="keywordflow">if</span> (passedLanes.size() == 0 || passedLanes.back() != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>) {
<a name="l00863"></a>00863         passedLanes.push_back(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>);
<a name="l00864"></a>00864     }
<a name="l00865"></a>00865     <span class="keywordtype">bool</span> moved = <span class="keyword">true</span>;
<a name="l00866"></a>00866     <span class="comment">// move on lane(s)</span>
<a name="l00867"></a>00867     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> &lt;= <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>()) {
<a name="l00868"></a>00868         <span class="comment">// we are staying at our lane</span>
<a name="l00869"></a>00869         <span class="comment">//  there is no need to go over succeeding lanes</span>
<a name="l00870"></a>00870         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2d2ecdb21395e05fa17990c6770c3c9b" title="Processes active move reminder.">workOnMoveReminders</a>(pos, pos + <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a228586559208ae2bf4d980854f3f1836">SPEED2DIST</a>(vNext), vNext);
<a name="l00871"></a>00871         moved = <span class="keyword">false</span>;
<a name="l00872"></a>00872     } <span class="keywordflow">else</span> {
<a name="l00873"></a>00873         <span class="comment">// we are moving at least to the next lane (maybe pass even more than one)</span>
<a name="l00874"></a>00874         <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>() - 1) {
<a name="l00875"></a>00875             <span class="comment">//Added by HI-Iberia to track those vehicles that have changed their current edge.</span>
<a name="l00876"></a>00876             <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* approachedLane = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>;
<a name="l00877"></a>00877             <span class="comment">// move the vehicle forward</span>
<a name="l00878"></a>00878             <span class="keywordflow">for</span> (i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.begin();
<a name="l00879"></a>00879                     i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.end() &amp;&amp; approachedLane != 0
<a name="l00880"></a>00880                             &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> &gt; approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l00881"></a>00881                     ++i) {
<a name="l00882"></a>00882                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab6a1893e0f0dee87c08f1f15cc24b988" title="Update of members if vehicle leaves a new lane in the lane change step or at arrival...">leaveLane</a>(<a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208a8daba133e99fb51492f460aaeedea000" title="The vehicle arrived at a junction.">MSMoveReminder::NOTIFICATION_JUNCTION</a>);
<a name="l00883"></a>00883                 <a class="code" href="../../d3/d2e/class_m_s_link.html">MSLink</a>* link = (*i).myLink;
<a name="l00884"></a>00884                 <span class="comment">// check whether the vehicle was allowed to enter lane</span>
<a name="l00885"></a>00885                 <span class="comment">//  otherwise it is decelerated and we do not need to test for it&#39;s</span>
<a name="l00886"></a>00886                 <span class="comment">//  approach on the following lanes when a lane changing is performed</span>
<a name="l00887"></a>00887                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> -= approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l00888"></a>00888                 assert(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> &gt; 0);
<a name="l00889"></a>00889                 <span class="comment">// proceed to the next lane</span>
<a name="l00890"></a>00890                 <span class="keywordflow">if</span> (link != 0) {
<a name="l00891"></a>00891 <span class="preprocessor">#ifdef HAVE_INTERNAL_LANES</span>
<a name="l00892"></a>00892 <span class="preprocessor"></span>                    approachedLane = link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a4dc53aa035090cd12e7c407540a32ddf" title="Returns the following inner lane.">getViaLane</a>();
<a name="l00893"></a>00893                     <span class="keywordflow">if</span> (approachedLane == 0) {
<a name="l00894"></a>00894                         approachedLane = link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a078289793c9a153caeaa0f73cce012e8" title="Returns the connected lane.">getLane</a>();
<a name="l00895"></a>00895                     }
<a name="l00896"></a>00896 <span class="preprocessor">#else</span>
<a name="l00897"></a>00897 <span class="preprocessor"></span>                    approachedLane = link-&gt;<a class="code" href="../../d3/d2e/class_m_s_link.html#a078289793c9a153caeaa0f73cce012e8" title="Returns the connected lane.">getLane</a>();
<a name="l00898"></a>00898 <span class="preprocessor">#endif</span>
<a name="l00899"></a>00899 <span class="preprocessor"></span>                } <span class="keywordflow">else</span> {
<a name="l00900"></a>00900                     approachedLane = 0;
<a name="l00901"></a>00901                 }
<a name="l00902"></a>00902                 <span class="keywordflow">if</span> (approachedLane != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a> &amp;&amp; approachedLane != 0) {
<a name="l00903"></a>00903                     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a152a61843a2dc6213ac40718ddc91c19" title="Update when the vehicle enters a new lane in the move step.">enterLaneAtMove</a>(approachedLane);
<a name="l00904"></a>00904                     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a> = approachedLane;
<a name="l00905"></a>00905                     <span class="keywordflow">if</span> (approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#ab6696eab27d84055d0d048d38884e43e" title="Returns whether vehicles on this edge shall be vaporized.">isVaporizing</a>()) {
<a name="l00906"></a>00906                         <span class="keywordflow">break</span>;
<a name="l00907"></a>00907                     }
<a name="l00908"></a>00908                 }
<a name="l00909"></a>00909                 passedLanes.push_back(approachedLane);
<a name="l00910"></a>00910             }
<a name="l00911"></a>00911         }
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913 
<a name="l00914"></a>00914     <span class="keywordflow">for</span> (std::vector&lt;MSLane*&gt;::iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.begin();
<a name="l00915"></a>00915             i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.end(); ++i) {
<a name="l00916"></a>00916         (*i)-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad7d09abe0df8e86537cf2f42a51345d1" title="Removes the information about a vehicle lapping into this lane.">resetPartialOccupation</a>(<span class="keyword">this</span>);
<a name="l00917"></a>00917     }
<a name="l00918"></a>00918     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.clear();
<a name="l00919"></a>00919     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac2f78b6f676a6643bc8e823c7535be92" title="Returns the information whether the vehicle should end now.">ends</a>()) {
<a name="l00920"></a>00920         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> - <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().getLengthWithGap() &lt; 0
<a name="l00921"></a>00921                 &amp;&amp; passedLanes.size() &gt; 0) {
<a name="l00922"></a>00922             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> leftLength = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#affc5e63e8f8ff67003b8e3109f05ce5c" title="Get vehicle&amp;#39;s length including the minimum gap [m].">getLengthWithGap</a>()
<a name="l00923"></a>00923                     - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l00924"></a>00924             std::vector&lt;MSLane*&gt;::reverse_iterator i = passedLanes.rbegin() + 1;
<a name="l00925"></a>00925             <span class="keywordflow">while</span> (leftLength &gt; 0 &amp;&amp; i != passedLanes.rend()) {
<a name="l00926"></a>00926                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.push_back(*i);
<a name="l00927"></a>00927                 leftLength -= (*i)-&gt;setPartialOccupation(<span class="keyword">this</span>, leftLength);
<a name="l00928"></a>00928                 ++i;
<a name="l00929"></a>00929             }
<a name="l00930"></a>00930         }
<a name="l00931"></a>00931         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a84feac31b325e546e74ad14b86694cd6">setBlinkerInformation</a>();
<a name="l00932"></a>00932     }
<a name="l00933"></a>00933     <span class="comment">//std::cout &lt;&lt; &quot;\n MoveChecked A all &quot; &lt;&lt; getID()&lt;&lt;&quot;\t&quot; &lt;&lt; time2string(MSNet::getInstance()-&gt;getCurrentTimeStep()) &lt;&lt; &quot;\t&quot; &lt;&lt; getMyLane()-&gt;getEdge().getID() &lt;&lt; &quot;\t&quot; &lt;&lt; getMyLastEdgeId()&lt;&lt;&quot;\n&quot;;</span>
<a name="l00934"></a>00934     <span class="comment">//std::cout &lt;&lt; &quot;\n MoveChecked B &quot; &lt;&lt; getID()&lt;&lt;&quot;\t&quot; &lt;&lt; time2string(MSNet::getInstance()-&gt;getCurrentTimeStep()) &lt;&lt; &quot;\t&quot; &lt;&lt; getMyLane()-&gt;getEdge().getID() &lt;&lt; &quot;\t&quot; &lt;&lt; getMyLastEdgeId()&lt;&lt;&quot;\n&quot;;</span>
<a name="l00935"></a>00935     <span class="comment">//Code added by HI-Iberia</span>
<a name="l00936"></a>00936     <span class="comment">//For synthetic data generation is required that each vehicles</span>
<a name="l00937"></a>00937     <span class="comment">//dumps their speed and other parameters whenever each car reach a new edge</span>
<a name="l00938"></a>00938     <span class="comment">//the next lane is approachedLane and myLane is my current lane</span>
<a name="l00939"></a>00939     <span class="comment">// clear previously set information</span>
<a name="l00940"></a>00940     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#a715096baba12f1f89b7bc1bedd6df1b5" title="Returns the id of the edge.">getID</a>().compare(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a095f35637a54750eafe3bf02eca46e38">myLastEdgeId</a>) != 0) {
<a name="l00941"></a>00941         <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a095f35637a54750eafe3bf02eca46e38">myLastEdgeId</a>.compare(<span class="stringliteral">&quot;null&quot;</span>) != 0)
<a name="l00942"></a>00942             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a84ce59f6d0abf80baa3ef3d3156a73a4">writeSyntheticData</a>(lastLane);
<a name="l00943"></a>00943         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a5e74b6c352267e0d10e8234286d5e413">setEnterLane</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep());
<a name="l00944"></a>00944         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a840e7cbdf5907d09abe5bedd44181c65">setMyEnterPosLane</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>);
<a name="l00945"></a>00945         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab70f4b07166c48ed3cd642a60e88f237">setMyLastChargeRemoved</a>(aux1-&gt;<a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html#a7943810de7263c5089b43cbe2596c82c">getMyLastChargeRem</a>());
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a095f35637a54750eafe3bf02eca46e38">myLastEdgeId</a>.assign(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#a715096baba12f1f89b7bc1bedd6df1b5" title="Returns the id of the edge.">getID</a>());
<a name="l00948"></a>00948     <span class="keywordflow">return</span> moved;
<a name="l00949"></a>00949 }
<a name="l00950"></a>00950 
<a name="l00951"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3aa166d19c10ec85cd227a6e53f5ace4">00951</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3aa166d19c10ec85cd227a6e53f5ace4">MSVehicle::getSpaceTillLastStanding</a>(<a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* l, <span class="keywordtype">bool</span>&amp; foundStopped) {
<a name="l00952"></a>00952     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> lengths = 0;
<a name="l00953"></a>00953     <span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html#acbdd3114ff401004381026a7111ee0cd" title="Container for vehicles.">MSLane::VehCont</a>&amp; vehs = l-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a76db8e133e5e91a9a02293b8d2a18c6d" title="Returns the vehicles container; locks it for microsimulation.">getVehiclesSecure</a>();
<a name="l00954"></a>00954     <span class="keywordflow">for</span> (MSLane::VehCont::const_iterator i = vehs.begin(); i != vehs.end();
<a name="l00955"></a>00955             ++i) {
<a name="l00956"></a>00956         <span class="keywordflow">if</span> ((*i)-&gt;getSpeed() &lt; .1) {
<a name="l00957"></a>00957             foundStopped = <span class="keyword">true</span>;
<a name="l00958"></a>00958             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> ret = (*i)-&gt;getPositionOnLane()
<a name="l00959"></a>00959                     - (*i)-&gt;getVehicleType().getLengthWithGap() - lengths;
<a name="l00960"></a>00960             l-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a07f2fe818c5f0f94d3dd820873eb26af" title="Allows to use the container for microsimulation again.">releaseVehicles</a>();
<a name="l00961"></a>00961             <span class="keywordflow">return</span> ret;
<a name="l00962"></a>00962         }
<a name="l00963"></a>00963         lengths += (*i)-&gt;getVehicleType().getLengthWithGap();
<a name="l00964"></a>00964     }
<a name="l00965"></a>00965     l-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a07f2fe818c5f0f94d3dd820873eb26af" title="Allows to use the container for microsimulation again.">releaseVehicles</a>();
<a name="l00966"></a>00966     <span class="keywordflow">return</span> l-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - lengths;
<a name="l00967"></a>00967 }
<a name="l00968"></a>00968 
<a name="l00969"></a>00969 <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a181288900ce4518b7af2534a984db33d">MSVehicle::checkRewindLinkLanes</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> lengthsInFront) {
<a name="l00970"></a>00970 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l00971"></a>00971 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../de/dd7/_g_u_i_global_selection_8cpp.html#a2726a253c94700d65ae60acdf38a4f29" title="A global holder of selected objects.">gSelected</a>.<a class="code" href="../../d1/dae/class_g_u_i_selected_storage.html#aabb67245d52decb3dbc5aee46ab82a24" title="Returns the information whether the object with the given type and id is selected...">isSelected</a>(<a class="code" href="../../db/dcf/_g_u_i_gl_object_types_8h.html#af2b60d80f2ed12c3f597887aec83db5caae40d439832a13fb1598a451375e92ce" title="a vehicles">GLO_VEHICLE</a>, static_cast&lt;const GUIVehicle*&gt;(<span class="keyword">this</span>)-&gt;getGlID())) {
<a name="l00972"></a>00972         <span class="keywordtype">int</span> <a class="code" href="../../d5/d3d/_m_s___e2___z_s___collector_over_lanes_8cpp.html#a01abcd138495e1be908eb2bdf86f453e">bla</a> = 0;
<a name="l00973"></a>00973         <span class="keywordflow">if</span> (<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>() == 152000) {
<a name="l00974"></a>00974             bla = 0;
<a name="l00975"></a>00975         }
<a name="l00976"></a>00976     }
<a name="l00977"></a>00977 <span class="preprocessor">#endif</span>
<a name="l00978"></a>00978 <span class="preprocessor"></span><span class="preprocessor">#ifdef HAVE_INTERNAL_LANES</span>
<a name="l00979"></a>00979 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#afab897d0ff315c0853f3dfad1b617d8a" title="Information whether the simulation regards internal lanes.">MSGlobals::gUsingInternalLanes</a>) {
<a name="l00980"></a>00980         <span class="keywordtype">int</span> removalBegin = -1;
<a name="l00981"></a>00981         <span class="keywordtype">bool</span> hadVehicle = <span class="keyword">false</span>;
<a name="l00982"></a>00982         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> seenSpace = -lengthsInFront;
<a name="l00983"></a>00983 
<a name="l00984"></a>00984         std::vector&lt;SUMOReal&gt; availableSpace;
<a name="l00985"></a>00985         std::vector&lt;bool&gt; hadVehicles;
<a name="l00986"></a>00986         <span class="keywordtype">bool</span> foundStopped = <span class="keyword">false</span>;
<a name="l00987"></a>00987 
<a name="l00988"></a>00988         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.size(); ++i) {
<a name="l00989"></a>00989             <span class="comment">// skip unset links</span>
<a name="l00990"></a>00990             DriveProcessItem&amp; item = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>[i];
<a name="l00991"></a>00991             <span class="keywordflow">if</span> (item.myLink == 0 || foundStopped) {
<a name="l00992"></a>00992                 availableSpace.push_back(seenSpace);
<a name="l00993"></a>00993                 hadVehicles.push_back(hadVehicle);
<a name="l00994"></a>00994                 <span class="keywordflow">continue</span>;
<a name="l00995"></a>00995             }
<a name="l00996"></a>00996             <span class="comment">// get the next lane, determine whether it is an internal lane</span>
<a name="l00997"></a>00997             <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* approachedLane = item.myLink-&gt;getViaLane();
<a name="l00998"></a>00998             <span class="keywordflow">if</span> (approachedLane != 0) {
<a name="l00999"></a>00999                 <span class="keywordflow">if</span> (item.myLink-&gt;isCrossing()
<a name="l01000"></a>01000                         &amp;&amp; item.myLink-&gt;willHaveBlockedFoe()) {
<a name="l01001"></a>01001                     seenSpace = seenSpace - approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a01a4036f86c15cec5b2c6e0fd340db36" title="Returns the sum of lengths of vehicles which were on the lane during the last step...">getVehLenSum</a>();
<a name="l01002"></a>01002                     hadVehicle |= approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a5a1cd4987f81b17a69969591a6c16220" title="Returns the number of vehicles on this lane.">getVehicleNumber</a>() != 0;
<a name="l01003"></a>01003                 } <span class="keywordflow">else</span> {
<a name="l01004"></a>01004                     seenSpace = seenSpace
<a name="l01005"></a>01005                             + <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3aa166d19c10ec85cd227a6e53f5ace4">getSpaceTillLastStanding</a>(approachedLane,
<a name="l01006"></a>01006                                     foundStopped); <span class="comment">// - approachedLane-&gt;getVehLenSum() + approachedLane-&gt;getLength();</span>
<a name="l01007"></a>01007                     hadVehicle |= approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a5a1cd4987f81b17a69969591a6c16220" title="Returns the number of vehicles on this lane.">getVehicleNumber</a>() != 0;
<a name="l01008"></a>01008                 }
<a name="l01009"></a>01009                 availableSpace.push_back(seenSpace);
<a name="l01010"></a>01010                 hadVehicles.push_back(hadVehicle);
<a name="l01011"></a>01011                 <span class="keywordflow">continue</span>;
<a name="l01012"></a>01012             }
<a name="l01013"></a>01013             approachedLane = item.myLink-&gt;getLane();
<a name="l01014"></a>01014             <a class="code" href="../../d7/d90/class_m_s_vehicle.html" title="Representation of a vehicle in the micro simulation.">MSVehicle</a>* last = approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a1a10bb02ff18d4e2c5ff48893a70f956" title="returns the last vehicle">getLastVehicle</a>();
<a name="l01015"></a>01015             <span class="keywordflow">if</span> (last == 0) {
<a name="l01016"></a>01016                 last = approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ac35b6a282ccf3433234cf9b071966deb" title="Returns the vehicle which laps into this lane.">getPartialOccupator</a>();
<a name="l01017"></a>01017                 <span class="keywordflow">if</span> (last != 0) {
<a name="l01018"></a>01018                     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> m = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(seenSpace,
<a name="l01019"></a>01019                             seenSpace + approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ac5ebca511b7620782816f28257913c7a" title="Returns the position of the in-lapping vehicle&amp;#39;s end.">getPartialOccupatorEnd</a>()
<a name="l01020"></a>01020                                     + last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a69f16520d18bdb916d03d0ad4d342209" title="Returns the distance the vehicle needs to halt including driver&amp;#39;s reaction time...">brakeGap</a>(
<a name="l01021"></a>01021                                             last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>()));
<a name="l01022"></a>01022                     availableSpace.push_back(m);
<a name="l01023"></a>01023                     hadVehicle = <span class="keyword">true</span>;
<a name="l01024"></a>01024                     seenSpace = seenSpace
<a name="l01025"></a>01025                             + <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3aa166d19c10ec85cd227a6e53f5ace4">getSpaceTillLastStanding</a>(approachedLane,
<a name="l01026"></a>01026                                     foundStopped); <span class="comment">// - approachedLane-&gt;getVehLenSum() + approachedLane-&gt;getLength();</span>
<a name="l01027"></a>01027                     <span class="keywordflow">if</span> (last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9befd677bbe3bba3b2d192ca54301557">myHaveToWaitOnNextLink</a>) {
<a name="l01028"></a>01028                         foundStopped = <span class="keyword">true</span>;
<a name="l01029"></a>01029                     }
<a name="l01030"></a>01030                 } <span class="keywordflow">else</span> {
<a name="l01031"></a>01031 <span class="comment">//                    seenSpace = seenSpace - approachedLane-&gt;getVehLenSum() + approachedLane-&gt;getLength();</span>
<a name="l01032"></a>01032 <span class="comment">//                    availableSpace.push_back(seenSpace);</span>
<a name="l01033"></a>01033                     availableSpace.push_back(
<a name="l01034"></a>01034                             seenSpace
<a name="l01035"></a>01035                                     + <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3aa166d19c10ec85cd227a6e53f5ace4">getSpaceTillLastStanding</a>(approachedLane,
<a name="l01036"></a>01036                                             foundStopped));
<a name="l01037"></a>01037                     <span class="keywordflow">if</span> (!foundStopped) {
<a name="l01038"></a>01038                         seenSpace = seenSpace - approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a01a4036f86c15cec5b2c6e0fd340db36" title="Returns the sum of lengths of vehicles which were on the lane during the last step...">getVehLenSum</a>()
<a name="l01039"></a>01039                                 + approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l01040"></a>01040                     } <span class="keywordflow">else</span> {
<a name="l01041"></a>01041                         seenSpace = availableSpace.back();
<a name="l01042"></a>01042                     }
<a name="l01043"></a>01043                 }
<a name="l01044"></a>01044             } <span class="keywordflow">else</span> {
<a name="l01045"></a>01045                 <span class="keywordflow">if</span> (last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab8e1b144e71eac38850a0fe5af802363" title="Returns whether the given signal is on.">signalSet</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a6d11e2d5d480e643accf2267a99b4fb5" title="The brake lights are on.">VEH_SIGNAL_BRAKELIGHT</a>)) {
<a name="l01046"></a>01046                     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> lastBrakeGap = last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a69f16520d18bdb916d03d0ad4d342209" title="Returns the distance the vehicle needs to halt including driver&amp;#39;s reaction time...">brakeGap</a>(
<a name="l01047"></a>01047                             approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a1a10bb02ff18d4e2c5ff48893a70f956" title="returns the last vehicle">getLastVehicle</a>()-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>());
<a name="l01048"></a>01048                     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> lastGap =
<a name="l01049"></a>01049                             last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9730b019bfc264e955b4af196619f72d" title="Get the vehicle&amp;#39;s position along the lane.">getPositionOnLane</a>()
<a name="l01050"></a>01050                                     - last-&gt;<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#affc5e63e8f8ff67003b8e3109f05ce5c" title="Get vehicle&amp;#39;s length including the minimum gap [m].">getLengthWithGap</a>()
<a name="l01051"></a>01051                                     + lastBrakeGap
<a name="l01052"></a>01052                                     - last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>()
<a name="l01053"></a>01053                                             * last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a02df02bf7e180da6a27e2fad6a199fb9" title="Get the driver&amp;#39;s reaction time [s].">getHeadwayTime</a>();
<a name="l01054"></a>01054                     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> m = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(seenSpace, seenSpace + lastGap);
<a name="l01055"></a>01055                     availableSpace.push_back(m);
<a name="l01056"></a>01056                     seenSpace = seenSpace
<a name="l01057"></a>01057                             + <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3aa166d19c10ec85cd227a6e53f5ace4">getSpaceTillLastStanding</a>(approachedLane,
<a name="l01058"></a>01058                                     foundStopped); <span class="comment">// - approachedLane-&gt;getVehLenSum() + approachedLane-&gt;getLength();</span>
<a name="l01059"></a>01059                 } <span class="keywordflow">else</span> {
<a name="l01060"></a>01060 <span class="comment">//                    seenSpace = seenSpace - approachedLane-&gt;getVehLenSum() + approachedLane-&gt;getLength();</span>
<a name="l01061"></a>01061 <span class="comment">//                    availableSpace.push_back(seenSpace);</span>
<a name="l01062"></a>01062                     availableSpace.push_back(
<a name="l01063"></a>01063                             seenSpace
<a name="l01064"></a>01064                                     + <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3aa166d19c10ec85cd227a6e53f5ace4">getSpaceTillLastStanding</a>(approachedLane,
<a name="l01065"></a>01065                                             foundStopped));
<a name="l01066"></a>01066                     <span class="keywordflow">if</span> (!foundStopped) {
<a name="l01067"></a>01067                         seenSpace = seenSpace - approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a01a4036f86c15cec5b2c6e0fd340db36" title="Returns the sum of lengths of vehicles which were on the lane during the last step...">getVehLenSum</a>()
<a name="l01068"></a>01068                                 + approachedLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l01069"></a>01069                     } <span class="keywordflow">else</span> {
<a name="l01070"></a>01070                         seenSpace = availableSpace.back();
<a name="l01071"></a>01071                     }
<a name="l01072"></a>01072                 }
<a name="l01073"></a>01073                 <span class="keywordflow">if</span> (last-&gt;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9befd677bbe3bba3b2d192ca54301557">myHaveToWaitOnNextLink</a>) {
<a name="l01074"></a>01074                     foundStopped = <span class="keyword">true</span>;
<a name="l01075"></a>01075                 }
<a name="l01076"></a>01076                 hadVehicle = <span class="keyword">true</span>;
<a name="l01077"></a>01077             }
<a name="l01078"></a>01078             hadVehicles.push_back(hadVehicle);
<a name="l01079"></a>01079         }
<a name="l01080"></a>01080 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l01081"></a>01081 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../de/dd7/_g_u_i_global_selection_8cpp.html#a2726a253c94700d65ae60acdf38a4f29" title="A global holder of selected objects.">gSelected</a>.<a class="code" href="../../d1/dae/class_g_u_i_selected_storage.html#aabb67245d52decb3dbc5aee46ab82a24" title="Returns the information whether the object with the given type and id is selected...">isSelected</a>(<a class="code" href="../../db/dcf/_g_u_i_gl_object_types_8h.html#af2b60d80f2ed12c3f597887aec83db5caae40d439832a13fb1598a451375e92ce" title="a vehicles">GLO_VEHICLE</a>, static_cast&lt;const GUIVehicle*&gt;(<span class="keyword">this</span>)-&gt;getGlID())) {
<a name="l01082"></a>01082             <span class="keywordtype">int</span> bla = 0;
<a name="l01083"></a>01083         }
<a name="l01084"></a>01084 <span class="preprocessor">#endif</span>
<a name="l01085"></a>01085 <span class="preprocessor"></span>        <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> t = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l01086"></a>01086         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = (<span class="keywordtype">int</span>) (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.size() - 1); i &gt; 0; --i) {
<a name="l01087"></a>01087             DriveProcessItem&amp; item = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>[i - 1];
<a name="l01088"></a>01088             <span class="keywordtype">bool</span> opened = item.myLink != 0
<a name="l01089"></a>01089                     &amp;&amp; item.myLink-&gt;opened(t, .1,
<a name="l01090"></a>01090                             <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().getLengthWithGap());
<a name="l01091"></a>01091             <span class="keywordtype">bool</span> check1 = item.myLink == 0 || item.myLink-&gt;isCont()
<a name="l01092"></a>01092                     || !hadVehicles[i];
<a name="l01093"></a>01093             <span class="keywordtype">bool</span> allowsContinuation = check1 || opened;
<a name="l01094"></a>01094             <span class="keywordflow">if</span> (!opened &amp;&amp; item.myLink != 0) {
<a name="l01095"></a>01095                 <span class="keywordflow">if</span> (i &gt; 1) {
<a name="l01096"></a>01096                     DriveProcessItem&amp; item2 = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>[i - 2];
<a name="l01097"></a>01097                     <span class="keywordflow">if</span> (item2.myLink != 0 &amp;&amp; item2.myLink-&gt;isCont()) {
<a name="l01098"></a>01098                         allowsContinuation = <span class="keyword">true</span>;
<a name="l01099"></a>01099                     }
<a name="l01100"></a>01100                 }
<a name="l01101"></a>01101             }
<a name="l01102"></a>01102             <span class="keywordflow">if</span> (allowsContinuation) {
<a name="l01103"></a>01103                 availableSpace[i - 1] = availableSpace[i];
<a name="l01104"></a>01104             }
<a name="l01105"></a>01105         }
<a name="l01106"></a>01106 
<a name="l01107"></a>01107         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0;
<a name="l01108"></a>01108                 hadVehicle &amp;&amp; i &lt; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.size() &amp;&amp; removalBegin &lt; 0;
<a name="l01109"></a>01109                 ++i) {
<a name="l01110"></a>01110             <span class="comment">// skip unset links</span>
<a name="l01111"></a>01111             DriveProcessItem&amp; item = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>[i];
<a name="l01112"></a>01112             <span class="keywordflow">if</span> (item.myLink == 0) {
<a name="l01113"></a>01113                 <span class="keywordflow">continue</span>;
<a name="l01114"></a>01114             }
<a name="l01115"></a>01115             <span class="comment">/*</span>
<a name="l01116"></a>01116 <span class="comment">             SUMOReal impatienceCorrection = MAX2(SUMOReal(0), SUMOReal(SUMOReal(myWaitingTime)));</span>
<a name="l01117"></a>01117 <span class="comment">             if (seenSpace&lt;getVehicleType().getLengthWithGap()-impatienceCorrection/10.&amp;&amp;nextSeenNonInternal!=0) {</span>
<a name="l01118"></a>01118 <span class="comment">             removalBegin = lastLinkToInternal;</span>
<a name="l01119"></a>01119 <span class="comment">             }</span>
<a name="l01120"></a>01120 <span class="comment">             */</span>
<a name="l01121"></a>01121 
<a name="l01122"></a>01122             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> leftSpace = availableSpace[i]
<a name="l01123"></a>01123                     - <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#affc5e63e8f8ff67003b8e3109f05ce5c" title="Get vehicle&amp;#39;s length including the minimum gap [m].">getLengthWithGap</a>();
<a name="l01124"></a>01124             <span class="keywordflow">if</span> (leftSpace &lt; 0 &amp;&amp; item.myLink-&gt;willHaveBlockedFoe()) {
<a name="l01125"></a>01125                 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> impatienceCorrection = 0;
<a name="l01126"></a>01126                 <span class="comment">/*</span>
<a name="l01127"></a>01127 <span class="comment">                 if(item.myLink-&gt;getState()==LINKSTATE_MINOR) {</span>
<a name="l01128"></a>01128 <span class="comment">                 impatienceCorrection = MAX2(SUMOReal(0), STEPS2TIME(myWaitingTime));</span>
<a name="l01129"></a>01129 <span class="comment">                 }</span>
<a name="l01130"></a>01130 <span class="comment">                 */</span>
<a name="l01131"></a>01131                 <span class="keywordflow">if</span> (leftSpace &lt; -impatienceCorrection / 10.) {
<a name="l01132"></a>01132                     removalBegin = i;
<a name="l01133"></a>01133                 }
<a name="l01134"></a>01134                 <span class="comment">//removalBegin = i;</span>
<a name="l01135"></a>01135             }
<a name="l01136"></a>01136         }
<a name="l01137"></a>01137         <span class="keywordflow">if</span> (removalBegin != -1
<a name="l01138"></a>01138                 &amp;&amp; !(removalBegin == 0
<a name="l01139"></a>01139                         &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#a07eec865d5d14ee3cf491b0c3b04b42b" title="Returns the edge type (EdgeBasicFunction).">getPurpose</a>()
<a name="l01140"></a>01140                                 == <a class="code" href="../../d7/d27/class_m_s_edge.html#a075fc93ccf4dc6ad26f654b7a2b30f5eaa38b0cfd4643a86e2a34c92e2e182120" title="The edge is an internal edge.">MSEdge::EDGEFUNCTION_INTERNAL</a>)) {
<a name="l01141"></a>01141             <span class="keywordflow">while</span> (removalBegin &lt; (<span class="keywordtype">int</span>) (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.size())) {
<a name="l01142"></a>01142                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>[removalBegin].myVLinkPass =
<a name="l01143"></a>01143                         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>[removalBegin].myVLinkWait;
<a name="l01144"></a>01144                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>[removalBegin].mySetRequest = <span class="keyword">false</span>;
<a name="l01145"></a>01145                 ++removalBegin;
<a name="l01146"></a>01146             }
<a name="l01147"></a>01147         }
<a name="l01148"></a>01148     }
<a name="l01149"></a>01149 <span class="preprocessor">#endif</span>
<a name="l01150"></a>01150 <span class="preprocessor"></span>    <span class="keywordflow">for</span> (DriveItemVector::iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.begin();
<a name="l01151"></a>01151             i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.end(); ++i) {
<a name="l01152"></a>01152         <span class="keywordflow">if</span> ((*i).myLink != 0) {
<a name="l01153"></a>01153             (*i).myLink-&gt;setApproaching(<span class="keyword">this</span>, (*i).myArrivalTime,
<a name="l01154"></a>01154                     (*i).myArrivalSpeed, (*i).mySetRequest);
<a name="l01155"></a>01155         }
<a name="l01156"></a>01156     }
<a name="l01157"></a>01157 }
<a name="l01158"></a>01158 
<a name="l01159"></a>01159 <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a42b50352626b97cb3fe023efbbf49ee3">MSVehicle::vsafeCriticalCont</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> t, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> boundVSafe) {
<a name="l01160"></a>01160 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l01161"></a>01161 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../de/dd7/_g_u_i_global_selection_8cpp.html#a2726a253c94700d65ae60acdf38a4f29" title="A global holder of selected objects.">gSelected</a>.<a class="code" href="../../d1/dae/class_g_u_i_selected_storage.html#aabb67245d52decb3dbc5aee46ab82a24" title="Returns the information whether the object with the given type and id is selected...">isSelected</a>(<a class="code" href="../../db/dcf/_g_u_i_gl_object_types_8h.html#af2b60d80f2ed12c3f597887aec83db5caae40d439832a13fb1598a451375e92ce" title="a vehicles">GLO_VEHICLE</a>, static_cast&lt;const GUIVehicle*&gt;(<span class="keyword">this</span>)-&gt;getGlID())) {
<a name="l01162"></a>01162         <span class="keywordtype">int</span> bla = 0;
<a name="l01163"></a>01163     }
<a name="l01164"></a>01164 <span class="preprocessor">#endif</span>
<a name="l01165"></a>01165 <span class="preprocessor"></span><span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l01166"></a>01166 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a> != 0) {
<a name="l01167"></a>01167         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vMin = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>(0),
<a name="l01168"></a>01168                 <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>().getSpeedAfterMaxDecel(
<a name="l01169"></a>01169                         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>));
<a name="l01170"></a>01170         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vMax = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a8083fe6430ef3aa4f443be6694be41cd" title="Returns the vehicle type&amp;#39;s car following model definition (const version).">getCarFollowModel</a>().<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#af87c32b0447ae5bc4d30e5b633af963a" title="Returns the maximum speed given the current speed.">maxNextSpeed</a>(
<a name="l01171"></a>01171                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>);
<a name="l01172"></a>01172         boundVSafe = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a>-&gt;<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#aba51e645f75ce33f372fa11a7d95f80c" title="Applies stored velocity information on the speed to use.">influenceSpeed</a>(
<a name="l01173"></a>01173                 <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep(), boundVSafe,
<a name="l01174"></a>01174                 boundVSafe, vMin, vMax);
<a name="l01175"></a>01175     }
<a name="l01176"></a>01176 <span class="preprocessor">#endif</span>
<a name="l01177"></a>01177 <span class="preprocessor"></span>    <span class="keyword">const</span> <a class="code" href="../../d1/d9d/class_m_s_c_f_model.html" title="The car-following model abstraction.">MSCFModel</a>&amp; cfModel = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aced40de269f0f55ad5a74bc3ec6e55cb" title="Returns the vehicle&amp;#39;s car following model definition.">getCarFollowModel</a>();
<a name="l01178"></a>01178     <span class="comment">// the vehicle may have just to look into the next lane</span>
<a name="l01179"></a>01179     <span class="comment">//  compute this information and use it only once in the next loop</span>
<a name="l01180"></a>01180     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> seen = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l01181"></a>01181     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> seenNonInternal = 0;
<a name="l01182"></a>01182     <span class="comment">//</span>
<a name="l01183"></a>01183     <span class="keywordflow">if</span> (<span class="keyword">this</span> != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a523e052cd7f19f86a15eeb26d0c41e6d">getFirstVehicle</a>()
<a name="l01184"></a>01184             &amp;&amp; seen - cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a69f16520d18bdb916d03d0ad4d342209" title="Returns the distance the vehicle needs to halt including driver&amp;#39;s reaction time...">brakeGap</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>) &gt; 0
<a name="l01185"></a>01185             &amp;&amp; seen - <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a228586559208ae2bf4d980854f3f1836">SPEED2DIST</a>(boundVSafe) - <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#adfa0c2786fc48fb06572800431ad4bb3">ACCEL2DIST</a>(cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#af9fc7a20cef152541c771a082d02ca30" title="Get the vehicle type&amp;#39;s maximum acceleration [m/s^2].">getMaxAccel</a>())
<a name="l01186"></a>01186                     &gt; 0) {
<a name="l01187"></a>01187         <span class="comment">// not &quot;reaching critical&quot;</span>
<a name="l01188"></a>01188         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.push_back(
<a name="l01189"></a>01189                 DriveProcessItem(0, boundVSafe, boundVSafe, <span class="keyword">false</span>, 0, 0, seen));
<a name="l01190"></a>01190         <span class="keywordflow">return</span>;
<a name="l01191"></a>01191     }
<a name="l01192"></a>01192 
<a name="l01193"></a>01193     <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* nextLane = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>;
<a name="l01194"></a>01194     <span class="comment">// compute the way the vehicle would drive if it would use the current speed and then</span>
<a name="l01195"></a>01195     <span class="comment">//  decelerate</span>
<a name="l01196"></a>01196     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> maxV = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#af87c32b0447ae5bc4d30e5b633af963a" title="Returns the maximum speed given the current speed.">maxNextSpeed</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>);
<a name="l01197"></a>01197     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> dist = <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a228586559208ae2bf4d980854f3f1836">SPEED2DIST</a>(maxV) + cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a69f16520d18bdb916d03d0ad4d342209" title="Returns the distance the vehicle needs to halt including driver&amp;#39;s reaction time...">brakeGap</a>(maxV);
<a name="l01198"></a>01198     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vLinkPass = boundVSafe;
<a name="l01199"></a>01199     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vLinkWait = vLinkPass;
<a name="l01200"></a>01200     <span class="keyword">const</span> std::vector&lt;MSLane*&gt; &amp;bestLaneConts = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8177eb379c97a792b45851ec5332fe2b" title="Returns the subpart of best lanes that describes the vehicle&amp;#39;s current lane and...">getBestLanesContinuation</a>();
<a name="l01201"></a>01201 <span class="preprocessor">#ifdef HAVE_INTERNAL_LANES</span>
<a name="l01202"></a>01202 <span class="preprocessor"></span>    <span class="keywordtype">bool</span> hadNonInternal = <span class="keyword">false</span>;
<a name="l01203"></a>01203 <span class="preprocessor">#else</span>
<a name="l01204"></a>01204 <span class="preprocessor"></span>    <span class="keywordtype">bool</span> hadNonInternal = <span class="keyword">true</span>;
<a name="l01205"></a>01205 <span class="preprocessor">#endif</span>
<a name="l01206"></a>01206 <span class="preprocessor"></span>
<a name="l01207"></a>01207     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> view = 1;
<a name="l01208"></a>01208     <span class="comment">// loop over following lanes</span>
<a name="l01209"></a>01209     <span class="keywordflow">while</span> (<span class="keyword">true</span>) {
<a name="l01210"></a>01210         <span class="comment">// process stops</span>
<a name="l01211"></a>01211         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.empty()
<a name="l01212"></a>01212                 &amp;&amp; &amp;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin()-&gt;lane-&gt;getEdge() == &amp;nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>()) {
<a name="l01213"></a>01213             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vsafeStop = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>,
<a name="l01214"></a>01214                     seen - (nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin()-&gt;endPos));
<a name="l01215"></a>01215             vLinkPass = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, vsafeStop);
<a name="l01216"></a>01216             vLinkWait = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkWait, vsafeStop);
<a name="l01217"></a>01217         }
<a name="l01218"></a>01218 
<a name="l01219"></a>01219         <span class="comment">// get the next link used</span>
<a name="l01220"></a>01220         MSLinkCont::const_iterator link = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a5cfac30025eb02d049a41eb17317838c">succLinkSec</a>(*<span class="keyword">this</span>, view,
<a name="l01221"></a>01221                 *nextLane, bestLaneConts);
<a name="l01222"></a>01222 
<a name="l01223"></a>01223         <span class="comment">// check whether the lane is a dead end</span>
<a name="l01224"></a>01224         <span class="comment">//  (should be valid only on further loop iterations</span>
<a name="l01225"></a>01225         <span class="keywordflow">if</span> (nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a777ad33f9803319f53bc5932f84e909e">isLinkEnd</a>(link)) {
<a name="l01226"></a>01226             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> laneEndVSafe = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>, seen);
<a name="l01227"></a>01227             <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> + view == <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>()) {
<a name="l01228"></a>01228                 <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a1a96ff3c032ed5aa862bf3cf3d4607d4" title="Information how the vehicle&amp;#39;s end speed shall be chosen.">arrivalSpeedProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a42d4e43bf91f4d708bb6c0ae0a6b8abdadb730c6984248f5d75a66b16e43c1062" title="The speed is given.">ARRIVAL_SPEED_GIVEN</a>) {
<a name="l01229"></a>01229                     laneEndVSafe = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a343e6bf5cc2808e2641a2578002948c0" title="Computes the vehicle&amp;#39;s safe speed without a leader.">freeSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(), seen,
<a name="l01230"></a>01230                             <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a4126e93c0bd2fb528e9b0d625e73e3b0" title="(optional) The final speed of the vehicle (not used yet)">arrivalSpeed</a>);
<a name="l01231"></a>01231                 } <span class="keywordflow">else</span> {
<a name="l01232"></a>01232                     laneEndVSafe = vLinkPass;
<a name="l01233"></a>01233                 }
<a name="l01234"></a>01234             }
<a name="l01235"></a>01235             <span class="comment">// the vehicle will not drive further</span>
<a name="l01236"></a>01236             assert(
<a name="l01237"></a>01237                     <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, laneEndVSafe) &gt;= cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>));
<a name="l01238"></a>01238             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.push_back(
<a name="l01239"></a>01239                     DriveProcessItem(0, <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, laneEndVSafe),
<a name="l01240"></a>01240                             <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, laneEndVSafe), <span class="keyword">false</span>, 0, 0, seen));
<a name="l01241"></a>01241             <span class="keywordflow">return</span>;
<a name="l01242"></a>01242         }
<a name="l01243"></a>01243         <span class="comment">// the link was passed</span>
<a name="l01244"></a>01244         vLinkWait = vLinkPass;
<a name="l01245"></a>01245 
<a name="l01246"></a>01246         <span class="comment">// get the following lane</span>
<a name="l01247"></a>01247 <span class="preprocessor">#ifdef HAVE_INTERNAL_LANES</span>
<a name="l01248"></a>01248 <span class="preprocessor"></span>        nextLane = (*link)-&gt;getViaLane();
<a name="l01249"></a>01249         <span class="keywordflow">if</span> (nextLane == 0) {
<a name="l01250"></a>01250             nextLane = (*link)-&gt;getLane();
<a name="l01251"></a>01251             hadNonInternal = <span class="keyword">true</span>;
<a name="l01252"></a>01252             view++;
<a name="l01253"></a>01253         }
<a name="l01254"></a>01254 <span class="preprocessor">#else</span>
<a name="l01255"></a>01255 <span class="preprocessor"></span>        nextLane = (*link)-&gt;getLane();
<a name="l01256"></a>01256         view++;
<a name="l01257"></a>01257 <span class="preprocessor">#endif</span>
<a name="l01258"></a>01258 <span class="preprocessor"></span>
<a name="l01259"></a>01259         <span class="comment">// compute the velocity to use when the link is not blocked by other vehicles</span>
<a name="l01260"></a>01260         <span class="comment">//  the vehicle shall be not faster when reaching the next lane than allowed</span>
<a name="l01261"></a>01261         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vmaxNextLane = <a class="code" href="../../da/dbd/_std_defs_8h.html#a3c4556662cf5cb93067cdc7365aecbcd">MAX2</a>(
<a name="l01262"></a>01262                 cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a343e6bf5cc2808e2641a2578002948c0" title="Computes the vehicle&amp;#39;s safe speed without a leader.">freeSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(), seen,
<a name="l01263"></a>01263                         nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>()), nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>());
<a name="l01264"></a>01264 
<a name="l01265"></a>01265         <span class="comment">// the vehicle shall keep a secure distance to its predecessor</span>
<a name="l01266"></a>01266         <span class="comment">//  (or approach the lane end if the predeccessor is too near)</span>
<a name="l01267"></a>01267         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vsafePredNextLane = 100000;
<a name="l01268"></a>01268         std::pair&lt;MSVehicle*, SUMOReal&gt; lastOnNext =
<a name="l01269"></a>01269                 nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a03e072bbd08300410d511159520a75d0" title="Returns the last vehicle which is still on the lane.">getLastVehicleInformation</a>();
<a name="l01270"></a>01270         <span class="keywordflow">if</span> (lastOnNext.first != 0) {
<a name="l01271"></a>01271             <span class="keywordflow">if</span> (seen + lastOnNext.second &gt;= 0) {
<a name="l01272"></a>01272                 vsafePredNextLane = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a83091fc05838bf11888a8ce394593bfc" title="Computes the vehicle&amp;#39;s safe speed (no dawdling).">followSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(),
<a name="l01273"></a>01273                         seen + lastOnNext.second, lastOnNext.first-&gt;getSpeed(),
<a name="l01274"></a>01274                         lastOnNext.first-&gt;getCarFollowModel().getMaxDecel());
<a name="l01275"></a>01275             } <span class="keywordflow">else</span> {
<a name="l01276"></a>01276                 vsafePredNextLane = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>, seen);
<a name="l01277"></a>01277             }
<a name="l01278"></a>01278         }
<a name="l01279"></a>01279 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l01280"></a>01280 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../de/dd7/_g_u_i_global_selection_8cpp.html#a2726a253c94700d65ae60acdf38a4f29" title="A global holder of selected objects.">gSelected</a>.<a class="code" href="../../d1/dae/class_g_u_i_selected_storage.html#aabb67245d52decb3dbc5aee46ab82a24" title="Returns the information whether the object with the given type and id is selected...">isSelected</a>(<a class="code" href="../../db/dcf/_g_u_i_gl_object_types_8h.html#af2b60d80f2ed12c3f597887aec83db5caae40d439832a13fb1598a451375e92ce" title="a vehicles">GLO_VEHICLE</a>, static_cast&lt;const GUIVehicle*&gt;(<span class="keyword">this</span>)-&gt;getGlID())) {
<a name="l01281"></a>01281             <span class="keywordtype">int</span> bla = 0;
<a name="l01282"></a>01282         }
<a name="l01283"></a>01283 <span class="preprocessor">#endif</span>
<a name="l01284"></a>01284 <span class="preprocessor"></span>        <span class="comment">// compute the velocity to use when the link may be used</span>
<a name="l01285"></a>01285         vLinkPass = <a class="code" href="../../da/dbd/_std_defs_8h.html#a5f92f2a25e588fd5cddc7af24836046e">MIN3</a>(vLinkPass, vmaxNextLane, vsafePredNextLane);
<a name="l01286"></a>01286 
<a name="l01287"></a>01287         <span class="comment">// if the link may not be used (is blocked by another vehicle) then let the</span>
<a name="l01288"></a>01288         <span class="comment">//  vehicle decelerate until the end of the street</span>
<a name="l01289"></a>01289         vLinkWait = <a class="code" href="../../da/dbd/_std_defs_8h.html#a5f92f2a25e588fd5cddc7af24836046e">MIN3</a>(vLinkPass, vLinkWait, cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>, seen));
<a name="l01290"></a>01290 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l01291"></a>01291 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (vLinkWait &lt; cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) {
<a name="l01292"></a>01292             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Vehicle &#39;&quot;</span> + <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af558b8f5379ec8f91cb47e9b7d2b7556" title="Returns the name of the vehicle.">getID</a>() + <span class="stringliteral">&quot;&#39; is decelerating too much (#2; is: &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> - vLinkWait) + <span class="stringliteral">&quot;, may: &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) + <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01293"></a>01293         }
<a name="l01294"></a>01294 <span class="preprocessor">#endif</span>
<a name="l01295"></a>01295 <span class="preprocessor"></span>
<a name="l01296"></a>01296         <span class="comment">// behaviour in front of not priorised intersections (waiting for priorised foe vehicles)</span>
<a name="l01297"></a>01297         <span class="keywordtype">bool</span> setRequest = <span class="keyword">false</span>;
<a name="l01298"></a>01298         <span class="comment">// process stops</span>
<a name="l01299"></a>01299         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.empty()
<a name="l01300"></a>01300                 &amp;&amp; &amp;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin()-&gt;lane-&gt;getEdge() == &amp;nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>()) {
<a name="l01301"></a>01301             <span class="keyword">const</span> <a class="code" href="../../da/ddf/struct_stop.html" title="Definition of vehicle stop (position and duration).">Stop</a>&amp; stop = *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin();
<a name="l01302"></a>01302             <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vsafeStop =
<a name="l01303"></a>01303                     stop.busstop == 0 ?
<a name="l01304"></a>01304                             cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>, seen + stop.endPos) :
<a name="l01305"></a>01305                             cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a0b31ac8ab12f74ebd2fdb9b9e4c45423" title="Computes the vehicle&amp;#39;s safe speed for approaching a non-moving obstacle (no dawdling)...">stopSpeed</a>(<span class="keyword">this</span>,
<a name="l01306"></a>01306                                     seen
<a name="l01307"></a>01307                                             + stop.busstop-&gt;getLastFreePos() - <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>);
<a name="l01308"></a>01308             vLinkPass = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, vsafeStop);
<a name="l01309"></a>01309             vLinkWait = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkWait, vsafeStop);
<a name="l01310"></a>01310         }
<a name="l01311"></a>01311         <span class="comment">// check whether we approach the final edge</span>
<a name="l01312"></a>01312         <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> + view == <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>()) {
<a name="l01313"></a>01313             <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a1a96ff3c032ed5aa862bf3cf3d4607d4" title="Information how the vehicle&amp;#39;s end speed shall be chosen.">arrivalSpeedProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a42d4e43bf91f4d708bb6c0ae0a6b8abdadb730c6984248f5d75a66b16e43c1062" title="The speed is given.">ARRIVAL_SPEED_GIVEN</a>) {
<a name="l01314"></a>01314                 <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> vsafe = cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a343e6bf5cc2808e2641a2578002948c0" title="Computes the vehicle&amp;#39;s safe speed without a leader.">freeSpeed</a>(<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac6847bb54de8bdf75ddb8e2fc689cb2e" title="Returns the vehicle&amp;#39;s current speed.">getSpeed</a>(),
<a name="l01315"></a>01315                         seen + <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#afd710496383af73ec9caee1dcb674a5a" title="the position on the destination lane where the vehicle stops">myArrivalPos</a>, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a4126e93c0bd2fb528e9b0d625e73e3b0" title="(optional) The final speed of the vehicle (not used yet)">arrivalSpeed</a>);
<a name="l01316"></a>01316                 vLinkPass = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, vsafe);
<a name="l01317"></a>01317                 vLinkWait = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkWait, vsafe);
<a name="l01318"></a>01318             }
<a name="l01319"></a>01319         }
<a name="l01320"></a>01320 
<a name="l01321"></a>01321         setRequest |= ((*link)-&gt;getState() != <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0adb082154e7ad11b890bee12f9afffc60" title="The link has red light (must brake).">LINKSTATE_TL_RED</a>
<a name="l01322"></a>01322                 &amp;&amp; (vLinkPass &gt; 0 &amp;&amp; dist - seen &gt; 0));
<a name="l01323"></a>01323         <span class="keywordtype">bool</span> yellow = (*link)-&gt;getState() == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0a4f9c8f40228bc373888e0ad0c4ea94bc" title="The link has yellow light, may pass.">LINKSTATE_TL_YELLOW_MAJOR</a>
<a name="l01324"></a>01324                 || (*link)-&gt;getState() == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0ac024e70664be064530ddcd83984c50ba" title="The link has yellow light, has to brake anyway.">LINKSTATE_TL_YELLOW_MINOR</a>;
<a name="l01325"></a>01325         <span class="keywordtype">bool</span> red = (*link)-&gt;getState() == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#ab0033b911037fd995258d117e65461e0adb082154e7ad11b890bee12f9afffc60" title="The link has red light (must brake).">LINKSTATE_TL_RED</a>;
<a name="l01326"></a>01326         <span class="keywordflow">if</span> ((yellow || red)
<a name="l01327"></a>01327                 &amp;&amp; seen
<a name="l01328"></a>01328                         &gt; cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a69f16520d18bdb916d03d0ad4d342209" title="Returns the distance the vehicle needs to halt including driver&amp;#39;s reaction time...">brakeGap</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)
<a name="l01329"></a>01329                                 - <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#a228586559208ae2bf4d980854f3f1836">SPEED2DIST</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)
<a name="l01330"></a>01330                                         * cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a02df02bf7e180da6a27e2fad6a199fb9" title="Get the driver&amp;#39;s reaction time [s].">getHeadwayTime</a>()) { <span class="comment">// !!! we should reuse brakeGap with no reaction time...</span>
<a name="l01331"></a>01331             vLinkPass = vLinkWait;
<a name="l01332"></a>01332             setRequest = <span class="keyword">false</span>;
<a name="l01333"></a>01333             assert(vLinkWait &gt;= cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>));
<a name="l01334"></a>01334             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.push_back(
<a name="l01335"></a>01335                     DriveProcessItem(*link, vLinkWait, vLinkWait, <span class="keyword">false</span>,
<a name="l01336"></a>01336                             t + <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(seen / vLinkPass), vLinkPass, seen));
<a name="l01337"></a>01337         }
<a name="l01338"></a>01338         <span class="comment">// the next condition matches the previously one used for determining the difference</span>
<a name="l01339"></a>01339         <span class="comment">//  between critical/non-critical vehicles. Though, one should assume that a vehicle</span>
<a name="l01340"></a>01340         <span class="comment">//  should want to move over an intersection even though it could brake before it!?</span>
<a name="l01341"></a>01341         setRequest &amp;= dist - seen &gt; 0;
<a name="l01342"></a>01342 <span class="preprocessor">#ifdef _DEBUG</span>
<a name="l01343"></a>01343 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, vLinkWait) &lt; cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) {
<a name="l01344"></a>01344             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Vehicle &#39;&quot;</span> + <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af558b8f5379ec8f91cb47e9b7d2b7556" title="Returns the name of the vehicle.">getID</a>() + <span class="stringliteral">&quot;&#39; is decelerating too much (#3; is: &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> - <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(vLinkPass, vLinkWait)) + <span class="stringliteral">&quot;, may: &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(cfModel.<a class="code" href="../../d1/d9d/class_m_s_c_f_model.html#a82ccec15cccbe5c645efe2a196c4ceca" title="Returns the velocity after maximum deceleration.">getSpeedAfterMaxDecel</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>)) + <span class="stringliteral">&quot;)&quot;</span>);
<a name="l01345"></a>01345         }
<a name="l01346"></a>01346 <span class="preprocessor">#endif</span>
<a name="l01347"></a>01347 <span class="preprocessor"></span>        <a class="code" href="../../d7/d90/class_m_s_vehicle.html#afe06f4acc69021662c8fa8f161d078be" title="Container for used Links/visited Lanes during lookForward.">myLFLinkLanes</a>.push_back(
<a name="l01348"></a>01348                 DriveProcessItem(*link, vLinkPass, vLinkWait, setRequest,
<a name="l01349"></a>01349                         t + <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ac685f1ff371bcd4d294780fde36d2f8f">TIME2STEPS</a>(seen / vLinkPass), vLinkPass, seen));
<a name="l01350"></a>01350         seen += nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l01351"></a>01351         seenNonInternal +=
<a name="l01352"></a>01352                 nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#a07eec865d5d14ee3cf491b0c3b04b42b" title="Returns the edge type (EdgeBasicFunction).">getPurpose</a>()
<a name="l01353"></a>01353                         == <a class="code" href="../../d7/d27/class_m_s_edge.html#a075fc93ccf4dc6ad26f654b7a2b30f5eaa38b0cfd4643a86e2a34c92e2e182120" title="The edge is an internal edge.">MSEdge::EDGEFUNCTION_INTERNAL</a> ?
<a name="l01354"></a>01354                         0 : nextLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l01355"></a>01355         <span class="keywordflow">if</span> ((vLinkPass &lt;= 0 || seen &gt; dist) &amp;&amp; hadNonInternal
<a name="l01356"></a>01356                 &amp;&amp; seenNonInternal &gt; 50) {
<a name="l01357"></a>01357             <span class="keywordflow">return</span>;
<a name="l01358"></a>01358         }
<a name="l01359"></a>01359     }
<a name="l01360"></a>01360 }
<a name="l01361"></a>01361 
<a name="l01362"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#add37eebcc1cb7d33eed4c1d307b5a0b7">01362</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#add37eebcc1cb7d33eed4c1d307b5a0b7" title="&amp;quot;Activates&amp;quot; all current move reminder">MSVehicle::activateReminders</a>(<span class="keyword">const</span> <a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208" title="Definition of a vehicle state.">MSMoveReminder::Notification</a> reason) {
<a name="l01363"></a>01363     <span class="keywordflow">for</span> (MoveReminderCont::iterator rem = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.begin();
<a name="l01364"></a>01364             rem != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.end();) {
<a name="l01365"></a>01365         <span class="keywordflow">if</span> (rem-&gt;first-&gt;getLane() != 0 &amp;&amp; rem-&gt;first-&gt;getLane() != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a7ed3e152a9a05f5629b84d443fe428bb" title="Returns the lane the vehicle is on.">getLane</a>()) {
<a name="l01366"></a>01366             ++rem;
<a name="l01367"></a>01367         } <span class="keywordflow">else</span> {
<a name="l01368"></a>01368             <span class="keywordflow">if</span> (rem-&gt;first-&gt;notifyEnter(*<span class="keyword">this</span>, reason)) {
<a name="l01369"></a>01369                 ++rem;
<a name="l01370"></a>01370             } <span class="keywordflow">else</span> {
<a name="l01371"></a>01371                 rem = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.erase(rem);
<a name="l01372"></a>01372             }
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374     }
<a name="l01375"></a>01375 }
<a name="l01376"></a>01376 
<a name="l01377"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a152a61843a2dc6213ac40718ddc91c19">01377</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a152a61843a2dc6213ac40718ddc91c19" title="Update when the vehicle enters a new lane in the move step.">MSVehicle::enterLaneAtMove</a>(<a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* enteredLane, <span class="keywordtype">bool</span> onTeleporting) {
<a name="l01378"></a>01378 
<a name="l01379"></a>01379     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5cd8bc4f5b18e057bfcff215dd40585b" title="Whether the vehicle is on the network (not parking, teleported, vaporized, or arrived)...">myAmOnNet</a> = <span class="keyword">true</span>;
<a name="l01380"></a>01380     <span class="comment">// vaporizing edge?</span>
<a name="l01381"></a>01381     <span class="comment">/*</span>
<a name="l01382"></a>01382 <span class="comment">     if (enteredLane-&gt;getEdge().isVaporizing()) {</span>
<a name="l01383"></a>01383 <span class="comment">     // yep, let&#39;s do the vaporization...</span>
<a name="l01384"></a>01384 <span class="comment">     myLane = enteredLane;</span>
<a name="l01385"></a>01385 <span class="comment">     return true;</span>
<a name="l01386"></a>01386 <span class="comment">     }</span>
<a name="l01387"></a>01387 <span class="comment">     */</span>
<a name="l01388"></a>01388 
<a name="l01389"></a>01389     <span class="keywordflow">if</span> (!onTeleporting) {
<a name="l01390"></a>01390 
<a name="l01391"></a>01391         <span class="comment">// move mover reminder one lane further</span>
<a name="l01392"></a>01392         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2501dc16614c13ce4e62831c0c234eaf" title="Adapts the vehicle&amp;#39;s entering of a new lane.">adaptLaneEntering2MoveReminder</a>(*enteredLane);
<a name="l01393"></a>01393         <span class="comment">// set the entered lane as the current lane</span>
<a name="l01394"></a>01394         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a> = enteredLane;
<a name="l01395"></a>01395     }
<a name="l01396"></a>01396 
<a name="l01397"></a>01397     <span class="comment">// internal edges are not a part of the route...</span>
<a name="l01398"></a>01398     <span class="keywordflow">if</span> (enteredLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#a07eec865d5d14ee3cf491b0c3b04b42b" title="Returns the edge type (EdgeBasicFunction).">getPurpose</a>() != <a class="code" href="../../d7/d27/class_m_s_edge.html#a075fc93ccf4dc6ad26f654b7a2b30f5eaa38b0cfd4643a86e2a34c92e2e182120" title="The edge is an internal edge.">MSEdge::EDGEFUNCTION_INTERNAL</a>) {
<a name="l01399"></a>01399         assert(&amp;enteredLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>() == *(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> + 1));
<a name="l01400"></a>01400         ++<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>;
<a name="l01401"></a>01401     }
<a name="l01402"></a>01402     <span class="keywordflow">if</span> (!onTeleporting) {
<a name="l01403"></a>01403         <span class="comment">// may be optimized: compute only, if the current or the next have more than one lane...!!!</span>
<a name="l01404"></a>01404         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4fc0b32f53a2415b39634217a5741adc" title="Returns the description of best lanes to use in order to continue the route.">getBestLanes</a>(<span class="keyword">true</span>);
<a name="l01405"></a>01405         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#add37eebcc1cb7d33eed4c1d307b5a0b7" title="&amp;quot;Activates&amp;quot; all current move reminder">activateReminders</a>(<a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208a8daba133e99fb51492f460aaeedea000" title="The vehicle arrived at a junction.">MSMoveReminder::NOTIFICATION_JUNCTION</a>);
<a name="l01406"></a>01406 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l01407"></a>01407 <span class="preprocessor"></span>        <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a> != 0) {
<a name="l01408"></a>01408             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a48115c0c5b5dac41805373f23f959683">myLaneChangeModel</a>-&gt;<a class="code" href="../../db/d0d/class_m_s_abstract_lane_change_model.html#ab7edde2c5a95472fa5b05b3fa8fba302">requestLaneChange</a>(
<a name="l01409"></a>01409                     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a>-&gt;<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ad3edd164bb3bdc1258a905a366fde312">checkForLaneChanges</a>(
<a name="l01410"></a>01410                             <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>(),
<a name="l01411"></a>01411                             **<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4e8b8ed4069225966c48d6de9e62f1d2">getLaneIndex</a>()));
<a name="l01412"></a>01412         }
<a name="l01413"></a>01413 <span class="preprocessor">#endif</span>
<a name="l01414"></a>01414 <span class="preprocessor"></span>    }
<a name="l01415"></a>01415     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ac2f78b6f676a6643bc8e823c7535be92" title="Returns the information whether the vehicle should end now.">ends</a>();
<a name="l01416"></a>01416 }
<a name="l01417"></a>01417 
<a name="l01418"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#aad6842b317bef7a9ad29a20a114f4c0a">01418</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aad6842b317bef7a9ad29a20a114f4c0a" title="Update when the vehicle enters a new lane in the laneChange step.">MSVehicle::enterLaneAtLaneChange</a>(<a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* enteredLane) {
<a name="l01419"></a>01419     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5cd8bc4f5b18e057bfcff215dd40585b" title="Whether the vehicle is on the network (not parking, teleported, vaporized, or arrived)...">myAmOnNet</a> = <span class="keyword">true</span>;
<a name="l01420"></a>01420 
<a name="l01421"></a>01421 <span class="preprocessor">#ifdef _MESSAGES</span>
<a name="l01422"></a>01422 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (myLCMsgEmitter != 0) {
<a name="l01423"></a>01423         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> timeStep = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>();
<a name="l01424"></a>01424         myLCMsgEmitter-&gt;writeLaneChangeEvent(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ab39b1071f7e8b20fc560b30685069601" title="The vehicle&amp;#39;s id.">id</a>, timeStep, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a298b3fc8aa583719c334375961994950" title="Position of this state.">pos</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(), enteredLane, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a51c33a67d08730631a34482850b2203b" title="Returns the x-position.">x</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0e464e17d48501f4515b5ede67306a73" title="Return current position (x/y, cartesian).">getPosition</a>().<a class="code" href="../../d7/d3b/class_position.html#a4a65556f1de2548b23ce662f81c7ab1a" title="Returns the y-position.">y</a>());
<a name="l01425"></a>01425     }
<a name="l01426"></a>01426 <span class="preprocessor">#endif</span>
<a name="l01427"></a>01427 <span class="preprocessor"></span>    <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a> = enteredLane;
<a name="l01428"></a>01428     <span class="comment">// switch to and activate the new lane&#39;s reminders</span>
<a name="l01429"></a>01429     <span class="comment">// keep OldLaneReminders</span>
<a name="l01430"></a>01430     <span class="keywordflow">for</span> (std::vector&lt;MSMoveReminder*&gt;::const_iterator rem =
<a name="l01431"></a>01431             enteredLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad57e765b14d44ac3b32e65ed6d18e561" title="Return the list of this lane&amp;#39;s move reminders.">getMoveReminders</a>().begin();
<a name="l01432"></a>01432             rem != enteredLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad57e765b14d44ac3b32e65ed6d18e561" title="Return the list of this lane&amp;#39;s move reminders.">getMoveReminders</a>().end(); ++rem) {
<a name="l01433"></a>01433         <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a32bbfcef95b3ea0c42d77b5e9921b953" title="Adds a MoveReminder dynamically.">addReminder</a>(*rem);
<a name="l01434"></a>01434     }
<a name="l01435"></a>01435     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#add37eebcc1cb7d33eed4c1d307b5a0b7" title="&amp;quot;Activates&amp;quot; all current move reminder">activateReminders</a>(<a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208a7429a37d162c35284aa596503a9c56f4" title="The vehicle changes lanes (micro only).">MSMoveReminder::NOTIFICATION_LANE_CHANGE</a>);
<a name="l01436"></a>01436     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> leftLength = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> - <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af0509244821c3c7c85e64344ca66929c" title="Returns the vehicle&amp;#39;s type definition.">getVehicleType</a>().<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#affc5e63e8f8ff67003b8e3109f05ce5c" title="Get vehicle&amp;#39;s length including the minimum gap [m].">getLengthWithGap</a>();
<a name="l01437"></a>01437     <span class="keywordflow">if</span> (leftLength &lt; 0) {
<a name="l01438"></a>01438         <span class="comment">// we have to rebuild &quot;further lanes&quot;</span>
<a name="l01439"></a>01439         <span class="keyword">const</span> <a class="code" href="../../de/dd8/class_m_s_route.html">MSRoute</a>&amp; route = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ad54c9a2eeea444f4538ac5c405844d46" title="Returns the current route.">getRoute</a>();
<a name="l01440"></a>01440         <a class="code" href="../../d0/d24/_m_s_route_8h.html#a7253220e09ff4670521e6da98a9fc3f6">MSRouteIterator</a> i = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>;
<a name="l01441"></a>01441         <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* lane = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>;
<a name="l01442"></a>01442         <span class="keywordflow">while</span> (i != route.<a class="code" href="../../de/dd8/class_m_s_route.html#a19df3c97135029c574956a7c0f88b9eb" title="Returns the begin of the list of edges to pass.">begin</a>() &amp;&amp; leftLength &gt; 0) {
<a name="l01443"></a>01443             <span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* <span class="keyword">const</span> prev = *(--i);
<a name="l01444"></a>01444             <span class="keyword">const</span> std::vector&lt;MSLane::IncomingLaneInfo&gt; &amp;incomingLanes =
<a name="l01445"></a>01445                     lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a60e32ce07bda54222912ccce5a2090c3">getIncomingLanes</a>();
<a name="l01446"></a>01446             <span class="keywordflow">for</span> (std::vector&lt;MSLane::IncomingLaneInfo&gt;::const_iterator j =
<a name="l01447"></a>01447                     incomingLanes.begin(); j != incomingLanes.end(); ++j) {
<a name="l01448"></a>01448                 <span class="keywordflow">if</span> (&amp;(*j).lane-&gt;getEdge() == prev) {
<a name="l01449"></a>01449 <span class="preprocessor">#ifdef HAVE_INTERNAL_LANES</span>
<a name="l01450"></a>01450 <span class="preprocessor"></span>                    (*j).lane-&gt;setPartialOccupation(<span class="keyword">this</span>, leftLength);
<a name="l01451"></a>01451 <span class="preprocessor">#else</span>
<a name="l01452"></a>01452 <span class="preprocessor"></span>                    leftLength -= (*j).length;
<a name="l01453"></a>01453                     (*j).lane-&gt;setPartialOccupation(<span class="keyword">this</span>, leftLength);
<a name="l01454"></a>01454 <span class="preprocessor">#endif</span>
<a name="l01455"></a>01455 <span class="preprocessor"></span>                    leftLength -= (*j).lane-&gt;getLength();
<a name="l01456"></a>01456                     <span class="keywordflow">break</span>;
<a name="l01457"></a>01457                 }
<a name="l01458"></a>01458             }
<a name="l01459"></a>01459         }
<a name="l01460"></a>01460         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a5e74b6c352267e0d10e8234286d5e413">setEnterLane</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep());
<a name="l01461"></a>01461         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a27329a66619be1d62503fd9062670eba">setMyPosOnLane</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>);
<a name="l01462"></a>01462     }
<a name="l01463"></a>01463 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l01464"></a>01464 <span class="preprocessor"></span>    <span class="comment">// check if further changes are necessary</span>
<a name="l01465"></a>01465     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a> != 0) {
<a name="l01466"></a>01466         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a48115c0c5b5dac41805373f23f959683">myLaneChangeModel</a>-&gt;<a class="code" href="../../db/d0d/class_m_s_abstract_lane_change_model.html#ab7edde2c5a95472fa5b05b3fa8fba302">requestLaneChange</a>(
<a name="l01467"></a>01467                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a>-&gt;<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#ad3edd164bb3bdc1258a905a366fde312">checkForLaneChanges</a>(
<a name="l01468"></a>01468                         <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>(),
<a name="l01469"></a>01469                         **<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4e8b8ed4069225966c48d6de9e62f1d2">getLaneIndex</a>()));
<a name="l01470"></a>01470     }
<a name="l01471"></a>01471 <span class="preprocessor">#endif</span>
<a name="l01472"></a>01472 <span class="preprocessor"></span>}
<a name="l01473"></a>01473 
<a name="l01474"></a>01474 <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a569792d7d995994e155af1a0e5d4a24b" title="Update when the vehicle enters a new lane in the emit step.">MSVehicle::enterLaneAtInsertion</a>(<a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* enteredLane, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> pos,
<a name="l01475"></a>01475         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> speed, <a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208" title="Definition of a vehicle state.">MSMoveReminder::Notification</a> notification) {
<a name="l01476"></a>01476     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a> = State(pos, speed, <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep());
<a name="l01477"></a>01477     assert(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> &gt;= 0);
<a name="l01478"></a>01478     assert(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a> &gt;= 0);
<a name="l01479"></a>01479     <span class="comment">//assert(myState.myPosOnLane &gt;= 0);</span>
<a name="l01480"></a>01480     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a27329a66619be1d62503fd9062670eba">setMyPosOnLane</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>);
<a name="l01481"></a>01481     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a1436c3be4a550287cb44712bafdf865c" title="The time the vehicle waits (is not faster than 0.1m/s) in seconds.">myWaitingTime</a> = 0;
<a name="l01482"></a>01482     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a> = enteredLane;
<a name="l01483"></a>01483 
<a name="l01484"></a>01484     <span class="comment">// set and activate the new lane&#39;s reminders</span>
<a name="l01485"></a>01485     <span class="keywordflow">for</span> (std::vector&lt;MSMoveReminder*&gt;::const_iterator rem =
<a name="l01486"></a>01486             enteredLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad57e765b14d44ac3b32e65ed6d18e561" title="Return the list of this lane&amp;#39;s move reminders.">getMoveReminders</a>().begin();
<a name="l01487"></a>01487             rem != enteredLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad57e765b14d44ac3b32e65ed6d18e561" title="Return the list of this lane&amp;#39;s move reminders.">getMoveReminders</a>().end(); ++rem) {
<a name="l01488"></a>01488         <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a32bbfcef95b3ea0c42d77b5e9921b953" title="Adds a MoveReminder dynamically.">addReminder</a>(*rem);
<a name="l01489"></a>01489     }
<a name="l01490"></a>01490     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#add37eebcc1cb7d33eed4c1d307b5a0b7" title="&amp;quot;Activates&amp;quot; all current move reminder">activateReminders</a>(notification);
<a name="l01491"></a>01491     std::string msg;
<a name="l01492"></a>01492     <span class="keywordflow">if</span> (<a class="code" href="../../d5/de7/class_m_s_globals.html#a196ca7a09abfbc66c85ae75ff0512fbe">MSGlobals::gCheckRoutes</a> &amp;&amp; !<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a3deed8cc382be7fd479a7b30d86b8dc5" title="Validates the current route.">hasValidRoute</a>(msg)) {
<a name="l01493"></a>01493         <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(
<a name="l01494"></a>01494                 <span class="stringliteral">&quot;Vehicle &#39;&quot;</span> + <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af558b8f5379ec8f91cb47e9b7d2b7556" title="Returns the name of the vehicle.">getID</a>() + <span class="stringliteral">&quot;&#39; has no valid route. &quot;</span> + msg);
<a name="l01495"></a>01495     }
<a name="l01496"></a>01496     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5cd8bc4f5b18e057bfcff215dd40585b" title="Whether the vehicle is on the network (not parking, teleported, vaporized, or arrived)...">myAmOnNet</a> = <span class="keyword">true</span>;
<a name="l01497"></a>01497     <span class="comment">// build the list of lanes the vehicle is lapping into</span>
<a name="l01498"></a>01498     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> leftLength = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#affc5e63e8f8ff67003b8e3109f05ce5c" title="Get vehicle&amp;#39;s length including the minimum gap [m].">getLengthWithGap</a>() - pos;
<a name="l01499"></a>01499     <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* clane = enteredLane;
<a name="l01500"></a>01500     <span class="keywordflow">while</span> (leftLength &gt; 0) {
<a name="l01501"></a>01501         clane = clane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a14758daf8dc4cea7836a11c2d39406e7">getLogicalPredecessorLane</a>();
<a name="l01502"></a>01502         <span class="keywordflow">if</span> (clane == 0) {
<a name="l01503"></a>01503             <span class="keywordflow">break</span>;
<a name="l01504"></a>01504         }
<a name="l01505"></a>01505         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.push_back(clane);
<a name="l01506"></a>01506         leftLength -= (clane)-&gt;setPartialOccupation(<span class="keyword">this</span>, leftLength);
<a name="l01507"></a>01507     }
<a name="l01508"></a>01508 }
<a name="l01509"></a>01509 
<a name="l01510"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab6a1893e0f0dee87c08f1f15cc24b988">01510</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab6a1893e0f0dee87c08f1f15cc24b988" title="Update of members if vehicle leaves a new lane in the lane change step or at arrival...">MSVehicle::leaveLane</a>(<span class="keyword">const</span> <a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208" title="Definition of a vehicle state.">MSMoveReminder::Notification</a> reason) {
<a name="l01511"></a>01511     <span class="keywordflow">for</span> (MoveReminderCont::iterator rem = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.begin();
<a name="l01512"></a>01512             rem != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.end();) {
<a name="l01513"></a>01513         <span class="keywordflow">if</span> (rem-&gt;first-&gt;notifyLeave(*<span class="keyword">this</span>, <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a> + rem-&gt;second,
<a name="l01514"></a>01514                 reason)) {
<a name="l01515"></a>01515             ++rem;
<a name="l01516"></a>01516         } <span class="keywordflow">else</span> {
<a name="l01517"></a>01517             rem = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.erase(rem);
<a name="l01518"></a>01518         }
<a name="l01519"></a>01519     }
<a name="l01520"></a>01520     <span class="keywordflow">if</span> (reason != <a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208a8daba133e99fb51492f460aaeedea000" title="The vehicle arrived at a junction.">MSMoveReminder::NOTIFICATION_JUNCTION</a>) {
<a name="l01521"></a>01521         <span class="keywordflow">for</span> (std::vector&lt;MSLane*&gt;::iterator i = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.begin();
<a name="l01522"></a>01522                 i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.end(); ++i) {
<a name="l01523"></a>01523             (*i)-&gt;resetPartialOccupation(<span class="keyword">this</span>);
<a name="l01524"></a>01524         }
<a name="l01525"></a>01525         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4b446b10dcf37cb459f17e3d805fd4d7" title="The information into which lanes the vehicle laps into.">myFurtherLanes</a>.clear();
<a name="l01526"></a>01526     }
<a name="l01527"></a>01527     <span class="keywordflow">if</span> (reason &gt;= <a class="code" href="../../d2/da5/class_m_s_move_reminder.html#a9bb933702facf0323c2541dfb8d5c208ad93ce3d4d37f62438fda41cd6b54ea1c" title="The vehicle is being teleported.">MSMoveReminder::NOTIFICATION_TELEPORT</a>) {
<a name="l01528"></a>01528         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5cd8bc4f5b18e057bfcff215dd40585b" title="Whether the vehicle is on the network (not parking, teleported, vaporized, or arrived)...">myAmOnNet</a> = <span class="keyword">false</span>;
<a name="l01529"></a>01529     }
<a name="l01530"></a>01530 
<a name="l01531"></a>01531 }
<a name="l01532"></a>01532 
<a name="l01533"></a>01533 <a class="code" href="../../db/d0d/class_m_s_abstract_lane_change_model.html" title="Interface for lane-change models.">MSAbstractLaneChangeModel</a>&amp;
<a name="l01534"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a43edf659969b57828d8faf5fef053de5">01534</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a43edf659969b57828d8faf5fef053de5">MSVehicle::getLaneChangeModel</a>() {
<a name="l01535"></a>01535     <span class="keywordflow">return</span> *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a48115c0c5b5dac41805373f23f959683">myLaneChangeModel</a>;
<a name="l01536"></a>01536 }
<a name="l01537"></a>01537 
<a name="l01538"></a>01538 <span class="keyword">const</span> <a class="code" href="../../db/d0d/class_m_s_abstract_lane_change_model.html" title="Interface for lane-change models.">MSAbstractLaneChangeModel</a>&amp;
<a name="l01539"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a235b307823dc1ac59c18dc0d3bd7002d">01539</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a43edf659969b57828d8faf5fef053de5">MSVehicle::getLaneChangeModel</a>()<span class="keyword"> const </span>{
<a name="l01540"></a>01540     <span class="keywordflow">return</span> *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a48115c0c5b5dac41805373f23f959683">myLaneChangeModel</a>;
<a name="l01541"></a>01541 }
<a name="l01542"></a>01542 
<a name="l01543"></a>01543 <span class="keyword">const</span> std::vector&lt;MSVehicle::LaneQ&gt; &amp;
<a name="l01544"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4fc0b32f53a2415b39634217a5741adc">01544</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4fc0b32f53a2415b39634217a5741adc" title="Returns the description of best lanes to use in order to continue the route.">MSVehicle::getBestLanes</a>(<span class="keywordtype">bool</span> forceRebuild, <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* startLane)<span class="keyword"> const </span>{
<a name="l01545"></a>01545 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l01546"></a>01546 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../de/dd7/_g_u_i_global_selection_8cpp.html#a2726a253c94700d65ae60acdf38a4f29" title="A global holder of selected objects.">gSelected</a>.<a class="code" href="../../d1/dae/class_g_u_i_selected_storage.html#aabb67245d52decb3dbc5aee46ab82a24" title="Returns the information whether the object with the given type and id is selected...">isSelected</a>(<a class="code" href="../../db/dcf/_g_u_i_gl_object_types_8h.html#af2b60d80f2ed12c3f597887aec83db5caae40d439832a13fb1598a451375e92ce" title="a vehicles">GLO_VEHICLE</a>, static_cast&lt;const GUIVehicle*&gt;(<span class="keyword">this</span>)-&gt;getGlID())) {
<a name="l01547"></a>01547         <span class="keywordtype">int</span> bla = 0;
<a name="l01548"></a>01548         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a74c3dababee7d9cd7594e4fd4495cb6d">myLastBestLanesEdge</a> = 0;
<a name="l01549"></a>01549     }
<a name="l01550"></a>01550 <span class="preprocessor">#endif</span>
<a name="l01551"></a>01551 <span class="preprocessor"></span>
<a name="l01552"></a>01552     <span class="keywordflow">if</span> (startLane == 0) {
<a name="l01553"></a>01553         startLane = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>;
<a name="l01554"></a>01554     }
<a name="l01555"></a>01555     <span class="comment">// update occupancy and current lane index, only, if the vehicle has not moved to a new lane</span>
<a name="l01556"></a>01556     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a74c3dababee7d9cd7594e4fd4495cb6d">myLastBestLanesEdge</a> == &amp;startLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>() &amp;&amp; !forceRebuild) {
<a name="l01557"></a>01557         std::vector&lt;LaneQ&gt; &amp;lanes = *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.begin();
<a name="l01558"></a>01558         std::vector&lt;LaneQ&gt;::iterator i;
<a name="l01559"></a>01559         <span class="keywordflow">for</span> (i = lanes.begin(); i != lanes.end(); ++i) {
<a name="l01560"></a>01560             <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> nextOccupation = 0;
<a name="l01561"></a>01561             <span class="keywordflow">for</span> (std::vector&lt;MSLane*&gt;::const_iterator j =
<a name="l01562"></a>01562                     (*i).bestContinuations.begin() + 1;
<a name="l01563"></a>01563                     j != (*i).bestContinuations.end(); ++j) {
<a name="l01564"></a>01564                 nextOccupation += (*j)-&gt;getVehLenSum();
<a name="l01565"></a>01565             }
<a name="l01566"></a>01566             (*i).nextOccupation = nextOccupation;
<a name="l01567"></a>01567             <span class="keywordflow">if</span> ((*i).lane == startLane) {
<a name="l01568"></a>01568                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a63a49cabcca99c88464f8dae5d168f90">myCurrentLaneInBestLanes</a> = i;
<a name="l01569"></a>01569             }
<a name="l01570"></a>01570         }
<a name="l01571"></a>01571         <span class="keywordflow">return</span> *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.begin();
<a name="l01572"></a>01572     }
<a name="l01573"></a>01573     <span class="comment">// start rebuilding</span>
<a name="l01574"></a>01574     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a74c3dababee7d9cd7594e4fd4495cb6d">myLastBestLanesEdge</a> = &amp;startLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>();
<a name="l01575"></a>01575     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.clear();
<a name="l01576"></a>01576 
<a name="l01577"></a>01577     <span class="comment">// get information about the next stop</span>
<a name="l01578"></a>01578     <span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* nextStopEdge = 0;
<a name="l01579"></a>01579     <span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* nextStopLane = 0;
<a name="l01580"></a>01580     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> nextStopPos = 0;
<a name="l01581"></a>01581     <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.empty()) {
<a name="l01582"></a>01582         <span class="keyword">const</span> <a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html" title="Definition of vehicle stop (position and duration).">Stop</a>&amp; nextStop = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.front();
<a name="l01583"></a>01583         nextStopLane = nextStop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a1fb74cf5fb948ec9413368b6ee50e0c2" title="The lane to stop at.">lane</a>;
<a name="l01584"></a>01584         nextStopEdge = &amp;nextStopLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>();
<a name="l01585"></a>01585         nextStopPos = nextStop.<a class="code" href="../../d8/d6c/struct_m_s_vehicle_1_1_stop.html#a83aa90ad9a973fc67f7194a6cc4eca07" title="The stopping position start.">startPos</a>;
<a name="l01586"></a>01586     }
<a name="l01587"></a>01587     <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#a476f2a844260418cefbf8d753f1729ad" title="Information how the vehicle shall choose the lane to arrive on.">arrivalLaneProcedure</a> == <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a6ccc411cac59260d5822e7b6822c8825a5ffd3332e813770b740561a036dd786c" title="The arrival lane is given.">ARRIVAL_LANE_GIVEN</a>
<a name="l01588"></a>01588             &amp;&amp; nextStopEdge == 0) {
<a name="l01589"></a>01589         nextStopEdge = *(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>() - 1);
<a name="l01590"></a>01590         nextStopLane = nextStopEdge-&gt;<a class="code" href="../../d7/d27/class_m_s_edge.html#ac6454be7984c840da4fa48808cf22833" title="Returns this edge&amp;#39;s lanes.">getLanes</a>()[<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae39ca6810ce513cc01b4a48d71f1a060" title="This Vehicle&amp;#39;s parameter.">myParameter</a>-&gt;<a class="code" href="../../d8/d51/class_s_u_m_o_vehicle_parameter.html#ac79efea85ec7c0e58ea2ac94fe051ce2" title="(optional) The lane the vehicle shall arrive on (not used yet)">arrivalLane</a>];
<a name="l01591"></a>01591         nextStopPos = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#afd710496383af73ec9caee1dcb674a5a" title="the position on the destination lane where the vehicle stops">myArrivalPos</a>;
<a name="l01592"></a>01592     }
<a name="l01593"></a>01593 
<a name="l01594"></a>01594     <span class="comment">// go forward along the next lanes;</span>
<a name="l01595"></a>01595     <span class="keywordtype">int</span> seen = 0;
<a name="l01596"></a>01596     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> seenLength = 0;
<a name="l01597"></a>01597     <span class="keywordtype">bool</span> progress = <span class="keyword">true</span>;
<a name="l01598"></a>01598     <span class="keywordflow">for</span> (<a class="code" href="../../d0/d24/_m_s_route_8h.html#a7253220e09ff4670521e6da98a9fc3f6">MSRouteIterator</a> ce = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>; progress;) {
<a name="l01599"></a>01599         std::vector&lt;LaneQ&gt; currentLanes;
<a name="l01600"></a>01600         <span class="keyword">const</span> std::vector&lt;MSLane*&gt; *allowed = 0;
<a name="l01601"></a>01601         <span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* nextEdge = 0;
<a name="l01602"></a>01602         <span class="keywordflow">if</span> (ce != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>() &amp;&amp; ce + 1 != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>()) {
<a name="l01603"></a>01603             nextEdge = *(ce + 1);
<a name="l01604"></a>01604             allowed = (*ce)-&gt;<a class="code" href="../../d7/d27/class_m_s_edge.html#a0fe903e805b50018b96a0b0426ab1b1d" title="Get the allowed lanes to reach the destination-edge.">allowedLanes</a>(*nextEdge, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ac0b28516cbc8c572f58edc8d01348cb1" title="Get this vehicle type&amp;#39;s vehicle class.">getVehicleClass</a>());
<a name="l01605"></a>01605         }
<a name="l01606"></a>01606         <span class="keyword">const</span> std::vector&lt;MSLane*&gt; &amp;lanes = (*ce)-&gt;getLanes();
<a name="l01607"></a>01607         <span class="keywordflow">for</span> (std::vector&lt;MSLane*&gt;::const_iterator i = lanes.begin();
<a name="l01608"></a>01608                 i != lanes.end(); ++i) {
<a name="l01609"></a>01609             <a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html" title="A structure representing the best lanes for continuing the route.">LaneQ</a> q;
<a name="l01610"></a>01610             <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* cl = *i;
<a name="l01611"></a>01611             q.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a3df6bd9b94a7e3e4795547feddf68bf2" title="The described lane.">lane</a> = cl;
<a name="l01612"></a>01612             q.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a2fc7b1df76210eff08026dbd53c13312" title="Consecutive lane that can be followed without a lane change (contribute to length...">bestContinuations</a>.push_back(cl);
<a name="l01613"></a>01613             q.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#aa7f926a77c7d33c071c620ae7e9d0ac1" title="The (signed) number of lanes to be crossed to get to the lane which allows to continue...">bestLaneOffset</a> = 0;
<a name="l01614"></a>01614             q.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a05b50e3736d96f07fe7e6144e5d7f1a3" title="The overall length which may be driven when using this lane without a lane change...">length</a> = cl-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l01615"></a>01615             q.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a1491a03d3e914ce9f78fe892c6f8594b" title="Whether this lane allows to continue the drive.">allowsContinuation</a> = allowed == 0
<a name="l01616"></a>01616                     || find(allowed-&gt;begin(), allowed-&gt;end(), cl)
<a name="l01617"></a>01617                             != allowed-&gt;end();
<a name="l01618"></a>01618             currentLanes.push_back(q);
<a name="l01619"></a>01619         }
<a name="l01620"></a>01620         <span class="comment">//</span>
<a name="l01621"></a>01621         <span class="keywordflow">if</span> (nextStopEdge == *ce) {
<a name="l01622"></a>01622             progress = <span class="keyword">false</span>;
<a name="l01623"></a>01623             <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator q = currentLanes.begin();
<a name="l01624"></a>01624                     q != currentLanes.end(); ++q) {
<a name="l01625"></a>01625                 <span class="keywordflow">if</span> (nextStopLane != (*q).lane) {
<a name="l01626"></a>01626                     (*q).allowsContinuation = <span class="keyword">false</span>;
<a name="l01627"></a>01627                     (*q).length = nextStopPos;
<a name="l01628"></a>01628                 }
<a name="l01629"></a>01629             }
<a name="l01630"></a>01630         }
<a name="l01631"></a>01631 
<a name="l01632"></a>01632         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.push_back(currentLanes);
<a name="l01633"></a>01633         ++seen;
<a name="l01634"></a>01634         seenLength += currentLanes[0].lane-&gt;getLength();
<a name="l01635"></a>01635         ++ce;
<a name="l01636"></a>01636         progress &amp;= (seen &lt;= 4 || seenLength &lt; 3000);
<a name="l01637"></a>01637         progress &amp;= seen &lt;= 8;
<a name="l01638"></a>01638         progress &amp;= ce != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#a46a50e341d78ea7ac195dbfaf9fa7367" title="Returns the end of the list of edges to pass.">end</a>();
<a name="l01639"></a>01639         <span class="comment">/*</span>
<a name="l01640"></a>01640 <span class="comment">         if(progress) {</span>
<a name="l01641"></a>01641 <span class="comment">         progress &amp;= (currentLanes.size()!=1||(*ce)-&gt;getLanes().size()!=1);</span>
<a name="l01642"></a>01642 <span class="comment">         }</span>
<a name="l01643"></a>01643 <span class="comment">         */</span>
<a name="l01644"></a>01644     }
<a name="l01645"></a>01645 
<a name="l01646"></a>01646     <span class="comment">// we are examining the last lane explicitly</span>
<a name="l01647"></a>01647     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.size() != 0) {
<a name="l01648"></a>01648         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> bestLength = -1;
<a name="l01649"></a>01649         <span class="keywordtype">int</span> bestThisIndex = 0;
<a name="l01650"></a>01650         <span class="keywordtype">int</span> index = 0;
<a name="l01651"></a>01651         std::vector&lt;LaneQ&gt; &amp;last = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.back();
<a name="l01652"></a>01652         <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator j = last.begin(); j != last.end();
<a name="l01653"></a>01653                 ++j, ++index) {
<a name="l01654"></a>01654             <span class="keywordflow">if</span> ((*j).length &gt; bestLength) {
<a name="l01655"></a>01655                 bestLength = (*j).length;
<a name="l01656"></a>01656                 bestThisIndex = index;
<a name="l01657"></a>01657             }
<a name="l01658"></a>01658         }
<a name="l01659"></a>01659         index = 0;
<a name="l01660"></a>01660         <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator j = last.begin(); j != last.end();
<a name="l01661"></a>01661                 ++j, ++index) {
<a name="l01662"></a>01662             <span class="keywordflow">if</span> ((*j).length &lt; bestLength) {
<a name="l01663"></a>01663                 (*j).bestLaneOffset = bestThisIndex - index;
<a name="l01664"></a>01664             }
<a name="l01665"></a>01665         }
<a name="l01666"></a>01666     }
<a name="l01667"></a>01667 
<a name="l01668"></a>01668     <span class="comment">// go backward through the lanes</span>
<a name="l01669"></a>01669     <span class="comment">// track back best lane and compute the best prior lane(s)</span>
<a name="l01670"></a>01670     <span class="keywordflow">for</span> (std::vector&lt;std::vector&lt;LaneQ&gt; &gt;::reverse_iterator i =
<a name="l01671"></a>01671             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.rbegin() + 1; i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.rend(); ++i) {
<a name="l01672"></a>01672         std::vector&lt;LaneQ&gt; &amp;nextLanes = (*(i - 1));
<a name="l01673"></a>01673         std::vector&lt;LaneQ&gt; &amp;clanes = (*i);
<a name="l01674"></a>01674         <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>&amp; cE = clanes[0].lane-&gt;getEdge();
<a name="l01675"></a>01675         <span class="keywordtype">int</span> index = 0;
<a name="l01676"></a>01676         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> bestConnectedLength = -1;
<a name="l01677"></a>01677         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> bestLength = -1;
<a name="l01678"></a>01678         <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator j = nextLanes.begin();
<a name="l01679"></a>01679                 j != nextLanes.end(); ++j, ++index) {
<a name="l01680"></a>01680             <span class="keywordflow">if</span> ((*j).lane-&gt;isApproachedFrom(&amp;cE)
<a name="l01681"></a>01681                     &amp;&amp; bestConnectedLength &lt; (*j).length) {
<a name="l01682"></a>01682                 bestConnectedLength = (*j).length;
<a name="l01683"></a>01683             }
<a name="l01684"></a>01684             <span class="keywordflow">if</span> (bestLength &lt; (*j).length) {
<a name="l01685"></a>01685                 bestLength = (*j).length;
<a name="l01686"></a>01686             }
<a name="l01687"></a>01687         }
<a name="l01688"></a>01688         <span class="keywordflow">if</span> (bestConnectedLength &gt; 0) {
<a name="l01689"></a>01689             <span class="keywordtype">int</span> bestThisIndex = 0;
<a name="l01690"></a>01690             index = 0;
<a name="l01691"></a>01691             <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator j = clanes.begin();
<a name="l01692"></a>01692                     j != clanes.end(); ++j, ++index) {
<a name="l01693"></a>01693                 <a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html" title="A structure representing the best lanes for continuing the route.">LaneQ</a> bestConnectedNext;
<a name="l01694"></a>01694                 bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a05b50e3736d96f07fe7e6144e5d7f1a3" title="The overall length which may be driven when using this lane without a lane change...">length</a> = -1;
<a name="l01695"></a>01695                 <span class="keywordflow">if</span> ((*j).allowsContinuation) {
<a name="l01696"></a>01696                     <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::const_iterator m =
<a name="l01697"></a>01697                             nextLanes.begin(); m != nextLanes.end(); ++m) {
<a name="l01698"></a>01698                         <span class="keywordflow">if</span> ((*m).lane-&gt;isApproachedFrom(&amp;cE, (*j).lane)) {
<a name="l01699"></a>01699                             <span class="keywordflow">if</span> (bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a05b50e3736d96f07fe7e6144e5d7f1a3" title="The overall length which may be driven when using this lane without a lane change...">length</a> &lt; (*m).length
<a name="l01700"></a>01700                                     || (bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a05b50e3736d96f07fe7e6144e5d7f1a3" title="The overall length which may be driven when using this lane without a lane change...">length</a> == (*m).length
<a name="l01701"></a>01701                                             &amp;&amp; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(
<a name="l01702"></a>01702                                                     bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#aa7f926a77c7d33c071c620ae7e9d0ac1" title="The (signed) number of lanes to be crossed to get to the lane which allows to continue...">bestLaneOffset</a>)
<a name="l01703"></a>01703                                                     &gt; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>((*m).bestLaneOffset))) {
<a name="l01704"></a>01704                                 bestConnectedNext = *m;
<a name="l01705"></a>01705                             }
<a name="l01706"></a>01706                         }
<a name="l01707"></a>01707                     }
<a name="l01708"></a>01708                     <span class="keywordflow">if</span> (bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a05b50e3736d96f07fe7e6144e5d7f1a3" title="The overall length which may be driven when using this lane without a lane change...">length</a> == bestConnectedLength
<a name="l01709"></a>01709                             &amp;&amp; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#aa7f926a77c7d33c071c620ae7e9d0ac1" title="The (signed) number of lanes to be crossed to get to the lane which allows to continue...">bestLaneOffset</a>) &lt; 2) {
<a name="l01710"></a>01710                         (*j).<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a05b50e3736d96f07fe7e6144e5d7f1a3" title="The overall length which may be driven when using this lane without a lane change...">length</a> += bestLength;
<a name="l01711"></a>01711                     } <span class="keywordflow">else</span> {
<a name="l01712"></a>01712                         (*j).length += bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a05b50e3736d96f07fe7e6144e5d7f1a3" title="The overall length which may be driven when using this lane without a lane change...">length</a>;
<a name="l01713"></a>01713                     }
<a name="l01714"></a>01714                 }
<a name="l01715"></a>01715                 <span class="keywordflow">if</span> (clanes[bestThisIndex].length &lt; (*j).length
<a name="l01716"></a>01716                         || (clanes[bestThisIndex].length == (*j).length
<a name="l01717"></a>01717                                 &amp;&amp; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(
<a name="l01718"></a>01718                                         <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(
<a name="l01719"></a>01719                                                 clanes[bestThisIndex].bestLaneOffset
<a name="l01720"></a>01720                                                         &gt; (*j).bestLaneOffset)))) {
<a name="l01721"></a>01721                     bestThisIndex = index;
<a name="l01722"></a>01722                 }
<a name="l01723"></a>01723                 copy(bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a2fc7b1df76210eff08026dbd53c13312" title="Consecutive lane that can be followed without a lane change (contribute to length...">bestContinuations</a>.begin(),
<a name="l01724"></a>01724                         bestConnectedNext.<a class="code" href="../../d3/d89/struct_m_s_vehicle_1_1_lane_q.html#a2fc7b1df76210eff08026dbd53c13312" title="Consecutive lane that can be followed without a lane change (contribute to length...">bestContinuations</a>.end(),
<a name="l01725"></a>01725                         back_inserter((*j).bestContinuations));
<a name="l01726"></a>01726             }
<a name="l01727"></a>01727 
<a name="l01728"></a>01728             index = 0;
<a name="l01729"></a>01729             <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator j = clanes.begin();
<a name="l01730"></a>01730                     j != clanes.end(); ++j, ++index) {
<a name="l01731"></a>01731                 <span class="keywordflow">if</span> ((*j).length &lt; clanes[bestThisIndex].length
<a name="l01732"></a>01732                         || ((*j).length == clanes[bestThisIndex].length
<a name="l01733"></a>01733                                 &amp;&amp; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>((*j).bestLaneOffset)
<a name="l01734"></a>01734                                         &lt; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(
<a name="l01735"></a>01735                                                 clanes[bestThisIndex].bestLaneOffset))) {
<a name="l01736"></a>01736                     (*j).bestLaneOffset = bestThisIndex - index;
<a name="l01737"></a>01737                 } <span class="keywordflow">else</span> {
<a name="l01738"></a>01738                     (*j).bestLaneOffset = 0;
<a name="l01739"></a>01739                 }
<a name="l01740"></a>01740             }
<a name="l01741"></a>01741 
<a name="l01742"></a>01742         } <span class="keywordflow">else</span> {
<a name="l01743"></a>01743 
<a name="l01744"></a>01744             <span class="keywordtype">int</span> bestThisIndex = 0;
<a name="l01745"></a>01745             <span class="keywordtype">int</span> bestNextIndex = 0;
<a name="l01746"></a>01746             <span class="keywordtype">int</span> bestDistToNeeded = (int) clanes.size();
<a name="l01747"></a>01747             index = 0;
<a name="l01748"></a>01748             <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator j = clanes.begin();
<a name="l01749"></a>01749                     j != clanes.end(); ++j, ++index) {
<a name="l01750"></a>01750                 <span class="keywordflow">if</span> ((*j).allowsContinuation) {
<a name="l01751"></a>01751                     <span class="keywordtype">int</span> nextIndex = 0;
<a name="l01752"></a>01752                     <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::const_iterator m =
<a name="l01753"></a>01753                             nextLanes.begin(); m != nextLanes.end();
<a name="l01754"></a>01754                             ++m, ++nextIndex) {
<a name="l01755"></a>01755                         <span class="keywordflow">if</span> ((*m).lane-&gt;isApproachedFrom(&amp;cE, (*j).lane)) {
<a name="l01756"></a>01756                             <span class="keywordflow">if</span> (bestDistToNeeded &gt; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>((*m).bestLaneOffset)) {
<a name="l01757"></a>01757                                 bestDistToNeeded = <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>((*m).bestLaneOffset);
<a name="l01758"></a>01758                                 bestThisIndex = index;
<a name="l01759"></a>01759                                 bestNextIndex = nextIndex;
<a name="l01760"></a>01760                             }
<a name="l01761"></a>01761                         }
<a name="l01762"></a>01762                     }
<a name="l01763"></a>01763                 }
<a name="l01764"></a>01764             }
<a name="l01765"></a>01765             clanes[bestThisIndex].length += nextLanes[bestNextIndex].length;
<a name="l01766"></a>01766             copy(nextLanes[bestNextIndex].bestContinuations.begin(),
<a name="l01767"></a>01767                     nextLanes[bestNextIndex].bestContinuations.end(),
<a name="l01768"></a>01768                     back_inserter(clanes[bestThisIndex].bestContinuations));
<a name="l01769"></a>01769             index = 0;
<a name="l01770"></a>01770             <span class="keywordflow">for</span> (std::vector&lt;LaneQ&gt;::iterator j = clanes.begin();
<a name="l01771"></a>01771                     j != clanes.end(); ++j, ++index) {
<a name="l01772"></a>01772                 <span class="keywordflow">if</span> ((*j).length &lt; clanes[bestThisIndex].length
<a name="l01773"></a>01773                         || ((*j).length == clanes[bestThisIndex].length
<a name="l01774"></a>01774                                 &amp;&amp; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>((*j).bestLaneOffset)
<a name="l01775"></a>01775                                         &lt; <a class="code" href="../../d1/dc9/polyfonts_8c.html#a6a010865b10e541735fa2da8f3cd062d">abs</a>(
<a name="l01776"></a>01776                                                 clanes[bestThisIndex].bestLaneOffset))) {
<a name="l01777"></a>01777                     (*j).bestLaneOffset = bestThisIndex - index;
<a name="l01778"></a>01778                 } <span class="keywordflow">else</span> {
<a name="l01779"></a>01779                     (*j).bestLaneOffset = 0;
<a name="l01780"></a>01780                 }
<a name="l01781"></a>01781             }
<a name="l01782"></a>01782 
<a name="l01783"></a>01783         }
<a name="l01784"></a>01784 
<a name="l01785"></a>01785     }
<a name="l01786"></a>01786 
<a name="l01787"></a>01787     <span class="comment">// update occupancy and current lane index</span>
<a name="l01788"></a>01788     std::vector&lt;LaneQ&gt; &amp;currLanes = *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.begin();
<a name="l01789"></a>01789     std::vector&lt;LaneQ&gt;::iterator i;
<a name="l01790"></a>01790     <span class="keywordflow">for</span> (i = currLanes.begin(); i != currLanes.end(); ++i) {
<a name="l01791"></a>01791         <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> nextOccupation = 0;
<a name="l01792"></a>01792         <span class="keywordflow">for</span> (std::vector&lt;MSLane*&gt;::const_iterator j =
<a name="l01793"></a>01793                 (*i).bestContinuations.begin() + 1;
<a name="l01794"></a>01794                 j != (*i).bestContinuations.end(); ++j) {
<a name="l01795"></a>01795             nextOccupation += (*j)-&gt;getVehLenSum();
<a name="l01796"></a>01796         }
<a name="l01797"></a>01797         (*i).nextOccupation = nextOccupation;
<a name="l01798"></a>01798         <span class="keywordflow">if</span> ((*i).lane == startLane) {
<a name="l01799"></a>01799             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a63a49cabcca99c88464f8dae5d168f90">myCurrentLaneInBestLanes</a> = i;
<a name="l01800"></a>01800         }
<a name="l01801"></a>01801     }
<a name="l01802"></a>01802     <span class="keywordflow">return</span> *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.begin();
<a name="l01803"></a>01803 }
<a name="l01804"></a>01804 
<a name="l01805"></a>01805 <span class="keyword">const</span> std::vector&lt;MSLane*&gt; &amp;
<a name="l01806"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8177eb379c97a792b45851ec5332fe2b">01806</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8177eb379c97a792b45851ec5332fe2b" title="Returns the subpart of best lanes that describes the vehicle&amp;#39;s current lane and...">MSVehicle::getBestLanesContinuation</a>()<span class="keyword"> const </span>{
<a name="l01807"></a>01807     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.empty() || <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>[0].empty()
<a name="l01808"></a>01808             || <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#a07eec865d5d14ee3cf491b0c3b04b42b" title="Returns the edge type (EdgeBasicFunction).">getPurpose</a>()
<a name="l01809"></a>01809                     == <a class="code" href="../../d7/d27/class_m_s_edge.html#a075fc93ccf4dc6ad26f654b7a2b30f5eaa38b0cfd4643a86e2a34c92e2e182120" title="The edge is an internal edge.">MSEdge::EDGEFUNCTION_INTERNAL</a>) {
<a name="l01810"></a>01810         <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#abde29751d5030cdfc27fc1f229c197b9">myEmptyLaneVector</a>;
<a name="l01811"></a>01811     }
<a name="l01812"></a>01812     <span class="keywordflow">return</span> (*myCurrentLaneInBestLanes).bestContinuations;
<a name="l01813"></a>01813 }
<a name="l01814"></a>01814 
<a name="l01815"></a>01815 <span class="keyword">const</span> std::vector&lt;MSLane*&gt; &amp;
<a name="l01816"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0d026d19e04880918c63644a1cbe5593">01816</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8177eb379c97a792b45851ec5332fe2b" title="Returns the subpart of best lanes that describes the vehicle&amp;#39;s current lane and...">MSVehicle::getBestLanesContinuation</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* <span class="keyword">const</span> l)<span class="keyword"> const </span>{
<a name="l01817"></a>01817     <span class="keywordflow">for</span> (std::vector&lt;std::vector&lt;LaneQ&gt; &gt;::const_iterator i =
<a name="l01818"></a>01818             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.begin(); i != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab2eb93c27c8a0ac31008c502552d89f7">myBestLanes</a>.end(); ++i) {
<a name="l01819"></a>01819         <span class="keywordflow">if</span> ((*i).size() != 0 &amp;&amp; (*i)[0].lane == l) {
<a name="l01820"></a>01820             <span class="keywordflow">return</span> (*i)[0].bestContinuations;
<a name="l01821"></a>01821         }
<a name="l01822"></a>01822     }
<a name="l01823"></a>01823     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#abde29751d5030cdfc27fc1f229c197b9">myEmptyLaneVector</a>;
<a name="l01824"></a>01824 }
<a name="l01825"></a>01825 
<a name="l01826"></a>01826 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a681cf45eca37ab29069a20a9021fda10">MSVehicle::getDistanceToPosition</a>(<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> destPos,
<a name="l01827"></a>01827         <span class="keyword">const</span> <a class="code" href="../../d7/d27/class_m_s_edge.html" title="A road/street connecting two junctions.">MSEdge</a>* destEdge) {
<a name="l01828"></a>01828 <span class="preprocessor">#ifdef DEBUG_VEHICLE_GUI_SELECTION</span>
<a name="l01829"></a>01829 <span class="preprocessor"></span>    <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> distance = 1000000.;
<a name="l01830"></a>01830 <span class="preprocessor">#else</span>
<a name="l01831"></a>01831 <span class="preprocessor"></span>    <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> distance = <a class="code" href="../../d1/dc9/polyfonts_8c.html#affe776513b24d84b39af8ab0930fef7f">std::numeric_limits&lt;SUMOReal&gt;::max</a>();
<a name="l01832"></a>01832 <span class="preprocessor">#endif</span>
<a name="l01833"></a>01833 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9c57b7d54c70b1d5c7b2db6434c2c7e0" title="Returns the information whether the vehicle is on a road (is simulated).">isOnRoad</a>() &amp;&amp; destEdge != NULL) {
<a name="l01834"></a>01834         <span class="keywordflow">if</span> (&amp;<a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>() == *<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>) {
<a name="l01835"></a>01835             <span class="comment">// vehicle is on a normal edge</span>
<a name="l01836"></a>01836             distance = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#aefccac628f32cd320a56332c95abfd7f" title="Compute the distance between 2 given edges on this route, including the length of...">getDistanceBetween</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9730b019bfc264e955b4af196619f72d" title="Get the vehicle&amp;#39;s position along the lane.">getPositionOnLane</a>(), destPos,
<a name="l01837"></a>01837                     *<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a>, destEdge);
<a name="l01838"></a>01838         } <span class="keywordflow">else</span> {
<a name="l01839"></a>01839             <span class="comment">// vehicle is on inner junction edge</span>
<a name="l01840"></a>01840             distance = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9730b019bfc264e955b4af196619f72d" title="Get the vehicle&amp;#39;s position along the lane.">getPositionOnLane</a>();
<a name="l01841"></a>01841             distance += <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9d734b6c4adc76c81e0b5be3fdd96a48" title="This Vehicle&amp;#39;s route.">myRoute</a>-&gt;<a class="code" href="../../de/dd8/class_m_s_route.html#aefccac628f32cd320a56332c95abfd7f" title="Compute the distance between 2 given edges on this route, including the length of...">getDistanceBetween</a>(0, destPos,
<a name="l01842"></a>01842                     *(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a74ef8a75661b17a4c9cf871338ccb6f2" title="Iterator to current route-edge.">myCurrEdge</a> + 1), destEdge);
<a name="l01843"></a>01843         }
<a name="l01844"></a>01844     }
<a name="l01845"></a>01845     <span class="keywordflow">return</span> distance;
<a name="l01846"></a>01846 }
<a name="l01847"></a>01847 
<a name="l01848"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a49915ab2e792b0897e6fdcdc04b5c555">01848</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a49915ab2e792b0897e6fdcdc04b5c555" title="Returns CO2 emission of the current state.">MSVehicle::getHBEFA_CO2Emissions</a>()<span class="keyword"> const </span>{
<a name="l01849"></a>01849     <span class="keywordflow">return</span> <a class="code" href="../../d4/d8d/class_helpers_h_b_e_f_a.html#a10cfbec21459af6c18486a298b6e0501" title="Returns the amount of emitted CO2 given the vehicle type and state (in mg/s).">HelpersHBEFA::computeCO2</a>(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#af504fa5e7be61e03c9c7163cc511d53a" title="Get this vehicle type&amp;#39;s emission class.">getEmissionClass</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(),
<a name="l01850"></a>01850             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a650e7b60232175996316585a9968ffc5" title="The current acceleration before dawdling.">myPreDawdleAcceleration</a>);
<a name="l01851"></a>01851 }
<a name="l01852"></a>01852 
<a name="l01853"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#abb0b355c01ca18bc7fc6631043bba4ca">01853</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#abb0b355c01ca18bc7fc6631043bba4ca" title="Returns CO emission of the current state.">MSVehicle::getHBEFA_COEmissions</a>()<span class="keyword"> const </span>{
<a name="l01854"></a>01854     <span class="keywordflow">return</span> <a class="code" href="../../d4/d8d/class_helpers_h_b_e_f_a.html#ae4891ba7e78774927de234d84cfe44e6" title="Returns the amount of emitted CO given the vehicle type and state (in mg/s).">HelpersHBEFA::computeCO</a>(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#af504fa5e7be61e03c9c7163cc511d53a" title="Get this vehicle type&amp;#39;s emission class.">getEmissionClass</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(),
<a name="l01855"></a>01855             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a650e7b60232175996316585a9968ffc5" title="The current acceleration before dawdling.">myPreDawdleAcceleration</a>);
<a name="l01856"></a>01856 }
<a name="l01857"></a>01857 
<a name="l01858"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#ada4135b3dfeafaf7cca16b5cea7dc007">01858</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ada4135b3dfeafaf7cca16b5cea7dc007" title="Returns HC emission of the current state.">MSVehicle::getHBEFA_HCEmissions</a>()<span class="keyword"> const </span>{
<a name="l01859"></a>01859     <span class="keywordflow">return</span> <a class="code" href="../../d4/d8d/class_helpers_h_b_e_f_a.html#ad0cff77bfb3ceca30a3b6acbc77c134d" title="Returns the amount of emitted HC given the vehicle type and state (in mg/s).">HelpersHBEFA::computeHC</a>(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#af504fa5e7be61e03c9c7163cc511d53a" title="Get this vehicle type&amp;#39;s emission class.">getEmissionClass</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(),
<a name="l01860"></a>01860             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a650e7b60232175996316585a9968ffc5" title="The current acceleration before dawdling.">myPreDawdleAcceleration</a>);
<a name="l01861"></a>01861 }
<a name="l01862"></a>01862 
<a name="l01863"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a244faac2fab160c829a20ec1c8b8cab2">01863</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a244faac2fab160c829a20ec1c8b8cab2" title="Returns NOx emission of the current state.">MSVehicle::getHBEFA_NOxEmissions</a>()<span class="keyword"> const </span>{
<a name="l01864"></a>01864     <span class="keywordflow">return</span> <a class="code" href="../../d4/d8d/class_helpers_h_b_e_f_a.html#ac1303a8a485d9a770a1c58ea6bc50277" title="Returns the amount of emitted NOx given the vehicle type and state (in mg/s).">HelpersHBEFA::computeNOx</a>(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#af504fa5e7be61e03c9c7163cc511d53a" title="Get this vehicle type&amp;#39;s emission class.">getEmissionClass</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(),
<a name="l01865"></a>01865             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a650e7b60232175996316585a9968ffc5" title="The current acceleration before dawdling.">myPreDawdleAcceleration</a>);
<a name="l01866"></a>01866 }
<a name="l01867"></a>01867 
<a name="l01868"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5b4bbb6211df5cb4ee47e5212b6e0605">01868</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a5b4bbb6211df5cb4ee47e5212b6e0605" title="Returns PMx emission of the current state.">MSVehicle::getHBEFA_PMxEmissions</a>()<span class="keyword"> const </span>{
<a name="l01869"></a>01869     <span class="keywordflow">return</span> <a class="code" href="../../d4/d8d/class_helpers_h_b_e_f_a.html#a66eccc7953c43d58d53712f05867b641" title="Returns the amount of emitted PMx given the vehicle type and state (in mg/s).">HelpersHBEFA::computePMx</a>(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#af504fa5e7be61e03c9c7163cc511d53a" title="Get this vehicle type&amp;#39;s emission class.">getEmissionClass</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(),
<a name="l01870"></a>01870             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a650e7b60232175996316585a9968ffc5" title="The current acceleration before dawdling.">myPreDawdleAcceleration</a>);
<a name="l01871"></a>01871 }
<a name="l01872"></a>01872 
<a name="l01873"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8cd36309da768a01619257e0e3a2e2e7">01873</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8cd36309da768a01619257e0e3a2e2e7" title="Returns fuel consumption of the current state.">MSVehicle::getHBEFA_FuelConsumption</a>()<span class="keyword"> const </span>{
<a name="l01874"></a>01874     <span class="keywordflow">return</span> <a class="code" href="../../d4/d8d/class_helpers_h_b_e_f_a.html#afb9fc3d0c0cfc706e825900d4ff9fe97" title="Returns the amount of consumed fuel given the vehicle type and state (in ml/s).">HelpersHBEFA::computeFuel</a>(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#af504fa5e7be61e03c9c7163cc511d53a" title="Get this vehicle type&amp;#39;s emission class.">getEmissionClass</a>(),
<a name="l01875"></a>01875             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a650e7b60232175996316585a9968ffc5" title="The current acceleration before dawdling.">myPreDawdleAcceleration</a>);
<a name="l01876"></a>01876 }
<a name="l01877"></a>01877 
<a name="l01878"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0102e0a91fc18c7a96c10fba46c4bc63">01878</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a0102e0a91fc18c7a96c10fba46c4bc63" title="Returns noise emissions of the current state.">MSVehicle::getHarmonoise_NoiseEmissions</a>()<span class="keyword"> const </span>{
<a name="l01879"></a>01879     <span class="keywordflow">return</span> <a class="code" href="../../dd/d41/class_helpers_harmonoise.html#ab98909fb77610a59e65d17193478cc0e" title="Returns the noise produced by the a vehicle of the given type at the given speed...">HelpersHarmonoise::computeNoise</a>(<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#af504fa5e7be61e03c9c7163cc511d53a" title="Get this vehicle type&amp;#39;s emission class.">getEmissionClass</a>(),
<a name="l01880"></a>01880             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab9e00eda157e129bcd1c47d23a7d8ef3" title="Speed of this state.">speed</a>(), <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a650e7b60232175996316585a9968ffc5" title="The current acceleration before dawdling.">myPreDawdleAcceleration</a>);
<a name="l01881"></a>01881 }
<a name="l01882"></a>01882 
<a name="l01883"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3adf58f51c4a8854b1a5c4c8b44f33bf">01883</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a3adf58f51c4a8854b1a5c4c8b44f33bf" title="Adds a person to this vehicle.">MSVehicle::addPerson</a>(<a class="code" href="../../de/d25/class_m_s_person.html">MSPerson</a>* person) {
<a name="l01884"></a>01884     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2fd535b73b0a875c420e374bc1ea8e30" title="The passengers this vehicle may have.">myPersonDevice</a> == 0) {
<a name="l01885"></a>01885         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2fd535b73b0a875c420e374bc1ea8e30" title="The passengers this vehicle may have.">myPersonDevice</a> = <a class="code" href="../../d3/df0/class_m_s_device___person.html#a7f43f03d12596691a990bbf6ef1565c1" title="Build devices for the given vehicle, if needed.">MSDevice_Person::buildVehicleDevices</a>(*<span class="keyword">this</span>, <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a9cd1f3f4aba9025cab8404a95dcae6d8" title="The devices this vehicle has.">myDevices</a>);
<a name="l01886"></a>01886         <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a2fdd6a88fbee98b18e17c61602a18638" title="Current lane&amp;#39;s move reminder.">myMoveReminders</a>.push_back(std::make_pair(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2fd535b73b0a875c420e374bc1ea8e30" title="The passengers this vehicle may have.">myPersonDevice</a>, 0.));
<a name="l01887"></a>01887     }
<a name="l01888"></a>01888     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a2fd535b73b0a875c420e374bc1ea8e30" title="The passengers this vehicle may have.">myPersonDevice</a>-&gt;<a class="code" href="../../d3/df0/class_m_s_device___person.html#a64ec7648bae5df8418b355f08c693464" title="Add a passenger.">addPerson</a>(person);
<a name="l01889"></a>01889     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.size() &gt; 0 &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.front().reached
<a name="l01890"></a>01890             &amp;&amp; <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.front().triggered) {
<a name="l01891"></a>01891         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.front().duration = 0;
<a name="l01892"></a>01892     }
<a name="l01893"></a>01893 }
<a name="l01894"></a>01894 
<a name="l01895"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a84feac31b325e546e74ad14b86694cd6">01895</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a84feac31b325e546e74ad14b86694cd6">MSVehicle::setBlinkerInformation</a>() {
<a name="l01896"></a>01896     <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a934e442e57717599c2ada67b4063cda3" title="Switches the given signal off.">switchOffSignal</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a66887f4a5df3afacf1015d05fffbf605" title="Right blinker lights are switched on.">VEH_SIGNAL_BLINKER_RIGHT</a> | <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a7694a85f4bebe20a3706d7245bbc7716" title="Left blinker lights are switched on.">VEH_SIGNAL_BLINKER_LEFT</a>);
<a name="l01897"></a>01897     <span class="keywordtype">int</span> state = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a43edf659969b57828d8faf5fef053de5">getLaneChangeModel</a>().<a class="code" href="../../db/d0d/class_m_s_abstract_lane_change_model.html#a6ffd6476a49ddab8bc8098be5dab6310">getOwnState</a>();
<a name="l01898"></a>01898     <span class="keywordflow">if</span> ((state &amp; <a class="code" href="../../df/dbe/_m_s_abstract_lane_change_model_8h.html#abe2b9d5319b08e7b6932bdfd7004e5dea9be418cc3c702f7cf0b4cdb076ea9ae6" title="Wants go to the left.">LCA_LEFT</a>) != 0) {
<a name="l01899"></a>01899         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#af7597f6554e8af4fe2046f46fa8a6fe3" title="Switches the given signal on.">switchOnSignal</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a7694a85f4bebe20a3706d7245bbc7716" title="Left blinker lights are switched on.">VEH_SIGNAL_BLINKER_LEFT</a>);
<a name="l01900"></a>01900     } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((state &amp; <a class="code" href="../../df/dbe/_m_s_abstract_lane_change_model_8h.html#abe2b9d5319b08e7b6932bdfd7004e5deacfeb63cd03a470cbf1b4c8e8f88d9b5b" title="Wants go to the right.">LCA_RIGHT</a>) != 0) {
<a name="l01901"></a>01901         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#af7597f6554e8af4fe2046f46fa8a6fe3" title="Switches the given signal on.">switchOnSignal</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a66887f4a5df3afacf1015d05fffbf605" title="Right blinker lights are switched on.">VEH_SIGNAL_BLINKER_RIGHT</a>);
<a name="l01902"></a>01902     } <span class="keywordflow">else</span> {
<a name="l01903"></a>01903         <span class="keyword">const</span> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* lane = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a7ed3e152a9a05f5629b84d443fe428bb" title="Returns the lane the vehicle is on.">getLane</a>();
<a name="l01904"></a>01904         MSLinkCont::const_iterator link = lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a5cfac30025eb02d049a41eb17317838c">succLinkSec</a>(*<span class="keyword">this</span>, 1, *lane,
<a name="l01905"></a>01905                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8177eb379c97a792b45851ec5332fe2b" title="Returns the subpart of best lanes that describes the vehicle&amp;#39;s current lane and...">getBestLanesContinuation</a>());
<a name="l01906"></a>01906         <span class="keywordflow">if</span> (link != lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a1d4b5d2ae5c186182a3b3ee30703b844" title="returns the container with all links !!!">getLinkCont</a>().end()
<a name="l01907"></a>01907                 &amp;&amp; lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>() - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9730b019bfc264e955b4af196619f72d" title="Get the vehicle&amp;#39;s position along the lane.">getPositionOnLane</a>()
<a name="l01908"></a>01908                         &lt; lane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#a8122139b83423d16c5228bdd280a21cc" title="Returns the lane&amp;#39;s maximum speed.">getMaxSpeed</a>() * (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>) 7.) {
<a name="l01909"></a>01909             <span class="keywordflow">switch</span> ((*link)-&gt;getDirection()) {
<a name="l01910"></a>01910             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#aa0b67dafb51a20429fabfa8d7a07d57ea3a971c67f9867b2541430659aa19d9f9" title="The link is a 180 degree turn.">LINKDIR_TURN</a>:
<a name="l01911"></a>01911             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#aa0b67dafb51a20429fabfa8d7a07d57eaad7740c4bcacf58c61c9b78b459a9b58" title="The link is a (hard) left direction.">LINKDIR_LEFT</a>:
<a name="l01912"></a>01912             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#aa0b67dafb51a20429fabfa8d7a07d57ea752d5f231f4dacc62853855ce88f909c" title="The link is a partial left direction.">LINKDIR_PARTLEFT</a>:
<a name="l01913"></a>01913                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#af7597f6554e8af4fe2046f46fa8a6fe3" title="Switches the given signal on.">switchOnSignal</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a7694a85f4bebe20a3706d7245bbc7716" title="Left blinker lights are switched on.">VEH_SIGNAL_BLINKER_LEFT</a>);
<a name="l01914"></a>01914                 <span class="keywordflow">break</span>;
<a name="l01915"></a>01915             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#aa0b67dafb51a20429fabfa8d7a07d57ea049aa1a1a8489768120ecb4bb76c0d1f" title="The link is a (hard) right direction.">LINKDIR_RIGHT</a>:
<a name="l01916"></a>01916             <span class="keywordflow">case</span> <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#aa0b67dafb51a20429fabfa8d7a07d57eadd6b539ec90b1d119e9d8f4097a0c35b" title="The link is a partial right direction.">LINKDIR_PARTRIGHT</a>:
<a name="l01917"></a>01917                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#af7597f6554e8af4fe2046f46fa8a6fe3" title="Switches the given signal on.">switchOnSignal</a>(<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9a8782410216db415677bf89f9d93ba0a66887f4a5df3afacf1015d05fffbf605" title="Right blinker lights are switched on.">VEH_SIGNAL_BLINKER_RIGHT</a>);
<a name="l01918"></a>01918                 <span class="keywordflow">break</span>;
<a name="l01919"></a>01919             <span class="keywordflow">default</span>:
<a name="l01920"></a>01920                 <span class="keywordflow">break</span>;
<a name="l01921"></a>01921             }
<a name="l01922"></a>01922         }
<a name="l01923"></a>01923     }
<a name="l01924"></a>01924 }
<a name="l01925"></a>01925 
<a name="l01926"></a>01926 <span class="comment">//Added by HI-Iberia</span>
<a name="l01927"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a84ce59f6d0abf80baa3ef3d3156a73a4">01927</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a84ce59f6d0abf80baa3ef3d3156a73a4">MSVehicle::writeSyntheticData</a>(<a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>*&amp; lastLane) {
<a name="l01928"></a>01928     <a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html" title="A device which collects Full electric vehicles consumptions.">MSDevice_FEV</a> * aux1 = NULL;
<a name="l01929"></a>01929     <a class="code" href="../../de/da0/class_output_device.html" title="Static storage of an output device and its base (abstract) implementation.">OutputDevice</a>&amp; of = <a class="code" href="../../de/da0/class_output_device.html#a8f99dc2c6fedf48066712a22622298d4" title="Returns the device described by the option.">OutputDevice::getDeviceByOption</a>(<span class="stringliteral">&quot;netstate-dump-fev&quot;</span>);
<a name="l01930"></a>01930 
<a name="l01931"></a>01931     <span class="comment">//Holds the aggregated energy costs.</span>
<a name="l01932"></a>01932     <span class="keyword">static</span> <span class="keywordtype">double</span> aggredatedEnergyCosts;
<a name="l01933"></a>01933     <span class="comment">/*</span>
<a name="l01934"></a>01934 <span class="comment">     //Holds the energy cost by edge.</span>
<a name="l01935"></a>01935 <span class="comment">     double mean_charge_removed_by_edge;*/</span>
<a name="l01936"></a>01936 
<a name="l01937"></a>01937     <span class="keywordflow">for</span> (std::vector&lt;MSDevice*&gt;::const_iterator it = <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a7424c2ea68f5eba6643ef6aa587910de" title="Returns this vehicle&amp;#39;s devices.">getDevices</a>().begin();
<a name="l01938"></a>01938             it != <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a7424c2ea68f5eba6643ef6aa587910de" title="Returns this vehicle&amp;#39;s devices.">getDevices</a>().end(); ++it) {
<a name="l01939"></a>01939         aux1 = <span class="keyword">dynamic_cast&lt;</span><a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html" title="A device which collects Full electric vehicles consumptions.">MSDevice_FEV</a>*<span class="keyword">&gt;</span>(*it);
<a name="l01940"></a>01940         <span class="keywordflow">if</span> (aux1) {
<a name="l01941"></a>01941             <span class="keywordflow">break</span>;
<a name="l01942"></a>01942         }
<a name="l01943"></a>01943     }
<a name="l01944"></a>01944     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9c57b7d54c70b1d5c7b2db6434c2c7e0" title="Returns the information whether the vehicle is on a road (is simulated).">isOnRoad</a>()) {
<a name="l01945"></a>01945         <span class="comment">//SUMOTime time_on_lane = MSNet::getInstance()-&gt;getCurrentTimeStep()-veh.myState.enterLane;</span>
<a name="l01946"></a>01946         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> time_on_lane = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a835b8056e154e434da624033500e1943" title="Returns the current simulation step (in s).">getCurrentTimeStep</a>()
<a name="l01947"></a>01947                 - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8a34bea2d1a2ba17b810ff7be571c213">getMyState</a>().<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a289cf824b2f2df325a9ac562da2a680d">getEnterLane</a>();
<a name="l01948"></a>01948         <span class="keywordtype">double</span> time = time_on_lane;
<a name="l01949"></a>01949 
<a name="l01950"></a>01950         <span class="keywordflow">if</span> (time != 0)
<a name="l01951"></a>01951             time = time / 1000; <span class="comment">//time_step_to_seconds;</span>
<a name="l01952"></a>01952         of.<a class="code" href="../../de/da0/class_output_device.html#a3b0f96462607bb3acd79ab119612dada" title="Opens an XML tag.">openTag</a>(<span class="stringliteral">&quot;Register&quot;</span>);
<a name="l01953"></a>01953         <span class="keywordtype">double</span> a = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#aef27e64ed4642176e8a2dbea0799a589">getMyPosOnLane</a>();
<a name="l01954"></a>01954         <span class="keywordtype">double</span> b = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#aea077a41933cb4e1a96c3928b9bcedb1">getMyEnterPosLane</a>();
<a name="l01955"></a>01955 
<a name="l01956"></a>01956         <span class="comment">//The vehicle has changed from the current edge in one time step,</span>
<a name="l01957"></a>01957         <span class="comment">//then we compute avg_spped until the end of the current lane</span>
<a name="l01958"></a>01958 
<a name="l01959"></a>01959         <span class="keywordflow">if</span> (a == b) {
<a name="l01960"></a>01960             a = lastLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#aef5b982f774910cf6de56065fee1d260" title="Returns the lane&amp;#39;s length.">getLength</a>();
<a name="l01961"></a>01961         }
<a name="l01962"></a>01962         <span class="keywordtype">double</span> avg_speed = (a - b) / time;
<a name="l01963"></a>01963         avg_speed *= 3.6; <span class="comment">// convert m/s to Km/h</span>
<a name="l01964"></a>01964         <span class="keywordtype">double</span> ampheres_spent_segment = aux1-&gt;<a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html#a6ec8b456637093e956eb72ca1c756921">getMyCurrChargeRem</a>()
<a name="l01965"></a>01965                 - <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a6719122911e776d07f5e9479eecc5f35">getMyLastChargeRemoved</a>();
<a name="l01966"></a>01966 
<a name="l01967"></a>01967         <span class="comment">//Whatts = Amphs x Volts</span>
<a name="l01968"></a>01968         <span class="keywordtype">double</span> mean_charge_removed_by_edge = ampheres_spent_segment
<a name="l01969"></a>01969                 * aux1-&gt;<a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html#aeb5817dbd158f8895917bf31e9368014">getMyCurrE</a>();
<a name="l01970"></a>01970 
<a name="l01971"></a>01971         <span class="comment">/*MyHandler2 handler;</span>
<a name="l01972"></a>01972 <span class="comment"></span>
<a name="l01973"></a>01973 <span class="comment">        std::vector&lt;VehicleToTrack&gt; result = handler.vehicles;</span>
<a name="l01974"></a>01974 <span class="comment"></span>
<a name="l01975"></a>01975 <span class="comment">        handler.showVehiclesToTrack(result);*/</span>
<a name="l01976"></a>01976 
<a name="l01977"></a>01977         <span class="comment">//std::cout &lt;&lt; &quot; Goes here..!&quot; &lt;&lt; std::endl;</span>
<a name="l01978"></a>01978 
<a name="l01979"></a>01979         <span class="comment">// Driver type: Cautious</span>
<a name="l01980"></a>01980         <span class="keywordflow">if</span> (<span class="keyword">false</span>) {
<a name="l01981"></a>01981             mean_charge_removed_by_edge *=1;
<a name="l01982"></a>01982         }
<a name="l01983"></a>01983 
<a name="l01984"></a>01984         <span class="comment">// Driver type: Normal</span>
<a name="l01985"></a>01985         <span class="keywordflow">if</span> (<span class="keyword">false</span>) {
<a name="l01986"></a>01986             mean_charge_removed_by_edge *= 1.1;
<a name="l01987"></a>01987         }
<a name="l01988"></a>01988 
<a name="l01989"></a>01989         <span class="comment">// Driver type: Aggressive</span>
<a name="l01990"></a>01990         <span class="keywordflow">if</span> (<span class="keyword">false</span>) {
<a name="l01991"></a>01991             mean_charge_removed_by_edge *= 1.3;
<a name="l01992"></a>01992         }
<a name="l01993"></a>01993 
<a name="l01994"></a>01994         <span class="comment">//Adds aggregated energy costs.</span>
<a name="l01995"></a>01995         aggredatedEnergyCosts += mean_charge_removed_by_edge;
<a name="l01996"></a>01996 
<a name="l01997"></a>01997         <span class="comment">//Makes addition of the energy costs.</span>
<a name="l01998"></a>01998 
<a name="l01999"></a>01999         of &lt;&lt; <span class="stringliteral">&quot; timeStampUTC=\&quot;&quot;</span>
<a name="l02000"></a>02000                 &lt;&lt; <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5bd5c47639f33fda316b4eca62222a21">time2string</a>(<a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;getCurrentTimeStep())
<a name="l02001"></a>02001                 &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot; LinkId=\&quot;&quot;</span> &lt;&lt; lastLane-&gt;<a class="code" href="../../d9/d16/class_m_s_lane.html#ad689e4b858799c088f315442527a814f" title="Returns the lane&amp;#39;s edge.">getEdge</a>().<a class="code" href="../../d7/d27/class_m_s_edge.html#a715096baba12f1f89b7bc1bedd6df1b5" title="Returns the id of the edge.">getID</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02002"></a>02002                 &lt;&lt; <span class="stringliteral">&quot; LaneId=\&quot;&quot;</span> &lt;&lt; lastLane-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot; VIN=\&quot;&quot;</span>
<a name="l02003"></a>02003                 &lt;&lt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#af558b8f5379ec8f91cb47e9b7d2b7556" title="Returns the name of the vehicle.">getID</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot; VehicleWeight=\&quot;&quot;</span>
<a name="l02004"></a>02004                 &lt;&lt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae4fcc0e9f7db45b05153b13c5bc4806c">getMyType</a>()-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a556093a868d6fe001e87375137dca220">getMass</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02005"></a>02005                 <span class="comment">//&lt;&lt; &quot; NumCell=\&quot;&quot; &lt;&lt; veh.getMyType()-&gt;getNumCells() &lt;&lt;&quot;\&quot;&quot;</span>
<a name="l02006"></a>02006                 &lt;&lt; <span class="stringliteral">&quot; BatterySOH=\&quot;&quot;</span>
<a name="l02007"></a>02007                 &lt;&lt; <a class="code" href="../../de/da0/class_output_device.html#aa07f66f8ed89bfe8c315f3e6a60294d5" title="Abstract output operator.">OutputDevice::realString</a>(aux1-&gt;<a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html#a0c49d5ae81500212b9abbcc2fd5056ad">getMySoh</a>(), 6) &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02008"></a>02008                 &lt;&lt; <span class="stringliteral">&quot; BatterySOC=\&quot;&quot;</span>
<a name="l02009"></a>02009                 &lt;&lt; <a class="code" href="../../de/da0/class_output_device.html#aa07f66f8ed89bfe8c315f3e6a60294d5" title="Abstract output operator.">OutputDevice::realString</a>(1.0 - (aux1-&gt;<a class="code" href="../../d1/dfd/class_m_s_device___f_e_v.html#ae9d74f09eef8bc01e10396d66876add4">getMyCurrDoD</a>()), 6)
<a name="l02010"></a>02010                 &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot; BatteryCapacity=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae4fcc0e9f7db45b05153b13c5bc4806c">getMyType</a>()-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a4e5bc56e6abbeb92735a676781225a95">getCapacity</a>()
<a name="l02011"></a>02011                 &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot; AuxMask=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae4fcc0e9f7db45b05153b13c5bc4806c">getMyType</a>()-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a42318648ebb61162c34e7860ccd69172">getAuxMask</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02012"></a>02012                 &lt;&lt; <span class="stringliteral">&quot; LightMask=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae4fcc0e9f7db45b05153b13c5bc4806c">getMyType</a>()-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a7e14ded40ed692cb36148bb02b407b84">getLightMask</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02013"></a>02013                 &lt;&lt; <span class="stringliteral">&quot; EnvTemp=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae4fcc0e9f7db45b05153b13c5bc4806c">getMyType</a>()-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ae15eda8004eebb8d24f2ae7084ce2c28">getCelsius</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02014"></a>02014                 &lt;&lt; <span class="stringliteral">&quot; EnvHum=\&quot;&quot;</span> &lt;&lt; <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#ae4fcc0e9f7db45b05153b13c5bc4806c">getMyType</a>()-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#a1db9731f0cac74beae174471890bc6f6">getHumidity</a>() &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02015"></a>02015                 <span class="comment">//      &lt;&lt; &quot; enter_time_on_lane=\&quot;&quot; &lt;&lt; time2string(veh.getMyState().getEnterLane()) &lt;&lt;&quot;\&quot;&quot;</span>
<a name="l02016"></a>02016                 <span class="comment">//      &lt;&lt; &quot; time_on_lane =\&quot;&quot; &lt;&lt; time2string(time_on_lane) &lt;&lt; &quot;\&quot;&quot;</span>
<a name="l02017"></a>02017                 <span class="comment">//      &lt;&lt; &quot; enter_pos =\&quot;&quot; &lt;&lt; veh.getMyState().getMyPosOnLane() &lt;&lt;&quot;\&quot;&quot;</span>
<a name="l02018"></a>02018                 <span class="comment">//      &lt;&lt; &quot; curr_pos =\&quot;&quot; &lt;&lt; veh.getPositionOnLane() &lt;&lt;&quot;\&quot;&quot;</span>
<a name="l02019"></a>02019                 <span class="comment">//      &lt;&lt; &quot; instantaneous_speed=\&quot;&quot; &lt;&lt; veh.getSpeed() &lt;&lt;&quot;\&quot;&quot;</span>
<a name="l02020"></a>02020                 &lt;&lt; <span class="stringliteral">&quot; Avg_speed =\&quot;&quot;</span> &lt;&lt; avg_speed &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot; TravelTime =\&quot;&quot;</span>
<a name="l02021"></a>02021                 &lt;&lt; <a class="code" href="../../d6/d1f/_s_u_m_o_time_8cpp.html#a5bd5c47639f33fda316b4eca62222a21">time2string</a>(time_on_lane) &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span> &lt;&lt; <span class="stringliteral">&quot; EnergyCostByEdge =\&quot;&quot;</span>
<a name="l02022"></a>02022                 &lt;&lt; mean_charge_removed_by_edge &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>
<a name="l02023"></a>02023                 &lt;&lt; <span class="stringliteral">&quot; AggregatedEnergyCost =\&quot;&quot;</span> &lt;&lt; aggredatedEnergyCosts &lt;&lt; <span class="stringliteral">&quot;\&quot;&quot;</span>;
<a name="l02024"></a>02024         of.<a class="code" href="../../de/da0/class_output_device.html#a16c6003a3128afaaaf44014d6db7b9fa" title="Closes the most recently opened tag.">closeTag</a>(<span class="keyword">true</span>);
<a name="l02025"></a>02025 
<a name="l02026"></a>02026     }
<a name="l02027"></a>02027 
<a name="l02028"></a>02028     <span class="comment">/*   *</span>
<a name="l02029"></a>02029 <span class="comment">     * Write down the aggregated Energy costs.</span>
<a name="l02030"></a>02030 <span class="comment"></span>
<a name="l02031"></a>02031 <span class="comment">     of.openTag(&quot;AggregatedEnergyCost&quot;);</span>
<a name="l02032"></a>02032 <span class="comment">     of &lt;&lt; &quot; EnergyCost=\&quot;&quot; &lt;&lt; aggredatedEnergyCosts &lt;&lt; &quot;\&quot;&quot;;</span>
<a name="l02033"></a>02033 <span class="comment">     of.closeTag(true);*/</span>
<a name="l02034"></a>02034 
<a name="l02035"></a>02035 }
<a name="l02036"></a>02036 
<a name="l02037"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a905027abd4c02c1c27d34721190d807b">02037</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a905027abd4c02c1c27d34721190d807b" title="Replaces the current vehicle type by the one given.">MSVehicle::replaceVehicleType</a>(<a class="code" href="../../de/da2/class_m_s_vehicle_type.html" title="The car-following model and parameter.">MSVehicleType</a>* type) {
<a name="l02038"></a>02038     <span class="keywordflow">if</span> (<a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>-&gt;<a class="code" href="../../de/da2/class_m_s_vehicle_type.html#ad58de41e989066b253af5ef6e4ded046" title="Returns whether this type belongs to a single vehicle only (was modified).">amVehicleSpecific</a>()) {
<a name="l02039"></a>02039         <span class="keyword">delete</span> <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a>;
<a name="l02040"></a>02040     }
<a name="l02041"></a>02041     <a class="code" href="../../d9/dd6/class_m_s_base_vehicle.html#a5891f4fb411d990184f7f62e0fcaca52" title="This Vehicle&amp;#39;s type.">myType</a> = type;
<a name="l02042"></a>02042 }
<a name="l02043"></a>02043 
<a name="l02044"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4e8b8ed4069225966c48d6de9e62f1d2">02044</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4e8b8ed4069225966c48d6de9e62f1d2">MSVehicle::getLaneIndex</a>()<span class="keyword"> const </span>{
<a name="l02045"></a>02045     std::vector&lt;MSLane*&gt;::const_iterator laneP = std::find(
<a name="l02046"></a>02046             (*myCurrEdge)-&gt;getLanes().begin(), (*myCurrEdge)-&gt;getLanes().end(),
<a name="l02047"></a>02047             <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>);
<a name="l02048"></a>02048     <span class="keywordflow">return</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) std::distance((*myCurrEdge)-&gt;getLanes().begin(),
<a name="l02049"></a>02049             laneP);
<a name="l02050"></a>02050 }
<a name="l02051"></a>02051 
<a name="l02052"></a>02052 <span class="preprocessor">#ifndef NO_TRACI</span>
<a name="l02053"></a>02053 <span class="preprocessor"></span><span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a64b9d5d27a4d8ebf3f72eb543c6105e8">MSVehicle::addTraciStop</a>(<a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a>* lane, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> pos, <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <span class="comment">/*radius*/</span>,
<a name="l02054"></a>02054         <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> duration) {
<a name="l02055"></a>02055     <span class="comment">//if the stop exists update the duration</span>
<a name="l02056"></a>02056     <span class="keywordflow">for</span> (std::list&lt;Stop&gt;::iterator iter = <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.begin();
<a name="l02057"></a>02057             iter != <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.end(); iter++) {
<a name="l02058"></a>02058         <span class="keywordflow">if</span> (iter-&gt;lane == lane &amp;&amp; fabs(iter-&gt;endPos - pos) &lt; <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>) {
<a name="l02059"></a>02059             <span class="keywordflow">if</span> (duration == 0 &amp;&amp; !iter-&gt;reached) {
<a name="l02060"></a>02060                 <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a9feff3aba8ffc6645dce8878fc600129" title="The vehicle&amp;#39;s list of stops.">myStops</a>.erase(iter);
<a name="l02061"></a>02061             } <span class="keywordflow">else</span> {
<a name="l02062"></a>02062                 iter-&gt;duration = duration;
<a name="l02063"></a>02063             }
<a name="l02064"></a>02064             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02065"></a>02065         }
<a name="l02066"></a>02066     }
<a name="l02067"></a>02067 
<a name="l02068"></a>02068     <a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html" title="Definition of vehicle stop (position and duration).">SUMOVehicleParameter::Stop</a> newStop;
<a name="l02069"></a>02069     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a0b01edd0c5899fbeeb87ef729ef1f0b6" title="The lane to stop at.">lane</a> = lane-&gt;<a class="code" href="../../d5/dbf/class_named.html#a20fd12b55c213fd79eae9fdd47b14eb1" title="Returns the id.">getID</a>();
<a name="l02070"></a>02070     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ad7e6ddc044bf06a4052ac2f366372cfa" title="(Optional) bus stop if one is assigned to the stop">busstop</a> = <a class="code" href="../../dc/d5d/class_m_s_net.html#a2024ec4396b66fd698bb581fc5cc3408" title="Returns the pointer to the unique instance of MSNet (singleton).">MSNet::getInstance</a>()-&gt;<a class="code" href="../../dc/d5d/class_m_s_net.html#a56b6ff09f6b851c80aaf7f385eb03c00" title="Returns the bus stop close to the given position.">getBusStopID</a>(lane, pos);
<a name="l02071"></a>02071     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a3435e088375fa79b59c4b58aac609f0c" title="The stopping position start.">startPos</a> = pos - <a class="code" href="../../db/d16/config_8h.html#af94afeb21356793ecd34d4b7bef68d50">POSITION_EPS</a>;
<a name="l02072"></a>02072     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a5c720143067b1cb982026f68ba417149" title="The stopping position end.">endPos</a> = pos;
<a name="l02073"></a>02073     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#af34de16e90f8027aac5973aefc3bbde0" title="The stopping duration.">duration</a> = duration;
<a name="l02074"></a>02074     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a9183e42ddbb877af1e4b767a1847ceda" title="The time at which the vehicle may continue its journey.">until</a> = -1;
<a name="l02075"></a>02075     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a959e989af41210da5548f1186efc4495" title="whether an arriving person lets the vehicle continue">triggered</a> = <span class="keyword">false</span>;
<a name="l02076"></a>02076     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#ac510509332a167a67550d62e941be867" title="whether the vehicle is removed from the net while stopping">parking</a> = <span class="keyword">false</span>;
<a name="l02077"></a>02077     newStop.<a class="code" href="../../d3/de9/struct_s_u_m_o_vehicle_parameter_1_1_stop.html#a7b741fc0d50e24b21e7cfbb2e3deb3c5" title="at which position in the stops list">index</a> = <a class="code" href="../../d0/d7a/_s_u_m_o_vehicle_parameter_8h.html#a24c5761d498b1887614323093e764c83">STOP_INDEX_END</a>;
<a name="l02078"></a>02078     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a602d0955951adc814cffc1a3fdc41d80" title="Adds a stop.">addStop</a>(newStop);
<a name="l02079"></a>02079 }
<a name="l02080"></a>02080 
<a name="l02081"></a>02081 <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html" title="Changes the wished vehicle speed / lanes.">MSVehicle::Influencer</a>&amp;
<a name="l02082"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#aae283d13ee3e53755394685b0b24767e">02082</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aae283d13ee3e53755394685b0b24767e" title="Returns the velocity/lane influencer.">MSVehicle::getInfluencer</a>() {
<a name="l02083"></a>02083     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a> == 0) {
<a name="l02084"></a>02084         <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a> = <span class="keyword">new</span> <a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html" title="Changes the wished vehicle speed / lanes.">Influencer</a>();
<a name="l02085"></a>02085     }
<a name="l02086"></a>02086     <span class="keywordflow">return</span> *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a>;
<a name="l02087"></a>02087 }
<a name="l02088"></a>02088 
<a name="l02089"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#af7094df359b127b37dee127d66a76ca7">02089</a> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#af7094df359b127b37dee127d66a76ca7" title="Returns the uninfluenced velocity.">MSVehicle::getSpeedWithoutTraciInfluence</a>()<span class="keyword"> const </span>{
<a name="l02090"></a>02090     <span class="keywordflow">if</span> (<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a> != 0) {
<a name="l02091"></a>02091         <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a794434c79977fe8b7b491416a1afd389" title="An instance of a velicty/lane influencing instance; built in &amp;quot;getInfluencer&amp;quot;...">myInfluencer</a>-&gt;<a class="code" href="../../dd/d39/class_m_s_vehicle_1_1_influencer.html#a7b96d03461270fc9d31b74b58f9bd00f" title="Returns the originally longitudianl speed to use.">getOriginalSpeed</a>();
<a name="l02092"></a>02092     }
<a name="l02093"></a>02093     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>.<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>;
<a name="l02094"></a>02094 }
<a name="l02095"></a>02095 
<a name="l02096"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a289cf824b2f2df325a9ac562da2a680d">02096</a> <a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a289cf824b2f2df325a9ac562da2a680d">MSVehicle::State::getEnterLane</a>()<span class="keyword"> const </span>{
<a name="l02097"></a>02097     <span class="keywordflow">return</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a>;
<a name="l02098"></a>02098 }
<a name="l02099"></a>02099 
<a name="l02100"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#aef27e64ed4642176e8a2dbea0799a589">02100</a> <span class="keywordtype">double</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#aef27e64ed4642176e8a2dbea0799a589">MSVehicle::State::getMyPosOnLane</a>()<span class="keyword"> const </span>{
<a name="l02101"></a>02101     <span class="keywordflow">return</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a4f92b1fdef09fd8a53c436b2ff4296c0">myPosOnLane</a>;
<a name="l02102"></a>02102 }
<a name="l02103"></a>02103 
<a name="l02104"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab8a21b05281767b610f0994ac8f8283c">02104</a> <span class="keywordtype">double</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab8a21b05281767b610f0994ac8f8283c">MSVehicle::State::getMyPos</a>()<span class="keyword"> const </span>{
<a name="l02105"></a>02105     <span class="keywordflow">return</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a56cfdc52decf66bde21f9009b6c0241c" title="the stored position">myPos</a>;
<a name="l02106"></a>02106 }
<a name="l02107"></a>02107 
<a name="l02108"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a5e607c19d516bfe3206535127ef9ee7e">02108</a> <span class="keywordtype">double</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a5e607c19d516bfe3206535127ef9ee7e">MSVehicle::State::getMySpeed</a>()<span class="keyword"> const </span>{
<a name="l02109"></a>02109     <span class="keywordflow">return</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a97b85076ed3946df1d9966f45bc79e04" title="the stored speed">mySpeed</a>;
<a name="l02110"></a>02110 }
<a name="l02111"></a>02111 
<a name="l02112"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a27329a66619be1d62503fd9062670eba">02112</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a27329a66619be1d62503fd9062670eba">MSVehicle::State::setMyPosOnLane</a>(<span class="keywordtype">double</span> aux) {
<a name="l02113"></a>02113     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a4f92b1fdef09fd8a53c436b2ff4296c0">myPosOnLane</a> = aux;
<a name="l02114"></a>02114 }
<a name="l02115"></a>02115 
<a name="l02116"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a5e74b6c352267e0d10e8234286d5e413">02116</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a5e74b6c352267e0d10e8234286d5e413">MSVehicle::State::setEnterLane</a>(<a class="code" href="../../d4/d64/_s_u_m_o_time_8h.html#ae665eda71d2654ce49eea540f154a3c7">SUMOTime</a> enterLaneI) {
<a name="l02117"></a>02117     <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a152182333011f7dc57c560963d5cb6ba">myTimeEnterLane</a> = enterLaneI;
<a name="l02118"></a>02118 }
<a name="l02119"></a>02119 
<a name="l02120"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#afab7549a09b52940a764c0082223c9f8">02120</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#afab7549a09b52940a764c0082223c9f8">MSVehicle::State::setMyPos</a>(<span class="keywordtype">double</span> myPos) {
<a name="l02121"></a>02121     this-&gt;myPos = myPos;
<a name="l02122"></a>02122 }
<a name="l02123"></a>02123 
<a name="l02124"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#abb33f2cfcb38ab7caa5caa90589dcc0c">02124</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#abb33f2cfcb38ab7caa5caa90589dcc0c">MSVehicle::State::setMySpeed</a>(<span class="keywordtype">double</span> mySpeed) {
<a name="l02125"></a>02125     this-&gt;mySpeed = mySpeed;
<a name="l02126"></a>02126 }
<a name="l02127"></a>02127 
<a name="l02128"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8a34bea2d1a2ba17b810ff7be571c213">02128</a> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html" title="Container that holds the vehicles driving state (position+speed).">MSVehicle::State</a> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a8a34bea2d1a2ba17b810ff7be571c213">MSVehicle::getMyState</a>()<span class="keyword"> const </span>{
<a name="l02129"></a>02129     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aed69452bdabae1c54763d0844d159e40" title="This Vehicles driving state (pos and speed).">myState</a>;
<a name="l02130"></a>02130 }
<a name="l02131"></a>02131 
<a name="l02132"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa9c05d985a8416f990fdd0dad409752a">02132</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#aa9c05d985a8416f990fdd0dad409752a">MSVehicle::setMyState</a>(<a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html" title="Container that holds the vehicles driving state (position+speed).">State</a> myState) {
<a name="l02133"></a>02133     this-&gt;myState = myState;
<a name="l02134"></a>02134 }
<a name="l02135"></a>02135 
<a name="l02136"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a223400c7b5ed11eff7d623432b96918a">02136</a> <a class="code" href="../../d9/d16/class_m_s_lane.html" title="Representation of a lane in the micro simulation.">MSLane</a> *<a class="code" href="../../d7/d90/class_m_s_vehicle.html#a223400c7b5ed11eff7d623432b96918a">MSVehicle::getMyLane</a>()<span class="keyword"> const </span>{
<a name="l02137"></a>02137     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#adf4eba103a9ea46dd4858e565e22e957" title="The lane the vehicle is on.">myLane</a>;
<a name="l02138"></a>02138 }
<a name="l02139"></a>02139 
<a name="l02140"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4f75132e021d5c0bc58c28e9e356a51f">02140</a> <span class="keywordtype">bool</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4f75132e021d5c0bc58c28e9e356a51f">MSVehicle::isHasChangeEdge</a>()<span class="keyword"> const </span>{
<a name="l02141"></a>02141     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a4976fc5a9c6febb2c362b9c7240e3c7e">hasChangeEdge</a>;
<a name="l02142"></a>02142 }
<a name="l02143"></a>02143 
<a name="l02144"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#af91dd7f16bbb5f716c0e077ac75c40c1">02144</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#af91dd7f16bbb5f716c0e077ac75c40c1">MSVehicle::setHasChangeEdge</a>(<span class="keywordtype">bool</span> hasChangeEdge) {
<a name="l02145"></a>02145     this-&gt;hasChangeEdge = hasChangeEdge;
<a name="l02146"></a>02146 }
<a name="l02147"></a>02147 
<a name="l02148"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab003138466869d3ef8cfd9767f5e03a5">02148</a> std::string <a class="code" href="../../d7/d90/class_m_s_vehicle.html#ab003138466869d3ef8cfd9767f5e03a5">MSVehicle::getMyLastEdgeId</a>()<span class="keyword"> const </span>{
<a name="l02149"></a>02149     <span class="keywordflow">return</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a095f35637a54750eafe3bf02eca46e38">myLastEdgeId</a>;
<a name="l02150"></a>02150 }
<a name="l02151"></a>02151 
<a name="l02152"></a><a class="code" href="../../d7/d90/class_m_s_vehicle.html#a7c3004acef2e805220beadf4fda83dca">02152</a> <span class="keywordtype">void</span> <a class="code" href="../../d7/d90/class_m_s_vehicle.html#a7c3004acef2e805220beadf4fda83dca">MSVehicle::setMyLastEdgeId</a>(std::string myLastEdgeId) {
<a name="l02153"></a>02153     this-&gt;myLastEdgeId = myLastEdgeId;
<a name="l02154"></a>02154 }
<a name="l02155"></a>02155 
<a name="l02156"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#aea077a41933cb4e1a96c3928b9bcedb1">02156</a> <span class="keywordtype">double</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#aea077a41933cb4e1a96c3928b9bcedb1">MSVehicle::State::getMyEnterPosLane</a>()<span class="keyword"> const </span>{
<a name="l02157"></a>02157     <span class="keywordflow">return</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a3ac3deac9de783c3f74a0eb426d9680d">myEnterPosLane</a>;
<a name="l02158"></a>02158 }
<a name="l02159"></a>02159 
<a name="l02160"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a840e7cbdf5907d09abe5bedd44181c65">02160</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a840e7cbdf5907d09abe5bedd44181c65">MSVehicle::State::setMyEnterPosLane</a>(<span class="keywordtype">double</span> myEnterPosLane) {
<a name="l02161"></a>02161     this-&gt;myEnterPosLane = myEnterPosLane;
<a name="l02162"></a>02162 }
<a name="l02163"></a>02163 
<a name="l02164"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a6719122911e776d07f5e9479eecc5f35">02164</a> <span class="keywordtype">double</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#a6719122911e776d07f5e9479eecc5f35">MSVehicle::State::getMyLastChargeRemoved</a>()<span class="keyword"> const </span>{
<a name="l02165"></a>02165     <span class="keywordflow">return</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#adf2541afc09a947c723db1411e8fb6ef">myLastChargeRemoved</a>;
<a name="l02166"></a>02166 }
<a name="l02167"></a>02167 
<a name="l02168"></a><a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab70f4b07166c48ed3cd642a60e88f237">02168</a> <span class="keywordtype">void</span> <a class="code" href="../../df/dd1/class_m_s_vehicle_1_1_state.html#ab70f4b07166c48ed3cd642a60e88f237">MSVehicle::State::setMyLastChargeRemoved</a>(<span class="keywordtype">double</span> myLastChargeRemoved) {
<a name="l02169"></a>02169     this-&gt;myLastChargeRemoved = myLastChargeRemoved;
<a name="l02170"></a>02170 }
<a name="l02171"></a>02171 
<a name="l02172"></a>02172 <span class="preprocessor">#endif</span>
<a name="l02173"></a>02173 <span class="preprocessor"></span>
<a name="l02174"></a>02174 <span class="comment">/****************************************************************************/</span>
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:02 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
