<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SUMO - Simulation of Urban MObility: NIImporter_OpenStreetMap.cpp Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="../../main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="../../pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="../../modules.html"><span>Modules</span></a></li>
      <li><a href="../../annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="../../files.html"><span>Files</span></a></li>
      <li><a href="../../dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="../../files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="../../globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="../../dir_75b82e7e4a5feb05200b9ad7adf06257.html">home</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_46b8f36974b309f038ffc35aa047a32b.html">boni</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_52e5be8ca53cec2b5437a8ba83e8e4f0.html">Desktop</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_7de3ce0f65e0314f747915173f89e60e.html">DanielTouched</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_a0096e276045b3ff0719c75e0b3c59bf.html">sumo-0.14.0</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_e9b8d709919855cd07b0394009af2578.html">src</a>&nbsp;&raquo;&nbsp;<a class="el" href="../../dir_941ad1c9f6979a737b8a94dcef837464.html">netimport</a>
  </div>
</div>
<div class="contents">
<h1>NIImporter_OpenStreetMap.cpp</h1><a href="../../df/de0/_n_i_importer___open_street_map_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/****************************************************************************/</span>
<a name="l00010"></a>00010 <span class="comment">// Importer for networks stored in OpenStreetMap format</span>
<a name="l00011"></a>00011 <span class="comment">/****************************************************************************/</span>
<a name="l00012"></a>00012 <span class="comment">// SUMO, Simulation of Urban MObility; see http://sumo.sourceforge.net/</span>
<a name="l00013"></a>00013 <span class="comment">// Copyright (C) 2001-2012 DLR (http://www.dlr.de/) and contributors</span>
<a name="l00014"></a>00014 <span class="comment">/****************************************************************************/</span>
<a name="l00015"></a>00015 <span class="comment">//</span>
<a name="l00016"></a>00016 <span class="comment">//   This file is part of SUMO.</span>
<a name="l00017"></a>00017 <span class="comment">//   SUMO is free software: you can redistribute it and/or modify</span>
<a name="l00018"></a>00018 <span class="comment">//   it under the terms of the GNU General Public License as published by</span>
<a name="l00019"></a>00019 <span class="comment">//   the Free Software Foundation, either version 3 of the License, or</span>
<a name="l00020"></a>00020 <span class="comment">//   (at your option) any later version.</span>
<a name="l00021"></a>00021 <span class="comment">//</span>
<a name="l00022"></a>00022 <span class="comment">/****************************************************************************/</span>
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 <span class="comment">// ===========================================================================</span>
<a name="l00026"></a>00026 <span class="comment">// included modules</span>
<a name="l00027"></a>00027 <span class="comment">// ===========================================================================</span>
<a name="l00028"></a>00028 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00029"></a>00029 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d3/d99/windows__config_8h.html">windows_config.h</a>&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#else</span>
<a name="l00031"></a>00031 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../db/d16/config_8h.html">config.h</a>&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#endif</span>
<a name="l00033"></a>00033 <span class="preprocessor"></span><span class="preprocessor">#include &lt;algorithm&gt;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &lt;set&gt;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;functional&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &lt;<a class="code" href="../../d2/d70/_s_u_m_o_s_a_x_handler_8h.html">utils/xml/SUMOSAXHandler.h</a>&gt;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db4/_util_exceptions_8h.html">utils/common/UtilExceptions.h</a>&gt;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="../../de/d4a/_tpl_convert_8h.html">utils/common/TplConvert.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d08/_to_string_8h.html">utils/common/ToString.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/df7/_msg_handler_8h.html">utils/common/MsgHandler.h</a>&gt;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &lt;<a class="code" href="../../de/dde/_string_utils_8h.html">utils/common/StringUtils.h</a>&gt;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="../../da/d8e/_string_tokenizer_8h.html">utils/common/StringTokenizer.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;<a class="code" href="../../d8/d0b/_n_b_edge_8h.html">netbuild/NBEdge.h</a>&gt;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="../../d7/db4/_n_b_edge_cont_8h.html">netbuild/NBEdgeCont.h</a>&gt;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &lt;<a class="code" href="../../d4/da0/_n_b_node_8h.html">netbuild/NBNode.h</a>&gt;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="../../da/d09/_n_b_node_cont_8h.html">netbuild/NBNodeCont.h</a>&gt;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="../../dd/df1/_n_b_net_builder_8h.html">netbuild/NBNetBuilder.h</a>&gt;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="../../d1/df8/_n_b_own_t_l_def_8h.html">netbuild/NBOwnTLDef.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html">utils/xml/SUMOXMLDefinitions.h</a>&gt;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d6d/_geo_conv_helper_8h.html">utils/geom/GeoConvHelper.h</a>&gt;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;<a class="code" href="../../db/dec/_geom_conv_helper_8h.html">utils/geom/GeomConvHelper.h</a>&gt;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;<a class="code" href="../../d3/d5c/_options_cont_8h.html">utils/options/OptionsCont.h</a>&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;<a class="code" href="../../d0/da2/_file_helpers_8h.html">utils/common/FileHelpers.h</a>&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;<a class="code" href="../../d5/de9/_x_m_l_sub_sys_8h.html">utils/xml/XMLSubSys.h</a>&gt;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="../../d2/d16/_n_i_loader_8h.html">NILoader.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="../../d5/d4c/_n_i_importer___open_street_map_8h.html">NIImporter_OpenStreetMap.h</a>&quot;</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="preprocessor">#ifdef CHECK_MEMORY_LEAKS</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="preprocessor">#include &lt;<a class="code" href="../../d7/d8d/debug__new_8h.html">foreign/nvwa/debug_new.h</a>&gt;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#endif // CHECK_MEMORY_LEAKS</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00065"></a>00065 <span class="comment">// static members</span>
<a name="l00066"></a>00066 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00067"></a>00067 <span class="keyword">const</span> <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a08ccf4d3d54c0850e227853ae8ad3133">NIImporter_OpenStreetMap::MAXSPEED_UNGIVEN</a> = -1;
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 <span class="comment">// ===========================================================================</span>
<a name="l00071"></a>00071 <span class="comment">// Private classes</span>
<a name="l00072"></a>00072 <span class="comment">// ===========================================================================</span>
<a name="l00073"></a>00073 
<a name="l00076"></a><a class="code" href="../../d5/d3b/class_n_i_importer___open_street_map_1_1_compare_edges.html">00076</a> <span class="keyword">class </span><a class="code" href="../../d5/d3b/class_n_i_importer___open_street_map_1_1_compare_edges.html" title="Functor which compares two Edges.">NIImporter_OpenStreetMap::CompareEdges</a> {
<a name="l00077"></a>00077 <span class="keyword">public</span>:
<a name="l00078"></a><a class="code" href="../../d5/d3b/class_n_i_importer___open_street_map_1_1_compare_edges.html#a1304116bc46e3078b2ff9580f8b91a45">00078</a>     <span class="keywordtype">bool</span> <a class="code" href="../../d5/d3b/class_n_i_importer___open_street_map_1_1_compare_edges.html#a1304116bc46e3078b2ff9580f8b91a45">operator()</a>(<span class="keyword">const</span> <a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html" title="An internal definition of a loaded edge.">Edge</a>* e1, <span class="keyword">const</span> <a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html" title="An internal definition of a loaded edge.">Edge</a>* e2)<span class="keyword"> const </span>{
<a name="l00079"></a>00079         <span class="keywordflow">if</span> (e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a> != e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a>) {
<a name="l00080"></a>00080             <span class="keywordflow">return</span> e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a> &gt; e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a>;
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082         <span class="keywordflow">if</span> (e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a> != e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a>) {
<a name="l00083"></a>00083             <span class="keywordflow">return</span> e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a> &gt; e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a>;
<a name="l00084"></a>00084         }
<a name="l00085"></a>00085         <span class="keywordflow">if</span> (e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a> != e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a>) {
<a name="l00086"></a>00086             <span class="keywordflow">return</span> e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a> &gt; e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a>;
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088         <span class="keywordflow">if</span> (e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a>) {
<a name="l00089"></a>00089             <span class="keywordflow">return</span> e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> &gt; e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a>;
<a name="l00090"></a>00090         }
<a name="l00091"></a>00091         <span class="keywordflow">return</span> e1-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a> &gt; e2-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>;
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093 };
<a name="l00094"></a>00094 
<a name="l00095"></a>00095 <span class="comment">// ===========================================================================</span>
<a name="l00096"></a>00096 <span class="comment">// method definitions</span>
<a name="l00097"></a>00097 <span class="comment">// ===========================================================================</span>
<a name="l00098"></a>00098 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00099"></a>00099 <span class="comment">// static methods</span>
<a name="l00100"></a>00100 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00101"></a>00101 <span class="keyword">const</span> std::string <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#aaae2ddd338e47202c9b070cbd3e8ef37" title="The separator within newly created compound type names.">NIImporter_OpenStreetMap::compoundTypeSeparator</a>(<span class="stringliteral">&quot;|&quot;</span>);
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="keywordtype">void</span>
<a name="l00105"></a><a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a32ab6c51a2d5fb3568253ae1e8e5fb78">00105</a> <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a32ab6c51a2d5fb3568253ae1e8e5fb78" title="Loads content of the optionally given OSM file.">NIImporter_OpenStreetMap::loadNetwork</a>(<span class="keyword">const</span> <a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../d3/df6/class_n_b_net_builder.html" title="Instance responsible for building networks.">NBNetBuilder</a>&amp; nb) {
<a name="l00106"></a>00106     <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html" title="Importer for networks stored in OpenStreetMap format.">NIImporter_OpenStreetMap</a> importer;
<a name="l00107"></a>00107     importer.<a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a002a4d2fe1ee7eea38ba15020f98a8e5">_loadNetwork</a>(oc, nb);
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a2fbf460d93742672578cf8608725076b">00111</a> <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a2fbf460d93742672578cf8608725076b">NIImporter_OpenStreetMap::NIImporter_OpenStreetMap</a>() {}
<a name="l00112"></a>00112 
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a4ab31296ef7e8078ced962947553cd78">00114</a> <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a4ab31296ef7e8078ced962947553cd78">NIImporter_OpenStreetMap::~NIImporter_OpenStreetMap</a>() {
<a name="l00115"></a>00115     <span class="comment">// delete nodes</span>
<a name="l00116"></a>00116     <span class="keywordflow">for</span> (std::set&lt;NIOSMNode*, CompareNodes&gt;::iterator i = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7fbead4c7a39c4f982362ccce98eafd8" title="the set of unique nodes used in NodesHandler, used when freeing memory">myUniqueNodes</a>.begin(); i != <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7fbead4c7a39c4f982362ccce98eafd8" title="the set of unique nodes used in NodesHandler, used when freeing memory">myUniqueNodes</a>.end(); i++) {
<a name="l00117"></a>00117         <span class="keyword">delete</span> *i;
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119     <span class="comment">// delete edges</span>
<a name="l00120"></a>00120     <span class="keywordflow">for</span> (std::map&lt;std::string, Edge*&gt;::iterator i = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.begin(); i != <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.end(); ++i) {
<a name="l00121"></a>00121         <span class="keyword">delete</span>(*i).second;
<a name="l00122"></a>00122     }
<a name="l00123"></a>00123 }
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 
<a name="l00126"></a>00126 <span class="keywordtype">void</span>
<a name="l00127"></a><a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a002a4d2fe1ee7eea38ba15020f98a8e5">00127</a> <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a002a4d2fe1ee7eea38ba15020f98a8e5">NIImporter_OpenStreetMap::_loadNetwork</a>(<span class="keyword">const</span> <a class="code" href="../../db/d31/class_options_cont.html" title="A storage for options typed value containers).">OptionsCont</a>&amp; oc, <a class="code" href="../../d3/df6/class_n_b_net_builder.html" title="Instance responsible for building networks.">NBNetBuilder</a>&amp; nb) {
<a name="l00128"></a>00128     <span class="comment">// check whether the option is set (properly)</span>
<a name="l00129"></a>00129     <span class="keywordflow">if</span> (!oc.<a class="code" href="../../db/d31/class_options_cont.html#a08a62e1f4fcf9acaefc97efce45609fc" title="Returns the information whether the named option is set.">isSet</a>(<span class="stringliteral">&quot;osm-files&quot;</span>)) {
<a name="l00130"></a>00130         <span class="keywordflow">return</span>;
<a name="l00131"></a>00131     }
<a name="l00132"></a>00132     <span class="comment">// preset types</span>
<a name="l00133"></a>00133     <span class="comment">//  for highways</span>
<a name="l00134"></a>00134     <a class="code" href="../../db/d57/class_n_b_type_cont.html" title="A storage for available types of edges.">NBTypeCont</a>&amp; tc = nb.<a class="code" href="../../d3/df6/class_n_b_net_builder.html#a5c4fed8889dde5383bed0d68137cfede" title="Returns the type container.">getTypeCont</a>();
<a name="l00135"></a>00135     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> <span class="keyword">const</span> WIDTH = <a class="code" href="../../d7/d41/class_n_b_edge.html#a0dd9544e9aac1c56a9c6b80d74ce2808" title="unspecified lane width">NBEdge::UNSPECIFIED_WIDTH</a>;
<a name="l00136"></a>00136     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.motorway&quot;</span>,      3, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(160./ 3.6), 13, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a8c0f63db2fcf07ff773b945340a16e14">SVC_UNKNOWN</a>, <span class="keyword">true</span>);
<a name="l00137"></a>00137     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.motorway_link&quot;</span>, 1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(80. / 3.6), 12, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a8c0f63db2fcf07ff773b945340a16e14">SVC_UNKNOWN</a>, <span class="keyword">true</span>);
<a name="l00138"></a>00138     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.trunk&quot;</span>,         2, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(100./ 3.6), 11, WIDTH); <span class="comment">// !!! 130km/h?</span>
<a name="l00139"></a>00139     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.trunk_link&quot;</span>,    1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(80. / 3.6), 10, WIDTH);
<a name="l00140"></a>00140     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.primary&quot;</span>,       2, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(100./ 3.6),  9, WIDTH);
<a name="l00141"></a>00141     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.primary_link&quot;</span>,  1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(80. / 3.6),  8, WIDTH);
<a name="l00142"></a>00142     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.secondary&quot;</span>,     2, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(100./ 3.6),  7, WIDTH);
<a name="l00143"></a>00143     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.secondary_link&quot;</span>,1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(80. / 3.6),  6, WIDTH);
<a name="l00144"></a>00144     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.tertiary&quot;</span>,      1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(80. / 3.6),  6, WIDTH);
<a name="l00145"></a>00145     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.tertiary_link&quot;</span>, 1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(80. / 3.6),  5, WIDTH);
<a name="l00146"></a>00146     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.unclassified&quot;</span>,  1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(80. / 3.6),  5, WIDTH);
<a name="l00147"></a>00147     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.residential&quot;</span>,   1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(50. / 3.6),  4, WIDTH); <span class="comment">// actually, maybe one lane for parking would be nice...</span>
<a name="l00148"></a>00148     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.living_street&quot;</span>, 1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(10. / 3.6),  3, WIDTH);
<a name="l00149"></a>00149     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.service&quot;</span>,       1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(20. / 3.6),  2, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a7c02e5f6c8735836231989302db75197" title="vehicle is a small delivery vehicle">SVC_DELIVERY</a>);
<a name="l00150"></a>00150     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.track&quot;</span>,         1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(20. / 3.6),  1, WIDTH);
<a name="l00151"></a>00151     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.services&quot;</span>,      1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH);
<a name="l00152"></a>00152     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.unsurfaced&quot;</span>,    1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH); <span class="comment">// unofficial value, used outside germany</span>
<a name="l00153"></a>00153     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.footway&quot;</span>,       1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8af6b937ca5d29c3d7824f9171b3546658" title="is a pedestrian">SVC_PEDESTRIAN</a>); 
<a name="l00154"></a>00154     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.pedestrian&quot;</span>,    1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8af6b937ca5d29c3d7824f9171b3546658" title="is a pedestrian">SVC_PEDESTRIAN</a>);
<a name="l00155"></a>00155 
<a name="l00156"></a>00156     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.path&quot;</span>,          1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(10. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8af6b937ca5d29c3d7824f9171b3546658" title="is a pedestrian">SVC_PEDESTRIAN</a>);
<a name="l00157"></a>00157     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.bridleway&quot;</span>,     1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(10. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a4f607ce5e45cb13abfc17f351e2ff2f0" title="vehicle is a bicycle">SVC_BICYCLE</a>); <span class="comment">// no horse stuff</span>
<a name="l00158"></a>00158     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.cycleway&quot;</span>,      1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(20. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a4f607ce5e45cb13abfc17f351e2ff2f0" title="vehicle is a bicycle">SVC_BICYCLE</a>);
<a name="l00159"></a>00159     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.footway&quot;</span>,       1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(10. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8af6b937ca5d29c3d7824f9171b3546658" title="is a pedestrian">SVC_PEDESTRIAN</a>);
<a name="l00160"></a>00160     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.step&quot;</span>,          1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(5.  / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8af6b937ca5d29c3d7824f9171b3546658" title="is a pedestrian">SVC_PEDESTRIAN</a>); <span class="comment">// additional</span>
<a name="l00161"></a>00161     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.steps&quot;</span>,         1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(5.  / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8af6b937ca5d29c3d7824f9171b3546658" title="is a pedestrian">SVC_PEDESTRIAN</a>); <span class="comment">// :-) do not run too fast</span>
<a name="l00162"></a>00162     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.stairs&quot;</span>,        1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(5.  / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8af6b937ca5d29c3d7824f9171b3546658" title="is a pedestrian">SVC_PEDESTRIAN</a>); <span class="comment">// additional</span>
<a name="l00163"></a>00163     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.bus_guideway&quot;</span>,  1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8ad5c6fec626bbb4329fc696e8174afe07" title="vehicle is a bus">SVC_BUS</a>);
<a name="l00164"></a>00164     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.raceway&quot;</span>,       2, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(300./ 3.6), 14, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a0670b79f4f1aa2cf945c607abf30ab4d" title="vip vehicles">SVC_VIP</a>);
<a name="l00165"></a>00165     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;highway.ford&quot;</span>,          1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(10. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8ab21b133fff051274486ed14d4af9205e" title="army vehicles">SVC_PUBLIC_ARMY</a>);
<a name="l00166"></a>00166 
<a name="l00167"></a>00167     <span class="comment">//  for railways</span>
<a name="l00168"></a>00168     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;railway.rail&quot;</span>,          1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a57f93f2782fc334535fed0e16bac0b61" title="vehicle is a fast moving rail">SVC_RAIL_FAST</a>);
<a name="l00169"></a>00169     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;railway.tram&quot;</span>,          1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8abaf010dcedb84cd91f4a0a2ca56cd7de" title="vehicle is a city rail">SVC_CITYRAIL</a>);
<a name="l00170"></a>00170     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;railway.light_rail&quot;</span>,    1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a09faf7dcfc07a90725ef6b54d51d13d5" title="vehicle is a light rail">SVC_LIGHTRAIL</a>);
<a name="l00171"></a>00171     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;railway.subway&quot;</span>,        1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8abaf010dcedb84cd91f4a0a2ca56cd7de" title="vehicle is a city rail">SVC_CITYRAIL</a>);
<a name="l00172"></a>00172     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;railway.preserved&quot;</span>,     1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a09faf7dcfc07a90725ef6b54d51d13d5" title="vehicle is a light rail">SVC_LIGHTRAIL</a>);
<a name="l00173"></a>00173     tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a0bc5b858adb81f9d09d873e0e4c8c321" title="Adds a type into the list. This is a simplified convenience form of insert, if only...">insert</a>(<span class="stringliteral">&quot;railway.monorail&quot;</span>,      1, (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(30. / 3.6),  1, WIDTH, <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#a17df31a9aea72357cba448aa9a81add8a09faf7dcfc07a90725ef6b54d51d13d5" title="vehicle is a light rail">SVC_LIGHTRAIL</a>); <span class="comment">// rail stuff has to be discussed</span>
<a name="l00174"></a>00174 
<a name="l00175"></a>00175 
<a name="l00176"></a>00176     <span class="comment">/* Parse file(s)</span>
<a name="l00177"></a>00177 <span class="comment">     * Each file is parsed twice: first for nodes, second for edges. */</span>
<a name="l00178"></a>00178     std::vector&lt;std::string&gt; files = oc.<a class="code" href="../../db/d31/class_options_cont.html#a6713cebc23d2e3a88f8a00942e4fee32" title="Returns the list of string-vector-value of the named option (only for Option_String)...">getStringVector</a>(<span class="stringliteral">&quot;osm-files&quot;</span>);
<a name="l00179"></a>00179     <span class="comment">// load nodes, first</span>
<a name="l00180"></a>00180     <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html" title="A class which extracts OSM-nodes from a parsed OSM-file.">NodesHandler</a> nodesHandler(<a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7bdf108b38aab8dc67e899ead13cb92d" title="the map from OSM node ids to actual nodes">myOSMNodes</a>, <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7fbead4c7a39c4f982362ccce98eafd8" title="the set of unique nodes used in NodesHandler, used when freeing memory">myUniqueNodes</a>);
<a name="l00181"></a>00181     <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator file = files.begin(); file != files.end(); ++file) {
<a name="l00182"></a>00182         <span class="comment">// nodes</span>
<a name="l00183"></a>00183         <span class="keywordflow">if</span> (!<a class="code" href="../../de/d41/class_file_helpers.html#a7f457b757712c42c00f1917f98579e98" title="Checks whether the given file exists.">FileHelpers::exists</a>(*file)) {
<a name="l00184"></a>00184             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Could not open osm-file &#39;&quot;</span> + *file + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00185"></a>00185             <span class="keywordflow">return</span>;
<a name="l00186"></a>00186         }
<a name="l00187"></a>00187         nodesHandler.<a class="code" href="../../da/da8/class_generic_s_a_x_handler.html#aa16678c95ae836a53ade17ec5923effd" title="Sets the current file name.">setFileName</a>(*file);
<a name="l00188"></a>00188         <a class="code" href="../../d4/df7/_msg_handler_8h.html#afa3f7d0673e0a81062288662416bca15">PROGRESS_BEGIN_MESSAGE</a>(<span class="stringliteral">&quot;Parsing nodes from osm-file &#39;&quot;</span> + *file + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00189"></a>00189         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/db5/class_x_m_l_sub_sys.html#a76efc123ca1ac726bfa84fff454d47ec" title="Runs the given handler on the given file; returns if everything&amp;#39;s ok.">XMLSubSys::runParser</a>(nodesHandler, *file)) {
<a name="l00190"></a>00190             <span class="keywordflow">return</span>;
<a name="l00191"></a>00191         }
<a name="l00192"></a>00192         <a class="code" href="../../d4/df7/_msg_handler_8h.html#ab1885dedc6abc417e920e02f58531924">PROGRESS_DONE_MESSAGE</a>();
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194     <span class="comment">// load edges, then</span>
<a name="l00195"></a>00195     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html" title="A class which extracts OSM-edges from a parsed OSM-file.">EdgesHandler</a> edgesHandler(<a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7bdf108b38aab8dc67e899ead13cb92d" title="the map from OSM node ids to actual nodes">myOSMNodes</a>, <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>);
<a name="l00196"></a>00196     <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::const_iterator file = files.begin(); file != files.end(); ++file) {
<a name="l00197"></a>00197         <span class="comment">// edges</span>
<a name="l00198"></a>00198         edgesHandler.<a class="code" href="../../da/da8/class_generic_s_a_x_handler.html#aa16678c95ae836a53ade17ec5923effd" title="Sets the current file name.">setFileName</a>(*file);
<a name="l00199"></a>00199         <a class="code" href="../../d4/df7/_msg_handler_8h.html#afa3f7d0673e0a81062288662416bca15">PROGRESS_BEGIN_MESSAGE</a>(<span class="stringliteral">&quot;Parsing edges from osm-file &#39;&quot;</span> + *file + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l00200"></a>00200         <a class="code" href="../../d7/db5/class_x_m_l_sub_sys.html#a76efc123ca1ac726bfa84fff454d47ec" title="Runs the given handler on the given file; returns if everything&amp;#39;s ok.">XMLSubSys::runParser</a>(edgesHandler, *file);
<a name="l00201"></a>00201         <a class="code" href="../../d4/df7/_msg_handler_8h.html#ab1885dedc6abc417e920e02f58531924">PROGRESS_DONE_MESSAGE</a>();
<a name="l00202"></a>00202     }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204     <span class="comment">/* Remove duplicate edges with the same shape and attributes */</span>
<a name="l00205"></a>00205     <span class="keywordflow">if</span> (!<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().getBool(<span class="stringliteral">&quot;osm.skip-duplicates-check&quot;</span>)) {
<a name="l00206"></a>00206         <a class="code" href="../../d4/df7/_msg_handler_8h.html#afa3f7d0673e0a81062288662416bca15">PROGRESS_BEGIN_MESSAGE</a>(<span class="stringliteral">&quot;Removing duplicate edges&quot;</span>);
<a name="l00207"></a>00207         <span class="keywordflow">if</span> (<a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.size() &gt; 1) {
<a name="l00208"></a>00208             std::set&lt;const Edge*, CompareEdges&gt; dupsFinder;
<a name="l00209"></a>00209             <span class="keywordflow">for</span> (std::map&lt;std::string, Edge*&gt;::iterator it = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.begin(); it != <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.end();) {
<a name="l00210"></a>00210                 <span class="keywordflow">if</span> (dupsFinder.count(it-&gt;second) &gt; 0) {
<a name="l00211"></a>00211                     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;Found duplicate edges. Removing &quot;</span> + it-&gt;first);
<a name="l00212"></a>00212                     <span class="keyword">delete</span> it-&gt;second;
<a name="l00213"></a>00213                     <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.erase(it++);
<a name="l00214"></a>00214                 } <span class="keywordflow">else</span> {
<a name="l00215"></a>00215                     dupsFinder.insert(it-&gt;second);
<a name="l00216"></a>00216                     it++;
<a name="l00217"></a>00217                 }
<a name="l00218"></a>00218             }
<a name="l00219"></a>00219         }
<a name="l00220"></a>00220         <a class="code" href="../../d4/df7/_msg_handler_8h.html#ab1885dedc6abc417e920e02f58531924">PROGRESS_DONE_MESSAGE</a>();
<a name="l00221"></a>00221     }
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="comment">/* Mark which nodes are used (by edges or traffic lights).</span>
<a name="l00224"></a>00224 <span class="comment">     * This is necessary to detect which OpenStreetMap nodes are for</span>
<a name="l00225"></a>00225 <span class="comment">     * geometry only */</span>
<a name="l00226"></a>00226     std::map&lt;int, int&gt; nodeUsage;
<a name="l00227"></a>00227     <span class="comment">// Mark which nodes are used by edges (begin and end)</span>
<a name="l00228"></a>00228     <span class="keywordflow">for</span> (std::map&lt;std::string, Edge*&gt;::const_iterator i = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.begin(); i != <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.end(); ++i) {
<a name="l00229"></a>00229         <a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html" title="An internal definition of a loaded edge.">Edge</a>* e = (*i).second;
<a name="l00230"></a>00230         assert(e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a3651acd0b83c94fba482c2a5da60cab4" title="Information whether this is a road.">myCurrentIsRoad</a>);
<a name="l00231"></a>00231         <span class="keywordflow">for</span> (std::vector&lt;int&gt;::const_iterator j = e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.begin(); j != e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.end(); ++j) {
<a name="l00232"></a>00232             <span class="keywordflow">if</span> (nodeUsage.find(*j) == nodeUsage.end()) {
<a name="l00233"></a>00233                 nodeUsage[*j] = 0;
<a name="l00234"></a>00234             }
<a name="l00235"></a>00235             nodeUsage[*j] = nodeUsage[*j] + 1;
<a name="l00236"></a>00236         }
<a name="l00237"></a>00237     }
<a name="l00238"></a>00238     <span class="comment">// Mark which nodes are used by traffic lights</span>
<a name="l00239"></a>00239     <span class="keywordflow">for</span> (std::map&lt;int, NIOSMNode*&gt;::const_iterator nodesIt = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7bdf108b38aab8dc67e899ead13cb92d" title="the map from OSM node ids to actual nodes">myOSMNodes</a>.begin(); nodesIt != <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7bdf108b38aab8dc67e899ead13cb92d" title="the map from OSM node ids to actual nodes">myOSMNodes</a>.end(); ++nodesIt) {
<a name="l00240"></a>00240         <span class="keywordflow">if</span> (nodesIt-&gt;second-&gt;tlsControlled) {
<a name="l00241"></a>00241             <span class="comment">// If the key is not found in the map, the value is automatically</span>
<a name="l00242"></a>00242             <span class="comment">// initialized with 0.</span>
<a name="l00243"></a>00243             nodeUsage[nodesIt-&gt;first] += 1;
<a name="l00244"></a>00244         }
<a name="l00245"></a>00245     }
<a name="l00246"></a>00246     <span class="comment">/* Instantiate edges</span>
<a name="l00247"></a>00247 <span class="comment">     * Only those nodes in the middle of an edge which are used by more than</span>
<a name="l00248"></a>00248 <span class="comment">     * one edge are instantiated. Other nodes are considered as geometry nodes. */</span>
<a name="l00249"></a>00249     <a class="code" href="../../db/d8c/class_n_b_node_cont.html" title="Container for nodes during the netbuilding process.">NBNodeCont</a>&amp; nc = nb.<a class="code" href="../../d3/df6/class_n_b_net_builder.html#ad979a4393f11213c4628c2fdb1dedc21" title="Returns the node container.">getNodeCont</a>();
<a name="l00250"></a>00250     <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec = nb.<a class="code" href="../../d3/df6/class_n_b_net_builder.html#abee895b64ec934e4a4dea81e0d6cab1b" title="Returns the edge container.">getEdgeCont</a>();
<a name="l00251"></a>00251     <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlsc = nb.<a class="code" href="../../d3/df6/class_n_b_net_builder.html#aebffc1a8477a6c722b7edfa4a865e0da" title="Returns the traffic light logics container.">getTLLogicCont</a>();
<a name="l00252"></a>00252     <span class="keywordflow">for</span> (std::map&lt;std::string, Edge*&gt;::iterator i = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.begin(); i != <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a8a80585b55449daf125c0c015ad9fd24">myEdges</a>.end(); ++i) {
<a name="l00253"></a>00253         <a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html" title="An internal definition of a loaded edge.">Edge</a>* e = (*i).second;
<a name="l00254"></a>00254         assert(e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a3651acd0b83c94fba482c2a5da60cab4" title="Information whether this is a road.">myCurrentIsRoad</a>);
<a name="l00255"></a>00255         <span class="comment">// build nodes;</span>
<a name="l00256"></a>00256         <span class="comment">//  the from- and to-nodes must be built in any case</span>
<a name="l00257"></a>00257         <span class="comment">//  the geometry nodes are only built if more than one edge references them</span>
<a name="l00258"></a>00258         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* currentFrom = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a2a83c98e75c3730601a706b1afbb6fdd" title="Builds an NBNode.">insertNodeChecking</a>(*e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.begin(), nc, tlsc);
<a name="l00259"></a>00259         <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* last = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a2a83c98e75c3730601a706b1afbb6fdd" title="Builds an NBNode.">insertNodeChecking</a>(*(e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.end() - 1), nc, tlsc);
<a name="l00260"></a>00260         <span class="keywordtype">int</span> running = 0;
<a name="l00261"></a>00261         std::vector&lt;int&gt; passed;
<a name="l00262"></a>00262         <span class="keywordflow">for</span> (std::vector&lt;int&gt;::iterator j = e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.begin(); j != e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.end(); ++j) {
<a name="l00263"></a>00263             passed.push_back(*j);
<a name="l00264"></a>00264             <span class="keywordflow">if</span> (nodeUsage[*j] &gt; 1 &amp;&amp; j != e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.end() - 1 &amp;&amp; j != e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.begin()) {
<a name="l00265"></a>00265                 <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* currentTo = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a2a83c98e75c3730601a706b1afbb6fdd" title="Builds an NBNode.">insertNodeChecking</a>(*j, nc, tlsc);
<a name="l00266"></a>00266                 <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a0aca15c116b21b6c61ed1d24d9b29642" title="Builds an NBEdge.">insertEdge</a>(e, running, currentFrom, currentTo, passed, ec, tc);
<a name="l00267"></a>00267                 currentFrom = currentTo;
<a name="l00268"></a>00268                 running++;
<a name="l00269"></a>00269                 passed.clear();
<a name="l00270"></a>00270             }
<a name="l00271"></a>00271         }
<a name="l00272"></a>00272         <span class="keywordflow">if</span> (running == 0) {
<a name="l00273"></a>00273             running = -1;
<a name="l00274"></a>00274         }
<a name="l00275"></a>00275         <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a0aca15c116b21b6c61ed1d24d9b29642" title="Builds an NBEdge.">insertEdge</a>(e, running, currentFrom, last, passed, ec, tc);
<a name="l00276"></a>00276     }
<a name="l00277"></a>00277 }
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 
<a name="l00280"></a>00280 <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>*
<a name="l00281"></a><a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a2a83c98e75c3730601a706b1afbb6fdd">00281</a> <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a2a83c98e75c3730601a706b1afbb6fdd" title="Builds an NBNode.">NIImporter_OpenStreetMap::insertNodeChecking</a>(<span class="keywordtype">int</span> <span class="keywordtype">id</span>, <a class="code" href="../../db/d8c/class_n_b_node_cont.html" title="Container for nodes during the netbuilding process.">NBNodeCont</a>&amp; nc, <a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html" title="A container for traffic light definitions and built programs.">NBTrafficLightLogicCont</a>&amp; tlsc) {
<a name="l00282"></a>00282     <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* from = nc.<a class="code" href="../../db/d8c/class_n_b_node_cont.html#a0e2ce1b9413a0c11728ac63344c62039" title="Returns the node with the given name.">retrieve</a>(<a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>));
<a name="l00283"></a>00283     <span class="keywordflow">if</span> (from == 0) {
<a name="l00284"></a>00284         <a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html" title="An internal representation of an OSM-node.">NIOSMNode</a>* n = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7bdf108b38aab8dc67e899ead13cb92d" title="the map from OSM node ids to actual nodes">myOSMNodes</a>.find(<span class="keywordtype">id</span>)-&gt;second;
<a name="l00285"></a>00285         <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a> pos(n-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a50039b411c201a1b4a5d28f32a7dd190" title="The longitude the node is located at.">lon</a>, n-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a1d3662a0feb88dc4a4f95fce979a829c" title="The latitude the node is located at.">lat</a>);
<a name="l00286"></a>00286         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d26/class_n_i_loader.html#aff54c5ec457af6836a76d6745276f477" title="transforms loaded coordinates handles projections, offsets (using GeoConvHelper)...">NILoader::transformCoordinates</a>(pos, <span class="keyword">true</span>)) {
<a name="l00287"></a>00287             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Unable to project coordinates for node &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>) + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l00288"></a>00288             <span class="keyword">delete</span> from;
<a name="l00289"></a>00289             <span class="keywordflow">return</span> 0;
<a name="l00290"></a>00290         }
<a name="l00291"></a>00291         from = <span class="keyword">new</span> <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>(<a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>), pos);
<a name="l00292"></a>00292         <span class="keywordflow">if</span> (!nc.<a class="code" href="../../db/d8c/class_n_b_node_cont.html#ab70c3a2678e411a0b1e3edd41d2dd177" title="Inserts a node into the map.">insert</a>(from)) {
<a name="l00293"></a>00293             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Could not insert node &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>) + <span class="stringliteral">&quot;&#39;).&quot;</span>);
<a name="l00294"></a>00294             <span class="keyword">delete</span> from;
<a name="l00295"></a>00295             <span class="keywordflow">return</span> 0;
<a name="l00296"></a>00296         }
<a name="l00297"></a>00297         <span class="keywordflow">if</span> (n-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a7816665b3deed663507db0b84bd8def6" title="Whether this is a tls controlled junction.">tlsControlled</a>) {
<a name="l00298"></a>00298             <span class="comment">// ok, this node is a traffic light node where no other nodes</span>
<a name="l00299"></a>00299             <span class="comment">//  participate</span>
<a name="l00300"></a>00300             <a class="code" href="../../d3/dfe/class_n_b_own_t_l_def.html" title="A traffic light logics which must be computed (only nodes/edges are given).">NBOwnTLDef</a>* tlDef = <span class="keyword">new</span> <a class="code" href="../../d3/dfe/class_n_b_own_t_l_def.html" title="A traffic light logics which must be computed (only nodes/edges are given).">NBOwnTLDef</a>(<a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>), from);
<a name="l00301"></a>00301             <span class="keywordflow">if</span> (!tlsc.<a class="code" href="../../d9/d5e/class_n_b_traffic_light_logic_cont.html#ae5230d7284321706e0fd811bc6ef8878" title="Adds a logic definition to the dictionary.">insert</a>(tlDef)) {
<a name="l00302"></a>00302                 <span class="comment">// actually, nothing should fail here</span>
<a name="l00303"></a>00303                 <span class="keyword">delete</span> tlDef;
<a name="l00304"></a>00304                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not allocate tls &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>) + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00305"></a>00305             }
<a name="l00306"></a>00306         }
<a name="l00307"></a>00307     }
<a name="l00308"></a>00308     <span class="keywordflow">return</span> from;
<a name="l00309"></a>00309 }
<a name="l00310"></a>00310 
<a name="l00311"></a>00311 
<a name="l00312"></a>00312 <span class="keywordtype">void</span>
<a name="l00313"></a><a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a0aca15c116b21b6c61ed1d24d9b29642">00313</a> <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a0aca15c116b21b6c61ed1d24d9b29642" title="Builds an NBEdge.">NIImporter_OpenStreetMap::insertEdge</a>(<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html" title="An internal definition of a loaded edge.">Edge</a>* e, <span class="keywordtype">int</span> index, <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* from, <a class="code" href="../../d3/dd1/class_n_b_node.html" title="Represents a single node (junction) during network building.">NBNode</a>* to,
<a name="l00314"></a>00314                                      <span class="keyword">const</span> std::vector&lt;int&gt; &amp;passed, <a class="code" href="../../da/ded/class_n_b_edge_cont.html" title="Storage for edges, including some functionality operating on multiple edges.">NBEdgeCont</a>&amp; ec, <a class="code" href="../../db/d57/class_n_b_type_cont.html" title="A storage for available types of edges.">NBTypeCont</a>&amp; tc) {
<a name="l00315"></a>00315     <span class="comment">// patch the id</span>
<a name="l00316"></a>00316     std::string <span class="keywordtype">id</span> = e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a>;
<a name="l00317"></a>00317     <span class="keywordflow">if</span> (index &gt;= 0) {
<a name="l00318"></a>00318         <span class="keywordtype">id</span> = <span class="keywordtype">id</span> + <span class="stringliteral">&quot;#&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(index);
<a name="l00319"></a>00319     }
<a name="l00320"></a>00320     <span class="comment">// convert the shape</span>
<a name="l00321"></a>00321     <a class="code" href="../../da/d56/class_position_vector.html" title="A list of 2D-positions.">PositionVector</a> shape;
<a name="l00322"></a>00322     <span class="keywordflow">for</span> (std::vector&lt;int&gt;::const_iterator i = passed.begin(); i != passed.end(); ++i) {
<a name="l00323"></a>00323         <a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html" title="An internal representation of an OSM-node.">NIOSMNode</a>* n = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7bdf108b38aab8dc67e899ead13cb92d" title="the map from OSM node ids to actual nodes">myOSMNodes</a>.find(*i)-&gt;second;
<a name="l00324"></a>00324         <a class="code" href="../../d7/d3b/class_position.html" title="A point in 2D or 3D with translation and scaling methods.">Position</a> pos(n-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a50039b411c201a1b4a5d28f32a7dd190" title="The longitude the node is located at.">lon</a>, n-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a1d3662a0feb88dc4a4f95fce979a829c" title="The latitude the node is located at.">lat</a>);
<a name="l00325"></a>00325         <span class="keywordflow">if</span> (!<a class="code" href="../../d7/d26/class_n_i_loader.html#aff54c5ec457af6836a76d6745276f477" title="transforms loaded coordinates handles projections, offsets (using GeoConvHelper)...">NILoader::transformCoordinates</a>(pos, <span class="keyword">true</span>)) {
<a name="l00326"></a>00326             <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Unable to project coordinates for edge &quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;.&quot;</span>);
<a name="l00327"></a>00327         }
<a name="l00328"></a>00328         shape.<a class="code" href="../../da/d56/class_position_vector.html#ab86064177ddffd3981afb3ce95e4a52e">push_back_noDoublePos</a>(pos);
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330 
<a name="l00331"></a>00331     std::string type = e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a>;
<a name="l00332"></a>00332     <span class="keywordflow">if</span> (!tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a54d3087233d540015cd9106a5d470526" title="Returns whether the named type is in the container.">knows</a>(type)) {
<a name="l00333"></a>00333         <span class="keywordflow">if</span> (type.find(<a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#aaae2ddd338e47202c9b070cbd3e8ef37" title="The separator within newly created compound type names.">compoundTypeSeparator</a>) != std::string::npos) {
<a name="l00334"></a>00334             <span class="comment">// this edge has a combination type which does not yet exist in the TypeContainer</span>
<a name="l00335"></a>00335             <a class="code" href="../../db/dc0/class_string_tokenizer.html">StringTokenizer</a> tok = <a class="code" href="../../db/dc0/class_string_tokenizer.html">StringTokenizer</a>(type, <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#aaae2ddd338e47202c9b070cbd3e8ef37" title="The separator within newly created compound type names.">compoundTypeSeparator</a>);
<a name="l00336"></a>00336             std::set&lt;std::string&gt; types;
<a name="l00337"></a>00337             <span class="keywordflow">while</span> (tok.<a class="code" href="../../db/dc0/class_string_tokenizer.html#aa654384891d4b9d724eee0f6c739193c">hasNext</a>()) {
<a name="l00338"></a>00338                 std::string t = tok.<a class="code" href="../../db/dc0/class_string_tokenizer.html#afbe25dccd9c18a10650861730e63a7c2">next</a>();
<a name="l00339"></a>00339                 <span class="keywordflow">if</span> (tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a54d3087233d540015cd9106a5d470526" title="Returns whether the named type is in the container.">knows</a>(t)) {
<a name="l00340"></a>00340                     types.insert(t);
<a name="l00341"></a>00341                 } <span class="keywordflow">else</span> {
<a name="l00342"></a>00342                     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Discarding edge &quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot; with type \&quot;&quot;</span> + type + <span class="stringliteral">&quot;\&quot; (unknown compound \&quot;&quot;</span> + t + <span class="stringliteral">&quot;\&quot;).&quot;</span>);
<a name="l00343"></a>00343                     <span class="keywordflow">return</span>;
<a name="l00344"></a>00344                 }
<a name="l00345"></a>00345             }
<a name="l00346"></a>00346 
<a name="l00347"></a>00347             <span class="keywordflow">if</span> (types.size() == 2 &amp;&amp;
<a name="l00348"></a>00348                     types.count(<span class="stringliteral">&quot;railway.tram&quot;</span>) == 1) {
<a name="l00349"></a>00349                 <span class="comment">// compound types concern mostly the special case of tram tracks on a normal road.</span>
<a name="l00350"></a>00350                 <span class="comment">// in this case we simply discard the tram information since the default for road is to allow all vclasses</span>
<a name="l00351"></a>00351                 types.erase(<span class="stringliteral">&quot;railway.tram&quot;</span>);
<a name="l00352"></a>00352                 std::string otherCompound = *(types.begin());
<a name="l00353"></a>00353                 <span class="comment">// XXX if otherCompound does not allow all vehicles (e.g. SVC_DELIVERY), tram will still not be allowed</span>
<a name="l00354"></a>00354                 type = otherCompound;
<a name="l00355"></a>00355             } <span class="keywordflow">else</span> {
<a name="l00356"></a>00356                 <span class="comment">// other cases not implemented yet</span>
<a name="l00357"></a>00357                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Discarding edge &quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot; with unknown type \&quot;&quot;</span> + type + <span class="stringliteral">&quot;\&quot;.&quot;</span>);
<a name="l00358"></a>00358                 <span class="keywordflow">return</span>;
<a name="l00359"></a>00359             }
<a name="l00360"></a>00360         } <span class="keywordflow">else</span> {
<a name="l00361"></a>00361             <span class="comment">// we do not know the type -&gt; something else, ignore</span>
<a name="l00362"></a>00362             <span class="comment">//WRITE_WARNING(&quot;Discarding edge &quot; + id + &quot; with unknown type \&quot;&quot; + type + &quot;\&quot;.&quot;);</span>
<a name="l00363"></a>00363             <span class="keywordflow">return</span>;
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365     }
<a name="l00366"></a>00366 
<a name="l00367"></a>00367 
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     <span class="comment">// otherwise it is not an edge and will be ignored</span>
<a name="l00370"></a>00370     <span class="keywordtype">int</span> noLanes = tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a4be40be0868bd5e626ccfe99e52601a1" title="Returns the number of lanes for the given type.">getNumLanes</a>(type);
<a name="l00371"></a>00371     <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> speed = tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#ac5e013789fea67b88b8ba113980a7555" title="Returns the maximal velocity for the given type [m/s].">getSpeed</a>(type);
<a name="l00372"></a>00372     <span class="keywordtype">bool</span> defaultsToOneWay = tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#aa0386c3300a9cb888250688b91b669bb" title="Returns whether edges are one-way per default for the given type.">getIsOneWay</a>(type);
<a name="l00373"></a>00373     <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#aeeb92a4c5c00b838d8f8b481b17eccce">SUMOVehicleClasses</a> allowedClasses = tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a645e5be5c32b78b3a4d79b318526927d" title="Returns allowed vehicle classes for the given type.">getAllowedClasses</a>(type);
<a name="l00374"></a>00374     <a class="code" href="../../d2/d6d/_s_u_m_o_vehicle_class_8h.html#aeeb92a4c5c00b838d8f8b481b17eccce">SUMOVehicleClasses</a> disallowedClasses = tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a659114cbacc5b4e4e1e3ef2f3453b4b7" title="Returns not allowed vehicle classes for the given type.">getDisallowedClasses</a>(type);
<a name="l00375"></a>00375     <span class="comment">// check directions</span>
<a name="l00376"></a>00376     <span class="keywordtype">bool</span> addSecond = <span class="keyword">true</span>;
<a name="l00377"></a>00377     <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> == <span class="stringliteral">&quot;true&quot;</span> || e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> == <span class="stringliteral">&quot;yes&quot;</span> || e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> == <span class="stringliteral">&quot;1&quot;</span> || (defaultsToOneWay &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;no&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;false&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;0&quot;</span>)) {
<a name="l00378"></a>00378         addSecond = <span class="keyword">false</span>;
<a name="l00379"></a>00379     }
<a name="l00380"></a>00380     <span class="comment">// if we had been able to extract the number of lanes, override the highway type default</span>
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a> &gt;= 0) {
<a name="l00382"></a>00382         <span class="keywordflow">if</span> (!addSecond) {
<a name="l00383"></a>00383             noLanes = e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a>;
<a name="l00384"></a>00384         } <span class="keywordflow">else</span> {
<a name="l00385"></a>00385             noLanes = e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a> / 2;
<a name="l00386"></a>00386         }
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388     <span class="comment">// if we had been able to extract the maximum speed, override the type&#39;s default</span>
<a name="l00389"></a>00389     <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a> != <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a08ccf4d3d54c0850e227853ae8ad3133">MAXSPEED_UNGIVEN</a>) {
<a name="l00390"></a>00390         speed = (<a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a>)(e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a> / 3.6);
<a name="l00391"></a>00391     }
<a name="l00392"></a>00392 
<a name="l00393"></a>00393     <span class="keywordflow">if</span> (noLanes != 0 &amp;&amp; speed != 0) {
<a name="l00394"></a>00394         <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;false&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;no&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;true&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;yes&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;-1&quot;</span> &amp;&amp; e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;1&quot;</span>) {
<a name="l00395"></a>00395             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;New value for oneway found: &quot;</span> + e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a>);
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397         <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a9266afbd0b47dea3e4a46c3ea8e9b511" title="Numbers representing special SUMO-XML-attribute values Information how the edge&amp;#39;s...">LaneSpreadFunction</a> lsf = addSecond ? <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a9266afbd0b47dea3e4a46c3ea8e9b511ae7e3b88514c3c8ec96b3be33ff58944b">LANESPREAD_RIGHT</a> : <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a9266afbd0b47dea3e4a46c3ea8e9b511a55d244ddc2721841db383d43bb60c01d">LANESPREAD_CENTER</a>;
<a name="l00398"></a>00398         <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;-1&quot;</span>) {
<a name="l00399"></a>00399             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* nbe = <span class="keyword">new</span> <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>(<span class="keywordtype">id</span>, from, to, type, speed, noLanes, tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a4827ea02d078ac4cea43cd52ff551cc8" title="Returns the priority for the given type.">getPriority</a>(type),
<a name="l00400"></a>00400                                      tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a36d77e59e5b09dcfec217b9b331174c0" title="Returns the lane width for the given type [m/s].">getWidth</a>(type), <a class="code" href="../../d7/d41/class_n_b_edge.html#ab8dff601b260c1aafec075e08efa6d84" title="unspecified lane offset">NBEdge::UNSPECIFIED_OFFSET</a>, shape, e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ad70f0b166a719f5a320a44277a7b1f63" title="The edge&amp;#39;s street name.">streetName</a>, lsf);
<a name="l00401"></a>00401             nbe-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a3172ee896aa08ba932e9fe6abca838a7" title="set allowed/disallowed classes for the given lane or for all lanes if -1 is given...">setVehicleClasses</a>(allowedClasses, disallowedClasses);
<a name="l00402"></a>00402             <span class="keywordflow">if</span> (!ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#addde5ff7cfc01b1ca492fe9120646a73" title="Adds an edge to the dictionary.">insert</a>(nbe)) {
<a name="l00403"></a>00403                 <span class="keyword">delete</span> nbe;
<a name="l00404"></a>00404                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not add edge &#39;&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00405"></a>00405             }
<a name="l00406"></a>00406         }
<a name="l00407"></a>00407         <span class="keywordflow">if</span> (addSecond) {
<a name="l00408"></a>00408             <span class="keywordflow">if</span> (e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> != <span class="stringliteral">&quot;-1&quot;</span>) {
<a name="l00409"></a>00409                 <span class="keywordtype">id</span> = <span class="stringliteral">&quot;-&quot;</span> + id;
<a name="l00410"></a>00410             }
<a name="l00411"></a>00411             <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>* nbe = <span class="keyword">new</span> <a class="code" href="../../d7/d41/class_n_b_edge.html" title="The representation of a single edge during network building.">NBEdge</a>(<span class="keywordtype">id</span>, to, from, type, speed, noLanes, tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a4827ea02d078ac4cea43cd52ff551cc8" title="Returns the priority for the given type.">getPriority</a>(type),
<a name="l00412"></a>00412                                      tc.<a class="code" href="../../db/d57/class_n_b_type_cont.html#a36d77e59e5b09dcfec217b9b331174c0" title="Returns the lane width for the given type [m/s].">getWidth</a>(type), <a class="code" href="../../d7/d41/class_n_b_edge.html#ab8dff601b260c1aafec075e08efa6d84" title="unspecified lane offset">NBEdge::UNSPECIFIED_OFFSET</a>, shape.<a class="code" href="../../da/d56/class_position_vector.html#a0dec24e1521994cbf1d60195f87dc09d">reverse</a>(), e-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ad70f0b166a719f5a320a44277a7b1f63" title="The edge&amp;#39;s street name.">streetName</a>, lsf);
<a name="l00413"></a>00413             nbe-&gt;<a class="code" href="../../d7/d41/class_n_b_edge.html#a3172ee896aa08ba932e9fe6abca838a7" title="set allowed/disallowed classes for the given lane or for all lanes if -1 is given...">setVehicleClasses</a>(allowedClasses, disallowedClasses);
<a name="l00414"></a>00414             <span class="keywordflow">if</span> (!ec.<a class="code" href="../../da/ded/class_n_b_edge_cont.html#addde5ff7cfc01b1ca492fe9120646a73" title="Adds an edge to the dictionary.">insert</a>(nbe)) {
<a name="l00415"></a>00415                 <span class="keyword">delete</span> nbe;
<a name="l00416"></a>00416                 <span class="keywordflow">throw</span> <a class="code" href="../../da/d18/class_process_error.html">ProcessError</a>(<span class="stringliteral">&quot;Could not add edge &#39;-&quot;</span> + <span class="keywordtype">id</span> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00417"></a>00417             }
<a name="l00418"></a>00418         }
<a name="l00419"></a>00419     }
<a name="l00420"></a>00420 }
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 
<a name="l00423"></a>00423 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00424"></a>00424 <span class="comment">// definitions of NIImporter_OpenStreetMap::NodesHandler-methods</span>
<a name="l00425"></a>00425 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00426"></a><a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a87278fed3f9aed0896177e0f523dd347">00426</a> <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a87278fed3f9aed0896177e0f523dd347" title="Contructor.">NIImporter_OpenStreetMap::NodesHandler::NodesHandler</a>(
<a name="l00427"></a>00427         std::map&lt;int, NIOSMNode*&gt; &amp;toFill,
<a name="l00428"></a>00428         std::set&lt;NIOSMNode*, CompareNodes&gt; &amp;uniqueNodes) : 
<a name="l00429"></a>00429     <a class="code" href="../../db/db8/class_s_u_m_o_s_a_x_handler.html" title="SAX-handler base for SUMO-files.">SUMOSAXHandler</a>(<span class="stringliteral">&quot;osm - file&quot;</span>), 
<a name="l00430"></a>00430     myToFill(toFill), 
<a name="l00431"></a>00431     myUniqueNodes(uniqueNodes),
<a name="l00432"></a>00432     myLastNodeID(-1), 
<a name="l00433"></a>00433     myIsInValidNodeTag(false), 
<a name="l00434"></a>00434     myHierarchyLevel(0) {
<a name="l00435"></a>00435 }
<a name="l00436"></a>00436 
<a name="l00437"></a>00437 
<a name="l00438"></a><a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a099f1ea7eee43444c05b23747bb9b4ad">00438</a> <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a099f1ea7eee43444c05b23747bb9b4ad" title="Destructor.">NIImporter_OpenStreetMap::NodesHandler::~NodesHandler</a>() {}
<a name="l00439"></a>00439 
<a name="l00440"></a>00440 
<a name="l00441"></a>00441 <span class="keywordtype">void</span>
<a name="l00442"></a><a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a2e52e692b3cf69a1c74276a7e4694326">00442</a> <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a2e52e692b3cf69a1c74276a7e4694326" title="Called on the opening of a tag;.">NIImporter_OpenStreetMap::NodesHandler::myStartElement</a>(<span class="keywordtype">int</span> element, <span class="keyword">const</span> <a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html" title="Encapsulated SAX-Attributes.">SUMOSAXAttributes</a>&amp; attrs) {
<a name="l00443"></a>00443     ++<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a03947acb852d0c9a4b715aab7c73fab4" title="The current hierarchy level.">myHierarchyLevel</a>;
<a name="l00444"></a>00444     <span class="keywordflow">if</span> (element == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403baa89150e5a1e11395e0aad9c143095174">SUMO_TAG_NODE</a>) {
<a name="l00445"></a>00445         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00446"></a>00446         <span class="keywordflow">if</span> (<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a03947acb852d0c9a4b715aab7c73fab4" title="The current hierarchy level.">myHierarchyLevel</a> != 2) {
<a name="l00447"></a>00447             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Node element on wrong XML hierarchy level (id=&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#aa20314c8b11251d9d6d82566d6b34136" title="Tries to read given attribute assuming it is an int.">getIntReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96acd721cc93d1bc2a1d270b87a24232763">SUMO_ATTR_ID</a>, 0, ok)) + <span class="stringliteral">&quot;&#39;, level=&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a03947acb852d0c9a4b715aab7c73fab4" title="The current hierarchy level.">myHierarchyLevel</a>) + <span class="stringliteral">&quot;&#39;).&quot;</span>);
<a name="l00448"></a>00448             <span class="keywordflow">return</span>;
<a name="l00449"></a>00449         }
<a name="l00450"></a>00450         <span class="keywordtype">int</span> <span class="keywordtype">id</span> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#aa20314c8b11251d9d6d82566d6b34136" title="Tries to read given attribute assuming it is an int.">getIntReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96acd721cc93d1bc2a1d270b87a24232763">SUMO_ATTR_ID</a>, 0, ok);
<a name="l00451"></a>00451         std::string action = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<span class="stringliteral">&quot;action&quot;</span>) ? attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a7d81012d38b65b66075c1235b7a8fab3" title="Returns the string-value of the named (by its enum-value) attribute.">getStringSecure</a>(<span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00452"></a>00452         <span class="keywordflow">if</span> (action == <span class="stringliteral">&quot;delete&quot;</span>) {
<a name="l00453"></a>00453             <span class="keywordflow">return</span>;
<a name="l00454"></a>00454         }
<a name="l00455"></a>00455         <span class="keywordflow">if</span> (!ok) {
<a name="l00456"></a>00456             <span class="keywordflow">return</span>;
<a name="l00457"></a>00457         }
<a name="l00458"></a>00458         <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#ae42feab2dd2f6dbce0c0cf4a7b63fd99" title="ID of the currently parsed node, for reporting mainly.">myLastNodeID</a> = -1;
<a name="l00459"></a>00459         <span class="keywordflow">if</span> (<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a782d892f68ea42eb3c30af38e05bb579" title="The nodes container to fill.">myToFill</a>.find(<span class="keywordtype">id</span>) == <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a782d892f68ea42eb3c30af38e05bb579" title="The nodes container to fill.">myToFill</a>.end()) {
<a name="l00460"></a>00460             <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#ae42feab2dd2f6dbce0c0cf4a7b63fd99" title="ID of the currently parsed node, for reporting mainly.">myLastNodeID</a> = id;
<a name="l00461"></a>00461             <span class="comment">// assume we are loading multiple files...</span>
<a name="l00462"></a>00462             <span class="comment">//  ... so we won&#39;t report duplicate nodes</span>
<a name="l00463"></a>00463             <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00464"></a>00464             <span class="keywordtype">double</span> tlat, tlon;
<a name="l00465"></a>00465             std::istringstream lon(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a186db39409df0ccc44e65f236f0b9831">SUMO_ATTR_LON</a>, <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>).c_str(), ok));
<a name="l00466"></a>00466             <span class="keywordflow">if</span> (!ok) {
<a name="l00467"></a>00467                 <span class="keywordflow">return</span>;
<a name="l00468"></a>00468             }
<a name="l00469"></a>00469             lon &gt;&gt; tlon;
<a name="l00470"></a>00470             <span class="keywordflow">if</span> (lon.fail()) {
<a name="l00471"></a>00471                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Node&#39;s &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>) + <span class="stringliteral">&quot;&#39; lon information is not numeric.&quot;</span>);
<a name="l00472"></a>00472                 <span class="keywordflow">return</span>;
<a name="l00473"></a>00473             }
<a name="l00474"></a>00474             std::istringstream lat(attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96abdf803ed738edef70ee39b12dbaaa9e3">SUMO_ATTR_LAT</a>, <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>).c_str(), ok));
<a name="l00475"></a>00475             <span class="keywordflow">if</span> (!ok) {
<a name="l00476"></a>00476                 <span class="keywordflow">return</span>;
<a name="l00477"></a>00477             }
<a name="l00478"></a>00478             lat &gt;&gt; tlat;
<a name="l00479"></a>00479             <span class="keywordflow">if</span> (lat.fail()) {
<a name="l00480"></a>00480                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Node&#39;s &#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>) + <span class="stringliteral">&quot;&#39; lat information is not numeric.&quot;</span>);
<a name="l00481"></a>00481                 <span class="keywordflow">return</span>;
<a name="l00482"></a>00482             }
<a name="l00483"></a>00483             <a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html" title="An internal representation of an OSM-node.">NIOSMNode</a>* toAdd = <span class="keyword">new</span> <a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html" title="An internal representation of an OSM-node.">NIOSMNode</a>();
<a name="l00484"></a>00484             toAdd-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a5d05b2ab95b5433ef49596e905fb3f01" title="The node&amp;#39;s id.">id</a> = id;
<a name="l00485"></a>00485             toAdd-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a7816665b3deed663507db0b84bd8def6" title="Whether this is a tls controlled junction.">tlsControlled</a> = <span class="keyword">false</span>;
<a name="l00486"></a>00486             toAdd-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a1d3662a0feb88dc4a4f95fce979a829c" title="The latitude the node is located at.">lat</a> = tlat;
<a name="l00487"></a>00487             toAdd-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a50039b411c201a1b4a5d28f32a7dd190" title="The longitude the node is located at.">lon</a> = tlon;
<a name="l00488"></a>00488             <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a0ada7f34b17ff9948fe845063321c932" title="Hierarchy helper for parsing a node&amp;#39;s tags.">myIsInValidNodeTag</a> = <span class="keyword">true</span>;
<a name="l00489"></a>00489 
<a name="l00490"></a>00490             std::set&lt;NIOSMNode*, CompareNodes&gt;::iterator similarNode = <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a3968976c9ddd75760170f1e7bc8e275a" title="the set of unique nodes (used for duplicate detection/substitution)">myUniqueNodes</a>.find(toAdd);
<a name="l00491"></a>00491             <span class="keywordflow">if</span> (similarNode == <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a3968976c9ddd75760170f1e7bc8e275a" title="the set of unique nodes (used for duplicate detection/substitution)">myUniqueNodes</a>.end()) {
<a name="l00492"></a>00492                 <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a3968976c9ddd75760170f1e7bc8e275a" title="the set of unique nodes (used for duplicate detection/substitution)">myUniqueNodes</a>.insert(toAdd);
<a name="l00493"></a>00493             } <span class="keywordflow">else</span> {
<a name="l00494"></a>00494                 <span class="keyword">delete</span> toAdd;
<a name="l00495"></a>00495                 toAdd = *similarNode; 
<a name="l00496"></a>00496                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a4ff0c29263eba441db6e23204912ff7f">WRITE_MESSAGE</a>(<span class="stringliteral">&quot;Found duplicate nodes. Substituting &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<span class="keywordtype">id</span>) + <span class="stringliteral">&quot; with &quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(toAdd-&gt;<a class="code" href="../../dd/ddb/struct_n_i_importer___open_street_map_1_1_n_i_o_s_m_node.html#a5d05b2ab95b5433ef49596e905fb3f01" title="The node&amp;#39;s id.">id</a>));
<a name="l00497"></a>00497             }
<a name="l00498"></a>00498             <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a782d892f68ea42eb3c30af38e05bb579" title="The nodes container to fill.">myToFill</a>[id] = toAdd;
<a name="l00499"></a>00499         }
<a name="l00500"></a>00500     }
<a name="l00501"></a>00501     <span class="keywordflow">if</span> (element == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403bafc946d4866f452ccb1daf1ab54be68dc">SUMO_TAG_TAG</a> &amp;&amp; <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a0ada7f34b17ff9948fe845063321c932" title="Hierarchy helper for parsing a node&amp;#39;s tags.">myIsInValidNodeTag</a>) {
<a name="l00502"></a>00502         <span class="keywordflow">if</span> (<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a03947acb852d0c9a4b715aab7c73fab4" title="The current hierarchy level.">myHierarchyLevel</a> != 3) {
<a name="l00503"></a>00503             <a class="code" href="../../d4/df7/_msg_handler_8h.html#a55c513aa2d151eee464020081d6688c2">WRITE_ERROR</a>(<span class="stringliteral">&quot;Tag element on wrong XML hierarchy level.&quot;</span>);
<a name="l00504"></a>00504             <span class="keywordflow">return</span>;
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00507"></a>00507         std::string key = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ad1028eea4becb08f9af42fcd21408730">SUMO_ATTR_K</a>, <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#ae42feab2dd2f6dbce0c0cf4a7b63fd99" title="ID of the currently parsed node, for reporting mainly.">myLastNodeID</a>).c_str(), ok);
<a name="l00508"></a>00508         std::string value = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a532666e0ee347cad965e86e266b7b4fe" title="Tries to read given attribute assuming it is a string.">getOptStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a6c3a666f8bd8cac2fa8358c4b958c6f5">SUMO_ATTR_V</a>, <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#ae42feab2dd2f6dbce0c0cf4a7b63fd99" title="ID of the currently parsed node, for reporting mainly.">myLastNodeID</a>).c_str(), ok, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00509"></a>00509         <span class="keywordflow">if</span> (!ok) {
<a name="l00510"></a>00510             <span class="keywordflow">return</span>;
<a name="l00511"></a>00511         }
<a name="l00512"></a>00512         <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;highway&quot;</span> &amp;&amp; value.find(<span class="stringliteral">&quot;traffic_signal&quot;</span>) != std::string::npos &amp;&amp;
<a name="l00513"></a>00513                 !<a class="code" href="../../db/d31/class_options_cont.html#aeb57cb173789bce33943574837e6221c" title="Retrieves the options.">OptionsCont::getOptions</a>().<a class="code" href="../../db/d31/class_options_cont.html#a69874e7145a196b169c3c56eb58d3d57" title="Returns the boolean-value of the named option (only for Option_Bool).">getBool</a>(<span class="stringliteral">&quot;osm.discard-tls&quot;</span>)) {
<a name="l00514"></a>00514             <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a782d892f68ea42eb3c30af38e05bb579" title="The nodes container to fill.">myToFill</a>[<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#ae42feab2dd2f6dbce0c0cf4a7b63fd99" title="ID of the currently parsed node, for reporting mainly.">myLastNodeID</a>]-&gt;tlsControlled = <span class="keyword">true</span>;
<a name="l00515"></a>00515         }
<a name="l00516"></a>00516     }
<a name="l00517"></a>00517 }
<a name="l00518"></a>00518 
<a name="l00519"></a>00519 
<a name="l00520"></a>00520 <span class="keywordtype">void</span>
<a name="l00521"></a><a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#adbc65709f753c625f3642d4cc501caa9">00521</a> <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#adbc65709f753c625f3642d4cc501caa9" title="Called when a closing tag occurs.">NIImporter_OpenStreetMap::NodesHandler::myEndElement</a>(<span class="keywordtype">int</span> element) {
<a name="l00522"></a>00522     <span class="keywordflow">if</span> (element == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403baa89150e5a1e11395e0aad9c143095174">SUMO_TAG_NODE</a> &amp;&amp; <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a03947acb852d0c9a4b715aab7c73fab4" title="The current hierarchy level.">myHierarchyLevel</a> == 2) {
<a name="l00523"></a>00523         <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#ae42feab2dd2f6dbce0c0cf4a7b63fd99" title="ID of the currently parsed node, for reporting mainly.">myLastNodeID</a> = -1;
<a name="l00524"></a>00524         <a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a0ada7f34b17ff9948fe845063321c932" title="Hierarchy helper for parsing a node&amp;#39;s tags.">myIsInValidNodeTag</a> = <span class="keyword">false</span>;
<a name="l00525"></a>00525     }
<a name="l00526"></a>00526     --<a class="code" href="../../dd/da3/class_n_i_importer___open_street_map_1_1_nodes_handler.html#a03947acb852d0c9a4b715aab7c73fab4" title="The current hierarchy level.">myHierarchyLevel</a>;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 
<a name="l00530"></a>00530 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00531"></a>00531 <span class="comment">// definitions of NIImporter_OpenStreetMap::EdgesHandler-methods</span>
<a name="l00532"></a>00532 <span class="comment">// ---------------------------------------------------------------------------</span>
<a name="l00533"></a><a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#acf50c3d289fa500887f3cd001f884b02">00533</a> <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#acf50c3d289fa500887f3cd001f884b02" title="Constructor.">NIImporter_OpenStreetMap::EdgesHandler::EdgesHandler</a>(
<a name="l00534"></a>00534     <span class="keyword">const</span> std::map&lt;int, NIOSMNode*&gt; &amp;osmNodes,
<a name="l00535"></a>00535     std::map&lt;std::string, Edge*&gt; &amp;toFill)
<a name="l00536"></a>00536     : <a class="code" href="../../db/db8/class_s_u_m_o_s_a_x_handler.html" title="SAX-handler base for SUMO-files.">SUMOSAXHandler</a>(<span class="stringliteral">&quot;osm - file&quot;</span>),
<a name="l00537"></a>00537       <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a7bdf108b38aab8dc67e899ead13cb92d" title="the map from OSM node ids to actual nodes">myOSMNodes</a>(osmNodes), myEdgeMap(toFill) {
<a name="l00538"></a>00538     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[<span class="stringliteral">&quot;signals&quot;</span>] = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a08ccf4d3d54c0850e227853ae8ad3133">MAXSPEED_UNGIVEN</a>;
<a name="l00539"></a>00539     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[<span class="stringliteral">&quot;none&quot;</span>] = 300.;
<a name="l00540"></a>00540     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[<span class="stringliteral">&quot;no&quot;</span>] = 300.;
<a name="l00541"></a>00541     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[<span class="stringliteral">&quot;walk&quot;</span>] = 5.;
<a name="l00542"></a>00542     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[<span class="stringliteral">&quot;DE:rural&quot;</span>] = 100.;
<a name="l00543"></a>00543     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[<span class="stringliteral">&quot;DE:urban&quot;</span>] = 50.;
<a name="l00544"></a>00544     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[<span class="stringliteral">&quot;DE:living_street&quot;</span>] = 10.;
<a name="l00545"></a>00545 
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 
<a name="l00549"></a><a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#af1433f4aedf8df300dc136df26c44e46">00549</a> <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#af1433f4aedf8df300dc136df26c44e46" title="Destructor.">NIImporter_OpenStreetMap::EdgesHandler::~EdgesHandler</a>() {
<a name="l00550"></a>00550 }
<a name="l00551"></a>00551 
<a name="l00552"></a>00552 
<a name="l00553"></a>00553 <span class="keywordtype">void</span>
<a name="l00554"></a><a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a7f509bf010eeaa82a614885f2787e57e">00554</a> <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a7f509bf010eeaa82a614885f2787e57e" title="Called on the opening of a tag;.">NIImporter_OpenStreetMap::EdgesHandler::myStartElement</a>(<span class="keywordtype">int</span> element,
<a name="l00555"></a>00555         <span class="keyword">const</span> <a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html" title="Encapsulated SAX-Attributes.">SUMOSAXAttributes</a>&amp; attrs) {
<a name="l00556"></a>00556     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#aa83b7fc633e2b357ba2372fe4f9b9423" title="The element stack.">myParentElements</a>.push_back(element);
<a name="l00557"></a>00557     <span class="comment">// parse &quot;way&quot; elements</span>
<a name="l00558"></a>00558     <span class="keywordflow">if</span> (element == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba93d0fd914aa49e664ff8e1080addbc94">SUMO_TAG_WAY</a>) {
<a name="l00559"></a>00559         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00560"></a>00560         std::string <span class="keywordtype">id</span> = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96acd721cc93d1bc2a1d270b87a24232763">SUMO_ATTR_ID</a>, 0, ok);
<a name="l00561"></a>00561         std::string action = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#ae1e4d97d854c6f3a5a422b5666bc6472" title="Returns the information whether the named (by its enum-value) attribute is within...">hasAttribute</a>(<span class="stringliteral">&quot;action&quot;</span>) ? attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a7d81012d38b65b66075c1235b7a8fab3" title="Returns the string-value of the named (by its enum-value) attribute.">getStringSecure</a>(<span class="stringliteral">&quot;action&quot;</span>, <span class="stringliteral">&quot;&quot;</span>) : <span class="stringliteral">&quot;&quot;</span>;
<a name="l00562"></a>00562         <span class="keywordflow">if</span> (action == <span class="stringliteral">&quot;delete&quot;</span>) {
<a name="l00563"></a>00563             <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a> = 0;
<a name="l00564"></a>00564             <span class="keywordflow">return</span>;
<a name="l00565"></a>00565         }
<a name="l00566"></a>00566         <span class="keywordflow">if</span> (!ok) {
<a name="l00567"></a>00567             <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a> = 0;
<a name="l00568"></a>00568             <span class="keywordflow">return</span>;
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a> = <span class="keyword">new</span> <a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html" title="An internal definition of a loaded edge.">Edge</a>();
<a name="l00571"></a>00571         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a> = id;
<a name="l00572"></a>00572         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a> = -1;
<a name="l00573"></a>00573         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a> = <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#a08ccf4d3d54c0850e227853ae8ad3133">MAXSPEED_UNGIVEN</a>;
<a name="l00574"></a>00574         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a3651acd0b83c94fba482c2a5da60cab4" title="Information whether this is a road.">myCurrentIsRoad</a> = <span class="keyword">false</span>;
<a name="l00575"></a>00575     }
<a name="l00576"></a>00576     <span class="comment">// parse &quot;nd&quot; (node) elements</span>
<a name="l00577"></a>00577     <span class="keywordflow">if</span> (element == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba76f2e65b8c73b910b8fb37c015561240">SUMO_TAG_ND</a>) {
<a name="l00578"></a>00578         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00579"></a>00579         <span class="keywordtype">int</span> ref = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#aa20314c8b11251d9d6d82566d6b34136" title="Tries to read given attribute assuming it is an int.">getIntReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a9b4e71a65967f61cf8f848e2834aac27">SUMO_ATTR_REF</a>, 0, ok);
<a name="l00580"></a>00580         <span class="keywordflow">if</span> (ok) {
<a name="l00581"></a>00581             std::map&lt;int, NIOSMNode*&gt;::const_iterator node = <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a9fd679aea19e2780f527797a618fb6d9" title="The previously parsed nodes.">myOSMNodes</a>.find(ref);
<a name="l00582"></a>00582             <span class="keywordflow">if</span> (node == <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a9fd679aea19e2780f527797a618fb6d9" title="The previously parsed nodes.">myOSMNodes</a>.end()) {
<a name="l00583"></a>00583                 <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;The referenced geometry information (ref=&#39;&quot;</span> + <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(ref) + <span class="stringliteral">&quot;&#39;) is not known&quot;</span>);
<a name="l00584"></a>00584                 <span class="keywordflow">return</span>;
<a name="l00585"></a>00585             } <span class="keywordflow">else</span> {
<a name="l00586"></a>00586                 ref = node-&gt;second-&gt;id; <span class="comment">// node may have been substituted</span>
<a name="l00587"></a>00587                 <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.size() == 0 ||
<a name="l00588"></a>00588                         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.back() != ref) { <span class="comment">// avoid consecutive duplicates</span>
<a name="l00589"></a>00589                     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ae4d10cdfda13449a6e3f7d3b13a243c0" title="The list of nodes this edge is made of.">myCurrentNodes</a>.push_back(ref); 
<a name="l00590"></a>00590                 }
<a name="l00591"></a>00591             }
<a name="l00592"></a>00592         }
<a name="l00593"></a>00593     }
<a name="l00594"></a>00594     <span class="comment">// parse values</span>
<a name="l00595"></a>00595     <span class="keywordflow">if</span> (element == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403bafc946d4866f452ccb1daf1ab54be68dc">SUMO_TAG_TAG</a> &amp;&amp; <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#aa83b7fc633e2b357ba2372fe4f9b9423" title="The element stack.">myParentElements</a>.size() &gt; 2 &amp;&amp; <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#aa83b7fc633e2b357ba2372fe4f9b9423" title="The element stack.">myParentElements</a>[<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#aa83b7fc633e2b357ba2372fe4f9b9423" title="The element stack.">myParentElements</a>.size() - 2] == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba93d0fd914aa49e664ff8e1080addbc94">SUMO_TAG_WAY</a>) {
<a name="l00596"></a>00596         <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a> == 0) {
<a name="l00597"></a>00597             <span class="keywordflow">return</span>;
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599         <span class="keywordtype">bool</span> ok = <span class="keyword">true</span>;
<a name="l00600"></a>00600         std::string key = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96ad1028eea4becb08f9af42fcd21408730">SUMO_ATTR_K</a>, <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a>).c_str(), ok);
<a name="l00601"></a>00601         std::string value = attrs.<a class="code" href="../../db/ddf/class_s_u_m_o_s_a_x_attributes.html#a60fb11617232827b1e57ed41151dd67c" title="Tries to read given attribute assuming it is a string.">getStringReporting</a>(<a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#af3c090286e6f4a2b7fff99eea4690f96a6c3a666f8bd8cac2fa8358c4b958c6f5">SUMO_ATTR_V</a>, <a class="code" href="../../d8/d08/_to_string_8h.html#a18065e342d6bcbee25664108f38176f9">toString</a>(<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a>).c_str(), ok);
<a name="l00602"></a>00602         <span class="keywordflow">if</span> (!ok) {
<a name="l00603"></a>00603             <span class="keywordflow">return</span>;
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605         <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;highway&quot;</span> || key == <span class="stringliteral">&quot;railway&quot;</span>) {
<a name="l00606"></a>00606             <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a> != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00607"></a>00607                 <span class="comment">// osm-ways may be used by more than one mode (eg railway.tram + highway.residential. this is relevant for multimodal traffic)</span>
<a name="l00608"></a>00608                 <span class="comment">// we create a new type for this kind of situation which must then be resolved in insertEdge()</span>
<a name="l00609"></a>00609                 <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a> = <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a> + <a class="code" href="../../de/d29/class_n_i_importer___open_street_map.html#aaae2ddd338e47202c9b070cbd3e8ef37" title="The separator within newly created compound type names.">compoundTypeSeparator</a> + key + <span class="stringliteral">&quot;.&quot;</span> + value;
<a name="l00610"></a>00610             } <span class="keywordflow">else</span> {
<a name="l00611"></a>00611                 <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a605a67e66aa68402e3ab66d464d85d6b" title="The type, stored in &amp;quot;highway&amp;quot; key.">myHighWayType</a> = key + <span class="stringliteral">&quot;.&quot;</span> + value;
<a name="l00612"></a>00612             }
<a name="l00613"></a>00613             <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a3651acd0b83c94fba482c2a5da60cab4" title="Information whether this is a road.">myCurrentIsRoad</a> = <span class="keyword">true</span>;
<a name="l00614"></a>00614         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;lanes&quot;</span>) {
<a name="l00615"></a>00615             <span class="keywordflow">try</span> {
<a name="l00616"></a>00616                 <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a> = <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2int</a>(value.c_str());
<a name="l00617"></a>00617             } <span class="keywordflow">catch</span> (<a class="code" href="../../d7/ddc/class_number_format_exception.html">NumberFormatException</a>&amp;) {
<a name="l00618"></a>00618                 <span class="comment">// might be a list of values</span>
<a name="l00619"></a>00619                 <a class="code" href="../../db/dc0/class_string_tokenizer.html">StringTokenizer</a> st(value, <span class="stringliteral">&quot;;&quot;</span>, <span class="keyword">true</span>);
<a name="l00620"></a>00620                 std::vector&lt;std::string&gt; list = st.<a class="code" href="../../db/dc0/class_string_tokenizer.html#a72d662534abea7f6cf23011477f23c05">getVector</a>();
<a name="l00621"></a>00621                 <span class="keywordflow">if</span> (list.size() &gt;= 2) {
<a name="l00622"></a>00622                     <span class="keywordtype">int</span> minLanes = <a class="code" href="../../d1/dc9/polyfonts_8c.html#affe776513b24d84b39af8ab0930fef7f">std::numeric_limits&lt;int&gt;::max</a>();
<a name="l00623"></a>00623                     <span class="keywordflow">try</span> {
<a name="l00624"></a>00624                         <span class="keywordflow">for</span> (std::vector&lt;std::string&gt;::iterator i = list.begin(); i != list.end(); ++i) {
<a name="l00625"></a>00625                             <span class="keywordtype">int</span> numLanes = <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2int</a>(<a class="code" href="../../d3/d93/class_string_utils.html#a3262592c2a4ead46b92a6dad318a455c" title="Removes trailing and leading whitechars.">StringUtils::prune</a>(*i).c_str());
<a name="l00626"></a>00626                             minLanes = <a class="code" href="../../da/dbd/_std_defs_8h.html#addea5df1107152d65231122e3dfad6fb">MIN2</a>(minLanes, numLanes);
<a name="l00627"></a>00627                         }
<a name="l00628"></a>00628                         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#aa424e80a6fa15f26b4f5b2352299654c" title="number of lanes, or -1 if unknown">myNoLanes</a> = minLanes;
<a name="l00629"></a>00629                         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Using minimum lane number from list (&quot;</span> + value + <span class="stringliteral">&quot;) for edge &#39;&quot;</span> + <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00630"></a>00630                     } <span class="keywordflow">catch</span> (<a class="code" href="../../d7/ddc/class_number_format_exception.html">NumberFormatException</a>&amp;) {
<a name="l00631"></a>00631                         <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Value of key &#39;&quot;</span> + key + <span class="stringliteral">&quot;&#39; is not numeric (&#39;&quot;</span> + value + <span class="stringliteral">&quot;&#39;) in edge &#39;&quot;</span> + <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00632"></a>00632                     }
<a name="l00633"></a>00633                 }
<a name="l00634"></a>00634             }
<a name="l00635"></a>00635         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;maxspeed&quot;</span>) {
<a name="l00636"></a>00636             <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>.find(value) != <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>.end()) {
<a name="l00637"></a>00637                 <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a> = <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a3b7f3ecc336a616ae87a286c6f5e4adf" title="A map of non-numeric speed descriptions to their numeric values.">mySpeedMap</a>[value];
<a name="l00638"></a>00638             } <span class="keywordflow">else</span> {
<a name="l00639"></a>00639                 <a class="code" href="../../db/d16/config_8h.html#a2481f526aef497857d2b407bc09129fd">SUMOReal</a> conversion = 1; <span class="comment">// OSM default is km/h</span>
<a name="l00640"></a>00640                 <span class="keywordflow">if</span> (<a class="code" href="../../d3/d93/class_string_utils.html#a74dfa2e904fea8b8217800b456cabd59" title="Transfers the content to lower case.">StringUtils::to_lower_case</a>(value).find(<span class="stringliteral">&quot;km/h&quot;</span>) != std::string::npos) {
<a name="l00641"></a>00641                     value = <a class="code" href="../../d3/d93/class_string_utils.html#a3262592c2a4ead46b92a6dad318a455c" title="Removes trailing and leading whitechars.">StringUtils::prune</a>(value.substr(0, value.find_first_not_of(<span class="stringliteral">&quot;0123456789&quot;</span>)));
<a name="l00642"></a>00642                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="../../d3/d93/class_string_utils.html#a74dfa2e904fea8b8217800b456cabd59" title="Transfers the content to lower case.">StringUtils::to_lower_case</a>(value).find(<span class="stringliteral">&quot;mph&quot;</span>) != std::string::npos) {
<a name="l00643"></a>00643                     value = <a class="code" href="../../d3/d93/class_string_utils.html#a3262592c2a4ead46b92a6dad318a455c" title="Removes trailing and leading whitechars.">StringUtils::prune</a>(value.substr(0, value.find_first_not_of(<span class="stringliteral">&quot;0123456789&quot;</span>)));
<a name="l00644"></a>00644                     conversion = 1.609344; <span class="comment">// kilometers per mile</span>
<a name="l00645"></a>00645                 }
<a name="l00646"></a>00646                 <span class="keywordflow">try</span> {
<a name="l00647"></a>00647                     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a4dc2acc29ecf5efecca218df82dba19f" title="maximum speed in km/h, or MAXSPEED_UNGIVEN">myMaxSpeed</a> = <a class="code" href="../../da/d64/class_tpl_convert.html">TplConvert&lt;char&gt;::_2SUMOReal</a>(value.c_str()) * conversion;
<a name="l00648"></a>00648                 } <span class="keywordflow">catch</span> (<a class="code" href="../../d7/ddc/class_number_format_exception.html">NumberFormatException</a>&amp;) {
<a name="l00649"></a>00649                     <a class="code" href="../../d4/df7/_msg_handler_8h.html#a6875e463bd2d24f027eba135e7a5fdfa">WRITE_WARNING</a>(<span class="stringliteral">&quot;Value of key &#39;&quot;</span> + key + <span class="stringliteral">&quot;&#39; is not numeric (&#39;&quot;</span> + value + <span class="stringliteral">&quot;&#39;) in edge &#39;&quot;</span> + <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a> + <span class="stringliteral">&quot;&#39;.&quot;</span>);
<a name="l00650"></a>00650                 }
<a name="l00651"></a>00651             }
<a name="l00652"></a>00652         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;junction&quot;</span>) {
<a name="l00653"></a>00653             <span class="keywordflow">if</span> ((value == <span class="stringliteral">&quot;roundabout&quot;</span>) &amp;&amp; (<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> == <span class="stringliteral">&quot;&quot;</span>)) {
<a name="l00654"></a>00654                 <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> = <span class="stringliteral">&quot;yes&quot;</span>;
<a name="l00655"></a>00655             }
<a name="l00656"></a>00656         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;oneway&quot;</span>) {
<a name="l00657"></a>00657             <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#afc791b998fad0303b02930c5c6e01da2" title="Information whether this is an one-way road.">myIsOneWay</a> = value;
<a name="l00658"></a>00658         } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (key == <span class="stringliteral">&quot;name&quot;</span>) {
<a name="l00659"></a>00659             <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#ad70f0b166a719f5a320a44277a7b1f63" title="The edge&amp;#39;s street name.">streetName</a> = value;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662 }
<a name="l00663"></a>00663 
<a name="l00664"></a>00664 
<a name="l00665"></a>00665 <span class="keywordtype">void</span>
<a name="l00666"></a><a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a8fe8cd4fbfe4e4f25e48c3da2b8c9b34">00666</a> <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a8fe8cd4fbfe4e4f25e48c3da2b8c9b34" title="Called when a closing tag occurs.">NIImporter_OpenStreetMap::EdgesHandler::myEndElement</a>(<span class="keywordtype">int</span> element) {
<a name="l00667"></a>00667     <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#aa83b7fc633e2b357ba2372fe4f9b9423" title="The element stack.">myParentElements</a>.pop_back();
<a name="l00668"></a>00668     <span class="keywordflow">if</span> (element == <a class="code" href="../../d6/d7a/_s_u_m_o_x_m_l_definitions_8h.html#a439d0801a24ff890eae919988363403ba93d0fd914aa49e664ff8e1080addbc94">SUMO_TAG_WAY</a>) {
<a name="l00669"></a>00669         <span class="keywordflow">if</span> (<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a> != 0 &amp;&amp; <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a3651acd0b83c94fba482c2a5da60cab4" title="Information whether this is a road.">myCurrentIsRoad</a>) {
<a name="l00670"></a>00670             <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#affc1bd3fafab8731c82bae2bae3d87f6" title="A map of built edges.">myEdgeMap</a>[<a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>-&gt;<a class="code" href="../../d9/d25/struct_n_i_importer___open_street_map_1_1_edge.html#a7d7af8b75b3cddaa92b7ca51e178b807" title="The edge&amp;#39;s id.">id</a>] = <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>;
<a name="l00671"></a>00671         } <span class="keywordflow">else</span> {
<a name="l00672"></a>00672             <span class="keyword">delete</span> <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a>;
<a name="l00673"></a>00673         }
<a name="l00674"></a>00674         <a class="code" href="../../db/dfe/class_n_i_importer___open_street_map_1_1_edges_handler.html#a0de891a17d95ca55ece212b778d317d2" title="The currently built edge.">myCurrentEdge</a> = 0;
<a name="l00675"></a>00675     }
<a name="l00676"></a>00676 }
<a name="l00677"></a>00677 
<a name="l00678"></a>00678 
<a name="l00679"></a>00679 
<a name="l00680"></a>00680 
<a name="l00681"></a>00681 <span class="comment">/****************************************************************************/</span>
<a name="l00682"></a>00682 
</pre></div></div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Tue Jul 17 12:16:06 2012 for SUMO - Simulation of Urban MObility by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
